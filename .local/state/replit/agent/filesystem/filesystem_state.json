{"file_contents":{"client/src/components/game/AvatarCustomizer.tsx":{"content":"import { useState } from 'react';\nimport { Button } from '../ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '../ui/card';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '../ui/dialog';\n\nexport interface PlayerAvatar {\n  color: string;\n  icon: string;\n}\n\nconst AVATAR_COLORS = [\n  { name: 'Red', value: '#EF4444', light: '#FEE2E2' },\n  { name: 'Blue', value: '#3B82F6', light: '#DBEAFE' },\n  { name: 'Green', value: '#10B981', light: '#D1FAE5' },\n  { name: 'Purple', value: '#8B5CF6', light: '#EDE9FE' },\n  { name: 'Orange', value: '#F97316', light: '#FFEDD5' },\n  { name: 'Pink', value: '#EC4899', light: '#FCE7F3' },\n  { name: 'Yellow', value: '#EAB308', light: '#FEF9C3' },\n  { name: 'Teal', value: '#14B8A6', light: '#CCFBF1' },\n];\n\nconst AVATAR_ICONS = [\n  'ðŸ‘¤', 'ðŸ˜€', 'ðŸ˜Ž', 'ðŸ¤ ', 'ðŸŽ®', 'ðŸŽ¯', 'ðŸŽ²', 'ðŸƒ',\n  'â­', 'ðŸ”¥', 'ðŸ’Ž', 'ðŸŽª', 'ðŸŽ¨', 'ðŸŽ­', 'ðŸ†', 'ðŸ‘‘',\n  'ðŸ¦Š', 'ðŸ¼', 'ðŸ¦', 'ðŸ¯', 'ðŸ»', 'ðŸ¸', 'ðŸ¦‰', 'ðŸ§',\n];\n\ninterface AvatarCustomizerProps {\n  open: boolean;\n  onClose: () => void;\n  currentAvatar: PlayerAvatar;\n  onSave: (avatar: PlayerAvatar) => void;\n}\n\nexport default function AvatarCustomizer({\n  open,\n  onClose,\n  currentAvatar,\n  onSave,\n}: AvatarCustomizerProps) {\n  const [selectedColor, setSelectedColor] = useState(currentAvatar.color);\n  const [selectedIcon, setSelectedIcon] = useState(currentAvatar.icon);\n\n  const handleSave = () => {\n    onSave({ color: selectedColor, icon: selectedIcon });\n    onClose();\n  };\n\n  const selectedColorData = AVATAR_COLORS.find(c => c.value === selectedColor) || AVATAR_COLORS[0];\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"sm:max-w-md bg-white\">\n        <DialogHeader>\n          <DialogTitle>Customize Your Avatar</DialogTitle>\n        </DialogHeader>\n        \n        <div className=\"space-y-6 py-4\">\n          {/* Preview */}\n          <div className=\"flex justify-center\">\n            <div \n              className=\"w-24 h-24 rounded-full flex items-center justify-center shadow-lg\"\n              style={{ \n                backgroundColor: selectedColorData.light,\n                border: `4px solid ${selectedColor}`\n              }}\n            >\n              <span className=\"text-4xl\">{selectedIcon}</span>\n            </div>\n          </div>\n\n          {/* Color Selection */}\n          <div className=\"space-y-3\">\n            <h3 className=\"font-semibold text-sm\">Choose Color:</h3>\n            <div className=\"grid grid-cols-4 gap-3\">\n              {AVATAR_COLORS.map((color) => (\n                <button\n                  key={color.value}\n                  onClick={() => setSelectedColor(color.value)}\n                  className={`h-12 rounded-lg transition-all ${\n                    selectedColor === color.value\n                      ? 'ring-4 ring-offset-2 ring-blue-500 scale-105'\n                      : 'hover:scale-105'\n                  }`}\n                  style={{ backgroundColor: color.value }}\n                  title={color.name}\n                />\n              ))}\n            </div>\n          </div>\n\n          {/* Icon Selection */}\n          <div className=\"space-y-3\">\n            <h3 className=\"font-semibold text-sm\">Choose Icon:</h3>\n            <div className=\"grid grid-cols-8 gap-2 max-h-48 overflow-y-auto p-2 bg-gray-50 rounded-lg\">\n              {AVATAR_ICONS.map((icon) => (\n                <button\n                  key={icon}\n                  onClick={() => setSelectedIcon(icon)}\n                  className={`h-12 w-12 flex items-center justify-center text-2xl rounded-lg transition-all ${\n                    selectedIcon === icon\n                      ? 'bg-blue-500 text-white scale-110'\n                      : 'bg-white hover:bg-gray-100 hover:scale-105'\n                  }`}\n                >\n                  {icon}\n                </button>\n              ))}\n            </div>\n          </div>\n\n          {/* Actions */}\n          <div className=\"flex gap-3 pt-2\">\n            <Button onClick={onClose} variant=\"outline\" className=\"flex-1\">\n              Cancel\n            </Button>\n            <Button onClick={handleSave} className=\"flex-1\">\n              Save Avatar\n            </Button>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n\n// Avatar display component for use throughout the app\ninterface AvatarProps {\n  avatar: PlayerAvatar;\n  size?: 'sm' | 'md' | 'lg';\n  showBorder?: boolean;\n}\n\nexport function Avatar({ avatar, size = 'md', showBorder = true }: AvatarProps) {\n  const colorData = AVATAR_COLORS.find(c => c.value === avatar.color) || AVATAR_COLORS[0];\n  \n  const sizeClasses = {\n    sm: 'w-8 h-8 text-lg',\n    md: 'w-12 h-12 text-2xl',\n    lg: 'w-16 h-16 text-3xl',\n  };\n\n  return (\n    <div\n      className={`${sizeClasses[size]} rounded-full flex items-center justify-center ${\n        showBorder ? 'border-2' : ''\n      }`}\n      style={{\n        backgroundColor: colorData.light,\n        borderColor: showBorder ? avatar.color : 'transparent',\n      }}\n    >\n      <span>{avatar.icon}</span>\n    </div>\n  );\n}\n","size_bytes":5119},"client/src/components/ui/card.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Card = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\n      \"rounded-xl border bg-card text-card-foreground shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nCard.displayName = \"Card\"\n\nconst CardHeader = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex flex-col space-y-1.5 p-6\", className)}\n    {...props}\n  />\n))\nCardHeader.displayName = \"CardHeader\"\n\nconst CardTitle = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"font-semibold leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nCardTitle.displayName = \"CardTitle\"\n\nconst CardDescription = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nCardDescription.displayName = \"CardDescription\"\n\nconst CardContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"p-6 pt-0\", className)} {...props} />\n))\nCardContent.displayName = \"CardContent\"\n\nconst CardFooter = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"flex items-center p-6 pt-0\", className)}\n    {...props}\n  />\n))\nCardFooter.displayName = \"CardFooter\"\n\nexport { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent }\n","size_bytes":1828},"client/src/components/ui/calendar.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight } from \"lucide-react\"\nimport { DayPicker } from \"react-day-picker\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nexport type CalendarProps = React.ComponentProps<typeof DayPicker>\n\nfunction Calendar({\n  className,\n  classNames,\n  showOutsideDays = true,\n  ...props\n}: CalendarProps) {\n  return (\n    <DayPicker\n      showOutsideDays={showOutsideDays}\n      className={cn(\"p-3\", className)}\n      classNames={{\n        months: \"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0\",\n        month: \"space-y-4\",\n        caption: \"flex justify-center pt-1 relative items-center\",\n        caption_label: \"text-sm font-medium\",\n        nav: \"space-x-1 flex items-center\",\n        nav_button: cn(\n          buttonVariants({ variant: \"outline\" }),\n          \"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100\"\n        ),\n        nav_button_previous: \"absolute left-1\",\n        nav_button_next: \"absolute right-1\",\n        table: \"w-full border-collapse space-y-1\",\n        head_row: \"flex\",\n        head_cell:\n          \"text-muted-foreground rounded-md w-8 font-normal text-[0.8rem]\",\n        row: \"flex w-full mt-2\",\n        cell: cn(\n          \"relative p-0 text-center text-sm focus-within:relative focus-within:z-20 [&:has([aria-selected])]:bg-accent [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected].day-range-end)]:rounded-r-md\",\n          props.mode === \"range\"\n            ? \"[&:has(>.day-range-end)]:rounded-r-md [&:has(>.day-range-start)]:rounded-l-md first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md\"\n            : \"[&:has([aria-selected])]:rounded-md\"\n        ),\n        day: cn(\n          buttonVariants({ variant: \"ghost\" }),\n          \"h-8 w-8 p-0 font-normal aria-selected:opacity-100\"\n        ),\n        day_range_start: \"day-range-start\",\n        day_range_end: \"day-range-end\",\n        day_selected:\n          \"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground\",\n        day_today: \"bg-accent text-accent-foreground\",\n        day_outside:\n          \"day-outside text-muted-foreground aria-selected:bg-accent/50 aria-selected:text-muted-foreground\",\n        day_disabled: \"text-muted-foreground opacity-50\",\n        day_range_middle:\n          \"aria-selected:bg-accent aria-selected:text-accent-foreground\",\n        day_hidden: \"invisible\",\n        ...classNames,\n      }}\n      components={{\n        IconLeft: ({ className, ...props }) => (\n          <ChevronLeft className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n        IconRight: ({ className, ...props }) => (\n          <ChevronRight className={cn(\"h-4 w-4\", className)} {...props} />\n        ),\n      }}\n      {...props}\n    />\n  )\n}\nCalendar.displayName = \"Calendar\"\n\nexport { Calendar }\n","size_bytes":2935},"client/src/lib/stores/useAudio.tsx":{"content":"import { create } from \"zustand\";\n\ninterface AudioState {\n  backgroundMusic: HTMLAudioElement | null;\n  hitSound: HTMLAudioElement | null;\n  successSound: HTMLAudioElement | null;\n  isMuted: boolean;\n  \n  // Setter functions\n  setBackgroundMusic: (music: HTMLAudioElement) => void;\n  setHitSound: (sound: HTMLAudioElement) => void;\n  setSuccessSound: (sound: HTMLAudioElement) => void;\n  \n  // Control functions\n  toggleMute: () => void;\n  playHit: () => void;\n  playSuccess: () => void;\n}\n\nexport const useAudio = create<AudioState>((set, get) => ({\n  backgroundMusic: null,\n  hitSound: null,\n  successSound: null,\n  isMuted: true, // Start muted by default\n  \n  setBackgroundMusic: (music) => set({ backgroundMusic: music }),\n  setHitSound: (sound) => set({ hitSound: sound }),\n  setSuccessSound: (sound) => set({ successSound: sound }),\n  \n  toggleMute: () => {\n    const { isMuted } = get();\n    const newMutedState = !isMuted;\n    \n    // Just update the muted state\n    set({ isMuted: newMutedState });\n    \n    // Log the change\n    console.log(`Sound ${newMutedState ? 'muted' : 'unmuted'}`);\n  },\n  \n  playHit: () => {\n    const { hitSound, isMuted } = get();\n    if (hitSound) {\n      // If sound is muted, don't play anything\n      if (isMuted) {\n        console.log(\"Hit sound skipped (muted)\");\n        return;\n      }\n      \n      // Clone the sound to allow overlapping playback\n      const soundClone = hitSound.cloneNode() as HTMLAudioElement;\n      soundClone.volume = 0.3;\n      soundClone.play().catch(error => {\n        console.log(\"Hit sound play prevented:\", error);\n      });\n    }\n  },\n  \n  playSuccess: () => {\n    const { successSound, isMuted } = get();\n    if (successSound) {\n      // If sound is muted, don't play anything\n      if (isMuted) {\n        console.log(\"Success sound skipped (muted)\");\n        return;\n      }\n      \n      successSound.currentTime = 0;\n      successSound.play().catch(error => {\n        console.log(\"Success sound play prevented:\", error);\n      });\n    }\n  }\n}));\n","size_bytes":2025},"client/src/components/ui/pagination.tsx":{"content":"import * as React from \"react\"\nimport { ChevronLeft, ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { ButtonProps, buttonVariants } from \"@/components/ui/button\"\n\nconst Pagination = ({ className, ...props }: React.ComponentProps<\"nav\">) => (\n  <nav\n    role=\"navigation\"\n    aria-label=\"pagination\"\n    className={cn(\"mx-auto flex w-full justify-center\", className)}\n    {...props}\n  />\n)\nPagination.displayName = \"Pagination\"\n\nconst PaginationContent = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    className={cn(\"flex flex-row items-center gap-1\", className)}\n    {...props}\n  />\n))\nPaginationContent.displayName = \"PaginationContent\"\n\nconst PaginationItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li ref={ref} className={cn(\"\", className)} {...props} />\n))\nPaginationItem.displayName = \"PaginationItem\"\n\ntype PaginationLinkProps = {\n  isActive?: boolean\n} & Pick<ButtonProps, \"size\"> &\n  React.ComponentProps<\"a\">\n\nconst PaginationLink = ({\n  className,\n  isActive,\n  size = \"icon\",\n  ...props\n}: PaginationLinkProps) => (\n  <a\n    aria-current={isActive ? \"page\" : undefined}\n    className={cn(\n      buttonVariants({\n        variant: isActive ? \"outline\" : \"ghost\",\n        size,\n      }),\n      className\n    )}\n    {...props}\n  />\n)\nPaginationLink.displayName = \"PaginationLink\"\n\nconst PaginationPrevious = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to previous page\"\n    size=\"default\"\n    className={cn(\"gap-1 pl-2.5\", className)}\n    {...props}\n  >\n    <ChevronLeft className=\"h-4 w-4\" />\n    <span>Previous</span>\n  </PaginationLink>\n)\nPaginationPrevious.displayName = \"PaginationPrevious\"\n\nconst PaginationNext = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof PaginationLink>) => (\n  <PaginationLink\n    aria-label=\"Go to next page\"\n    size=\"default\"\n    className={cn(\"gap-1 pr-2.5\", className)}\n    {...props}\n  >\n    <span>Next</span>\n    <ChevronRight className=\"h-4 w-4\" />\n  </PaginationLink>\n)\nPaginationNext.displayName = \"PaginationNext\"\n\nconst PaginationEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    aria-hidden\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More pages</span>\n  </span>\n)\nPaginationEllipsis.displayName = \"PaginationEllipsis\"\n\nexport {\n  Pagination,\n  PaginationContent,\n  PaginationLink,\n  PaginationItem,\n  PaginationPrevious,\n  PaginationNext,\n  PaginationEllipsis,\n}\n","size_bytes":2751},"client/src/hooks/use-is-mobile.tsx":{"content":"import * as React from \"react\"\n\nconst MOBILE_BREAKPOINT = 768\n\nexport function useIsMobile() {\n  const [isMobile, setIsMobile] = React.useState<boolean | undefined>(undefined)\n\n  React.useEffect(() => {\n    const mql = window.matchMedia(`(max-width: ${MOBILE_BREAKPOINT - 1}px)`)\n    const onChange = () => {\n      setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    }\n    mql.addEventListener(\"change\", onChange)\n    setIsMobile(window.innerWidth < MOBILE_BREAKPOINT)\n    return () => mql.removeEventListener(\"change\", onChange)\n  }, [])\n\n  return !!isMobile\n}\n","size_bytes":565},"client/src/lib/game/gameLogic.ts":{"content":"import { Card } from './cardUtils';\n\nexport type AIDifficulty = 'easy' | 'medium' | 'hard';\n\nexport interface PlayerAvatar {\n  color: string;\n  icon: string;\n}\n\nexport interface Player {\n  id: string;\n  name: string;\n  hand: Card[];\n  isActive: boolean;\n  consecutiveSits: number;\n  isAI: boolean;\n  aiDifficulty?: AIDifficulty;\n  avatar?: PlayerAvatar;\n  wallet?: number;\n  punts?: number; // Track total punts across game\n  isConnected?: boolean; // Track if player is connected in multiplayer\n}\n\nexport type GamePhase = 'setup' | 'bidding' | 'trump_selection' | 'sit_pass' | 'everyone_sat' | 'hand_play' | 'trick_complete' | 'round_complete' | 'game_over';\n\nexport interface RoundHistory {\n  round: number;\n  bids: Map<string, number>;\n  trumpSuit: string | null;\n  highestBidder: string | null;\n  playingPlayers: string[];\n  tricksWon: Map<string, number>;\n  scoreChanges: Map<string, number>;\n  finalScores: Map<string, number>;\n  punts?: Map<string, number>; // Track who punted this round\n  moneyChanges?: Map<string, number>;\n  finalWallets?: Map<string, number>;\n}\n\nexport interface GameState {\n  gamePhase: GamePhase;\n  players: Player[];\n  eliminatedPlayers: Player[]; // Players removed from game (score > 32) but tracked for final scoreboard\n  currentPlayerIndex: number;\n  dealerIndex: number;\n  deck: Card[];\n  currentTrick: { playerId: string; card: Card }[];\n  completedTricks: { playerId: string; card: Card }[][];\n  bids: Map<string, number>;\n  trumpSuit: string | null;\n  highestBidder: string | null;\n  playingPlayers: Set<string>;\n  mustyPlayers: Set<string>;\n  scores: Map<string, number>;\n  round: number;\n  history: RoundHistory[];\n  lastTrickWinner: string | null;\n}\n\nexport function calculateScore(\n  playerId: string,\n  bid: number,\n  tricksWon: number,\n  currentScore: number\n): number {\n  if (bid === 0) {\n    // Punt: +5 if no tricks, -1 per trick if any\n    return currentScore + (tricksWon === 0 ? 5 : -tricksWon);\n  } else {\n    // Regular bid: -1 per trick won\n    return currentScore - tricksWon;\n  }\n}\n\nexport function calculateGameEndPayout(\n  players: Player[],\n  scores: Map<string, number>,\n  moneyPerPoint: number = 0.25,\n  moneyPerPunt: number = 1.0\n): Map<string, number> {\n  // Money changes at game end: configurable per point + per punt\n  const moneyChanges = new Map<string, number>();\n  \n  // Find the winner (score <= 0)\n  const winner = players.find(p => (scores.get(p.id) || 16) <= 0);\n  if (!winner) return moneyChanges;\n  \n  let totalPayout = 0;\n  \n  // Calculate what each loser pays\n  players.forEach(player => {\n    if (player.id !== winner.id) {\n      const finalScore = scores.get(player.id) || 16;\n      const punts = player.punts || 0;\n      const amountOwed = (finalScore * moneyPerPoint) + (punts * moneyPerPunt);\n      moneyChanges.set(player.id, -amountOwed);\n      totalPayout += amountOwed;\n    }\n  });\n  \n  // Winner receives total payout\n  moneyChanges.set(winner.id, totalPayout);\n  \n  return moneyChanges;\n}\n\nexport function isPlayerEliminated(score: number, eliminationScore: number = 32): boolean {\n  return score > eliminationScore;\n}\n\nexport function hasPlayerWon(score: number, winningScore: number = 0): boolean {\n  return score <= winningScore;\n}\n\nexport function getNextActivePlayer(\n  currentIndex: number,\n  players: Player[],\n  playingPlayers?: Set<string>\n): number {\n  let nextIndex = (currentIndex + 1) % players.length;\n  \n  while (\n    nextIndex !== currentIndex && \n    (!players[nextIndex].isActive || \n     (playingPlayers && !playingPlayers.has(players[nextIndex].id)))\n  ) {\n    nextIndex = (nextIndex + 1) % players.length;\n  }\n  \n  return nextIndex;\n}\n\nexport function canPlayerSit(player: Player, bid: number, trumpSuit: string | null): boolean {\n  // Cannot sit if bid is 1\n  if (bid === 1) return false;\n  \n  // Cannot sit if trump is spades\n  if (trumpSuit === 'spades') return false;\n  \n  // Cannot sit if already musty (2 consecutive sits)\n  if (player.consecutiveSits >= 2) return false;\n  \n  return true;\n}\n\nexport function validateBid(bid: number, currentHighestBid: number, isDealer: boolean): boolean {\n  // Bid must be 0 (pass) or between 1-5\n  if (bid < 0 || bid > 5) return false;\n  \n  // If someone has already bid 2+, must bid higher or pass\n  if (currentHighestBid >= 2 && bid !== 0 && bid <= currentHighestBid) {\n    return false;\n  }\n  \n  // Dealer gets last chance to bid higher\n  if (isDealer && bid !== 0 && bid <= currentHighestBid) {\n    return false;\n  }\n  \n  return true;\n}\n","size_bytes":4494},"client/src/components/ui/navigation-menu.tsx":{"content":"import * as React from \"react\"\nimport * as NavigationMenuPrimitive from \"@radix-ui/react-navigation-menu\"\nimport { cva } from \"class-variance-authority\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst NavigationMenu = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative z-10 flex max-w-max flex-1 items-center justify-center\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <NavigationMenuViewport />\n  </NavigationMenuPrimitive.Root>\n))\nNavigationMenu.displayName = NavigationMenuPrimitive.Root.displayName\n\nconst NavigationMenuList = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.List\n    ref={ref}\n    className={cn(\n      \"group flex flex-1 list-none items-center justify-center space-x-1\",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuList.displayName = NavigationMenuPrimitive.List.displayName\n\nconst NavigationMenuItem = NavigationMenuPrimitive.Item\n\nconst navigationMenuTriggerStyle = cva(\n  \"group inline-flex h-9 w-max items-center justify-center rounded-md bg-background px-4 py-2 text-sm font-medium transition-colors hover:bg-accent hover:text-accent-foreground focus:bg-accent focus:text-accent-foreground focus:outline-none disabled:pointer-events-none disabled:opacity-50 data-[state=open]:text-accent-foreground data-[state=open]:bg-accent/50 data-[state=open]:hover:bg-accent data-[state=open]:focus:bg-accent\"\n)\n\nconst NavigationMenuTrigger = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <NavigationMenuPrimitive.Trigger\n    ref={ref}\n    className={cn(navigationMenuTriggerStyle(), \"group\", className)}\n    {...props}\n  >\n    {children}{\" \"}\n    <ChevronDown\n      className=\"relative top-[1px] ml-1 h-3 w-3 transition duration-300 group-data-[state=open]:rotate-180\"\n      aria-hidden=\"true\"\n    />\n  </NavigationMenuPrimitive.Trigger>\n))\nNavigationMenuTrigger.displayName = NavigationMenuPrimitive.Trigger.displayName\n\nconst NavigationMenuContent = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"left-0 top-0 w-full data-[motion^=from-]:animate-in data-[motion^=to-]:animate-out data-[motion^=from-]:fade-in data-[motion^=to-]:fade-out data-[motion=from-end]:slide-in-from-right-52 data-[motion=from-start]:slide-in-from-left-52 data-[motion=to-end]:slide-out-to-right-52 data-[motion=to-start]:slide-out-to-left-52 md:absolute md:w-auto \",\n      className\n    )}\n    {...props}\n  />\n))\nNavigationMenuContent.displayName = NavigationMenuPrimitive.Content.displayName\n\nconst NavigationMenuLink = NavigationMenuPrimitive.Link\n\nconst NavigationMenuViewport = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Viewport>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Viewport>\n>(({ className, ...props }, ref) => (\n  <div className={cn(\"absolute left-0 top-full flex justify-center\")}>\n    <NavigationMenuPrimitive.Viewport\n      className={cn(\n        \"origin-top-center relative mt-1.5 h-[var(--radix-navigation-menu-viewport-height)] w-full overflow-hidden rounded-md border bg-popover text-popover-foreground shadow data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-90 md:w-[var(--radix-navigation-menu-viewport-width)]\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  </div>\n))\nNavigationMenuViewport.displayName =\n  NavigationMenuPrimitive.Viewport.displayName\n\nconst NavigationMenuIndicator = React.forwardRef<\n  React.ElementRef<typeof NavigationMenuPrimitive.Indicator>,\n  React.ComponentPropsWithoutRef<typeof NavigationMenuPrimitive.Indicator>\n>(({ className, ...props }, ref) => (\n  <NavigationMenuPrimitive.Indicator\n    ref={ref}\n    className={cn(\n      \"top-full z-[1] flex h-1.5 items-end justify-center overflow-hidden data-[state=visible]:animate-in data-[state=hidden]:animate-out data-[state=hidden]:fade-out data-[state=visible]:fade-in\",\n      className\n    )}\n    {...props}\n  >\n    <div className=\"relative top-[60%] h-2 w-2 rotate-45 rounded-tl-sm bg-border shadow-md\" />\n  </NavigationMenuPrimitive.Indicator>\n))\nNavigationMenuIndicator.displayName =\n  NavigationMenuPrimitive.Indicator.displayName\n\nexport {\n  navigationMenuTriggerStyle,\n  NavigationMenu,\n  NavigationMenuList,\n  NavigationMenuItem,\n  NavigationMenuContent,\n  NavigationMenuTrigger,\n  NavigationMenuLink,\n  NavigationMenuIndicator,\n  NavigationMenuViewport,\n}\n","size_bytes":5124},"client/src/components/ui/dialog.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as DialogPrimitive from \"@radix-ui/react-dialog\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Dialog = DialogPrimitive.Root\n\nconst DialogTrigger = DialogPrimitive.Trigger\n\nconst DialogPortal = DialogPrimitive.Portal\n\nconst DialogClose = DialogPrimitive.Close\n\nconst DialogOverlay = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Overlay\n    ref={ref}\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogOverlay.displayName = DialogPrimitive.Overlay.displayName\n\nconst DialogContent = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DialogPortal>\n    <DialogOverlay />\n    <DialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <DialogPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </DialogPrimitive.Close>\n    </DialogPrimitive.Content>\n  </DialogPortal>\n))\nDialogContent.displayName = DialogPrimitive.Content.displayName\n\nconst DialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-1.5 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogHeader.displayName = \"DialogHeader\"\n\nconst DialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nDialogFooter.displayName = \"DialogFooter\"\n\nconst DialogTitle = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDialogTitle.displayName = DialogPrimitive.Title.displayName\n\nconst DialogDescription = React.forwardRef<\n  React.ElementRef<typeof DialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDialogDescription.displayName = DialogPrimitive.Description.displayName\n\nexport {\n  Dialog,\n  DialogPortal,\n  DialogOverlay,\n  DialogTrigger,\n  DialogClose,\n  DialogContent,\n  DialogHeader,\n  DialogFooter,\n  DialogTitle,\n  DialogDescription,\n}\n","size_bytes":3849},"client/src/components/ui/menubar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as MenubarPrimitive from \"@radix-ui/react-menubar\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nfunction MenubarMenu({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Menu>) {\n  return <MenubarPrimitive.Menu {...props} />\n}\n\nfunction MenubarGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Group>) {\n  return <MenubarPrimitive.Group {...props} />\n}\n\nfunction MenubarPortal({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Portal>) {\n  return <MenubarPrimitive.Portal {...props} />\n}\n\nfunction MenubarRadioGroup({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.RadioGroup>) {\n  return <MenubarPrimitive.RadioGroup {...props} />\n}\n\nfunction MenubarSub({\n  ...props\n}: React.ComponentProps<typeof MenubarPrimitive.Sub>) {\n  return <MenubarPrimitive.Sub data-slot=\"menubar-sub\" {...props} />\n}\n\nconst Menubar = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"flex h-9 items-center space-x-1 rounded-md border bg-background p-1 shadow-sm\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubar.displayName = MenubarPrimitive.Root.displayName\n\nconst MenubarTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-3 py-1 text-sm font-medium outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarTrigger.displayName = MenubarPrimitive.Trigger.displayName\n\nconst MenubarSubTrigger = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <MenubarPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </MenubarPrimitive.SubTrigger>\n))\nMenubarSubTrigger.displayName = MenubarPrimitive.SubTrigger.displayName\n\nconst MenubarSubContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarSubContent.displayName = MenubarPrimitive.SubContent.displayName\n\nconst MenubarContent = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Content>\n>(\n  (\n    { className, align = \"start\", alignOffset = -4, sideOffset = 8, ...props },\n    ref\n  ) => (\n    <MenubarPrimitive.Portal>\n      <MenubarPrimitive.Content\n        ref={ref}\n        align={align}\n        alignOffset={alignOffset}\n        sideOffset={sideOffset}\n        className={cn(\n          \"z-50 min-w-[12rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n          className\n        )}\n        {...props}\n      />\n    </MenubarPrimitive.Portal>\n  )\n)\nMenubarContent.displayName = MenubarPrimitive.Content.displayName\n\nconst MenubarItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarItem.displayName = MenubarPrimitive.Item.displayName\n\nconst MenubarCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <MenubarPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.CheckboxItem>\n))\nMenubarCheckboxItem.displayName = MenubarPrimitive.CheckboxItem.displayName\n\nconst MenubarRadioItem = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <MenubarPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <MenubarPrimitive.ItemIndicator>\n        <Circle className=\"h-4 w-4 fill-current\" />\n      </MenubarPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </MenubarPrimitive.RadioItem>\n))\nMenubarRadioItem.displayName = MenubarPrimitive.RadioItem.displayName\n\nconst MenubarLabel = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <MenubarPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nMenubarLabel.displayName = MenubarPrimitive.Label.displayName\n\nconst MenubarSeparator = React.forwardRef<\n  React.ElementRef<typeof MenubarPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof MenubarPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <MenubarPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nMenubarSeparator.displayName = MenubarPrimitive.Separator.displayName\n\nconst MenubarShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nMenubarShortcut.displayname = \"MenubarShortcut\"\n\nexport {\n  Menubar,\n  MenubarMenu,\n  MenubarTrigger,\n  MenubarContent,\n  MenubarItem,\n  MenubarSeparator,\n  MenubarLabel,\n  MenubarCheckboxItem,\n  MenubarRadioGroup,\n  MenubarRadioItem,\n  MenubarPortal,\n  MenubarSubContent,\n  MenubarSubTrigger,\n  MenubarGroup,\n  MenubarSub,\n  MenubarShortcut,\n}\n","size_bytes":8522},"client/src/components/ui/accordion.tsx":{"content":"import * as React from \"react\"\nimport * as AccordionPrimitive from \"@radix-ui/react-accordion\"\nimport { ChevronDown } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Accordion = AccordionPrimitive.Root\n\nconst AccordionItem = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <AccordionPrimitive.Item\n    ref={ref}\n    className={cn(\"border-b\", className)}\n    {...props}\n  />\n))\nAccordionItem.displayName = \"AccordionItem\"\n\nconst AccordionTrigger = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Header className=\"flex\">\n    <AccordionPrimitive.Trigger\n      ref={ref}\n      className={cn(\n        \"flex flex-1 items-center justify-between py-4 text-sm font-medium transition-all hover:underline text-left [&[data-state=open]>svg]:rotate-180\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4 shrink-0 text-muted-foreground transition-transform duration-200\" />\n    </AccordionPrimitive.Trigger>\n  </AccordionPrimitive.Header>\n))\nAccordionTrigger.displayName = AccordionPrimitive.Trigger.displayName\n\nconst AccordionContent = React.forwardRef<\n  React.ElementRef<typeof AccordionPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AccordionPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <AccordionPrimitive.Content\n    ref={ref}\n    className=\"overflow-hidden text-sm data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down\"\n    {...props}\n  >\n    <div className={cn(\"pb-4 pt-0\", className)}>{children}</div>\n  </AccordionPrimitive.Content>\n))\nAccordionContent.displayName = AccordionPrimitive.Content.displayName\n\nexport { Accordion, AccordionItem, AccordionTrigger, AccordionContent }\n","size_bytes":2001},"client/src/components/ui/popover.tsx":{"content":"import * as React from \"react\"\nimport * as PopoverPrimitive from \"@radix-ui/react-popover\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Popover = PopoverPrimitive.Root\n\nconst PopoverTrigger = PopoverPrimitive.Trigger\n\nconst PopoverAnchor = PopoverPrimitive.Anchor\n\nconst PopoverContent = React.forwardRef<\n  React.ElementRef<typeof PopoverPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <PopoverPrimitive.Portal>\n    <PopoverPrimitive.Content\n      ref={ref}\n      align={align}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </PopoverPrimitive.Portal>\n))\nPopoverContent.displayName = PopoverPrimitive.Content.displayName\n\nexport { Popover, PopoverTrigger, PopoverContent, PopoverAnchor }\n","size_bytes":1292},"client/src/components/ui/resizable.tsx":{"content":"\"use client\"\n\nimport { GripVertical } from \"lucide-react\"\nimport * as ResizablePrimitive from \"react-resizable-panels\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ResizablePanelGroup = ({\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelGroup>) => (\n  <ResizablePrimitive.PanelGroup\n    className={cn(\n      \"flex h-full w-full data-[panel-group-direction=vertical]:flex-col\",\n      className\n    )}\n    {...props}\n  />\n)\n\nconst ResizablePanel = ResizablePrimitive.Panel\n\nconst ResizableHandle = ({\n  withHandle,\n  className,\n  ...props\n}: React.ComponentProps<typeof ResizablePrimitive.PanelResizeHandle> & {\n  withHandle?: boolean\n}) => (\n  <ResizablePrimitive.PanelResizeHandle\n    className={cn(\n      \"relative flex w-px items-center justify-center bg-border after:absolute after:inset-y-0 after:left-1/2 after:w-1 after:-translate-x-1/2 focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring focus-visible:ring-offset-1 data-[panel-group-direction=vertical]:h-px data-[panel-group-direction=vertical]:w-full data-[panel-group-direction=vertical]:after:left-0 data-[panel-group-direction=vertical]:after:h-1 data-[panel-group-direction=vertical]:after:w-full data-[panel-group-direction=vertical]:after:-translate-y-1/2 data-[panel-group-direction=vertical]:after:translate-x-0 [&[data-panel-group-direction=vertical]>div]:rotate-90\",\n      className\n    )}\n    {...props}\n  >\n    {withHandle && (\n      <div className=\"z-10 flex h-4 w-3 items-center justify-center rounded-sm border bg-border\">\n        <GripVertical className=\"h-2.5 w-2.5\" />\n      </div>\n    )}\n  </ResizablePrimitive.PanelResizeHandle>\n)\n\nexport { ResizablePanelGroup, ResizablePanel, ResizableHandle }\n","size_bytes":1723},"client/src/lib/hooks/useMultiplayer.ts":{"content":"import { useEffect, useRef, useState } from 'react';\nimport { useShnarps } from '../stores/useShnarps';\n\nexport type MultiplayerMode = 'local' | 'online';\n\nexport function useMultiplayer() {\n  const [isConnected, setIsConnected] = useState(false);\n  const reconnectAttempts = useRef(0);\n  const maxReconnectAttempts = 5;\n  const reconnectTimeoutRef = useRef<NodeJS.Timeout>();\n  \n  // Get mode, roomCode, isHost, and websocket from Zustand store\n  const { \n    multiplayerMode: mode, \n    multiplayerRoomCode: roomCode, \n    isMultiplayerHost: isHost,\n    websocket,\n    localPlayerId,\n    setMultiplayerMode,\n    setWebSocket \n  } = useShnarps();\n\n  const attemptReconnect = (existingRoomCode: string) => {\n    const store = useShnarps.getState();\n    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n    const wsUrl = `${protocol}//${window.location.host}/ws`;\n    console.log('Attempting to reconnect to WebSocket:', wsUrl);\n    \n    const ws = new WebSocket(wsUrl);\n\n    ws.onopen = () => {\n      console.log('WebSocket reconnected! Rejoining room:', existingRoomCode);\n      setIsConnected(true);\n      reconnectAttempts.current = 0; // Reset counter on successful reconnect\n      \n      // Rejoin the existing room\n      ws.send(JSON.stringify({\n        type: 'REJOIN_ROOM',\n        roomId: existingRoomCode,\n        playerId: store.localPlayerId\n      }));\n    };\n\n    ws.onmessage = (event) => {\n      const message = JSON.parse(event.data);\n      handleServerMessage(message);\n    };\n\n    ws.onclose = (event) => {\n      console.log('WebSocket closed during reconnect attempt', event.code);\n      setIsConnected(false);\n      \n      // Try again if we haven't hit max attempts\n      if (reconnectAttempts.current < maxReconnectAttempts && event.code !== 1000) {\n        reconnectAttempts.current++;\n        const delay = Math.min(1000 * Math.pow(2, reconnectAttempts.current - 1), 10000);\n        console.log(`Reconnect attempt failed. Retrying ${reconnectAttempts.current}/${maxReconnectAttempts} in ${delay}ms...`);\n        \n        reconnectTimeoutRef.current = setTimeout(() => {\n          attemptReconnect(existingRoomCode);\n        }, delay);\n      } else {\n        console.log('Max reconnect attempts reached or connection closed normally');\n        setMultiplayerMode('local', null, false);\n        store.initializeGame();\n      }\n    };\n\n    ws.onerror = (error) => {\n      console.error('WebSocket error during reconnect:', error);\n      setIsConnected(false);\n    };\n\n    setWebSocket(ws);\n  };\n\n  const connectToRoom = (playerName: string, existingRoomCode?: string, spectatorMode: boolean = false) => {\n    reconnectAttempts.current = 0; // Reset reconnect counter for fresh connection\n    const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';\n    const wsUrl = `${protocol}//${window.location.host}/ws`;\n    console.log('Connecting to WebSocket:', wsUrl, 'spectatorMode:', spectatorMode);\n    \n    const ws = new WebSocket(wsUrl);\n\n    ws.onopen = () => {\n      console.log('WebSocket connected');\n      setIsConnected(true);\n      \n      if (existingRoomCode) {\n        console.log('Joining room:', existingRoomCode);\n        ws.send(JSON.stringify({\n          type: 'JOIN_ROOM',\n          roomId: existingRoomCode,\n          playerName\n        }));\n      } else {\n        console.log('Creating new room, spectatorMode:', spectatorMode);\n        ws.send(JSON.stringify({\n          type: 'CREATE_ROOM',\n          playerName: spectatorMode ? '' : playerName, // Empty name for spectator\n          spectatorMode\n        }));\n        // Mode will be set to 'online' when we receive ROOM_CREATED message\n      }\n    };\n\n    ws.onmessage = (event) => {\n      console.log('WebSocket message received:', event.data);\n      const message = JSON.parse(event.data);\n      handleServerMessage(message);\n    };\n\n    ws.onclose = (event) => {\n      console.log('WebSocket closed', event.code, event.reason);\n      setIsConnected(false);\n      \n      // Only auto-reconnect if:\n      // 1. We're in online mode (not a user-initiated disconnect)\n      // 2. We have a room code (we were in a game)\n      // 3. We haven't exceeded max reconnect attempts\n      // 4. The close wasn't a normal close (code 1000) or server-initiated close\n      const store = useShnarps.getState();\n      const shouldReconnect = \n        store.multiplayerMode === 'online' && \n        store.multiplayerRoomCode && \n        reconnectAttempts.current < maxReconnectAttempts &&\n        event.code !== 1000; // 1000 = normal closure\n      \n      if (shouldReconnect) {\n        reconnectAttempts.current++;\n        const delay = Math.min(1000 * Math.pow(2, reconnectAttempts.current - 1), 10000); // Exponential backoff, max 10s\n        console.log(`Attempting reconnect ${reconnectAttempts.current}/${maxReconnectAttempts} in ${delay}ms...`);\n        \n        reconnectTimeoutRef.current = setTimeout(() => {\n          attemptReconnect(store.multiplayerRoomCode!);\n        }, delay);\n      } else if (event.code !== 1000 && reconnectAttempts.current >= maxReconnectAttempts) {\n        // Only reset to menu if we've exhausted all reconnection attempts\n        console.log('Max reconnect attempts exhausted - returning to menu');\n        setMultiplayerMode('local', null, false);\n        store.initializeGame();\n      }\n      // Note: If event.code === 1000 (normal close), we don't reset to menu\n      // The user explicitly disconnected via the disconnect() function\n    };\n\n    ws.onerror = (error) => {\n      console.error('WebSocket error:', error);\n      setIsConnected(false);\n    };\n\n    setWebSocket(ws);\n    // Note: Don't set mode to 'online' here - wait for ROOM_CREATED/JOINED_ROOM message\n  };\n\n  const handleServerMessage = (message: any) => {\n    const store = useShnarps.getState();\n    console.log('Handling server message:', message.type, message);\n\n    try {\n    switch (message.type) {\n      case 'ROOM_CREATED':\n        console.log('Room created:', message.roomId);\n        store.setMultiplayerMode('online', message.roomId, true);\n        store.setMultiplayerState(message.players, message.gameState, message.localPlayerId);\n        break;\n\n      case 'JOINED_ROOM':\n        console.log('Joined room:', message.roomId);\n        store.setMultiplayerMode('online', message.roomId, false);\n        store.setMultiplayerState(message.players, message.gameState, message.localPlayerId);\n        break;\n\n      case 'PLAYER_JOINED':\n        console.log('Player joined:', message.player.name);\n        store.addRemotePlayer(message.player);\n        break;\n\n      case 'PLAYER_LEFT':\n        console.log('Player left:', message.playerId);\n        store.removePlayer(message.playerId);\n        break;\n\n      case 'HOST_TRANSFERRED':\n        console.log('Host transferred to:', message.newHostId);\n        const isNewHost = message.newHostId === store.localPlayerId;\n        store.setMultiplayerMode('online', store.multiplayerRoomCode, isNewHost);\n        // Also remove the player who left\n        if (message.leftPlayerId) {\n          store.removePlayer(message.leftPlayerId);\n        }\n        break;\n\n      case 'ROOM_CLOSED':\n        console.log('Room closed:', message.reason);\n        alert(`Game ended: ${message.reason}`);\n        setIsConnected(false);\n        store.setMultiplayerMode('local', null, false);\n        store.initializeGame();\n        break;\n\n      case 'PLAYER_DISCONNECTED':\n        console.log('Player disconnected:', message.playerName);\n        // Store will handle marking player as disconnected\n        const disconnectedPlayer = store.players.find(p => p.id === message.playerId);\n        if (disconnectedPlayer) {\n          disconnectedPlayer.isConnected = false;\n        }\n        break;\n\n      case 'PLAYER_RECONNECTED':\n        console.log('Player reconnected:', message.playerName);\n        const reconnectedPlayer = store.players.find(p => p.id === message.playerId);\n        if (reconnectedPlayer) {\n          reconnectedPlayer.isConnected = true;\n        }\n        break;\n\n      case 'REJOINED_ROOM':\n        console.log('Rejoined room:', message.roomId);\n        store.setMultiplayerMode('online', message.roomId, message.isHost);\n        store.setMultiplayerState(message.players, message.gameState, message.localPlayerId);\n        setIsConnected(true);\n        break;\n\n      case 'TURN_TIMER_START':\n        console.log('Turn timer started:', message.timeLimit);\n        store.setTurnTimer(message.timeLimit);\n        break;\n\n      case 'GAME_STATE_SYNC':\n        console.log('Game state sync');\n        store.setMultiplayerState(message.players, message.gameState, message.localPlayerId || store.localPlayerId);\n        break;\n\n      case 'GAME_STATE_UPDATE':\n        console.log('Game state update:', message.action);\n        store.applyGameAction(message.action, message.payload);\n        break;\n\n      case 'GAME_STARTED':\n        console.log('Game started');\n        // Update both players (with hands) and game state\n        store.setMultiplayerState(message.players, message.gameState, message.localPlayerId || store.localPlayerId);\n        break;\n\n      case 'ERROR':\n        console.error('Server error:', message.message);\n        alert(message.message);\n        break;\n        \n      default:\n        console.warn('Unknown message type:', message.type);\n    }\n    } catch (error) {\n      console.error('Error handling server message:', error, message);\n      // Don't reset to menu on message handling errors - just log them\n    }\n  };\n\n  const sendAction = (action: string, payload: any) => {\n    if (websocket && websocket.readyState === WebSocket.OPEN) {\n      websocket.send(JSON.stringify({\n        type: 'GAME_ACTION',\n        action,\n        payload\n      }));\n    }\n  };\n\n  const addAIPlayer = (aiName: string, difficulty: 'easy' | 'medium' | 'hard') => {\n    console.log('addAIPlayer called:', { aiName, difficulty, hasWs: !!websocket, wsState: websocket?.readyState, isHost });\n    if (websocket && websocket.readyState === WebSocket.OPEN && isHost) {\n      console.log('Sending ADD_AI message to server');\n      websocket.send(JSON.stringify({\n        type: 'ADD_AI',\n        aiName,\n        difficulty\n      }));\n    } else {\n      console.log('Cannot send ADD_AI - conditions not met');\n    }\n  };\n\n  const startGame = () => {\n    if (websocket && websocket.readyState === WebSocket.OPEN && isHost) {\n      websocket.send(JSON.stringify({\n        type: 'START_GAME'\n      }));\n    }\n  };\n\n  const removePlayer = (playerId: string) => {\n    if (websocket && websocket.readyState === WebSocket.OPEN && isHost) {\n      websocket.send(JSON.stringify({\n        type: 'REMOVE_PLAYER',\n        playerId\n      }));\n    }\n  };\n\n  const disconnect = () => {\n    // Clear any pending reconnection attempts\n    if (reconnectTimeoutRef.current) {\n      clearTimeout(reconnectTimeoutRef.current);\n      reconnectTimeoutRef.current = undefined;\n    }\n    reconnectAttempts.current = 0;\n    \n    if (websocket) {\n      websocket.close(1000, 'User disconnected'); // Normal closure\n      setWebSocket(null);\n    }\n    setIsConnected(false);\n    setMultiplayerMode('local', null, false);\n  };\n\n  // Cleanup on unmount\n  useEffect(() => {\n    return () => {\n      if (reconnectTimeoutRef.current) {\n        clearTimeout(reconnectTimeoutRef.current);\n      }\n    };\n  }, []);\n\n  return {\n    mode,\n    isConnected,\n    roomCode,\n    isHost,\n    connectToRoom,\n    sendAction,\n    addAIPlayer,\n    removePlayer,\n    startGame,\n    disconnect\n  };\n}\n","size_bytes":11532},"client/src/components/game/SitPassPhase.tsx":{"content":"import { useShnarps } from '../../lib/stores/useShnarps';\nimport { Button } from '../ui/button';\nimport { canPlayerSit } from '../../lib/game/gameLogic';\n\nexport default function SitPassPhase() {\n  const { \n    players, \n    currentPlayerIndex, \n    chooseSitOrPlay,\n    bids,\n    trumpSuit,\n    localPlayerId\n  } = useShnarps();\n  \n  const currentPlayer = players[currentPlayerIndex];\n  const isLocalPlayerTurn = currentPlayer?.id === localPlayerId;\n  const highestBid = Math.max(0, ...Array.from(bids.values()));\n  \n  const handleSitOrPlay = (decision: 'sit' | 'play') => {\n    if (currentPlayer) {\n      chooseSitOrPlay(currentPlayer.id, decision);\n    }\n  };\n  \n  const canSit = currentPlayer ? canPlayerSit(currentPlayer, highestBid, trumpSuit) : false;\n\n  // Only show sit/play controls for local player's turn, positioned above player\n  if (!isLocalPlayerTurn || !currentPlayer) return null;\n\n  const trumpSymbol = trumpSuit === 'hearts' ? 'â™¥' : \n                      trumpSuit === 'diamonds' ? 'â™¦' : \n                      trumpSuit === 'clubs' ? 'â™£' : 'â™ ';\n  const trumpColor = trumpSuit === 'hearts' || trumpSuit === 'diamonds' ? 'text-red-500' : 'text-white';\n\n  return (\n    <div className=\"fixed bottom-56 sm:bottom-48 left-1/2 transform -translate-x-1/2 z-40\">\n      <div className=\"text-center mb-2\">\n        <p className=\"text-sm text-white bg-black bg-opacity-70 px-4 py-1 rounded inline-block\">\n          Trump: <span className={`text-2xl font-bold ${trumpColor}`}>{trumpSymbol}</span> <span className=\"capitalize\">{trumpSuit}</span>\n        </p>\n      </div>\n      <div className=\"flex gap-4 bg-gray-900 bg-opacity-90 px-6 py-3 rounded-lg shadow-xl\">\n        <Button\n          onClick={() => handleSitOrPlay('play')}\n          className=\"min-w-[100px] h-12 touch-manipulation bg-green-600 hover:bg-green-700 text-white font-bold\"\n        >\n          In\n        </Button>\n        <Button\n          onClick={() => handleSitOrPlay('sit')}\n          disabled={!canSit}\n          className=\"min-w-[100px] h-12 touch-manipulation bg-red-600 hover:bg-red-700 text-white font-bold disabled:opacity-30\"\n        >\n          Out\n        </Button>\n      </div>\n      {!canSit && (\n        <p className=\"text-xs text-orange-400 font-medium text-center mt-2 bg-black bg-opacity-70 px-3 py-1 rounded\">\n          Must play{highestBid === 1 ? ' (bid 1)' : trumpSuit === 'spades' ? ' (spades)' : currentPlayer.consecutiveSits >= 2 ? ' (musty)' : ''}\n        </p>\n      )}\n    </div>\n  );\n}\n","size_bytes":2500},"client/src/components/game/PlayerHand.tsx":{"content":"import Card from './Card';\nimport { Card as CardType } from '../../lib/game/cardUtils';\n\ninterface PlayerHandProps {\n  cards: CardType[];\n  isCurrentPlayer: boolean;\n  selectedCard?: CardType;\n  onCardClick?: (card: CardType) => void;\n  faceUp?: boolean;\n}\n\nexport default function PlayerHand({ \n  cards, \n  isCurrentPlayer,\n  selectedCard,\n  onCardClick,\n  faceUp = true\n}: PlayerHandProps) {\n\n  if (!faceUp) {\n    return (\n      <div className=\"flex justify-center items-center\">\n        {cards.slice(0, 5).map((card, index) => (\n          <div key={`${card.suit}-${card.rank}-${index}`} \n               className={index > 0 ? '-ml-5' : ''}>\n            <Card\n              card={card}\n              faceDown={true}\n              delay={index * 0.05}\n            />\n          </div>\n        ))}\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"flex overflow-x-auto pb-2 touch-pan-x scrollbar-thin scrollbar-thumb-gray-500 scrollbar-track-gray-200\">\n      {cards.map((card, index) => (\n        <div key={`${card.suit}-${card.rank}-${index}`} \n             className={index > 0 ? '-ml-4 sm:-ml-6' : ''}>\n          <Card\n            card={card}\n            isSelected={selectedCard?.suit === card.suit && selectedCard?.rank === card.rank}\n            isPlayable={isCurrentPlayer}\n            onClick={() => isCurrentPlayer && onCardClick?.(card)}\n            delay={index * 0.1}\n          />\n        </div>\n      ))}\n    </div>\n  );\n}\n","size_bytes":1441},"client/src/lib/utils.ts":{"content":"import { clsx, type ClassValue } from \"clsx\";\nimport { twMerge } from \"tailwind-merge\";\n\nexport function cn(...inputs: ClassValue[]) {\n  return twMerge(clsx(inputs));\n}\n\nconst getLocalStorage = (key: string): any =>\n  JSON.parse(window.localStorage.getItem(key) || \"null\");\nconst setLocalStorage = (key: string, value: any): void =>\n  window.localStorage.setItem(key, JSON.stringify(value));\n\nexport { getLocalStorage, setLocalStorage };\n","size_bytes":438},"server/websocket.ts":{"content":"import { WebSocketServer, WebSocket } from 'ws';\nimport { Server } from 'http';\nimport { processAITurn, setApplyGameAction } from './ai/gameLoop';\n\ntype GamePhase = 'setup' | 'bidding' | 'trump_selection' | 'sit_pass' | 'everyone_sat' | 'hand_play' | 'trick_complete' | 'round_complete' | 'game_over';\ntype AIDifficulty = 'easy' | 'medium' | 'hard';\n\ninterface Card {\n  suit: 'hearts' | 'diamonds' | 'clubs' | 'spades';\n  rank: 'A' | 'K' | 'Q' | 'J' | '10' | '9' | '8' | '7' | '6' | '5' | '4' | '3' | '2';\n  value: number;\n}\n\ninterface Player {\n  id: string;\n  name: string;\n  hand: Card[];\n  isActive: boolean;\n  consecutiveSits: number;\n  isAI: boolean;\n  aiDifficulty?: AIDifficulty;\n  avatar?: { color: string; icon: string };\n  wallet?: number;\n  isConnected?: boolean; // Track if human player is connected\n}\n\ninterface GameRoom {\n  id: string;\n  players: Map<string, Player & { ws?: WebSocket }>;\n  spectatorWs?: WebSocket; // WebSocket for spectator (non-player host)\n  gameState: {\n    gamePhase: GamePhase;\n    currentPlayerIndex: number;\n    dealerIndex: number;\n    deck: Card[];\n    currentTrick: { playerId: string; card: Card }[];\n    completedTricks: { playerId: string; card: Card }[][];\n    bids: Map<string, number>;\n    trumpSuit: string | null;\n    highestBidder: string | null;\n    playingPlayers: Set<string>;\n    mustyPlayers: Set<string>;\n    scores: Map<string, number>;\n    round: number;\n  };\n  host: string;\n  createdAt: number;\n  turnTimer?: NodeJS.Timeout;\n  turnTimeLimit: number; // in seconds\n  turnStartTime?: number;\n}\n\nconst rooms = new Map<string, GameRoom>();\n\nfunction generateRoomCode(): string {\n  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; // Exclude similar-looking chars\n  let code = '';\n  for (let i = 0; i < 6; i++) {\n    code += chars.charAt(Math.floor(Math.random() * chars.length));\n  }\n  return code;\n}\n\n// Card utility functions\nfunction createDeck(): Card[] {\n  const suits: Card['suit'][] = ['spades', 'hearts', 'diamonds', 'clubs'];\n  const ranks: Array<{ rank: Card['rank']; value: number }> = [\n    { rank: 'A', value: 14 },\n    { rank: 'K', value: 13 },\n    { rank: 'Q', value: 12 },\n    { rank: 'J', value: 11 },\n    { rank: '10', value: 10 },\n    { rank: '9', value: 9 },\n    { rank: '8', value: 8 },\n    { rank: '7', value: 7 },\n    { rank: '6', value: 6 },\n    { rank: '5', value: 5 },\n    { rank: '4', value: 4 },\n    { rank: '3', value: 3 },\n    { rank: '2', value: 2 }\n  ];\n\n  const deck: Card[] = [];\n  for (const suit of suits) {\n    for (const r of ranks) {\n      deck.push({\n        suit,\n        value: r.value,\n        rank: r.rank\n      });\n    }\n  }\n  \n  // Validate deck has exactly 52 unique cards\n  if (deck.length !== 52) {\n    console.error('âŒ SERVER DECK ERROR: Deck has', deck.length, 'cards instead of 52!');\n  }\n  \n  const uniqueCards = new Set(deck.map(c => `${c.rank}${c.suit}`));\n  if (uniqueCards.size !== 52) {\n    console.error('âŒ SERVER DECK ERROR: Deck has duplicate cards!', deck.length - uniqueCards.size, 'duplicates found');\n    console.error('Deck:', deck.map(c => `${c.rank}${c.suit}`).sort());\n  }\n  \n  return deck;\n}\n\nfunction shuffleDeck(deck: Card[]): Card[] {\n  const shuffled = [...deck];\n  for (let i = shuffled.length - 1; i > 0; i--) {\n    const j = Math.floor(Math.random() * (i + 1));\n    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];\n  }\n  return shuffled;\n}\n\nfunction dealCards(deck: Card[], numPlayers: number): Card[][] {\n  const hands: Card[][] = Array.from({ length: numPlayers }, () => []);\n  for (let i = 0; i < 5; i++) {\n    for (let p = 0; p < numPlayers; p++) {\n      const card = deck[i * numPlayers + p];\n      if (card) hands[p].push(card);\n    }\n  }\n  \n  // Validate: Check for duplicate cards across all hands\n  const allDealtCards: string[] = [];\n  hands.forEach((hand, playerIndex) => {\n    hand.forEach(card => {\n      const cardId = `${card.rank}${card.suit}`;\n      if (allDealtCards.includes(cardId)) {\n        console.error(`âŒ SERVER DEAL ERROR: Duplicate card ${cardId} found in player ${playerIndex}'s hand!`);\n        console.error('All dealt cards:', allDealtCards);\n        console.error('Current hand:', hand.map(c => `${c.rank}${c.suit}`));\n      }\n      allDealtCards.push(cardId);\n    });\n  });\n  \n  return hands;\n}\n\nfunction createRoom(hostId: string, hostName: string, spectatorMode: boolean = false): GameRoom {\n  const roomId = generateRoomCode();\n  \n  // If spectator mode, don't add host as a player\n  const players = new Map<string, Player & { ws?: WebSocket }>();\n  const scores = new Map<string, number>();\n  \n  if (!spectatorMode && hostName) {\n    const hostPlayer: Player & { ws?: WebSocket } = {\n      id: hostId,\n      name: hostName,\n      hand: [],\n      isActive: true,\n      consecutiveSits: 0,\n      isAI: false,\n      wallet: 100,\n      isConnected: true\n    };\n    players.set(hostId, hostPlayer);\n    scores.set(hostId, 16);\n  }\n\n  const room: GameRoom = {\n    id: roomId,\n    players,\n    gameState: {\n      gamePhase: 'setup',\n      currentPlayerIndex: 0,\n      dealerIndex: 0,\n      deck: [],\n      currentTrick: [],\n      completedTricks: [],\n      bids: new Map(),\n      trumpSuit: null,\n      highestBidder: null,\n      playingPlayers: new Set(),\n      mustyPlayers: new Set(),\n      scores,\n      round: 1\n    },\n    host: hostId,\n    createdAt: Date.now(),\n    turnTimeLimit: 0 // 0 = no timer (disabled for multiplayer)\n  };\n\n  rooms.set(roomId, room);\n  console.log(`ðŸŽ® Room ${roomId} created (spectatorMode: ${spectatorMode}, players: ${players.size})`);\n  return room;\n}\n\nfunction broadcastToRoom(roomId: string, message: any, excludePlayerId?: string) {\n  const room = rooms.get(roomId);\n  if (!room) return;\n\n  const messageStr = JSON.stringify(message);\n  \n  // Send to all players\n  room.players.forEach((player, playerId) => {\n    if (playerId !== excludePlayerId && player.ws && player.ws.readyState === WebSocket.OPEN) {\n      player.ws.send(messageStr);\n    }\n  });\n  \n  // Also send to spectator if present\n  if (room.spectatorWs && room.spectatorWs.readyState === WebSocket.OPEN) {\n    room.spectatorWs.send(messageStr);\n  }\n}\n\nfunction serializeGameState(room: GameRoom, playerId: string | null) {\n  return {\n    roomId: room.id,\n    players: Array.from(room.players.values()).map(p => ({\n      id: p.id,\n      name: p.name,\n      hand: (playerId && p.id === playerId) || p.isAI || !playerId ? p.hand : [], // Show all hands for spectators (null playerId) and AI\n      isActive: p.isActive,\n      consecutiveSits: p.consecutiveSits,\n      isAI: p.isAI,\n      aiDifficulty: p.aiDifficulty,\n      avatar: p.avatar,\n      wallet: p.wallet || 100,\n      isConnected: p.isConnected ?? true\n    })),\n    gameState: {\n      ...room.gameState,\n      bids: Object.fromEntries(room.gameState.bids),\n      playingPlayers: Array.from(room.gameState.playingPlayers),\n      mustyPlayers: Array.from(room.gameState.mustyPlayers),\n      scores: Object.fromEntries(room.gameState.scores)\n    },\n    localPlayerId: playerId,\n    isHost: playerId ? room.host === playerId : false,\n    turnTimeRemaining: room.turnStartTime ? Math.max(0, room.turnTimeLimit - Math.floor((Date.now() - room.turnStartTime) / 1000)) : null\n  };\n}\n\n// Timer and auto-play functions\nfunction startTurnTimer(room: GameRoom) {\n  // Clear any existing timer\n  if (room.turnTimer) {\n    clearTimeout(room.turnTimer);\n  }\n  \n  // Don't start timer if limit is 0 (no limit)\n  if (room.turnTimeLimit <= 0) return;\n  \n  // Get current player\n  const playerArray = Array.from(room.players.values());\n  const currentPlayer = playerArray[room.gameState.currentPlayerIndex];\n  \n  // Don't set timer for AI players (they move instantly) or connected human players in setup\n  if (!currentPlayer || currentPlayer.isAI || room.gameState.gamePhase === 'setup') return;\n  \n  room.turnStartTime = Date.now();\n  \n  // Broadcast timer start\n  broadcastToRoom(room.id, {\n    type: 'TURN_TIMER_START',\n    timeLimit: room.turnTimeLimit\n  });\n  \n  // Set timeout for auto-play\n  room.turnTimer = setTimeout(() => {\n    console.log(`Turn timer expired for player ${currentPlayer.name} in room ${room.id}`);\n    autoPlayTurn(room, currentPlayer);\n  }, room.turnTimeLimit * 1000);\n}\n\nfunction stopTurnTimer(room: GameRoom) {\n  if (room.turnTimer) {\n    clearTimeout(room.turnTimer);\n    room.turnTimer = undefined;\n    room.turnStartTime = undefined;\n  }\n}\n\nfunction autoPlayTurn(room: GameRoom, player: Player) {\n  // Simple auto-play logic based on current phase\n  const phase = room.gameState.gamePhase;\n  \n  try {\n    if (phase === 'bidding') {\n      // Auto-bid 0 (safest option)\n      room.gameState.bids.set(player.id, 0);\n      \n      const playerArray = Array.from(room.players.values());\n      const nextIndex = (room.gameState.currentPlayerIndex + 1) % playerArray.length;\n      \n      // Check if bidding is complete\n      if (room.gameState.bids.size === playerArray.length) {\n        const highestBid = Math.max(...Array.from(room.gameState.bids.values()));\n        const highestBidderId = Array.from(room.gameState.bids.entries())\n          .find(([_, bid]) => bid === highestBid)?.[0];\n        \n        room.gameState.highestBidder = highestBidderId || null;\n        room.gameState.gamePhase = 'trump_selection';\n        room.gameState.currentPlayerIndex = playerArray.findIndex(p => p.id === highestBidderId);\n      } else {\n        room.gameState.currentPlayerIndex = nextIndex;\n      }\n      \n      broadcastGameState(room);\n      if (room.gameState.gamePhase === 'bidding') {\n        startTurnTimer(room);\n      }\n    }\n    else if (phase === 'trump_selection') {\n      // Auto-select first suit with most cards in hand\n      const suitCounts = { hearts: 0, diamonds: 0, clubs: 0, spades: 0 };\n      player.hand.forEach(card => suitCounts[card.suit]++);\n      const trumpSuit = Object.entries(suitCounts).sort((a, b) => b[1] - a[1])[0][0];\n      \n      room.gameState.trumpSuit = trumpSuit;\n      room.gameState.gamePhase = 'sit_pass';\n      room.gameState.currentPlayerIndex = 0;\n      \n      broadcastGameState(room);\n      startTurnTimer(room);\n    }\n    else if (phase === 'sit_pass') {\n      // Auto-sit if possible, otherwise play\n      const canSit = player.consecutiveSits < 2;\n      const decision = canSit ? 'sit' : 'play';\n      \n      if (decision === 'sit') {\n        player.consecutiveSits++;\n      } else {\n        player.consecutiveSits = 0;\n        room.gameState.playingPlayers.add(player.id);\n      }\n      \n      const playerArray = Array.from(room.players.values());\n      const nextIndex = (room.gameState.currentPlayerIndex + 1) % playerArray.length;\n      \n      // Check if sit/pass is complete\n      const allDecided = playerArray.every(p => \n        room.gameState.playingPlayers.has(p.id) || p.consecutiveSits > 0\n      );\n      \n      if (allDecided) {\n        if (room.gameState.playingPlayers.size === 0) {\n          room.gameState.gamePhase = 'everyone_sat';\n        } else {\n          room.gameState.gamePhase = 'hand_play';\n          room.gameState.currentPlayerIndex = (room.gameState.dealerIndex + 1) % playerArray.length;\n        }\n      } else {\n        room.gameState.currentPlayerIndex = nextIndex;\n      }\n      \n      broadcastGameState(room);\n      if (room.gameState.gamePhase === 'sit_pass' || room.gameState.gamePhase === 'hand_play') {\n        startTurnTimer(room);\n      }\n    }\n    else if (phase === 'hand_play') {\n      // Auto-play lowest valid card\n      const currentTrick = room.gameState.currentTrick;\n      const leadSuit = currentTrick.length > 0 ? currentTrick[0].card.suit : null;\n      \n      let validCards = player.hand;\n      if (leadSuit) {\n        const suitCards = player.hand.filter(c => c.suit === leadSuit);\n        if (suitCards.length > 0) validCards = suitCards;\n      }\n      \n      // Play lowest value card\n      const cardToPlay = validCards.sort((a, b) => a.value - b.value)[0];\n      \n      if (cardToPlay) {\n        player.hand = player.hand.filter(c => !(c.suit === cardToPlay.suit && c.rank === cardToPlay.rank));\n        room.gameState.currentTrick.push({ playerId: player.id, card: cardToPlay });\n        \n        const playingPlayerIds = Array.from(room.gameState.playingPlayers);\n        \n        if (room.gameState.currentTrick.length === playingPlayerIds.length) {\n          room.gameState.gamePhase = 'trick_complete';\n        } else {\n          const playerArray = Array.from(room.players.values());\n          let nextIndex = (room.gameState.currentPlayerIndex + 1) % playerArray.length;\n          while (!room.gameState.playingPlayers.has(playerArray[nextIndex].id)) {\n            nextIndex = (nextIndex + 1) % playerArray.length;\n          }\n          room.gameState.currentPlayerIndex = nextIndex;\n        }\n        \n        broadcastGameState(room);\n        if (room.gameState.gamePhase === 'hand_play') {\n          startTurnTimer(room);\n        }\n      }\n    }\n  } catch (error) {\n    console.error('Error in autoPlayTurn:', error);\n  }\n}\n\nfunction broadcastGameState(room: GameRoom) {\n  room.players.forEach((player, playerId) => {\n    if (player.ws && player.ws.readyState === WebSocket.OPEN) {\n      player.ws.send(JSON.stringify({\n        type: 'GAME_STATE_SYNC',\n        ...serializeGameState(room, playerId)\n      }));\n    }\n  });\n}\n\n// Apply game action to server state (used by AI game loop)\nfunction applyGameAction(room: any, action: string, payload: any) {\n  const playerArray = Array.from(room.players.values());\n  \n  switch (action) {\n    case 'bid': {\n      room.gameState.bids.set(payload.playerId, payload.bid);\n      \n      // Check if bidding is complete\n      if (room.gameState.bids.size === playerArray.length) {\n        const highestBid = Math.max(...Array.from(room.gameState.bids.values()));\n        const highestBidderId = Array.from(room.gameState.bids.entries())\n          .find(([_, bid]) => bid === highestBid)?.[0];\n        \n        room.gameState.highestBidder = highestBidderId || null;\n        room.gameState.gamePhase = 'trump_selection';\n        room.gameState.currentPlayerIndex = playerArray.findIndex(p => p.id === highestBidderId);\n      } else {\n        room.gameState.currentPlayerIndex = (room.gameState.currentPlayerIndex + 1) % playerArray.length;\n      }\n      break;\n    }\n    \n    case 'trump': {\n      room.gameState.trumpSuit = payload.suit;\n      room.gameState.gamePhase = 'sit_pass';\n      room.gameState.currentPlayerIndex = 0;\n      break;\n    }\n    \n    case 'sitpass': {\n      const player = room.players.get(payload.playerId);\n      if (player) {\n        if (payload.decision === 'sit') {\n          room.gameState.playingPlayers.delete(payload.playerId);\n        } else {\n          room.gameState.playingPlayers.add(payload.playerId);\n        }\n      }\n      \n      // Check if all players have decided\n      const nextIndex = (room.gameState.currentPlayerIndex + 1) % playerArray.length;\n      if (nextIndex === 0) {\n        // All players have decided, move to next phase\n        if (room.gameState.playingPlayers.size === 1) {\n          room.gameState.gamePhase = 'everyone_sat';\n          const bidderId = room.gameState.highestBidder;\n          room.gameState.currentPlayerIndex = playerArray.findIndex(p => p.id === bidderId);\n        } else {\n          room.gameState.gamePhase = 'hand_play';\n          const dealerIndex = room.gameState.dealerIndex;\n          let firstPlayerIndex = (dealerIndex + 1) % playerArray.length;\n          while (!room.gameState.playingPlayers.has(playerArray[firstPlayerIndex].id)) {\n            firstPlayerIndex = (firstPlayerIndex + 1) % playerArray.length;\n          }\n          room.gameState.currentPlayerIndex = firstPlayerIndex;\n        }\n      } else {\n        room.gameState.currentPlayerIndex = nextIndex;\n      }\n      break;\n    }\n    \n    case 'playcard': {\n      const player = room.players.get(payload.playerId);\n      if (player) {\n        player.hand = player.hand.filter(c => !(c.suit === payload.card.suit && c.rank === payload.card.rank));\n        room.gameState.currentTrick.push({ playerId: payload.playerId, card: payload.card });\n        \n        const playingPlayerIds = Array.from(room.gameState.playingPlayers);\n        if (room.gameState.currentTrick.length === playingPlayerIds.length) {\n          // Trick is complete - determine winner and continue\n          room.gameState.gamePhase = 'trick_complete';\n          \n          // Determine trick winner\n          const leadCard = room.gameState.currentTrick[0].card;\n          const leadSuit = leadCard.suit;\n          const trumpSuit = room.gameState.trumpSuit;\n          \n          let winningPlay = room.gameState.currentTrick[0];\n          for (const play of room.gameState.currentTrick) {\n            if (play.card.suit === trumpSuit && winningPlay.card.suit !== trumpSuit) {\n              winningPlay = play;\n            } else if (play.card.suit === trumpSuit && winningPlay.card.suit === trumpSuit) {\n              if (play.card.value > winningPlay.card.value) {\n                winningPlay = play;\n              }\n            } else if (play.card.suit === leadSuit && winningPlay.card.suit === leadSuit) {\n              if (play.card.value > winningPlay.card.value) {\n                winningPlay = play;\n              }\n            }\n          }\n          \n          // Move trick to completed tricks\n          room.gameState.completedTricks.push([...room.gameState.currentTrick]);\n          room.gameState.currentTrick = [];\n          \n          // Set next player to winner\n          const winnerIndex = playerArray.findIndex(p => p.id === winningPlay.playerId);\n          room.gameState.currentPlayerIndex = winnerIndex;\n          \n          // Check if hand is complete (all 5 tricks played)\n          if (room.gameState.completedTricks.length >= 5) {\n            room.gameState.gamePhase = 'round_complete';\n          } else {\n            room.gameState.gamePhase = 'hand_play';\n          }\n        } else {\n          let nextIndex = (room.gameState.currentPlayerIndex + 1) % playerArray.length;\n          while (!room.gameState.playingPlayers.has(playerArray[nextIndex].id)) {\n            nextIndex = (nextIndex + 1) % playerArray.length;\n          }\n          room.gameState.currentPlayerIndex = nextIndex;\n        }\n      }\n      break;\n    }\n    \n    case 'penalty': {\n      // Handle everyone_sat penalty choice\n      // This would normally trigger scoring and new round, but we'll keep it simple for now\n      break;\n    }\n  }\n}\n\nexport function setupWebSocket(server: Server) {\n  // Register applyGameAction with the AI game loop\n  setApplyGameAction(applyGameAction);\n  \n  const wss = new WebSocketServer({ server, path: '/ws' });\n  \n  console.log('WebSocket server initialized on /ws');\n\n  wss.on('connection', (ws: WebSocket) => {\n    console.log('âœ… WebSocket client connected');\n    let currentPlayerId: string | null = null;\n    let currentRoomId: string | null = null;\n\n    ws.on('message', (data: string) => {\n      try {\n        const message = JSON.parse(data.toString());\n\n        switch (message.type) {\n          case 'CREATE_ROOM': {\n            const playerId = `player_${Date.now()}_${Math.random()}`;\n            const spectatorMode = message.spectatorMode || false;\n            const room = createRoom(playerId, message.playerName, spectatorMode);\n            \n            currentPlayerId = playerId;\n            currentRoomId = room.id;\n            \n            // Set ws for player if they joined as a player, or store spectator ws\n            if (!spectatorMode && message.playerName) {\n              const player = room.players.get(playerId)!;\n              player.ws = ws;\n            } else if (spectatorMode) {\n              room.spectatorWs = ws;\n            }\n\n            // For spectators, send game state with null playerId but keep host status\n            const gameState = serializeGameState(room, playerId);\n            ws.send(JSON.stringify({\n              type: 'ROOM_CREATED',\n              ...gameState,\n              localPlayerId: spectatorMode ? null : playerId, // Override to null for spectators\n              isHost: true, // Spectators are always host since they created the room\n              isSpectator: spectatorMode\n            }));\n            break;\n          }\n\n          case 'JOIN_ROOM': {\n            const room = rooms.get(message.roomId);\n            if (!room) {\n              ws.send(JSON.stringify({ type: 'ERROR', message: 'Room not found' }));\n              break;\n            }\n\n            if (room.players.size >= 8) {\n              ws.send(JSON.stringify({ type: 'ERROR', message: 'Room is full' }));\n              break;\n            }\n\n            if (room.gameState.gamePhase !== 'setup') {\n              ws.send(JSON.stringify({ type: 'ERROR', message: 'Game already started' }));\n              break;\n            }\n\n            const playerId = `player_${Date.now()}_${Math.random()}`;\n            const player: Player & { ws?: WebSocket } = {\n              id: playerId,\n              name: message.playerName,\n              hand: [],\n              isActive: true,\n              consecutiveSits: 0,\n              isAI: false,\n              ws,\n              wallet: 100\n            };\n\n            room.players.set(playerId, player);\n            room.gameState.scores.set(playerId, 16);\n            \n            currentPlayerId = playerId;\n            currentRoomId = room.id;\n\n            // Send state to joining player\n            ws.send(JSON.stringify({\n              type: 'JOINED_ROOM',\n              ...serializeGameState(room, playerId)\n            }));\n\n            // Notify others\n            broadcastToRoom(room.id, {\n              type: 'PLAYER_JOINED',\n              player: { id: playerId, name: player.name, isAI: false }\n            }, playerId);\n\n            break;\n          }\n\n          case 'REJOIN_ROOM': {\n            const room = rooms.get(message.roomId);\n            if (!room) {\n              ws.send(JSON.stringify({ type: 'ERROR', message: 'Room not found' }));\n              break;\n            }\n\n            // Check if player exists in the room by playerId (disconnected player)\n            const playerId = message.playerId;\n            const player = room.players.get(playerId);\n\n            if (!player || player.isAI) {\n              ws.send(JSON.stringify({ type: 'ERROR', message: 'Player not found in this game' }));\n              break;\n            }\n            \n            // Reconnect the player\n            player.ws = ws;\n            player.isConnected = true;\n            currentPlayerId = playerId;\n            currentRoomId = room.id;\n\n            // Send current game state to rejoining player\n            ws.send(JSON.stringify({\n              type: 'REJOINED_ROOM',\n              ...serializeGameState(room, playerId)\n            }));\n\n            // Notify others\n            broadcastToRoom(room.id, {\n              type: 'PLAYER_RECONNECTED',\n              playerId,\n              playerName: player.name\n            }, playerId);\n\n            console.log(`Player ${player.name} rejoined room ${room.id}`);\n            break;\n          }\n\n          case 'ADD_AI': {\n            if (!currentRoomId || !currentPlayerId) break;\n            const room = rooms.get(currentRoomId);\n            if (!room || room.host !== currentPlayerId || room.gameState.gamePhase !== 'setup') break;\n\n            const aiId = `ai_${Date.now()}_${Math.random()}`;\n            const aiPlayer: Player & { ws?: WebSocket } = {\n              id: aiId,\n              name: message.aiName,\n              hand: [],\n              isActive: true,\n              consecutiveSits: 0,\n              isAI: true,\n              aiDifficulty: message.difficulty,\n              wallet: 100\n            };\n\n            room.players.set(aiId, aiPlayer);\n            room.gameState.scores.set(aiId, 16);\n\n            broadcastToRoom(room.id, {\n              type: 'PLAYER_JOINED',\n              player: { id: aiId, name: aiPlayer.name, isAI: true, aiDifficulty: aiPlayer.aiDifficulty }\n            });\n\n            break;\n          }\n\n          case 'GAME_ACTION': {\n            if (!currentRoomId) break;\n            const room = rooms.get(currentRoomId);\n            if (!room) break;\n\n            // Stop current turn timer since action was received\n            stopTurnTimer(room);\n\n            // Update game state based on action\n            const { action, payload } = message;\n            \n            // Track consecutiveSits on server for sitpass actions\n            if (action === 'sitpass') {\n              const player = room.players.get(payload.playerId);\n              if (player) {\n                if (payload.decision === 'play') {\n                  player.consecutiveSits = 0;\n                } else {\n                  player.consecutiveSits += 1;\n                }\n              }\n            }\n            \n            // Broadcast the action to all players\n            broadcastToRoom(room.id, {\n              type: 'GAME_STATE_UPDATE',\n              action,\n              payload\n            });\n\n            // Check if next player is AI and process their turn automatically\n            setTimeout(() => {\n              processAITurn(room, (message) => broadcastToRoom(room.id, message));\n              // Start timer as fallback for human players\n              setTimeout(() => startTurnTimer(room), 500);\n            }, 500);\n\n            break;\n          }\n\n          case 'REMOVE_PLAYER': {\n            if (!currentRoomId || !currentPlayerId) break;\n            const room = rooms.get(currentRoomId);\n            if (!room || room.host !== currentPlayerId || room.gameState.gamePhase !== 'setup') break;\n\n            const playerToRemove = message.playerId;\n            if (playerToRemove === currentPlayerId) break; // Can't remove yourself\n\n            room.players.delete(playerToRemove);\n            room.gameState.scores.delete(playerToRemove);\n\n            broadcastToRoom(room.id, {\n              type: 'PLAYER_LEFT',\n              playerId: playerToRemove\n            });\n\n            break;\n          }\n\n          case 'START_GAME': {\n            if (!currentRoomId || !currentPlayerId) break;\n            const room = rooms.get(currentRoomId);\n            if (!room || room.host !== currentPlayerId) break;\n\n            if (room.players.size < 4) {\n              ws.send(JSON.stringify({ type: 'ERROR', message: 'Need at least 4 players' }));\n              break;\n            }\n\n            // Deal cards to all players\n            const shuffledDeck = shuffleDeck(createDeck());\n            const playerArray = Array.from(room.players.values());\n            const dealtCards = dealCards(shuffledDeck, playerArray.length);\n            \n            // Log all dealt cards for debugging\n            console.log(`ðŸƒ Dealing cards to ${playerArray.length} players in room ${room.id}`);\n            const allCardIds: string[] = [];\n            playerArray.forEach((player, index) => {\n              player.hand = dealtCards[index] || [];\n              const cardIds = player.hand.map(c => `${c.rank}${c.suit}`);\n              console.log(`  Player ${index} (${player.name}): ${cardIds.join(', ')}`);\n              allCardIds.push(...cardIds);\n            });\n            \n            // Check for duplicates\n            const uniqueCards = new Set(allCardIds);\n            if (uniqueCards.size !== allCardIds.length) {\n              console.error(`âŒ DUPLICATE CARDS DEALT! ${allCardIds.length - uniqueCards.size} duplicates found`);\n              console.error('All cards:', allCardIds.sort());\n            } else {\n              console.log(`âœ… All ${allCardIds.length} cards unique`);\n            }\n\n            room.gameState.gamePhase = 'bidding';\n            room.gameState.deck = shuffledDeck.slice(playerArray.length * 5); // Remaining cards\n            room.gameState.currentPlayerIndex = (room.gameState.dealerIndex + 1) % playerArray.length;\n            room.gameState.bids = new Map();\n            room.gameState.trumpSuit = null;\n            room.gameState.highestBidder = null;\n            \n            // Send personalized game state to each player (with their own hand)\n            room.players.forEach((player, playerId) => {\n              if (player.ws && player.ws.readyState === WebSocket.OPEN) {\n                player.ws.send(JSON.stringify({\n                  type: 'GAME_STARTED',\n                  ...serializeGameState(room, playerId)\n                }));\n              }\n            });\n            \n            // Also send to spectator if present (they see all hands)\n            if (room.spectatorWs && room.spectatorWs.readyState === WebSocket.OPEN) {\n              room.spectatorWs.send(JSON.stringify({\n                type: 'GAME_STARTED',\n                ...serializeGameState(room, null) // null = spectator, sees all hands\n              }));\n            }\n\n            // Check if first player is AI and process their turn\n            setTimeout(() => {\n              processAITurn(room, (message) => broadcastToRoom(room.id, message));\n              // Start timer as fallback for human players\n              setTimeout(() => startTurnTimer(room), 500);\n            }, 1000);\n\n            break;\n          }\n        }\n      } catch (error) {\n        console.error('WebSocket error:', error);\n        ws.send(JSON.stringify({ type: 'ERROR', message: 'Invalid message format' }));\n      }\n    });\n\n    ws.on('close', () => {\n      if (currentRoomId && currentPlayerId) {\n        const room = rooms.get(currentRoomId);\n        if (room) {\n          const player = room.players.get(currentPlayerId);\n          \n          // If game is in progress, mark as disconnected instead of removing\n          if (room.gameState.gamePhase !== 'setup' && player && !player.isAI) {\n            player.isConnected = false;\n            player.ws = undefined;\n            \n            broadcastToRoom(room.id, {\n              type: 'PLAYER_DISCONNECTED',\n              playerId: currentPlayerId,\n              playerName: player.name\n            });\n            \n            // If it's the disconnected player's turn, auto-play for them\n            const playerArray = Array.from(room.players.values());\n            const currentPlayer = playerArray[room.gameState.currentPlayerIndex];\n            if (currentPlayer && currentPlayer.id === currentPlayerId) {\n              console.log(`Auto-playing for disconnected player ${player.name}`);\n              setTimeout(() => autoPlayTurn(room, player), 2000);\n            }\n            \n            // Transfer host if needed\n            if (currentPlayerId === room.host) {\n              const newHost = Array.from(room.players.entries())\n                .find(([id, p]) => !p.isAI && p.isConnected !== false && id !== currentPlayerId)?.[0] \n                || Array.from(room.players.entries()).find(([_, p]) => !p.isAI)?.[0]\n                || Array.from(room.players.keys())[0];\n              \n              if (newHost) {\n                room.host = newHost;\n                broadcastToRoom(room.id, {\n                  type: 'HOST_TRANSFERRED',\n                  newHostId: newHost\n                });\n              }\n            }\n          } else {\n            // Game not started or AI player - remove completely\n            room.players.delete(currentPlayerId);\n            \n            // If room is empty, clean up room\n            if (room.players.size === 0) {\n              stopTurnTimer(room);\n              rooms.delete(currentRoomId);\n            } else if (currentPlayerId === room.host) {\n              // Game hasn't started yet, delete the room\n              stopTurnTimer(room);\n              rooms.delete(currentRoomId);\n              broadcastToRoom(room.id, {\n                type: 'ROOM_CLOSED',\n                reason: 'Host disconnected'\n              });\n            } else {\n              // Non-host player left during setup - just notify others\n              broadcastToRoom(room.id, {\n                type: 'PLAYER_LEFT',\n                playerId: currentPlayerId\n              });\n            }\n          }\n        }\n      }\n    });\n  });\n\n  console.log('WebSocket server initialized on /ws');\n}\n","size_bytes":32169},"client/src/components/ui/textarea.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Textarea = React.forwardRef<\n  HTMLTextAreaElement,\n  React.ComponentProps<\"textarea\">\n>(({ className, ...props }, ref) => {\n  return (\n    <textarea\n      className={cn(\n        \"flex min-h-[60px] w-full rounded-md border border-input bg-transparent px-3 py-2 text-base shadow-sm placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n        className\n      )}\n      ref={ref}\n      {...props}\n    />\n  )\n})\nTextarea.displayName = \"Textarea\"\n\nexport { Textarea }\n","size_bytes":649},"client/src/components/game/GameUI.tsx":{"content":"import { useShnarps } from '../../lib/stores/useShnarps';\nimport { Button } from '../ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '../ui/card';\nimport { Input } from '../ui/input';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '../ui/select';\nimport BiddingPhase from './BiddingPhase';\nimport SitPassPhase from './SitPassPhase';\nimport HandPlayPhase from './HandPlayPhase';\nimport GameHistory from './GameHistory';\nimport MultiplayerSetup from './MultiplayerSetup';\nimport AvatarCustomizer, { Avatar, type PlayerAvatar } from './AvatarCustomizer';\nimport Tutorial from './Tutorial';\nimport AppWalkthrough from './AppWalkthrough';\nimport { Settings as SettingsDialog } from '../Settings';\nimport { TransactionHistory } from '../TransactionHistory';\nimport { TurnTimer } from './TurnTimer';\nimport { useState, useEffect } from 'react';\nimport { AIDifficulty } from '../../lib/game/gameLogic';\nimport { useMultiplayer } from '../../lib/hooks/useMultiplayer';\nimport { useWallet } from '../../lib/stores/useWallet';\nimport { BookOpen, HelpCircle, Settings, X, Wallet, History } from 'lucide-react';\n\nexport default function GameUI() {\n  const { \n    gamePhase, \n    players,\n    eliminatedPlayers,\n    scores,\n    round,\n    history,\n    joinGame,\n    addAIPlayer,\n    startGame,\n    chooseTrumpSuit,\n    choosePenalty,\n    highestBidder,\n    resetGame,\n    localPlayerId,\n    isSimulating,\n    setSimulating,\n    removePlayer,\n    multiplayerMode: mode,\n    multiplayerRoomCode: roomCode,\n    isMultiplayerHost: isHost\n  } = useShnarps();\n  \n  const { addAIPlayer: addMultiplayerAI, removePlayer: removeMultiplayerPlayer, startGame: startMultiplayerGame } = useMultiplayer();\n  \n  const [playerName, setPlayerName] = useState('');\n  const [trumpSuit, setTrumpSuit] = useState<string>('');\n  const [aiDifficulty, setAiDifficulty] = useState<AIDifficulty>('medium');\n  const [gameMode, setGameMode] = useState<'menu' | 'local' | 'online'>('menu');\n  const [showAvatarCustomizer, setShowAvatarCustomizer] = useState(false);\n  const [showTutorial, setShowTutorial] = useState(false);\n  const [showWalkthrough, setShowWalkthrough] = useState(false);\n  const [showSettings, setShowSettings] = useState(false);\n  const [showHistory, setShowHistory] = useState(false);\n  const [currentAvatar, setCurrentAvatar] = useState<PlayerAvatar>({\n    color: '#3B82F6',\n    icon: 'ðŸ‘¤'\n  });\n  \n  const isHighestBidder = highestBidder === localPlayerId;\n  const localPlayer = players.find(p => p.id === localPlayerId);\n  const { balance } = useWallet();\n\n  // DEBUG: Log all state values\n  console.log('ðŸ” GameUI Render - gameMode:', gameMode, 'mode:', mode, 'gamePhase:', gamePhase, 'players:', players.length, 'roomCode:', roomCode);\n\n  // Check if first-time user and show walkthrough\n  useEffect(() => {\n    const walkthroughCompleted = localStorage.getItem('shnarps_walkthrough_completed');\n    if (!walkthroughCompleted && gamePhase === 'setup' && players.length === 0) {\n      setShowWalkthrough(true);\n    }\n  }, [gamePhase, players.length]);\n\n  // Welcome screen - choose game mode (only show if NOT in online mode)\n  if (gameMode === 'menu' && gamePhase === 'setup' && players.length === 0 && mode === 'local') {\n    console.log('Showing welcome menu - gameMode:', gameMode, 'mode:', mode, 'players:', players.length);\n    return (\n      <>\n        <div className=\"fixed inset-0 flex items-start justify-center pt-8 md:pt-16\" style={{ zIndex: 9999 }}>\n          <Card className=\"w-full max-w-md mx-4 shadow-2xl bg-white relative\">\n            <div \n              className=\"absolute top-3 right-3 cursor-pointer hover:opacity-80 transition-opacity\"\n              onClick={() => setShowHistory(true)}\n              title=\"View game statistics\"\n            >\n              <div className=\"flex items-center gap-1 text-gray-600\">\n                <Wallet className=\"h-4 w-4\" />\n                <span className=\"text-sm font-medium\">\n                  {balance.toFixed(0)}\n                </span>\n              </div>\n            </div>\n            <CardHeader>\n              <CardTitle className=\"text-center text-2xl\">Shnarps</CardTitle>\n              <p className=\"text-center text-sm text-muted-foreground\">\n                Choose your game mode\n              </p>\n            </CardHeader>\n            <CardContent className=\"space-y-4\">\n              <Button onClick={() => setGameMode('local')} className=\"w-full\" size=\"lg\">\n                ðŸ  Local Game\n              </Button>\n              <Button onClick={() => setGameMode('online')} className=\"w-full\" variant=\"outline\" size=\"lg\">\n                ðŸŒ Online Multiplayer\n              </Button>\n              <p className=\"text-xs text-center text-muted-foreground\">\n                Local: Play on one device<br/>\n                Online: Play with friends in real-time\n              </p>\n              \n              <div className=\"pt-4 border-t space-y-2\">\n                <Button \n                  onClick={() => setShowSettings(true)} \n                  variant=\"ghost\" \n                  className=\"w-full justify-start\"\n                  size=\"sm\"\n                >\n                  <Settings className=\"h-4 w-4 mr-2\" />\n                  Settings (Stakes & Rules)\n                </Button>\n                <Button \n                  onClick={() => setShowTutorial(true)} \n                  variant=\"ghost\" \n                  className=\"w-full justify-start\"\n                  size=\"sm\"\n                >\n                  <BookOpen className=\"h-4 w-4 mr-2\" />\n                  Game Tutorial (Learn How to Play)\n                </Button>\n                <Button \n                  onClick={() => setShowWalkthrough(true)} \n                  variant=\"ghost\" \n                  className=\"w-full justify-start\"\n                  size=\"sm\"\n                >\n                  <HelpCircle className=\"h-4 w-4 mr-2\" />\n                  App Walkthrough (First Time Here?)\n                </Button>\n              </div>\n            </CardContent>\n          </Card>\n        </div>\n        \n        {/* Settings, Tutorial, Walkthrough, and Transaction History modals */}\n        <SettingsDialog open={showSettings} onClose={() => setShowSettings(false)} />\n        <Tutorial open={showTutorial} onClose={() => setShowTutorial(false)} />\n        <AppWalkthrough open={showWalkthrough} onClose={() => setShowWalkthrough(false)} />\n        <TransactionHistory open={showHistory} onClose={() => setShowHistory(false)} />\n      </>\n    );\n  }\n\n  // Multiplayer setup - only show if trying to connect AND not yet connected AND not in an active game\n  if (gameMode === 'online' && mode === 'local' && gamePhase === 'setup' && players.length === 0) {\n    console.log('Showing multiplayer setup');\n    return (\n      <MultiplayerSetup \n        onBack={() => setGameMode('menu')} \n        onConnected={() => {\n          console.log('âœ… GameUI: Multiplayer connected, staying in online mode');\n          // Don't change gameMode - just let the setup phase render\n        }}\n      />\n    );\n  }\n\n  // Setup phase (works for both local and online games)\n  if (gamePhase === 'setup') {\n    // Show room code for online games\n    const isOnline = mode === 'online';\n    console.log('=== SETUP PHASE ===');\n    console.log('gameMode:', gameMode, 'mode:', mode, 'roomCode:', roomCode, 'players:', players.length);\n    \n    return (\n      <div className=\"fixed inset-0 flex items-start justify-center pt-8 md:pt-16\" style={{ zIndex: 9999 }}>\n        <Card className=\"w-full max-w-md mx-4 shadow-2xl bg-white\">\n          <CardHeader>\n            <CardTitle className=\"text-center\">Shnarps</CardTitle>\n            <p className=\"text-center text-sm text-muted-foreground\">\n              {isOnline ? `ðŸŒ Online Room` : 'ðŸ  Local Game'} â€¢ {players.length}/8 players\n            </p>\n            {isOnline && roomCode && (\n              <div className=\"mt-2 p-3 bg-blue-50 rounded-lg text-center\">\n                <p className=\"text-xs text-blue-600 font-medium mb-1\">Share this code with friends:</p>\n                <p className=\"text-2xl font-bold text-blue-700 tracking-wider\">{roomCode}</p>\n              </div>\n            )}\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            {/* Current players - scrollable list */}\n            {players.length > 0 && (\n              <div className=\"space-y-2\">\n                <h3 className=\"font-semibold text-sm\">Players:</h3>\n                <div className=\"max-h-48 overflow-y-auto pr-2 space-y-1\">\n                  {players.map((player) => (\n                    <div key={player.id} className=\"flex items-center gap-3 py-1\">\n                      {player.avatar && <Avatar avatar={player.avatar} size=\"sm\" />}\n                      <div className=\"flex-1\">\n                        <div className=\"flex justify-between items-center\">\n                          <div className=\"flex items-center gap-2\">\n                            <span className=\"text-sm font-medium\">\n                              {player.name}\n                              {player.isAI && ` ðŸ¤– (${player.aiDifficulty || 'medium'})`}\n                            </span>\n                            {isOnline && !player.isAI && (\n                              <span className={`text-xs ${player.isConnected === false ? 'text-red-500' : 'text-green-500'}`}>\n                                {player.isConnected === false ? 'âš ï¸ Disconnected' : 'ðŸŸ¢'}\n                              </span>\n                            )}\n                          </div>\n                          <span className=\"text-sm text-muted-foreground\">\n                            Score: {scores.get(player.id) || 16}\n                          </span>\n                        </div>\n                        {!player.isAI && (\n                          <div className=\"text-xs text-green-600 font-medium\">\n                            ðŸª™ {(player.wallet || 100).toFixed(2)} coins\n                          </div>\n                        )}\n                      </div>\n                      {/* Remove button - only show if not local player and (in local mode OR host in online mode) */}\n                      {player.id !== localPlayerId && (!isOnline || isHost) && (\n                        <Button\n                          variant=\"ghost\"\n                          size=\"sm\"\n                          onClick={() => {\n                            if (isOnline && isHost) {\n                              removeMultiplayerPlayer(player.id);\n                            } else {\n                              removePlayer(player.id);\n                            }\n                          }}\n                          className=\"h-8 w-8 p-0 hover:bg-red-100 hover:text-red-600\"\n                        >\n                          <X className=\"h-4 w-4\" />\n                        </Button>\n                      )}\n                    </div>\n                  ))}\n                </div>\n              </div>\n            )}\n            \n            {/* Join game - only for local mode */}\n            {!isOnline && players.length < 8 && !localPlayer && (\n              <div className=\"space-y-3\">\n                <div className=\"flex items-center gap-3\">\n                  <div onClick={() => setShowAvatarCustomizer(true)} className=\"cursor-pointer\">\n                    <Avatar avatar={currentAvatar} size=\"md\" />\n                  </div>\n                  <div className=\"flex-1 space-y-2\">\n                    <Input\n                      placeholder=\"Enter your name\"\n                      value={playerName}\n                      onChange={(e) => setPlayerName(e.target.value)}\n                      onKeyDown={(e) => {\n                        if (e.key === 'Enter' && playerName.trim()) {\n                          joinGame(playerName.trim(), currentAvatar);\n                          setPlayerName('');\n                        }\n                      }}\n                    />\n                  </div>\n                </div>\n                <Button \n                  onClick={() => {\n                    if (playerName.trim()) {\n                      joinGame(playerName.trim(), currentAvatar);\n                      setPlayerName('');\n                    }\n                  }}\n                  disabled={!playerName.trim()}\n                  className=\"w-full\"\n                >\n                  Join Game\n                </Button>\n                <p className=\"text-xs text-center text-muted-foreground\">\n                  Click avatar to customize\n                </p>\n              </div>\n            )}\n            \n            {/* Add AI - for local or if host in online */}\n            {players.length < 8 && (!isOnline || isHost) && (\n              <div className=\"space-y-2\">\n                <label className=\"text-sm font-medium\">Add AI Player:</label>\n                <div className=\"flex gap-2\">\n                  <Select value={aiDifficulty} onValueChange={(value) => setAiDifficulty(value as AIDifficulty)}>\n                    <SelectTrigger className=\"flex-1\">\n                      <SelectValue placeholder=\"Difficulty\" />\n                    </SelectTrigger>\n                    <SelectContent className=\"bg-white border-gray-300\">\n                      <SelectItem value=\"easy\">Easy</SelectItem>\n                      <SelectItem value=\"medium\">Medium</SelectItem>\n                      <SelectItem value=\"hard\">Hard</SelectItem>\n                    </SelectContent>\n                  </Select>\n                  <Button \n                    onClick={() => {\n                      console.log('ðŸ¤– Add AI clicked - isOnline:', isOnline, 'isHost:', isHost);\n                      if (isOnline && isHost) {\n                        // Get random manly name for AI\n                        const aiPlayerNames = [\n                          'Jack', 'Luke', 'Cole', 'Ryan',\n                          'Jake', 'Tyler', 'Chase', 'Dylan',\n                          'Blake', 'Hunter', 'Mason', 'Logan',\n                          'Austin', 'Carter', 'Wyatt', 'Cody',\n                          'Trevor', 'Connor', 'Brett', 'Shane'\n                        ];\n                        const usedNames = players.map(p => p.name);\n                        const availableNames = aiPlayerNames.filter(name => !usedNames.includes(name));\n                        const aiName = availableNames.length > 0 \n                          ? availableNames[Math.floor(Math.random() * availableNames.length)]\n                          : `AI ${players.length + 1}`;\n                        console.log('Adding multiplayer AI:', aiName, aiDifficulty);\n                        addMultiplayerAI(aiName, aiDifficulty);\n                      } else {\n                        console.log('Adding local AI:', aiDifficulty);\n                        addAIPlayer(aiDifficulty);\n                      }\n                    }}\n                    variant=\"outline\"\n                    className=\"flex-1\"\n                  >\n                    ðŸ¤– Add AI\n                  </Button>\n                </div>\n              </div>\n            )}\n            \n            {/* Start game */}\n            {players.length >= 4 && (!isOnline || isHost) && (\n              <Button \n                onClick={() => {\n                  if (isOnline && isHost) {\n                    startMultiplayerGame();\n                  } else {\n                    startGame();\n                  }\n                }} \n                className=\"w-full\" \n                variant=\"default\"\n              >\n                Start Game ({players.length} players)\n              </Button>\n            )}\n            \n            {players.length < 4 && (\n              <p className=\"text-center text-sm text-muted-foreground\">\n                Need at least 4 players to start\n              </p>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  // Trump selection phase - only show UI if you won the bid\n  if (gamePhase === 'trump_selection' && isHighestBidder) {\n    return (\n      <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n        <Card className=\"w-full max-w-md bg-gray-900 bg-opacity-80 text-white\">\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-center text-white text-lg md:text-xl\">Choose Trump Suit</CardTitle>\n            <p className=\"text-center text-sm text-gray-300\">\n              You won the bid! Select the trump suit.\n            </p>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            <div className=\"space-y-3\">\n              <div className=\"grid grid-cols-2 gap-3\">\n                {[\n                  { suit: 'hearts', symbol: 'â™¥', color: 'text-red-500' },\n                  { suit: 'diamonds', symbol: 'â™¦', color: 'text-red-500' },\n                  { suit: 'clubs', symbol: 'â™£', color: 'text-white' },\n                  { suit: 'spades', symbol: 'â™ ', color: 'text-white' }\n                ].map(({ suit, symbol, color }) => (\n                  <Button\n                    key={suit}\n                    variant={trumpSuit === suit ? \"default\" : \"outline\"}\n                    onClick={() => setTrumpSuit(suit)}\n                    className=\"h-20 flex flex-col touch-manipulation\"\n                  >\n                    <span className={`text-3xl ${color}`}>{symbol}</span>\n                    <span className=\"text-sm capitalize text-white\">{suit}</span>\n                  </Button>\n                ))}\n              </div>\n              \n              <Button \n                onClick={() => {\n                  if (trumpSuit) {\n                    chooseTrumpSuit(trumpSuit);\n                    setTrumpSuit('');\n                  }\n                }}\n                disabled={!trumpSuit}\n                className=\"w-full h-12 text-base touch-manipulation\"\n              >\n                Choose {trumpSuit}\n              </Button>\n            </div>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  // Everyone sat out phase\n  if (gamePhase === 'everyone_sat') {\n    const bidder = players.find(p => p.id === highestBidder);\n    const isBidder = highestBidder === localPlayerId;\n    \n    return (\n      <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n        <Card className=\"w-full max-w-md bg-gray-900 bg-opacity-80 text-white\">\n          <CardHeader className=\"pb-3\">\n            <CardTitle className=\"text-center text-white text-lg md:text-xl\">Everyone Sat Out!</CardTitle>\n            <p className=\"text-center text-sm text-gray-300\">\n              {isBidder ? 'Choose your penalty:' : `Waiting for ${bidder?.name} to choose penalty...`}\n            </p>\n          </CardHeader>\n          <CardContent className=\"space-y-3\">\n            {isBidder ? (\n              <div className=\"space-y-3\">\n                <p className=\"text-sm text-center text-gray-200\">\n                  Everyone sat out. You can either:\n                </p>\n                <Button\n                  variant=\"outline\"\n                  onClick={() => choosePenalty('self')}\n                  className=\"w-full h-auto flex flex-col gap-1 py-4 text-white border-gray-600 hover:bg-gray-700 touch-manipulation\"\n                >\n                  <span className=\"font-semibold text-base\">Take -5 to my score</span>\n                  <span className=\"text-xs text-gray-300\">Reduce your score by 5 points</span>\n                </Button>\n                <Button\n                  variant=\"outline\"\n                  onClick={() => choosePenalty('others')}\n                  className=\"w-full h-auto flex flex-col gap-1 py-4 text-white border-gray-600 hover:bg-gray-700 touch-manipulation\"\n                >\n                  <span className=\"font-semibold text-base\">Give +5 to all others</span>\n                  <span className=\"text-xs text-gray-300\">Add 5 points to everyone else's score</span>\n                </Button>\n              </div>\n            ) : (\n              <p className=\"text-center text-sm text-gray-300\">\n                {bidder?.name} is deciding the penalty...\n              </p>\n            )}\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  // Game over phase\n  if (gamePhase === 'game_over') {\n    // Get the last round history to see money changes\n    const lastRound = history[history.length - 1];\n    const moneyChanges = lastRound?.moneyChanges || new Map<string, number>();\n    \n    // Combine active players and eliminated players for final scoreboard\n    const allPlayers = [...players, ...(eliminatedPlayers || [])];\n    \n    // Find the winner (player with score <= 0)\n    const winner = allPlayers.find(p => (scores.get(p.id) ?? 16) <= 0);\n    \n    // Sort players: winner first, then by score (lowest to highest)\n    const sortedPlayers = allPlayers\n      .map(player => ({\n        ...player,\n        score: scores.get(player.id) ?? 16,\n        wallet: player.wallet || 100,\n        moneyChange: moneyChanges.get(player.id) || 0,\n        punts: player.punts || 0,\n        isEliminated: (scores.get(player.id) ?? 16) > 32\n      }))\n      .sort((a, b) => {\n        // Winner (score <= 0) comes first\n        if (a.id === winner?.id) return -1;\n        if (b.id === winner?.id) return 1;\n        // Then sort by score\n        return a.score - b.score;\n      });\n    \n    // Calculate total pot\n    const totalPot = sortedPlayers.reduce((sum, p) => {\n      if (p.id !== winner?.id) {\n        const pointsCost = p.score * 0.25;\n        const puntsCost = p.punts * 1.0;\n        return sum + pointsCost + puntsCost;\n      }\n      return sum;\n    }, 0);\n    \n    return (\n      <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n        <Card className=\"w-full max-w-md bg-gray-900 bg-opacity-80 text-white flex flex-col max-h-[90vh]\">\n          <CardHeader className=\"pb-3 flex-shrink-0\">\n            <CardTitle className=\"text-center text-white text-xl md:text-2xl\">Game Over!</CardTitle>\n            <div className=\"text-center mt-2 mb-3 py-2 bg-green-900 bg-opacity-40 rounded border border-green-500\">\n              <p className=\"text-2xl md:text-3xl font-bold text-green-400\">\n                ðŸŽ‰ {winner?.name} ðŸŽ‰\n              </p>\n              <p className=\"text-sm text-green-300 mt-1\">Winner!</p>\n            </div>\n            <p className=\"text-center text-sm text-yellow-400 font-bold\">\n              Total Pot: ${totalPot.toFixed(2)}\n            </p>\n          </CardHeader>\n          <CardContent className=\"space-y-3 overflow-y-auto flex-1\">\n            <div className=\"space-y-2 pb-2\">\n              <h3 className=\"font-semibold text-sm text-white sticky top-0 bg-gray-900 py-1 z-10\">Final Results:</h3>\n              {sortedPlayers.map((player, index) => {\n                const isWinner = player.id === winner?.id;\n                const pointsCost = player.score * 0.25;\n                const puntsCost = player.punts * 1.0;\n                const totalOwed = pointsCost + puntsCost;\n                \n                return (\n                  <div key={player.id} className={`bg-gray-800 bg-opacity-50 rounded p-2 space-y-1 ${player.isEliminated ? 'opacity-75' : ''}`}>\n                    <div className=\"flex justify-between text-sm\">\n                      <span className=\"flex items-center gap-1 truncate max-w-[140px] font-semibold\">\n                        {isWinner && <span className=\"text-yellow-400\">ðŸ‘‘</span>}\n                        {player.name}\n                        {player.isEliminated && <span className=\"text-red-400 text-xs ml-1\">(Elim)</span>}\n                      </span>\n                      <span className={`font-mono text-sm ${player.score <= 0 ? 'text-green-400' : player.score > 32 ? 'text-red-400' : 'text-gray-200'}`}>\n                        {player.score} pts\n                      </span>\n                    </div>\n                    \n                    <div className=\"text-xs text-gray-300\">\n                      <div className=\"flex justify-between\">\n                        <span>Punts: {player.punts}</span>\n                        <span>ðŸª™ {player.wallet.toFixed(2)} coins</span>\n                      </div>\n                    </div>\n                    \n                    {!isWinner && (\n                      <div className=\"text-xs border-t border-gray-600 pt-1\">\n                        <div className=\"flex justify-between text-gray-400\">\n                          <span>{player.score} pts Ã— ðŸª™0.25</span>\n                          <span>ðŸª™{pointsCost.toFixed(2)}</span>\n                        </div>\n                        <div className=\"flex justify-between text-gray-400\">\n                          <span>{player.punts} punts Ã— ðŸª™1.00</span>\n                          <span>ðŸª™{puntsCost.toFixed(2)}</span>\n                        </div>\n                        <div className=\"flex justify-between font-semibold text-red-400 border-t border-gray-700 pt-1\">\n                          <span>Total Owed:</span>\n                          <span>-ðŸª™{totalOwed.toFixed(2)}</span>\n                        </div>\n                      </div>\n                    )}\n                    \n                    {isWinner && (\n                      <div className=\"text-xs border-t border-gray-600 pt-1\">\n                        <div className=\"flex justify-between font-semibold text-green-400\">\n                          <span>Won:</span>\n                          <span>+ðŸª™{totalPot.toFixed(2)}</span>\n                        </div>\n                        <div className=\"text-[10px] text-gray-400 mt-1\">\n                          Owes: ðŸª™0.00\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                );\n              })}\n            </div>\n          </CardContent>\n          <div className=\"p-6 pt-0 flex-shrink-0\">\n            <Button onClick={resetGame} className=\"w-full h-12 text-base touch-manipulation\">\n              {mode === 'online' ? 'Return to Menu' : 'Play Again'}\n            </Button>\n          </div>\n        </Card>\n      </div>\n    );\n  }\n\n  // Check if local player is eliminated\n  const localPlayerScore = localPlayerId ? scores.get(localPlayerId) : undefined;\n  const isLocalPlayerEliminated = localPlayerScore !== undefined && localPlayerScore > 32;\n\n  // Phase-specific UI overlays\n  return (\n    <div>\n      {/* Turn timer (multiplayer only) */}\n      <TurnTimer />\n\n      {/* Phase-specific overlays */}\n      {gamePhase === 'bidding' && <BiddingPhase />}\n      {gamePhase === 'sit_pass' && <SitPassPhase />}\n      {gamePhase === 'hand_play' && <HandPlayPhase />}\n\n      {/* Game history */}\n      {gamePhase !== 'setup' && <GameHistory />}\n\n      {/* Eliminated player - Simulate to End option */}\n      {isLocalPlayerEliminated && !isSimulating && gamePhase !== 'game_over' && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4\">\n          <Card className=\"w-full max-w-md bg-gray-900 bg-opacity-95 text-white\">\n            <CardHeader>\n              <CardTitle className=\"text-center text-red-400 text-xl\">You've Been Eliminated!</CardTitle>\n              <p className=\"text-center text-sm text-gray-300 mt-2\">\n                Your score went over 32 points. You're out of the game, but you can watch the bots play or simulate to the end.\n              </p>\n            </CardHeader>\n            <CardContent className=\"space-y-3\">\n              <Button \n                onClick={() => setSimulating(true)} \n                className=\"w-full h-12 text-base touch-manipulation bg-blue-600 hover:bg-blue-700\"\n              >\n                âš¡ Simulate to End\n              </Button>\n              <p className=\"text-xs text-center text-gray-400\">\n                Or continue watching the bots play\n              </p>\n            </CardContent>\n          </Card>\n        </div>\n      )}\n\n      {/* Simulating overlay */}\n      {isSimulating && gamePhase !== 'game_over' && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50\">\n          <Card className=\"w-full max-w-sm bg-gray-900 bg-opacity-95 text-white\">\n            <CardContent className=\"py-8 text-center\">\n              <div className=\"text-4xl mb-4\">âš¡</div>\n              <p className=\"text-xl font-semibold mb-2\">Simulating...</p>\n              <p className=\"text-sm text-gray-400\">Fast-forwarding to the end</p>\n            </CardContent>\n          </Card>\n        </div>\n      )}\n\n      {/* Avatar customizer */}\n      <AvatarCustomizer\n        open={showAvatarCustomizer}\n        onClose={() => setShowAvatarCustomizer(false)}\n        currentAvatar={currentAvatar}\n        onSave={(avatar) => setCurrentAvatar(avatar)}\n      />\n    </div>\n  );\n}\n","size_bytes":28905},"client/src/components/game/Tutorial.tsx":{"content":"import { useState } from 'react';\nimport { Button } from '../ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '../ui/card';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '../ui/dialog';\nimport { ChevronLeft, ChevronRight, X } from 'lucide-react';\n\ninterface TutorialProps {\n  open: boolean;\n  onClose: () => void;\n}\n\nconst tutorialSteps = [\n  {\n    title: \"Welcome to Shnarps!\",\n    content: (\n      <div className=\"space-y-3\">\n        <p>Shnarps is a trick-taking card game for 4-8 players where you start at 16 points and race to reach 0 or below to win!</p>\n        <p className=\"font-semibold text-blue-600\">Goal: Be the first to reach 0 points (or lower)</p>\n        <div className=\"bg-yellow-50 p-3 rounded-lg border border-yellow-200\">\n          <p className=\"text-sm\">âš ï¸ <strong>Watch out!</strong> If you go over 32 points, you're eliminated!</p>\n        </div>\n      </div>\n    )\n  },\n  {\n    title: \"Game Setup\",\n    content: (\n      <div className=\"space-y-3\">\n        <p><strong>Players:</strong> 4-8 players (humans or AI)</p>\n        <p><strong>Starting Score:</strong> Everyone starts at 16 points</p>\n        <p><strong>The Deck:</strong> Standard 52-card deck</p>\n        <div className=\"bg-blue-50 p-3 rounded-lg\">\n          <p className=\"text-sm\"><strong>Card Order (Highest to Lowest):</strong></p>\n          <p className=\"text-sm\">A, K, Q, J, 10, 9, 8, 7, 6, 5, 4, 3, 2</p>\n        </div>\n      </div>\n    )\n  },\n  {\n    title: \"Phase 1: Bidding\",\n    content: (\n      <div className=\"space-y-3\">\n        <p>Players take turns bidding on how many tricks they think they can win (1-5) or they can pass.</p>\n        <div className=\"space-y-2\">\n          <div className=\"bg-green-50 p-2 rounded\">\n            <p className=\"text-sm\"><strong>Bid 1-5:</strong> You think you can win that many tricks</p>\n          </div>\n          <div className=\"bg-purple-50 p-2 rounded\">\n            <p className=\"text-sm\"><strong>Pass/Punt (0):</strong> You don't want to win ANY tricks</p>\n          </div>\n        </div>\n        <p className=\"text-sm text-muted-foreground\">The highest bidder wins the bid and gets to choose the trump suit!</p>\n      </div>\n    )\n  },\n  {\n    title: \"Phase 2: Trump Selection\",\n    content: (\n      <div className=\"space-y-3\">\n        <p>The highest bidder chooses one suit to be <strong>trump</strong>.</p>\n        <div className=\"bg-red-50 p-3 rounded-lg border border-red-200\">\n          <p className=\"text-sm\"><strong>What is Trump?</strong></p>\n          <p className=\"text-sm\">Trump cards beat all other suits, no matter the rank!</p>\n          <p className=\"text-sm mt-2\">Example: A 2 of trump beats an Ace of any other suit</p>\n        </div>\n      </div>\n    )\n  },\n  {\n    title: \"Phase 3: Sit or Play\",\n    content: (\n      <div className=\"space-y-3\">\n        <p>After trump is chosen, each player (except the bidder) decides:</p>\n        <div className=\"space-y-2\">\n          <div className=\"bg-blue-50 p-2 rounded\">\n            <p className=\"text-sm\"><strong>Play:</strong> Compete to win tricks</p>\n          </div>\n          <div className=\"bg-gray-50 p-2 rounded\">\n            <p className=\"text-sm\"><strong>Sit:</strong> Skip this round (no risk, no reward)</p>\n          </div>\n        </div>\n        <div className=\"bg-yellow-50 p-3 rounded-lg border border-yellow-200 mt-2\">\n          <p className=\"text-sm\"><strong>Musty Rule:</strong> If you sit 2 rounds in a row, you MUST play the next round!</p>\n        </div>\n        <div className=\"bg-green-50 p-3 rounded-lg border border-green-200 mt-2\">\n          <p className=\"text-sm\"><strong>Bonus:</strong> If you sit while at 4 points or less, you get +1 point!</p>\n        </div>\n      </div>\n    )\n  },\n  {\n    title: \"Phase 4: Playing Tricks\",\n    content: (\n      <div className=\"space-y-3\">\n        <p>Players who chose to play now compete in tricks:</p>\n        <ol className=\"list-decimal list-inside space-y-2 text-sm\">\n          <li>Lead player plays any card</li>\n          <li>Other players must <strong>follow suit</strong> if possible</li>\n          <li>If you can't follow suit, play any card (including trump!)</li>\n          <li>Highest card of the lead suit wins... <strong>unless trump is played!</strong></li>\n          <li>Highest trump card wins the trick</li>\n        </ol>\n      </div>\n    )\n  },\n  {\n    title: \"Scoring\",\n    content: (\n      <div className=\"space-y-3\">\n        <p className=\"font-semibold\">The goal is to reach 0 or lower!</p>\n        <div className=\"space-y-2\">\n          <div className=\"bg-purple-50 p-3 rounded-lg\">\n            <p className=\"text-sm font-semibold\">Punt (bid 0):</p>\n            <p className=\"text-sm\">âœ… Win 0 tricks = <strong>+5 points</strong></p>\n            <p className=\"text-sm\">âŒ Win any tricks = <strong>-1 per trick</strong></p>\n          </div>\n          <div className=\"bg-blue-50 p-3 rounded-lg\">\n            <p className=\"text-sm font-semibold\">Regular Bid (1-5):</p>\n            <p className=\"text-sm\"><strong>-1 point per trick won</strong> (regardless of bid)</p>\n          </div>\n        </div>\n        <div className=\"bg-red-50 p-3 rounded-lg border border-red-200 mt-3\">\n          <p className=\"text-sm\"><strong>âš ï¸ Elimination:</strong> Go over 32 points and you're out!</p>\n        </div>\n      </div>\n    )\n  },\n  {\n    title: \"Special Rules\",\n    content: (\n      <div className=\"space-y-3\">\n        <div className=\"bg-yellow-50 p-3 rounded-lg border border-yellow-200\">\n          <p className=\"text-sm font-semibold\">ðŸŽ¯ Everyone Sat Out:</p>\n          <p className=\"text-sm\">If everyone sits, the bidder chooses:</p>\n          <p className=\"text-sm\">â€¢ Take -5 points themselves, OR</p>\n          <p className=\"text-sm\">â€¢ Give +5 points to everyone else</p>\n        </div>\n        <div className=\"bg-green-50 p-3 rounded-lg border border-green-200\">\n          <p className=\"text-sm font-semibold\">ðŸ† Spading Out (Instant Win):</p>\n          <p className=\"text-sm\">Win all tricks when spades are trump = instant victory!</p>\n        </div>\n      </div>\n    )\n  },\n  {\n    title: \"Strategy Tips\",\n    content: (\n      <div className=\"space-y-2\">\n        <p className=\"font-semibold mb-2\">ðŸ’¡ Pro Tips:</p>\n        <ul className=\"list-disc list-inside space-y-1 text-sm\">\n          <li>Punting is risky but gives big rewards if successful</li>\n          <li>Watch your opponents' scores - prevent them from winning!</li>\n          <li>High cards are powerful, but trump beats everything</li>\n          <li>Sitting can be strategic when you have a bad hand</li>\n          <li>Don't forget the musty rule - plan ahead!</li>\n          <li>At 4 points or less, sitting gives you a bonus point</li>\n        </ul>\n      </div>\n    )\n  },\n  {\n    title: \"Ready to Play!\",\n    content: (\n      <div className=\"space-y-3 text-center\">\n        <p className=\"text-lg font-semibold\">You're all set! ðŸŽ‰</p>\n        <p>Start a game and put your skills to the test.</p>\n        <div className=\"bg-blue-50 p-3 rounded-lg\">\n          <p className=\"text-sm font-semibold\">Quick Recap:</p>\n          <p className=\"text-sm\">Bid â†’ Choose Trump â†’ Sit/Play â†’ Win Tricks â†’ Score Points</p>\n          <p className=\"text-sm mt-2\"><strong>Goal: Reach 0 points first!</strong></p>\n        </div>\n      </div>\n    )\n  }\n];\n\nexport default function Tutorial({ open, onClose }: TutorialProps) {\n  const [currentStep, setCurrentStep] = useState(0);\n\n  const handleNext = () => {\n    if (currentStep < tutorialSteps.length - 1) {\n      setCurrentStep(currentStep + 1);\n    } else {\n      onClose();\n    }\n  };\n\n  const handlePrevious = () => {\n    if (currentStep > 0) {\n      setCurrentStep(currentStep - 1);\n    }\n  };\n\n  const handleClose = () => {\n    setCurrentStep(0);\n    onClose();\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={handleClose}>\n      <DialogContent className=\"sm:max-w-2xl bg-white max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <div className=\"flex items-center justify-between\">\n            <DialogTitle>{tutorialSteps[currentStep].title}</DialogTitle>\n            <Button variant=\"ghost\" size=\"sm\" onClick={handleClose} className=\"h-8 w-8 p-0\">\n              <X className=\"h-4 w-4\" />\n            </Button>\n          </div>\n          <div className=\"flex items-center gap-2 mt-2\">\n            <div className=\"flex-1 bg-gray-200 rounded-full h-2\">\n              <div\n                className=\"bg-blue-500 h-2 rounded-full transition-all\"\n                style={{ width: `${((currentStep + 1) / tutorialSteps.length) * 100}%` }}\n              />\n            </div>\n            <span className=\"text-sm text-muted-foreground\">\n              {currentStep + 1}/{tutorialSteps.length}\n            </span>\n          </div>\n        </DialogHeader>\n\n        <div className=\"py-4\">\n          {tutorialSteps[currentStep].content}\n        </div>\n\n        <div className=\"flex justify-between pt-4 border-t\">\n          <Button\n            onClick={handlePrevious}\n            disabled={currentStep === 0}\n            variant=\"outline\"\n          >\n            <ChevronLeft className=\"h-4 w-4 mr-1\" />\n            Previous\n          </Button>\n          <Button onClick={handleNext}>\n            {currentStep === tutorialSteps.length - 1 ? (\n              \"Start Playing!\"\n            ) : (\n              <>\n                Next\n                <ChevronRight className=\"h-4 w-4 ml-1\" />\n              </>\n            )}\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":9560},"client/src/components/game/Card.tsx":{"content":"import { motion } from 'framer-motion';\nimport { Card as CardType, getSuitColor, getSuitSymbol } from '../../lib/game/cardUtils';\n\ninterface CardProps {\n  card: CardType;\n  isSelected?: boolean;\n  isPlayable?: boolean;\n  onClick?: () => void;\n  className?: string;\n  faceDown?: boolean;\n  delay?: number;\n}\n\nexport default function Card({ \n  card, \n  isSelected = false,\n  isPlayable = true,\n  onClick,\n  className = '',\n  faceDown = false,\n  delay = 0\n}: CardProps) {\n  const suitColor = getSuitColor(card.suit);\n  const suitSymbol = getSuitSymbol(card.suit);\n  \n  if (faceDown) {\n    return (\n      <motion.div \n        initial={{ opacity: 0, scale: 0.5, rotateY: 180 }}\n        animate={{ opacity: 1, scale: 1, rotateY: 0 }}\n        transition={{ duration: 0.3, delay }}\n        className={`w-7 h-10 sm:w-8 sm:h-12 bg-blue-700 border border-blue-900 rounded shadow-md ${className}`}\n      >\n        <div className=\"w-full h-full flex items-center justify-center\">\n          <div className=\"text-blue-900 text-sm sm:text-base\">ðŸ‚ </div>\n        </div>\n      </motion.div>\n    );\n  }\n\n  return (\n    <motion.button\n      initial={{ opacity: 0, scale: 0.5, y: -50 }}\n      animate={{ \n        opacity: 1, \n        scale: 1, \n        y: isSelected ? -8 : 0 \n      }}\n      whileHover={isPlayable ? { scale: 1.05 } : {}}\n      whileTap={isPlayable ? { scale: 0.95 } : {}}\n      transition={{ duration: 0.3, delay }}\n      onClick={isPlayable ? onClick : undefined}\n      disabled={!isPlayable}\n      className={`\n        w-20 h-28 sm:w-16 sm:h-24 bg-white border-2 rounded-lg shadow-lg\n        flex flex-col relative touch-manipulation\n        ${isSelected ? 'border-blue-500 shadow-xl' : 'border-gray-300'}\n        ${isPlayable ? 'cursor-pointer active:scale-95' : 'opacity-60 cursor-not-allowed'}\n        ${className}\n      `}\n    >\n      {/* Top left corner */}\n      <div className=\"absolute top-1 left-1 flex flex-col items-center leading-none\">\n        <span className=\"text-xs font-bold\" style={{ color: suitColor }}>\n          {card.rank}\n        </span>\n        <span className=\"text-sm\" style={{ color: suitColor }}>\n          {suitSymbol}\n        </span>\n      </div>\n\n      {/* Center suit */}\n      <div className=\"flex-1 flex items-center justify-center\">\n        <span className=\"text-3xl\" style={{ color: suitColor }}>\n          {suitSymbol}\n        </span>\n      </div>\n\n      {/* Bottom right corner (rotated) */}\n      <div className=\"absolute bottom-1 right-1 flex flex-col items-center leading-none rotate-180\">\n        <span className=\"text-xs font-bold\" style={{ color: suitColor }}>\n          {card.rank}\n        </span>\n        <span className=\"text-sm\" style={{ color: suitColor }}>\n          {suitSymbol}\n        </span>\n      </div>\n    </motion.button>\n  );\n}\n","size_bytes":2788},"client/src/components/ui/switch.tsx":{"content":"import * as React from \"react\"\nimport * as SwitchPrimitives from \"@radix-ui/react-switch\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Switch = React.forwardRef<\n  React.ElementRef<typeof SwitchPrimitives.Root>,\n  React.ComponentPropsWithoutRef<typeof SwitchPrimitives.Root>\n>(({ className, ...props }, ref) => (\n  <SwitchPrimitives.Root\n    className={cn(\n      \"peer inline-flex h-5 w-9 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent shadow-sm transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  >\n    <SwitchPrimitives.Thumb\n      className={cn(\n        \"pointer-events-none block h-4 w-4 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-4 data-[state=unchecked]:translate-x-0\"\n      )}\n    />\n  </SwitchPrimitives.Root>\n))\nSwitch.displayName = SwitchPrimitives.Root.displayName\n\nexport { Switch }\n","size_bytes":1148},"client/src/components/ui/drawer.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport { Drawer as DrawerPrimitive } from \"vaul\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Drawer = ({\n  shouldScaleBackground = true,\n  ...props\n}: React.ComponentProps<typeof DrawerPrimitive.Root>) => (\n  <DrawerPrimitive.Root\n    shouldScaleBackground={shouldScaleBackground}\n    {...props}\n  />\n)\nDrawer.displayName = \"Drawer\"\n\nconst DrawerTrigger = DrawerPrimitive.Trigger\n\nconst DrawerPortal = DrawerPrimitive.Portal\n\nconst DrawerClose = DrawerPrimitive.Close\n\nconst DrawerOverlay = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Overlay\n    ref={ref}\n    className={cn(\"fixed inset-0 z-50 bg-black/80\", className)}\n    {...props}\n  />\n))\nDrawerOverlay.displayName = DrawerPrimitive.Overlay.displayName\n\nconst DrawerContent = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Content>\n>(({ className, children, ...props }, ref) => (\n  <DrawerPortal>\n    <DrawerOverlay />\n    <DrawerPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed inset-x-0 bottom-0 z-50 mt-24 flex h-auto flex-col rounded-t-[10px] border bg-background\",\n        className\n      )}\n      {...props}\n    >\n      <div className=\"mx-auto mt-4 h-2 w-[100px] rounded-full bg-muted\" />\n      {children}\n    </DrawerPrimitive.Content>\n  </DrawerPortal>\n))\nDrawerContent.displayName = \"DrawerContent\"\n\nconst DrawerHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"grid gap-1.5 p-4 text-center sm:text-left\", className)}\n    {...props}\n  />\n)\nDrawerHeader.displayName = \"DrawerHeader\"\n\nconst DrawerFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\"mt-auto flex flex-col gap-2 p-4\", className)}\n    {...props}\n  />\n)\nDrawerFooter.displayName = \"DrawerFooter\"\n\nconst DrawerTitle = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Title\n    ref={ref}\n    className={cn(\n      \"text-lg font-semibold leading-none tracking-tight\",\n      className\n    )}\n    {...props}\n  />\n))\nDrawerTitle.displayName = DrawerPrimitive.Title.displayName\n\nconst DrawerDescription = React.forwardRef<\n  React.ElementRef<typeof DrawerPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof DrawerPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <DrawerPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nDrawerDescription.displayName = DrawerPrimitive.Description.displayName\n\nexport {\n  Drawer,\n  DrawerPortal,\n  DrawerOverlay,\n  DrawerTrigger,\n  DrawerClose,\n  DrawerContent,\n  DrawerHeader,\n  DrawerFooter,\n  DrawerTitle,\n  DrawerDescription,\n}\n","size_bytes":3021},"client/src/components/ui/separator.tsx":{"content":"import * as React from \"react\"\nimport * as SeparatorPrimitive from \"@radix-ui/react-separator\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Separator = React.forwardRef<\n  React.ElementRef<typeof SeparatorPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SeparatorPrimitive.Root>\n>(\n  (\n    { className, orientation = \"horizontal\", decorative = true, ...props },\n    ref\n  ) => (\n    <SeparatorPrimitive.Root\n      ref={ref}\n      decorative={decorative}\n      orientation={orientation}\n      className={cn(\n        \"shrink-0 bg-border\",\n        orientation === \"horizontal\" ? \"h-[1px] w-full\" : \"h-full w-[1px]\",\n        className\n      )}\n      {...props}\n    />\n  )\n)\nSeparator.displayName = SeparatorPrimitive.Root.displayName\n\nexport { Separator }\n","size_bytes":756},"client/src/components/ui/form.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport {\n  Controller,\n  FormProvider,\n  useFormContext,\n  type ControllerProps,\n  type FieldPath,\n  type FieldValues,\n} from \"react-hook-form\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Label } from \"@/components/ui/label\"\n\nconst Form = FormProvider\n\ntype FormFieldContextValue<\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n> = {\n  name: TName\n}\n\nconst FormFieldContext = React.createContext<FormFieldContextValue>(\n  {} as FormFieldContextValue\n)\n\nconst FormField = <\n  TFieldValues extends FieldValues = FieldValues,\n  TName extends FieldPath<TFieldValues> = FieldPath<TFieldValues>\n>({\n  ...props\n}: ControllerProps<TFieldValues, TName>) => {\n  return (\n    <FormFieldContext.Provider value={{ name: props.name }}>\n      <Controller {...props} />\n    </FormFieldContext.Provider>\n  )\n}\n\nconst useFormField = () => {\n  const fieldContext = React.useContext(FormFieldContext)\n  const itemContext = React.useContext(FormItemContext)\n  const { getFieldState, formState } = useFormContext()\n\n  const fieldState = getFieldState(fieldContext.name, formState)\n\n  if (!fieldContext) {\n    throw new Error(\"useFormField should be used within <FormField>\")\n  }\n\n  const { id } = itemContext\n\n  return {\n    id,\n    name: fieldContext.name,\n    formItemId: `${id}-form-item`,\n    formDescriptionId: `${id}-form-item-description`,\n    formMessageId: `${id}-form-item-message`,\n    ...fieldState,\n  }\n}\n\ntype FormItemContextValue = {\n  id: string\n}\n\nconst FormItemContext = React.createContext<FormItemContextValue>(\n  {} as FormItemContextValue\n)\n\nconst FormItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const id = React.useId()\n\n  return (\n    <FormItemContext.Provider value={{ id }}>\n      <div ref={ref} className={cn(\"space-y-2\", className)} {...props} />\n    </FormItemContext.Provider>\n  )\n})\nFormItem.displayName = \"FormItem\"\n\nconst FormLabel = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  const { error, formItemId } = useFormField()\n\n  return (\n    <Label\n      ref={ref}\n      className={cn(error && \"text-destructive\", className)}\n      htmlFor={formItemId}\n      {...props}\n    />\n  )\n})\nFormLabel.displayName = \"FormLabel\"\n\nconst FormControl = React.forwardRef<\n  React.ElementRef<typeof Slot>,\n  React.ComponentPropsWithoutRef<typeof Slot>\n>(({ ...props }, ref) => {\n  const { error, formItemId, formDescriptionId, formMessageId } = useFormField()\n\n  return (\n    <Slot\n      ref={ref}\n      id={formItemId}\n      aria-describedby={\n        !error\n          ? `${formDescriptionId}`\n          : `${formDescriptionId} ${formMessageId}`\n      }\n      aria-invalid={!!error}\n      {...props}\n    />\n  )\n})\nFormControl.displayName = \"FormControl\"\n\nconst FormDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => {\n  const { formDescriptionId } = useFormField()\n\n  return (\n    <p\n      ref={ref}\n      id={formDescriptionId}\n      className={cn(\"text-[0.8rem] text-muted-foreground\", className)}\n      {...props}\n    />\n  )\n})\nFormDescription.displayName = \"FormDescription\"\n\nconst FormMessage = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, children, ...props }, ref) => {\n  const { error, formMessageId } = useFormField()\n  const body = error ? String(error?.message ?? \"\") : children\n\n  if (!body) {\n    return null\n  }\n\n  return (\n    <p\n      ref={ref}\n      id={formMessageId}\n      className={cn(\"text-[0.8rem] font-medium text-destructive\", className)}\n      {...props}\n    >\n      {body}\n    </p>\n  )\n})\nFormMessage.displayName = \"FormMessage\"\n\nexport {\n  useFormField,\n  Form,\n  FormItem,\n  FormLabel,\n  FormControl,\n  FormDescription,\n  FormMessage,\n  FormField,\n}\n","size_bytes":4132},"client/src/components/ui/input-otp.tsx":{"content":"import * as React from \"react\"\nimport { OTPInput, OTPInputContext } from \"input-otp\"\nimport { Minus } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst InputOTP = React.forwardRef<\n  React.ElementRef<typeof OTPInput>,\n  React.ComponentPropsWithoutRef<typeof OTPInput>\n>(({ className, containerClassName, ...props }, ref) => (\n  <OTPInput\n    ref={ref}\n    containerClassName={cn(\n      \"flex items-center gap-2 has-[:disabled]:opacity-50\",\n      containerClassName\n    )}\n    className={cn(\"disabled:cursor-not-allowed\", className)}\n    {...props}\n  />\n))\nInputOTP.displayName = \"InputOTP\"\n\nconst InputOTPGroup = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ className, ...props }, ref) => (\n  <div ref={ref} className={cn(\"flex items-center\", className)} {...props} />\n))\nInputOTPGroup.displayName = \"InputOTPGroup\"\n\nconst InputOTPSlot = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\"> & { index: number }\n>(({ index, className, ...props }, ref) => {\n  const inputOTPContext = React.useContext(OTPInputContext)\n  const { char, hasFakeCaret, isActive } = inputOTPContext.slots[index]\n\n  return (\n    <div\n      ref={ref}\n      className={cn(\n        \"relative flex h-9 w-9 items-center justify-center border-y border-r border-input text-sm shadow-sm transition-all first:rounded-l-md first:border-l last:rounded-r-md\",\n        isActive && \"z-10 ring-1 ring-ring\",\n        className\n      )}\n      {...props}\n    >\n      {char}\n      {hasFakeCaret && (\n        <div className=\"pointer-events-none absolute inset-0 flex items-center justify-center\">\n          <div className=\"h-4 w-px animate-caret-blink bg-foreground duration-1000\" />\n        </div>\n      )}\n    </div>\n  )\n})\nInputOTPSlot.displayName = \"InputOTPSlot\"\n\nconst InputOTPSeparator = React.forwardRef<\n  React.ElementRef<\"div\">,\n  React.ComponentPropsWithoutRef<\"div\">\n>(({ ...props }, ref) => (\n  <div ref={ref} role=\"separator\" {...props}>\n    <Minus />\n  </div>\n))\nInputOTPSeparator.displayName = \"InputOTPSeparator\"\n\nexport { InputOTP, InputOTPGroup, InputOTPSlot, InputOTPSeparator }\n","size_bytes":2143},"client/src/components/game/GameHistory.tsx":{"content":"import { useShnarps } from '../../lib/stores/useShnarps';\nimport { Card, CardContent, CardHeader, CardTitle } from '../ui/card';\nimport { ScrollArea } from '../ui/scroll-area';\nimport { Button } from '../ui/button';\nimport { useState } from 'react';\n\nexport default function GameHistory() {\n  const { history, players } = useShnarps();\n  const [isOpen, setIsOpen] = useState(false);\n\n  if (!isOpen) {\n    return (\n      <div className=\"fixed top-4 right-4 z-30\">\n        <Button\n          onClick={() => setIsOpen(true)}\n          variant=\"outline\"\n          className=\"bg-gray-800 text-white hover:bg-gray-700\"\n        >\n          ðŸ“œ History ({history.length} rounds)\n        </Button>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"fixed top-4 right-4 z-40 w-96 max-h-96\">\n      <Card className=\"bg-white border-2 border-gray-300 shadow-2xl\">\n        <CardHeader className=\"pb-2 bg-white\">\n          <div className=\"flex justify-between items-center\">\n            <CardTitle className=\"text-lg text-gray-900\">Game History</CardTitle>\n            <Button\n              onClick={() => setIsOpen(false)}\n              variant=\"ghost\"\n              size=\"sm\"\n              className=\"text-gray-900 hover:bg-gray-100\"\n            >\n              âœ•\n            </Button>\n          </div>\n        </CardHeader>\n        <CardContent className=\"bg-white\">\n          <ScrollArea className=\"h-80\">\n            {history.length === 0 ? (\n              <p className=\"text-sm text-gray-600 text-center py-4\">\n                No rounds completed yet\n              </p>\n            ) : (\n              <div className=\"space-y-3\">\n                {history.map((round) => {\n                  const highestBidderName = players.find(\n                    p => p.id === round.highestBidder\n                  )?.name || 'Unknown';\n\n                  return (\n                    <div\n                      key={round.round}\n                      className=\"border-2 border-gray-300 rounded-lg p-3 bg-gray-100\"\n                    >\n                      <div className=\"flex justify-between items-center mb-2\">\n                        <h3 className=\"font-semibold text-sm\">Round {round.round}</h3>\n                        <span className=\"text-xs text-muted-foreground\">\n                          Trump: {round.trumpSuit === 'hearts' ? 'â™¥' : \n                                 round.trumpSuit === 'diamonds' ? 'â™¦' : \n                                 round.trumpSuit === 'clubs' ? 'â™£' : 'â™ '}\n                        </span>\n                      </div>\n\n                      <div className=\"space-y-1 text-xs\">\n                        <p className=\"text-muted-foreground\">\n                          Highest Bid: {highestBidderName} ({round.bids.get(round.highestBidder || '') || 0})\n                        </p>\n\n                        <div className=\"mt-2\">\n                          <p className=\"font-medium mb-1\">Results:</p>\n                          {round.playingPlayers.map(playerId => {\n                            const player = players.find(p => p.id === playerId);\n                            const tricksWon = round.tricksWon.get(playerId) || 0;\n                            const scoreChange = round.scoreChanges.get(playerId) || 0;\n                            const finalScore = round.finalScores.get(playerId) || 0;\n\n                            return (\n                              <div\n                                key={playerId}\n                                className=\"flex justify-between py-1\"\n                              >\n                                <span>{player?.name}</span>\n                                <span>\n                                  {tricksWon} tricks, {scoreChange > 0 ? '+' : ''}{scoreChange} â†’ {finalScore}\n                                </span>\n                              </div>\n                            );\n                          })}\n                        </div>\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n            )}\n          </ScrollArea>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":4145},"client/src/components/ui/alert.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst alertVariants = cva(\n  \"relative w-full rounded-lg border px-4 py-3 text-sm [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground [&>svg~*]:pl-7\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-background text-foreground\",\n        destructive:\n          \"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nconst Alert = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & VariantProps<typeof alertVariants>\n>(({ className, variant, ...props }, ref) => (\n  <div\n    ref={ref}\n    role=\"alert\"\n    className={cn(alertVariants({ variant }), className)}\n    {...props}\n  />\n))\nAlert.displayName = \"Alert\"\n\nconst AlertTitle = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLHeadingElement>\n>(({ className, ...props }, ref) => (\n  <h5\n    ref={ref}\n    className={cn(\"mb-1 font-medium leading-none tracking-tight\", className)}\n    {...props}\n  />\n))\nAlertTitle.displayName = \"AlertTitle\"\n\nconst AlertDescription = React.forwardRef<\n  HTMLParagraphElement,\n  React.HTMLAttributes<HTMLParagraphElement>\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    className={cn(\"text-sm [&_p]:leading-relaxed\", className)}\n    {...props}\n  />\n))\nAlertDescription.displayName = \"AlertDescription\"\n\nexport { Alert, AlertTitle, AlertDescription }\n","size_bytes":1598},"client/src/components/ui/label.tsx":{"content":"import * as React from \"react\"\nimport * as LabelPrimitive from \"@radix-ui/react-label\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst labelVariants = cva(\n  \"text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70\"\n)\n\nconst Label = React.forwardRef<\n  React.ElementRef<typeof LabelPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof LabelPrimitive.Root> &\n    VariantProps<typeof labelVariants>\n>(({ className, ...props }, ref) => (\n  <LabelPrimitive.Root\n    ref={ref}\n    className={cn(labelVariants(), className)}\n    {...props}\n  />\n))\nLabel.displayName = LabelPrimitive.Root.displayName\n\nexport { Label }\n","size_bytes":710},"drizzle.config.ts":{"content":"import { defineConfig } from \"drizzle-kit\";\n\nif (!process.env.DATABASE_URL) {\n  throw new Error(\"DATABASE_URL, ensure the database is provisioned\");\n}\n\nexport default defineConfig({\n  out: \"./migrations\",\n  schema: \"./shared/schema.ts\",\n  dialect: \"postgresql\",\n  dbCredentials: {\n    url: process.env.DATABASE_URL,\n  },\n});\n","size_bytes":325},"shared/schema.ts":{"content":"import { pgTable, text, serial, integer, boolean, timestamp } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const users = pgTable(\"users\", {\n  id: serial(\"id\").primaryKey(),\n  username: text(\"username\").notNull().unique(),\n  password: text(\"password\").notNull(),\n});\n\nexport const games = pgTable(\"games\", {\n  id: serial(\"id\").primaryKey(),\n  gameCode: text(\"game_code\").notNull().unique(),\n  hostId: integer(\"host_id\").references(() => users.id),\n  status: text(\"status\").notNull().default(\"waiting\"), // waiting, active, completed\n  maxPlayers: integer(\"max_players\").notNull().default(8),\n  currentPlayers: integer(\"current_players\").notNull().default(0),\n  gameState: text(\"game_state\"), // JSON string of game state\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  updatedAt: timestamp(\"updated_at\").defaultNow(),\n});\n\nexport const gamePlayers = pgTable(\"game_players\", {\n  id: serial(\"id\").primaryKey(),\n  gameId: integer(\"game_id\").references(() => games.id),\n  userId: integer(\"user_id\").references(() => users.id),\n  playerName: text(\"player_name\").notNull(),\n  score: integer(\"score\").notNull().default(16),\n  isActive: boolean(\"is_active\").notNull().default(true),\n  joinedAt: timestamp(\"joined_at\").defaultNow(),\n});\n\nexport const insertUserSchema = createInsertSchema(users).pick({\n  username: true,\n  password: true,\n});\n\nexport const insertGameSchema = createInsertSchema(games).pick({\n  gameCode: true,\n  maxPlayers: true,\n});\n\nexport const insertGamePlayerSchema = createInsertSchema(gamePlayers).pick({\n  gameId: true,\n  userId: true,\n  playerName: true,\n});\n\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type User = typeof users.$inferSelect;\nexport type Game = typeof games.$inferSelect;\nexport type GamePlayer = typeof gamePlayers.$inferSelect;\nexport type InsertGame = z.infer<typeof insertGameSchema>;\nexport type InsertGamePlayer = z.infer<typeof insertGamePlayerSchema>;\n","size_bytes":1986},"vite.config.ts":{"content":"import { defineConfig } from \"vite\";\nimport react from \"@vitejs/plugin-react\";\nimport path, { dirname } from \"path\";\nimport runtimeErrorOverlay from \"@replit/vite-plugin-runtime-error-modal\";\nimport { fileURLToPath } from \"url\";\nimport glsl from \"vite-plugin-glsl\";\n\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = dirname(__filename);\n\nexport default defineConfig({\n  plugins: [\n    react(),\n    runtimeErrorOverlay(),\n    glsl(), // Add GLSL shader support\n  ],\n  resolve: {\n    alias: {\n      \"@\": path.resolve(__dirname, \"client\", \"src\"),\n      \"@shared\": path.resolve(__dirname, \"shared\"),\n    },\n  },\n  root: path.resolve(__dirname, \"client\"),\n  build: {\n    outDir: path.resolve(__dirname, \"dist/public\"),\n    emptyOutDir: true,\n  },\n  // Add support for large models and audio files\n  assetsInclude: [\"**/*.gltf\", \"**/*.glb\", \"**/*.mp3\", \"**/*.ogg\", \"**/*.wav\"],\n});\n","size_bytes":896},"client/src/components/ui/select.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SelectPrimitive from \"@radix-ui/react-select\"\nimport { Check, ChevronDown, ChevronUp } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Select = SelectPrimitive.Root\n\nconst SelectGroup = SelectPrimitive.Group\n\nconst SelectValue = SelectPrimitive.Value\n\nconst SelectTrigger = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Trigger>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"flex h-9 w-full items-center justify-between whitespace-nowrap rounded-md border border-input bg-transparent px-3 py-2 text-sm shadow-sm ring-offset-background data-[placeholder]:text-muted-foreground focus:outline-none focus:ring-1 focus:ring-ring disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <SelectPrimitive.Icon asChild>\n      <ChevronDown className=\"h-4 w-4 opacity-50\" />\n    </SelectPrimitive.Icon>\n  </SelectPrimitive.Trigger>\n))\nSelectTrigger.displayName = SelectPrimitive.Trigger.displayName\n\nconst SelectScrollUpButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollUpButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollUpButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollUpButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronUp className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollUpButton>\n))\nSelectScrollUpButton.displayName = SelectPrimitive.ScrollUpButton.displayName\n\nconst SelectScrollDownButton = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.ScrollDownButton>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.ScrollDownButton>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.ScrollDownButton\n    ref={ref}\n    className={cn(\n      \"flex cursor-default items-center justify-center py-1\",\n      className\n    )}\n    {...props}\n  >\n    <ChevronDown className=\"h-4 w-4\" />\n  </SelectPrimitive.ScrollDownButton>\n))\nSelectScrollDownButton.displayName =\n  SelectPrimitive.ScrollDownButton.displayName\n\nconst SelectContent = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Content>\n>(({ className, children, position = \"popper\", ...props }, ref) => (\n  <SelectPrimitive.Portal>\n    <SelectPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        position === \"popper\" &&\n          \"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1\",\n        className\n      )}\n      position={position}\n      {...props}\n    >\n      <SelectScrollUpButton />\n      <SelectPrimitive.Viewport\n        className={cn(\n          \"p-1\",\n          position === \"popper\" &&\n            \"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]\"\n        )}\n      >\n        {children}\n      </SelectPrimitive.Viewport>\n      <SelectScrollDownButton />\n    </SelectPrimitive.Content>\n  </SelectPrimitive.Portal>\n))\nSelectContent.displayName = SelectPrimitive.Content.displayName\n\nconst SelectLabel = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Label>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Label\n    ref={ref}\n    className={cn(\"px-2 py-1.5 text-sm font-semibold\", className)}\n    {...props}\n  />\n))\nSelectLabel.displayName = SelectPrimitive.Label.displayName\n\nconst SelectItem = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Item>\n>(({ className, children, ...props }, ref) => (\n  <SelectPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-2 pr-8 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute right-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <SelectPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </SelectPrimitive.ItemIndicator>\n    </span>\n    <SelectPrimitive.ItemText>{children}</SelectPrimitive.ItemText>\n  </SelectPrimitive.Item>\n))\nSelectItem.displayName = SelectPrimitive.Item.displayName\n\nconst SelectSeparator = React.forwardRef<\n  React.ElementRef<typeof SelectPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof SelectPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <SelectPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nSelectSeparator.displayName = SelectPrimitive.Separator.displayName\n\nexport {\n  Select,\n  SelectGroup,\n  SelectValue,\n  SelectTrigger,\n  SelectContent,\n  SelectLabel,\n  SelectItem,\n  SelectSeparator,\n  SelectScrollUpButton,\n  SelectScrollDownButton,\n}\n","size_bytes":5639},"server/index.ts":{"content":"import express, { type Request, Response, NextFunction } from \"express\";\nimport { registerRoutes } from \"./routes\";\nimport { setupVite, serveStatic, log } from \"./vite\";\nimport { setupWebSocket } from \"./websocket\";\n\nconst app = express();\napp.use(express.json());\napp.use(express.urlencoded({ extended: false }));\n\napp.use((req, res, next) => {\n  const start = Date.now();\n  const path = req.path;\n  let capturedJsonResponse: Record<string, any> | undefined = undefined;\n\n  const originalResJson = res.json;\n  res.json = function (bodyJson, ...args) {\n    capturedJsonResponse = bodyJson;\n    return originalResJson.apply(res, [bodyJson, ...args]);\n  };\n\n  res.on(\"finish\", () => {\n    const duration = Date.now() - start;\n    if (path.startsWith(\"/api\")) {\n      let logLine = `${req.method} ${path} ${res.statusCode} in ${duration}ms`;\n      if (capturedJsonResponse) {\n        logLine += ` :: ${JSON.stringify(capturedJsonResponse)}`;\n      }\n\n      if (logLine.length > 80) {\n        logLine = logLine.slice(0, 79) + \"â€¦\";\n      }\n\n      log(logLine);\n    }\n  });\n\n  next();\n});\n\n(async () => {\n  const server = await registerRoutes(app);\n\n  // Setup WebSocket server\n  setupWebSocket(server);\n\n  app.use((err: any, _req: Request, res: Response, _next: NextFunction) => {\n    const status = err.status || err.statusCode || 500;\n    const message = err.message || \"Internal Server Error\";\n\n    res.status(status).json({ message });\n    throw err;\n  });\n\n  // importantly only setup vite in development and after\n  // setting up all the other routes so the catch-all route\n  // doesn't interfere with the other routes\n  if (app.get(\"env\") === \"development\") {\n    await setupVite(app, server);\n  } else {\n    serveStatic(app);\n  }\n\n  // ALWAYS serve the app on port 5000\n  // this serves both the API and the client\n  const port = 5000;\n  server.listen({\n    port,\n    host: \"0.0.0.0\",\n    reusePort: true,\n  }, () => {\n    log(`serving on port ${port}`);\n  });\n})();\n","size_bytes":1972},"client/src/components/ui/input.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Input = React.forwardRef<HTMLInputElement, React.ComponentProps<\"input\">>(\n  ({ className, type, ...props }, ref) => {\n    return (\n      <input\n        type={type}\n        className={cn(\n          \"flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-base shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 md:text-sm\",\n          className\n        )}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nInput.displayName = \"Input\"\n\nexport { Input }\n","size_bytes":768},"client/src/components/ui/chart.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as RechartsPrimitive from \"recharts\"\n\nimport { cn } from \"@/lib/utils\"\n\n// Format: { THEME_NAME: CSS_SELECTOR }\nconst THEMES = { light: \"\", dark: \".dark\" } as const\n\nexport type ChartConfig = {\n  [k in string]: {\n    label?: React.ReactNode\n    icon?: React.ComponentType\n  } & (\n    | { color?: string; theme?: never }\n    | { color?: never; theme: Record<keyof typeof THEMES, string> }\n  )\n}\n\ntype ChartContextProps = {\n  config: ChartConfig\n}\n\nconst ChartContext = React.createContext<ChartContextProps | null>(null)\n\nfunction useChart() {\n  const context = React.useContext(ChartContext)\n\n  if (!context) {\n    throw new Error(\"useChart must be used within a <ChartContainer />\")\n  }\n\n  return context\n}\n\nconst ChartContainer = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    config: ChartConfig\n    children: React.ComponentProps<\n      typeof RechartsPrimitive.ResponsiveContainer\n    >[\"children\"]\n  }\n>(({ id, className, children, config, ...props }, ref) => {\n  const uniqueId = React.useId()\n  const chartId = `chart-${id || uniqueId.replace(/:/g, \"\")}`\n\n  return (\n    <ChartContext.Provider value={{ config }}>\n      <div\n        data-chart={chartId}\n        ref={ref}\n        className={cn(\n          \"flex aspect-video justify-center text-xs [&_.recharts-cartesian-axis-tick_text]:fill-muted-foreground [&_.recharts-cartesian-grid_line[stroke='#ccc']]:stroke-border/50 [&_.recharts-curve.recharts-tooltip-cursor]:stroke-border [&_.recharts-dot[stroke='#fff']]:stroke-transparent [&_.recharts-layer]:outline-none [&_.recharts-polar-grid_[stroke='#ccc']]:stroke-border [&_.recharts-radial-bar-background-sector]:fill-muted [&_.recharts-rectangle.recharts-tooltip-cursor]:fill-muted [&_.recharts-reference-line_[stroke='#ccc']]:stroke-border [&_.recharts-sector[stroke='#fff']]:stroke-transparent [&_.recharts-sector]:outline-none [&_.recharts-surface]:outline-none\",\n          className\n        )}\n        {...props}\n      >\n        <ChartStyle id={chartId} config={config} />\n        <RechartsPrimitive.ResponsiveContainer>\n          {children}\n        </RechartsPrimitive.ResponsiveContainer>\n      </div>\n    </ChartContext.Provider>\n  )\n})\nChartContainer.displayName = \"Chart\"\n\nconst ChartStyle = ({ id, config }: { id: string; config: ChartConfig }) => {\n  const colorConfig = Object.entries(config).filter(\n    ([, config]) => config.theme || config.color\n  )\n\n  if (!colorConfig.length) {\n    return null\n  }\n\n  return (\n    <style\n      dangerouslySetInnerHTML={{\n        __html: Object.entries(THEMES)\n          .map(\n            ([theme, prefix]) => `\n${prefix} [data-chart=${id}] {\n${colorConfig\n  .map(([key, itemConfig]) => {\n    const color =\n      itemConfig.theme?.[theme as keyof typeof itemConfig.theme] ||\n      itemConfig.color\n    return color ? `  --color-${key}: ${color};` : null\n  })\n  .join(\"\\n\")}\n}\n`\n          )\n          .join(\"\\n\"),\n      }}\n    />\n  )\n}\n\nconst ChartTooltip = RechartsPrimitive.Tooltip\n\nconst ChartTooltipContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<typeof RechartsPrimitive.Tooltip> &\n    React.ComponentProps<\"div\"> & {\n      hideLabel?: boolean\n      hideIndicator?: boolean\n      indicator?: \"line\" | \"dot\" | \"dashed\"\n      nameKey?: string\n      labelKey?: string\n    }\n>(\n  (\n    {\n      active,\n      payload,\n      className,\n      indicator = \"dot\",\n      hideLabel = false,\n      hideIndicator = false,\n      label,\n      labelFormatter,\n      labelClassName,\n      formatter,\n      color,\n      nameKey,\n      labelKey,\n    },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    const tooltipLabel = React.useMemo(() => {\n      if (hideLabel || !payload?.length) {\n        return null\n      }\n\n      const [item] = payload\n      const key = `${labelKey || item?.dataKey || item?.name || \"value\"}`\n      const itemConfig = getPayloadConfigFromPayload(config, item, key)\n      const value =\n        !labelKey && typeof label === \"string\"\n          ? config[label as keyof typeof config]?.label || label\n          : itemConfig?.label\n\n      if (labelFormatter) {\n        return (\n          <div className={cn(\"font-medium\", labelClassName)}>\n            {labelFormatter(value, payload)}\n          </div>\n        )\n      }\n\n      if (!value) {\n        return null\n      }\n\n      return <div className={cn(\"font-medium\", labelClassName)}>{value}</div>\n    }, [\n      label,\n      labelFormatter,\n      payload,\n      hideLabel,\n      labelClassName,\n      config,\n      labelKey,\n    ])\n\n    if (!active || !payload?.length) {\n      return null\n    }\n\n    const nestLabel = payload.length === 1 && indicator !== \"dot\"\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"grid min-w-[8rem] items-start gap-1.5 rounded-lg border border-border/50 bg-background px-2.5 py-1.5 text-xs shadow-xl\",\n          className\n        )}\n      >\n        {!nestLabel ? tooltipLabel : null}\n        <div className=\"grid gap-1.5\">\n          {payload.map((item, index) => {\n            const key = `${nameKey || item.name || item.dataKey || \"value\"}`\n            const itemConfig = getPayloadConfigFromPayload(config, item, key)\n            const indicatorColor = color || item.payload.fill || item.color\n\n            return (\n              <div\n                key={item.dataKey}\n                className={cn(\n                  \"flex w-full flex-wrap items-stretch gap-2 [&>svg]:h-2.5 [&>svg]:w-2.5 [&>svg]:text-muted-foreground\",\n                  indicator === \"dot\" && \"items-center\"\n                )}\n              >\n                {formatter && item?.value !== undefined && item.name ? (\n                  formatter(item.value, item.name, item, index, item.payload)\n                ) : (\n                  <>\n                    {itemConfig?.icon ? (\n                      <itemConfig.icon />\n                    ) : (\n                      !hideIndicator && (\n                        <div\n                          className={cn(\n                            \"shrink-0 rounded-[2px] border-[--color-border] bg-[--color-bg]\",\n                            {\n                              \"h-2.5 w-2.5\": indicator === \"dot\",\n                              \"w-1\": indicator === \"line\",\n                              \"w-0 border-[1.5px] border-dashed bg-transparent\":\n                                indicator === \"dashed\",\n                              \"my-0.5\": nestLabel && indicator === \"dashed\",\n                            }\n                          )}\n                          style={\n                            {\n                              \"--color-bg\": indicatorColor,\n                              \"--color-border\": indicatorColor,\n                            } as React.CSSProperties\n                          }\n                        />\n                      )\n                    )}\n                    <div\n                      className={cn(\n                        \"flex flex-1 justify-between leading-none\",\n                        nestLabel ? \"items-end\" : \"items-center\"\n                      )}\n                    >\n                      <div className=\"grid gap-1.5\">\n                        {nestLabel ? tooltipLabel : null}\n                        <span className=\"text-muted-foreground\">\n                          {itemConfig?.label || item.name}\n                        </span>\n                      </div>\n                      {item.value && (\n                        <span className=\"font-mono font-medium tabular-nums text-foreground\">\n                          {item.value.toLocaleString()}\n                        </span>\n                      )}\n                    </div>\n                  </>\n                )}\n              </div>\n            )\n          })}\n        </div>\n      </div>\n    )\n  }\n)\nChartTooltipContent.displayName = \"ChartTooltip\"\n\nconst ChartLegend = RechartsPrimitive.Legend\n\nconst ChartLegendContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> &\n    Pick<RechartsPrimitive.LegendProps, \"payload\" | \"verticalAlign\"> & {\n      hideIcon?: boolean\n      nameKey?: string\n    }\n>(\n  (\n    { className, hideIcon = false, payload, verticalAlign = \"bottom\", nameKey },\n    ref\n  ) => {\n    const { config } = useChart()\n\n    if (!payload?.length) {\n      return null\n    }\n\n    return (\n      <div\n        ref={ref}\n        className={cn(\n          \"flex items-center justify-center gap-4\",\n          verticalAlign === \"top\" ? \"pb-3\" : \"pt-3\",\n          className\n        )}\n      >\n        {payload.map((item) => {\n          const key = `${nameKey || item.dataKey || \"value\"}`\n          const itemConfig = getPayloadConfigFromPayload(config, item, key)\n\n          return (\n            <div\n              key={item.value}\n              className={cn(\n                \"flex items-center gap-1.5 [&>svg]:h-3 [&>svg]:w-3 [&>svg]:text-muted-foreground\"\n              )}\n            >\n              {itemConfig?.icon && !hideIcon ? (\n                <itemConfig.icon />\n              ) : (\n                <div\n                  className=\"h-2 w-2 shrink-0 rounded-[2px]\"\n                  style={{\n                    backgroundColor: item.color,\n                  }}\n                />\n              )}\n              {itemConfig?.label}\n            </div>\n          )\n        })}\n      </div>\n    )\n  }\n)\nChartLegendContent.displayName = \"ChartLegend\"\n\n// Helper to extract item config from a payload.\nfunction getPayloadConfigFromPayload(\n  config: ChartConfig,\n  payload: unknown,\n  key: string\n) {\n  if (typeof payload !== \"object\" || payload === null) {\n    return undefined\n  }\n\n  const payloadPayload =\n    \"payload\" in payload &&\n    typeof payload.payload === \"object\" &&\n    payload.payload !== null\n      ? payload.payload\n      : undefined\n\n  let configLabelKey: string = key\n\n  if (\n    key in payload &&\n    typeof payload[key as keyof typeof payload] === \"string\"\n  ) {\n    configLabelKey = payload[key as keyof typeof payload] as string\n  } else if (\n    payloadPayload &&\n    key in payloadPayload &&\n    typeof payloadPayload[key as keyof typeof payloadPayload] === \"string\"\n  ) {\n    configLabelKey = payloadPayload[\n      key as keyof typeof payloadPayload\n    ] as string\n  }\n\n  return configLabelKey in config\n    ? config[configLabelKey]\n    : config[key as keyof typeof config]\n}\n\nexport {\n  ChartContainer,\n  ChartTooltip,\n  ChartTooltipContent,\n  ChartLegend,\n  ChartLegendContent,\n  ChartStyle,\n}\n","size_bytes":10481},"client/src/components/ui/table.tsx":{"content":"import * as React from \"react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Table = React.forwardRef<\n  HTMLTableElement,\n  React.HTMLAttributes<HTMLTableElement>\n>(({ className, ...props }, ref) => (\n  <div className=\"relative w-full overflow-auto\">\n    <table\n      ref={ref}\n      className={cn(\"w-full caption-bottom text-sm\", className)}\n      {...props}\n    />\n  </div>\n))\nTable.displayName = \"Table\"\n\nconst TableHeader = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <thead ref={ref} className={cn(\"[&_tr]:border-b\", className)} {...props} />\n))\nTableHeader.displayName = \"TableHeader\"\n\nconst TableBody = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tbody\n    ref={ref}\n    className={cn(\"[&_tr:last-child]:border-0\", className)}\n    {...props}\n  />\n))\nTableBody.displayName = \"TableBody\"\n\nconst TableFooter = React.forwardRef<\n  HTMLTableSectionElement,\n  React.HTMLAttributes<HTMLTableSectionElement>\n>(({ className, ...props }, ref) => (\n  <tfoot\n    ref={ref}\n    className={cn(\n      \"border-t bg-muted/50 font-medium [&>tr]:last:border-b-0\",\n      className\n    )}\n    {...props}\n  />\n))\nTableFooter.displayName = \"TableFooter\"\n\nconst TableRow = React.forwardRef<\n  HTMLTableRowElement,\n  React.HTMLAttributes<HTMLTableRowElement>\n>(({ className, ...props }, ref) => (\n  <tr\n    ref={ref}\n    className={cn(\n      \"border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nTableRow.displayName = \"TableRow\"\n\nconst TableHead = React.forwardRef<\n  HTMLTableCellElement,\n  React.ThHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <th\n    ref={ref}\n    className={cn(\n      \"h-10 px-2 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n      className\n    )}\n    {...props}\n  />\n))\nTableHead.displayName = \"TableHead\"\n\nconst TableCell = React.forwardRef<\n  HTMLTableCellElement,\n  React.TdHTMLAttributes<HTMLTableCellElement>\n>(({ className, ...props }, ref) => (\n  <td\n    ref={ref}\n    className={cn(\n      \"p-2 align-middle [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]\",\n      className\n    )}\n    {...props}\n  />\n))\nTableCell.displayName = \"TableCell\"\n\nconst TableCaption = React.forwardRef<\n  HTMLTableCaptionElement,\n  React.HTMLAttributes<HTMLTableCaptionElement>\n>(({ className, ...props }, ref) => (\n  <caption\n    ref={ref}\n    className={cn(\"mt-4 text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nTableCaption.displayName = \"TableCaption\"\n\nexport {\n  Table,\n  TableHeader,\n  TableBody,\n  TableFooter,\n  TableHead,\n  TableRow,\n  TableCell,\n  TableCaption,\n}\n","size_bytes":2859},"client/src/pages/not-found.tsx":{"content":"import { Card, CardContent } from \"@/components/ui/card\";\nimport { AlertCircle } from \"lucide-react\";\n\nexport default function NotFound() {\n  return (\n    <div className=\"min-h-screen w-full flex items-center justify-center bg-gray-50\">\n      <Card className=\"w-full max-w-md mx-4\">\n        <CardContent className=\"pt-6\">\n          <div className=\"flex mb-4 gap-2\">\n            <AlertCircle className=\"h-8 w-8 text-red-500\" />\n            <h1 className=\"text-2xl font-bold text-gray-900\">404 Page Not Found</h1>\n          </div>\n\n          <p className=\"mt-4 text-sm text-gray-600\">\n            Did you forget to add the page to the router?\n          </p>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":711},"client/src/components/game/HandPlayPhase.tsx":{"content":"import { useShnarps } from '../../lib/stores/useShnarps';\nimport { Button } from '../ui/button';\nimport { useGameBoardStore } from '../../lib/stores/useGameBoardStore';\n\nexport default function HandPlayPhase() {\n  const { \n    currentPlayerIndex, \n    currentTrick,\n    playCard,\n    playingPlayers,\n    nextTrick,\n    localPlayerId,\n    players\n  } = useShnarps();\n  \n  const { selectedCard, setSelectedCard } = useGameBoardStore();\n  \n  const currentPlayer = players[currentPlayerIndex];\n  const isLocalPlayerTurn = currentPlayer?.id === localPlayerId && playingPlayers.has(currentPlayer.id);\n  \n  const handleCardPlay = () => {\n    if (selectedCard && currentPlayer) {\n      playCard(currentPlayer.id, selectedCard);\n      setSelectedCard(null);\n    }\n  };\n  \n  const isTrickComplete = currentTrick.length === Array.from(playingPlayers).length;\n\n  // Trick complete button\n  if (isTrickComplete) {\n    return (\n      <div className=\"fixed bottom-32 sm:bottom-24 left-1/2 transform -translate-x-1/2 z-40\">\n        <Button \n          onClick={nextTrick} \n          className=\"bg-blue-600 hover:bg-blue-700 text-white font-bold h-12 px-8 touch-manipulation\"\n        >\n          Next Trick\n        </Button>\n      </div>\n    );\n  }\n\n  // Local player's turn - show play button if card is selected\n  if (isLocalPlayerTurn && selectedCard) {\n    return (\n      <div className=\"fixed bottom-8 sm:bottom-4 left-1/2 transform -translate-x-1/2 z-40 max-w-full px-2\">\n        <Button \n          onClick={handleCardPlay}\n          className=\"w-full max-w-md mx-auto bg-green-600 hover:bg-green-700 text-white font-bold h-12 touch-manipulation\"\n        >\n          âœ“ Play {selectedCard.rank} of {selectedCard.suit}\n        </Button>\n      </div>\n    );\n  }\n\n  return null;\n}\n","size_bytes":1767},"client/src/main.tsx":{"content":"import { createRoot } from \"react-dom/client\";\nimport App from \"./App\";\nimport \"./index.css\";\n\ncreateRoot(document.getElementById(\"root\")!).render(<App />);\n","size_bytes":157},"server/routes.ts":{"content":"import type { Express } from \"express\";\nimport { createServer, type Server } from \"http\";\nimport { storage } from \"./storage\";\nimport { z } from \"zod\";\n\n// Game state validation schemas\nconst CreateGameSchema = z.object({\n  playerName: z.string().min(1).max(50),\n  maxPlayers: z.number().min(4).max(8).default(8)\n});\n\nconst JoinGameSchema = z.object({\n  gameCode: z.string().length(6),\n  playerName: z.string().min(1).max(50)\n});\n\nconst GameActionSchema = z.object({\n  gameCode: z.string().length(6),\n  playerId: z.string(),\n  action: z.enum(['bid', 'trump', 'sitpass', 'playcard']),\n  data: z.any()\n});\n\nfunction generateGameCode(): string {\n  return Math.random().toString(36).substring(2, 8).toUpperCase();\n}\n\nexport async function registerRoutes(app: Express): Promise<Server> {\n  \n  // Create a new game\n  app.post(\"/api/games\", async (req, res) => {\n    try {\n      const { playerName, maxPlayers } = CreateGameSchema.parse(req.body);\n      \n      const gameCode = generateGameCode();\n      const game = await storage.createGame({\n        gameCode,\n        maxPlayers: maxPlayers || 8,\n        hostId: null, // For now, no user system\n        status: \"waiting\"\n      });\n      \n      // Add the creator as first player\n      const player = await storage.addPlayerToGame(game.id, {\n        playerName,\n        userId: null\n      });\n      \n      res.json({ \n        success: true, \n        game: {\n          ...game,\n          players: [player]\n        }\n      });\n    } catch (error) {\n      console.error(\"Create game error:\", error);\n      res.status(400).json({ \n        success: false, \n        error: error instanceof Error ? error.message : \"Failed to create game\" \n      });\n    }\n  });\n\n  // Join an existing game\n  app.post(\"/api/games/join\", async (req, res) => {\n    try {\n      const { gameCode, playerName } = JoinGameSchema.parse(req.body);\n      \n      const game = await storage.getGameByCode(gameCode);\n      if (!game) {\n        return res.status(404).json({ success: false, error: \"Game not found\" });\n      }\n      \n      if (game.status !== \"waiting\") {\n        return res.status(400).json({ success: false, error: \"Game already started\" });\n      }\n      \n      if (game.currentPlayers >= game.maxPlayers) {\n        return res.status(400).json({ success: false, error: \"Game is full\" });\n      }\n      \n      const player = await storage.addPlayerToGame(game.id, {\n        playerName,\n        userId: null\n      });\n      \n      const updatedGame = await storage.getGameById(game.id);\n      const players = await storage.getGamePlayers(game.id);\n      \n      res.json({ \n        success: true, \n        game: updatedGame,\n        players,\n        playerId: player.id\n      });\n    } catch (error) {\n      console.error(\"Join game error:\", error);\n      res.status(400).json({ \n        success: false, \n        error: error instanceof Error ? error.message : \"Failed to join game\" \n      });\n    }\n  });\n\n  // Get game state\n  app.get(\"/api/games/:gameCode\", async (req, res) => {\n    try {\n      const { gameCode } = req.params;\n      \n      const game = await storage.getGameByCode(gameCode);\n      if (!game) {\n        return res.status(404).json({ success: false, error: \"Game not found\" });\n      }\n      \n      const players = await storage.getGamePlayers(game.id);\n      \n      res.json({ \n        success: true, \n        game: {\n          ...game,\n          gameState: game.gameState ? JSON.parse(game.gameState) : null\n        },\n        players \n      });\n    } catch (error) {\n      console.error(\"Get game error:\", error);\n      res.status(500).json({ \n        success: false, \n        error: error instanceof Error ? error.message : \"Failed to get game\" \n      });\n    }\n  });\n\n  // Start game\n  app.post(\"/api/games/:gameCode/start\", async (req, res) => {\n    try {\n      const { gameCode } = req.params;\n      \n      const game = await storage.getGameByCode(gameCode);\n      if (!game) {\n        return res.status(404).json({ success: false, error: \"Game not found\" });\n      }\n      \n      if (game.currentPlayers < 4) {\n        return res.status(400).json({ success: false, error: \"Need at least 4 players to start\" });\n      }\n      \n      // Initialize game state\n      const initialGameState = {\n        phase: 'bidding',\n        round: 1,\n        dealerIndex: 0,\n        currentPlayerIndex: 1,\n        bids: {},\n        trumpSuit: null,\n        highestBidder: null,\n        playingPlayers: [],\n        currentTrick: [],\n        completedTricks: []\n      };\n      \n      const updatedGame = await storage.updateGameState(game.id, \"active\", initialGameState);\n      \n      res.json({ success: true, game: updatedGame });\n    } catch (error) {\n      console.error(\"Start game error:\", error);\n      res.status(500).json({ \n        success: false, \n        error: error instanceof Error ? error.message : \"Failed to start game\" \n      });\n    }\n  });\n\n  // Game action endpoint (bid, trump selection, sit/pass, play card)\n  app.post(\"/api/games/action\", async (req, res) => {\n    try {\n      const { gameCode, playerId, action, data } = GameActionSchema.parse(req.body);\n      \n      const game = await storage.getGameByCode(gameCode);\n      if (!game) {\n        return res.status(404).json({ success: false, error: \"Game not found\" });\n      }\n      \n      if (game.status !== \"active\") {\n        return res.status(400).json({ success: false, error: \"Game not active\" });\n      }\n      \n      // Parse current game state\n      const gameState = game.gameState ? JSON.parse(game.gameState) : {};\n      \n      // Process action based on type\n      switch (action) {\n        case 'bid':\n          gameState.bids = gameState.bids || {};\n          gameState.bids[playerId] = data.bid;\n          // Logic to determine if bidding is complete and move to next phase\n          break;\n          \n        case 'trump':\n          gameState.trumpSuit = data.suit;\n          gameState.phase = 'sit_pass';\n          break;\n          \n        case 'sitpass':\n          gameState.playingPlayers = gameState.playingPlayers || [];\n          if (data.decision === 'play') {\n            gameState.playingPlayers.push(playerId);\n          }\n          break;\n          \n        case 'playcard':\n          gameState.currentTrick = gameState.currentTrick || [];\n          gameState.currentTrick.push({\n            playerId,\n            card: data.card\n          });\n          break;\n      }\n      \n      // Update game state in storage\n      const updatedGame = await storage.updateGameState(game.id, game.status, gameState);\n      \n      res.json({ success: true, gameState });\n    } catch (error) {\n      console.error(\"Game action error:\", error);\n      res.status(400).json({ \n        success: false, \n        error: error instanceof Error ? error.message : \"Failed to process game action\" \n      });\n    }\n  });\n\n  const httpServer = createServer(app);\n  return httpServer;\n}\n","size_bytes":6901},"replit.md":{"content":"# Shnarps Card Game\n\n## Overview\n\nShnarps is a multiplayer card game application built with a modern web stack. The game features a bidding phase, trump suit selection, and trick-taking gameplay with support for both human and AI players. The application supports both local (same device) and real-time online multiplayer using WebSockets. The frontend uses React with Three.js for 3D rendering, Express backend with WebSocket server, and PostgreSQL database for persistence.\n\n## User Preferences\n\nPreferred communication style: Simple, everyday language.\n\n## Recent Updates\n\n### AI & Musty Rule Fixes (October 27, 2024)\n- **Bluffing Removed:** Eliminated illogical random bluffing from AI bidding strategy. AI now only overbids defensively when blocking players close to winning from calling trump, preventing wasteful punting.\n- **Musty Rule Fixed:** Corrected critical bug where `consecutiveSits` was incorrectly reset at start of each round, allowing players to sit indefinitely. Musty rule now properly tracks sits ACROSS rounds - players who sit 2 consecutive rounds must play the next round. Counter only resets when player actively chooses to play.\n\n### Critical Multiplayer Fixes (October 27, 2024)\n- **Everyone Sat Loop Fix:** Fixed infinite loop when everyone sits - penalty action now properly deals new cards for next round instead of reusing same hand, preventing repeated sit cycles and score drain\n- **Elimination Sync Fix:** Fixed players with scores > 32 continuing to play in multiplayer games. Host now broadcasts eliminatedPlayers list when starting new rounds, ensuring all clients know which players have been removed\n- **Phase Synchronization Fix:** Fixed critical multiplayer desync where game phases advanced incorrectly, causing players to see trump selection before bidding completed, wrong number of cards, and other players' cards before they played. Rewrote `applyGameAction` to apply state changes directly instead of calling action functions, preventing double-execution\n- **Duplicate Plays in Trick Fix:** Fixed critical bug where same player could play multiple cards in one trick. Added checks to ignore playcard actions when not in hand_play phase and when player already played in current trick (both in applyGameAction and useAIPlayer hook)\n- **AI Multi-Play Prevention:** Fixed AI players attempting to play multiple cards per trick by:\n  - Added check to skip if player already played in current trick\n  - Implemented useRef-based deduplication to prevent race conditions where AI hook fires multiple times before state updates\n  - Set pending action flag IMMEDIATELY before async operations to prevent multiple useEffect calls from scheduling duplicate actions\n- **Sitting Player Selected Fix:** Fixed game freeze when sitting players were selected as current player after sit/pass phase. Now correctly finds first playing player after dealer when transitioning to hand_play\n- **Stale State Bug Fix:** Fixed critical freeze issues where setTimeout callbacks were using stale/captured state instead of current state:\n  - Fixed player selection after tricks using old player data, causing sitting players to be selected as current player\n  - Fixed hand completion check using old trick count, causing game to try starting 6th trick when only 5 exist  \n  - Fixed completedTricks broadcast sending old count instead of current count, causing state inconsistencies\n- **Duplicate Card Bug Fix:** Fixed critical bug where client was dealing cards locally even in multiplayer mode, creating duplicate cards across players' hands. Now only server deals cards in online mode\n- **Trick Freeze Fix:** Fixed issue where AI players stopped playing mid-trick because playingPlayers state wasn't synced after trick completion. Now broadcasts complete game state including active players\n- **Everyone Sat Freeze Fix:** Fixed freeze when everyone sits except bidder by:\n  - Properly transitioning to everyone_sat phase with currentPlayerIndex set to bidder\n  - Implementing penalty choice action in multiplayer with proper state sync\n- **Score Desync Fix:** Implemented host-authoritative scoring where only the host calculates scores and broadcasts to all clients, preventing score resets and desyncs mid-game\n- **Mobile Card Visibility:** Improved iPhone card display by raising player position 15% on mobile and increasing bottom padding to 176px (pb-44) with safe-area support\n- **Card Overlap Fix:** Fixed other players' hands overlapping local player's cards by giving local player higher z-index (30 vs 10)\n- **Phase UI Positioning:** Adjusted bidding buttons, sit/pass controls, and play card button to bottom-56/bottom-32/bottom-8 on mobile to prevent overlap with raised cards\n- **Reconnection Logic:** Fixed WebSocket close handler to only reset to menu after exhausting all 5 reconnection attempts, preventing premature menu boots\n- **Rejoin Bug Fix:** Fixed critical bug where server looked for playerName instead of playerId during rejoin, causing reconnection failures\n- **Error Handling:** Added try-catch around message handling to prevent freezes from server message errors\n- **Enhanced Logging:** Added detailed logging for all WebSocket messages to aid debugging\n- **Timer Disabled:** Removed turn timer from multiplayer games (set to 0) to allow players to take their time without rushing\n\n### Multiplayer Stability & Bug Fixes (October 19, 2024)\n- **WebSocket Reconnection:** Added automatic reconnection with exponential backoff (up to 5 attempts) to prevent players from being kicked to main menu during network hiccups\n- **Connection Resilience:** WebSocket only resets to menu on explicit user disconnect or server-initiated close, not on temporary connection drops\n- **Deck Validation:** Added comprehensive validation to detect and prevent duplicate cards in deck creation and dealing (both client and server side)\n- **Mobile Card Display:** Fixed card visibility on iPhone 14 by increasing GameBoard bottom padding to 144px (pb-36) for mobile devices\n- **MultiplayerSetup Dialog:** Fixed dialog appearing mid-game by adding checks for gamePhase and player count\n\n### iOS App Deployment Setup (October 2024)\n- **Capacitor Integration:** Added Capacitor to wrap the web app as a native iOS app for App Store deployment\n- **iOS Platform:** Configured iOS project in `ios/` folder with proper build pipeline\n- **App Configuration:** Set up app ID (com.shnarps.cardgame) and app name (Shnarps Card Game)\n- **Build Scripts:** Configured web-to-native build and sync process\n- **Documentation:** Created comprehensive deployment guides (IOS_DEPLOYMENT_GUIDE.md, IOS_QUICK_START.md)\n\n### Player Customization (December 2024)\n- **Avatars:** Players can customize their avatars with 8 colors and 24 icon options. Avatars appear throughout the UI (player lists, scores). AI players get random avatars automatically.\n\n### Tutorial & Onboarding (December 2024)\n- **Game Tutorial:** Comprehensive 10-step tutorial explaining Shnarps rules, phases, scoring, and strategy. Accessible from main menu.\n- **App Walkthrough:** First-time user onboarding (9 steps) covering game modes, multiplayer setup, avatar customization, and UI navigation. Automatically shown to new users (tracked via localStorage).\n\n## System Architecture\n\n### Frontend Architecture\n\n**Framework & Build System**\n- React 18+ with TypeScript for type safety and developer experience\n- Vite as the build tool and dev server for fast HMR and optimized production builds\n- TailwindCSS for utility-first styling with custom theming support\n- Path aliases (`@/` for client/src, `@shared/` for shared code) for clean imports\n\n**State Management**\n- Zustand for lightweight, hook-based state management\n- Multiple stores for separation of concerns:\n  - `useShnarps`: Core game state (players, bids, tricks, scores)\n  - `useGame`: Game phase management (ready, playing, ended)\n  - `useAudio`: Sound effects and background music control\n- React Query (@tanstack/react-query) for server state and API caching\n\n**UI Components**\n- Radix UI primitives for accessible, unstyled components\n- Custom component library built on top of Radix (buttons, cards, dialogs, etc.)\n- Framer Motion for animations and transitions\n- Component organization follows atomic design principles\n\n**3D Rendering**\n- React Three Fiber for declarative Three.js in React\n- @react-three/drei for helpful 3D utilities\n- @react-three/postprocessing for visual effects\n- GLSL shader support via vite-plugin-glsl\n\n**Game UI Structure**\n- GameBoard: Main 3D canvas and player positions\n- Phase-specific components: BiddingPhase, SitPassPhase, HandPlayPhase\n- Card rendering with animations and playability states\n- GameHistory for round-by-round tracking\n\n### Backend Architecture\n\n**Server Framework**\n- Express.js with TypeScript for type-safe server code\n- ESM modules throughout for modern JavaScript\n- Custom middleware for request logging and error handling\n- Vite integration in development for seamless full-stack DX\n\n**API Design**\n- RESTful endpoints under `/api` namespace\n- Zod schemas for request validation\n- Game operations: create game, join game, game actions (bid, trump, sitpass, playcard)\n- JSON responses with consistent error handling\n\n**Storage Layer**\n- Abstract storage interface (IStorage) for flexibility\n- MemStorage implementation for in-memory development/testing\n- Designed to swap to PostgreSQL persistence via Drizzle ORM\n- Database schema ready in shared/schema.ts\n\n**Development Features**\n- Hot module replacement via Vite middleware\n- Runtime error overlay for debugging\n- Request/response logging with timing\n- Production build optimization with esbuild\n\n### Data Storage Solutions\n\n**Database Schema (Drizzle ORM + PostgreSQL)**\n- Users table: Authentication and player identity\n- Games table: Game metadata, status, and serialized state\n- GamePlayers table: Player-game relationships and scores\n- Indexes on game_code for fast lookups\n- Timestamps for auditing (createdAt, updatedAt)\n\n**ORM Strategy**\n- Drizzle-kit for schema management and migrations\n- Type-safe queries with full TypeScript inference\n- Zod integration for validation schemas\n- Schema sharing between client and server via `shared/schema.ts`\n\n**Session Management**\n- Prepared for express-session with connect-pg-simple\n- Session storage in PostgreSQL for persistence\n- Cookie-based authentication ready\n\n### Game Logic Architecture\n\n**Card System**\n- Standard 52-card deck implementation\n- Card utilities: shuffle, deal, suit/rank helpers\n- Play validation (following suit, trump rules)\n- Trick evaluation and winner determination\n\n**Game Phases**\n1. Setup: Player joining and lobby management\n2. Bidding: Sequential bidding with highest bid tracking\n3. Trump Selection: Winner chooses trump suit\n4. Sit/Pass: Players decide to play or sit out\n5. Hand Play: Trick-taking gameplay\n6. Scoring: Calculate and update player scores\n\n**AI Player System**\n- Hand strength evaluation based on trump and high cards\n- Bidding strategy with bluffing probability\n- Trump suit selection based on card distribution\n- Sit/pass decision logic considering score and hand quality\n- Card play using valid move filtering and heuristics\n- Automated AI turns via useAIPlayer hook with natural delays\n- Three difficulty levels: Easy (makes mistakes), Medium (occasional errors), Hard (optimal play)\n- Uses random manly names for AI players (Jack, Luke, Cole, Ryan, Jake, Tyler, etc.)\n- Advanced strategies: Collusion (gang up on leaders), Defensive bidding (block leaders from calling trump)\n\n**Multiplayer System**\n- WebSocket-based real-time communication (/ws endpoint)\n- Room-based architecture with 6-character alphanumeric room codes\n- Support for both local (same-device) and online multiplayer\n- Host controls: Add AI bots, start game\n- Real-time state synchronization across all connected players\n- Automatic handling of player joins/leaves\n- Works with AI bots in multiplayer rooms\n\n**Scoring Rules**\n- Punt (bid 0): +5 if no tricks taken, -1 per trick otherwise\n- Regular bid: +bid value if made, -bid value if failed\n- Overtime for tricks over bid\n- Game ends when player reaches 0 or negative score\n- Starting score: 16 points per player\n\n### External Dependencies\n\n**Database**\n- Neon Serverless PostgreSQL (@neondatabase/serverless)\n- Configured via DATABASE_URL environment variable\n- Connection pooling for scalability\n\n**UI Libraries**\n- Radix UI component primitives (30+ components)\n- Lucide React for icon system\n- cmdk for command palette patterns\n- class-variance-authority for component variants\n\n**3D Graphics**\n- Three.js via React Three Fiber\n- GLSL shader support\n- Post-processing effects pipeline\n- Asset loading for 3D models (GLTF/GLB) and audio files\n\n**Development Tools**\n- TypeScript for type checking\n- tsx for running TypeScript in Node.js\n- Vite runtime error modal plugin for Replit\n- PostCSS with Autoprefixer for CSS processing\n\n**Fonts & Typography**\n- Inter font family via @fontsource\n- Custom CSS variables for theming\n- Responsive typography system\n\n**Validation & Forms**\n- Zod for schema validation\n- React Hook Form integration ready\n- Drizzle-Zod for automatic schema generation\n\n**Animation**\n- Framer Motion for declarative animations\n- CSS transitions via Tailwind\n- Spring physics for natural movement\n\n**Build & Deployment**\n- Vite for frontend bundling\n- esbuild for backend bundling\n- Separate client and server builds\n- Static asset serving in production\n- Environment-based configuration (NODE_ENV)\n\n**iOS Deployment (Capacitor)**\n- Capacitor 7.4+ for native iOS app wrapping\n- iOS project in `ios/` folder (Xcode project)\n- Web app builds to `dist/public` and syncs to iOS\n- App ID: com.shnarps.cardgame\n- Supports all native iOS features and App Store deployment\n- Build process: `vite build` â†’ `npx cap sync ios` â†’ Open in Xcode\n- Requires Mac with Xcode and Apple Developer account for App Store submission","size_bytes":13924},"server/vite.ts":{"content":"import express, { type Express } from \"express\";\nimport fs from \"fs\";\nimport path, { dirname } from \"path\";\nimport { fileURLToPath } from \"url\";\nimport { createServer as createViteServer, createLogger, type ServerOptions } from \"vite\";\nconst __filename = fileURLToPath(import.meta.url);\nconst __dirname = dirname(__filename);\nimport { type Server } from \"http\";\nimport viteConfig from \"../vite.config\";\nimport { nanoid } from \"nanoid\";\n\nconst viteLogger = createLogger();\n\nexport function log(message: string, source = \"express\") {\n  const formattedTime = new Date().toLocaleTimeString(\"en-US\", {\n    hour: \"numeric\",\n    minute: \"2-digit\",\n    second: \"2-digit\",\n    hour12: true,\n  });\n\n  console.log(`${formattedTime} [${source}] ${message}`);\n}\n\nexport async function setupVite(app: Express, server: Server) {\n  const serverOptions: ServerOptions = {\n    middlewareMode: true,\n    hmr: { server },\n    allowedHosts: true,\n  };\n\n  const vite = await createViteServer({\n    ...viteConfig,\n    configFile: false,\n    customLogger: {\n      ...viteLogger,\n      error: (msg, options) => {\n        viteLogger.error(msg, options);\n        process.exit(1);\n      },\n    },\n    server: serverOptions,\n    appType: \"custom\",\n  });\n\n  app.use(vite.middlewares);\n  app.use(\"*\", async (req, res, next) => {\n    const url = req.originalUrl;\n\n    try {\n      const clientTemplate = path.resolve(\n        __dirname,\n        \"..\",\n        \"client\",\n        \"index.html\",\n      );\n\n      // always reload the index.html file from disk incase it changes\n      let template = await fs.promises.readFile(clientTemplate, \"utf-8\");\n      template = template.replace(\n        `src=\"/src/main.tsx\"`,\n        `src=\"/src/main.tsx?v=${nanoid()}\"`,\n      );\n      const page = await vite.transformIndexHtml(url, template);\n      res.status(200).set({ \"Content-Type\": \"text/html\" }).end(page);\n    } catch (e) {\n      vite.ssrFixStacktrace(e as Error);\n      next(e);\n    }\n  });\n}\n\nexport function serveStatic(app: Express) {\n  const distPath = path.resolve(__dirname, \"public\");\n\n  if (!fs.existsSync(distPath)) {\n    throw new Error(\n      `Could not find the build directory: ${distPath}, make sure to build the client first`,\n    );\n  }\n\n  app.use(express.static(distPath));\n\n  // fall through to index.html if the file doesn't exist\n  app.use(\"*\", (_req, res) => {\n    res.sendFile(path.resolve(distPath, \"index.html\"));\n  });\n}\n","size_bytes":2409},"client/src/lib/game/cardUtils.ts":{"content":"export interface Card {\n  suit: 'hearts' | 'diamonds' | 'clubs' | 'spades';\n  rank: 'A' | 'K' | 'Q' | 'J' | '10' | '9' | '8' | '7' | '6' | '5' | '4' | '3' | '2';\n  value: number; // For comparison (A=14, K=13, etc.)\n}\n\nexport function createDeck(): Card[] {\n  const suits: Card['suit'][] = ['hearts', 'diamonds', 'clubs', 'spades'];\n  const ranks: Card['rank'][] = ['A', 'K', 'Q', 'J', '10', '9', '8', '7', '6', '5', '4', '3', '2'];\n  const values = [14, 13, 12, 11, 10, 9, 8, 7, 6, 5, 4, 3, 2];\n  \n  const deck: Card[] = [];\n  \n  for (const suit of suits) {\n    for (let i = 0; i < ranks.length; i++) {\n      deck.push({\n        suit,\n        rank: ranks[i],\n        value: values[i]\n      });\n    }\n  }\n  \n  // Validate deck has exactly 52 unique cards\n  if (deck.length !== 52) {\n    console.error('âŒ DECK ERROR: Deck has', deck.length, 'cards instead of 52!');\n  }\n  \n  const uniqueCards = new Set(deck.map(c => `${c.rank}${c.suit}`));\n  if (uniqueCards.size !== 52) {\n    console.error('âŒ DECK ERROR: Deck has duplicate cards!', deck.length - uniqueCards.size, 'duplicates found');\n    console.error('Deck:', deck.map(c => `${c.rank}${c.suit}`).sort());\n  }\n  \n  return deck;\n}\n\nexport function shuffleDeck(deck: Card[]): Card[] {\n  const shuffled = [...deck];\n  for (let i = shuffled.length - 1; i > 0; i--) {\n    const j = Math.floor(Math.random() * (i + 1));\n    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];\n  }\n  return shuffled;\n}\n\nexport function sortHandBySuit(hand: Card[]): Card[] {\n  const suitOrder = { 'spades': 0, 'hearts': 1, 'diamonds': 2, 'clubs': 3 };\n  \n  return [...hand].sort((a, b) => {\n    // First sort by suit\n    const suitDiff = suitOrder[a.suit] - suitOrder[b.suit];\n    if (suitDiff !== 0) return suitDiff;\n    \n    // Then by value (high to low within same suit)\n    return b.value - a.value;\n  });\n}\n\nexport function dealCards(deck: Card[], numPlayers: number): Card[][] {\n  const hands: Card[][] = Array.from({ length: numPlayers }, () => []);\n  \n  // Deal 5 cards to each player\n  for (let cardIndex = 0; cardIndex < 5; cardIndex++) {\n    for (let playerIndex = 0; playerIndex < numPlayers; playerIndex++) {\n      const cardPosition = cardIndex * numPlayers + playerIndex;\n      if (cardPosition < deck.length) {\n        hands[playerIndex].push(deck[cardPosition]);\n      }\n    }\n  }\n  \n  // Validate: Check for duplicate cards across all hands\n  const allDealtCards: string[] = [];\n  hands.forEach((hand, playerIndex) => {\n    hand.forEach(card => {\n      const cardId = `${card.rank}${card.suit}`;\n      if (allDealtCards.includes(cardId)) {\n        console.error(`âŒ DEAL ERROR: Duplicate card ${cardId} found in player ${playerIndex}'s hand!`);\n        console.error('All dealt cards:', allDealtCards);\n        console.error('Current hand:', hand.map(c => `${c.rank}${c.suit}`));\n      }\n      allDealtCards.push(cardId);\n    });\n  });\n  \n  // Sort each hand by suit\n  return hands.map(hand => sortHandBySuit(hand));\n}\n\nexport function getSuitColor(suit: Card['suit']): string {\n  return suit === 'hearts' || suit === 'diamonds' ? '#dc2626' : '#1f2937';\n}\n\nexport function getSuitSymbol(suit: Card['suit']): string {\n  switch (suit) {\n    case 'hearts': return 'â™¥';\n    case 'diamonds': return 'â™¦';\n    case 'clubs': return 'â™£';\n    case 'spades': return 'â™ ';\n    default: return '';\n  }\n}\n\nexport function isValidPlay(\n  card: Card,\n  hand: Card[],\n  currentTrick: { playerId: string; card: Card }[],\n  trumpSuit: string | null\n): boolean {\n  // If first card of trick, any card is valid\n  if (currentTrick.length === 0) return true;\n  \n  const leadCard = currentTrick[0].card;\n  const leadSuit = leadCard.suit;\n  \n  // Must follow suit if possible\n  const hasSuit = hand.some(c => c.suit === leadSuit);\n  if (hasSuit && card.suit !== leadSuit) return false;\n  \n  return true;\n}\n\nexport function determineTrickWinner(\n  trick: { playerId: string; card: Card }[],\n  trumpSuit: string | null\n): string {\n  if (trick.length === 0) return '';\n  \n  const leadSuit = trick[0].card.suit;\n  let winner = trick[0];\n  \n  for (const play of trick) {\n    const { card } = play;\n    \n    // Trump beats non-trump\n    if (trumpSuit && card.suit === trumpSuit && winner.card.suit !== trumpSuit) {\n      winner = play;\n    }\n    // Higher trump beats lower trump\n    else if (trumpSuit && card.suit === trumpSuit && winner.card.suit === trumpSuit) {\n      if (card.value > winner.card.value) {\n        winner = play;\n      }\n    }\n    // Higher card of lead suit beats lower (if no trump involved)\n    else if (card.suit === leadSuit && winner.card.suit === leadSuit && (!trumpSuit || winner.card.suit !== trumpSuit)) {\n      if (card.value > winner.card.value) {\n        winner = play;\n      }\n    }\n  }\n  \n  return winner.playerId;\n}\n","size_bytes":4787},"client/src/components/ui/slider.tsx":{"content":"import * as React from \"react\"\nimport * as SliderPrimitive from \"@radix-ui/react-slider\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Slider = React.forwardRef<\n  React.ElementRef<typeof SliderPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof SliderPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <SliderPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex w-full touch-none select-none items-center\",\n      className\n    )}\n    {...props}\n  >\n    <SliderPrimitive.Track className=\"relative h-1.5 w-full grow overflow-hidden rounded-full bg-primary/20\">\n      <SliderPrimitive.Range className=\"absolute h-full bg-primary\" />\n    </SliderPrimitive.Track>\n    <SliderPrimitive.Thumb className=\"block h-4 w-4 rounded-full border border-primary/50 bg-background shadow transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50\" />\n  </SliderPrimitive.Root>\n))\nSlider.displayName = SliderPrimitive.Root.displayName\n\nexport { Slider }\n","size_bytes":1037},"client/src/components/ui/checkbox.tsx":{"content":"import * as React from \"react\"\nimport * as CheckboxPrimitive from \"@radix-ui/react-checkbox\"\nimport { Check } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Checkbox = React.forwardRef<\n  React.ElementRef<typeof CheckboxPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof CheckboxPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <CheckboxPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground\",\n      className\n    )}\n    {...props}\n  >\n    <CheckboxPrimitive.Indicator\n      className={cn(\"flex items-center justify-center text-current\")}\n    >\n      <Check className=\"h-4 w-4\" />\n    </CheckboxPrimitive.Indicator>\n  </CheckboxPrimitive.Root>\n))\nCheckbox.displayName = CheckboxPrimitive.Root.displayName\n\nexport { Checkbox }\n","size_bytes":1012},"server/storage.ts":{"content":"import { users, type User, type InsertUser } from \"@shared/schema\";\n\n// modify the interface with any CRUD methods\n// you might need\n\nexport interface IStorage {\n  getUser(id: number): Promise<User | undefined>;\n  getUserByUsername(username: string): Promise<User | undefined>;\n  createUser(user: InsertUser): Promise<User>;\n}\n\nexport class MemStorage implements IStorage {\n  private users: Map<number, User>;\n  currentId: number;\n\n  constructor() {\n    this.users = new Map();\n    this.currentId = 1;\n  }\n\n  async getUser(id: number): Promise<User | undefined> {\n    return this.users.get(id);\n  }\n\n  async getUserByUsername(username: string): Promise<User | undefined> {\n    return Array.from(this.users.values()).find(\n      (user) => user.username === username,\n    );\n  }\n\n  async createUser(insertUser: InsertUser): Promise<User> {\n    const id = this.currentId++;\n    const user: User = { ...insertUser, id };\n    this.users.set(id, user);\n    return user;\n  }\n}\n\nexport const storage = new MemStorage();\n","size_bytes":1012},"client/src/components/ui/dropdown-menu.tsx":{"content":"import * as React from \"react\"\nimport * as DropdownMenuPrimitive from \"@radix-ui/react-dropdown-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst DropdownMenu = DropdownMenuPrimitive.Root\n\nconst DropdownMenuTrigger = DropdownMenuPrimitive.Trigger\n\nconst DropdownMenuGroup = DropdownMenuPrimitive.Group\n\nconst DropdownMenuPortal = DropdownMenuPrimitive.Portal\n\nconst DropdownMenuSub = DropdownMenuPrimitive.Sub\n\nconst DropdownMenuRadioGroup = DropdownMenuPrimitive.RadioGroup\n\nconst DropdownMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto\" />\n  </DropdownMenuPrimitive.SubTrigger>\n))\nDropdownMenuSubTrigger.displayName =\n  DropdownMenuPrimitive.SubTrigger.displayName\n\nconst DropdownMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuSubContent.displayName =\n  DropdownMenuPrimitive.SubContent.displayName\n\nconst DropdownMenuContent = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <DropdownMenuPrimitive.Portal>\n    <DropdownMenuPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 max-h-[var(--radix-dropdown-menu-content-available-height)] min-w-[8rem] overflow-y-auto overflow-x-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md\",\n        \"data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </DropdownMenuPrimitive.Portal>\n))\nDropdownMenuContent.displayName = DropdownMenuPrimitive.Content.displayName\n\nconst DropdownMenuItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&>svg]:size-4 [&>svg]:shrink-0\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuItem.displayName = DropdownMenuPrimitive.Item.displayName\n\nconst DropdownMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <DropdownMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.CheckboxItem>\n))\nDropdownMenuCheckboxItem.displayName =\n  DropdownMenuPrimitive.CheckboxItem.displayName\n\nconst DropdownMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <DropdownMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <DropdownMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-2 w-2 fill-current\" />\n      </DropdownMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </DropdownMenuPrimitive.RadioItem>\n))\nDropdownMenuRadioItem.displayName = DropdownMenuPrimitive.RadioItem.displayName\n\nconst DropdownMenuLabel = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <DropdownMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nDropdownMenuLabel.displayName = DropdownMenuPrimitive.Label.displayName\n\nconst DropdownMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof DropdownMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof DropdownMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <DropdownMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-muted\", className)}\n    {...props}\n  />\n))\nDropdownMenuSeparator.displayName = DropdownMenuPrimitive.Separator.displayName\n\nconst DropdownMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\"ml-auto text-xs tracking-widest opacity-60\", className)}\n      {...props}\n    />\n  )\n}\nDropdownMenuShortcut.displayName = \"DropdownMenuShortcut\"\n\nexport {\n  DropdownMenu,\n  DropdownMenuTrigger,\n  DropdownMenuContent,\n  DropdownMenuItem,\n  DropdownMenuCheckboxItem,\n  DropdownMenuRadioItem,\n  DropdownMenuLabel,\n  DropdownMenuSeparator,\n  DropdownMenuShortcut,\n  DropdownMenuGroup,\n  DropdownMenuPortal,\n  DropdownMenuSub,\n  DropdownMenuSubContent,\n  DropdownMenuSubTrigger,\n  DropdownMenuRadioGroup,\n}\n","size_bytes":7480},"client/src/lib/stores/useGame.tsx":{"content":"import { create } from \"zustand\";\nimport { subscribeWithSelector } from \"zustand/middleware\";\n\nexport type GamePhase = \"ready\" | \"playing\" | \"ended\";\n\ninterface GameState {\n  phase: GamePhase;\n  \n  // Actions\n  start: () => void;\n  restart: () => void;\n  end: () => void;\n}\n\nexport const useGame = create<GameState>()(\n  subscribeWithSelector((set) => ({\n    phase: \"ready\",\n    \n    start: () => {\n      set((state) => {\n        // Only transition from ready to playing\n        if (state.phase === \"ready\") {\n          return { phase: \"playing\" };\n        }\n        return {};\n      });\n    },\n    \n    restart: () => {\n      set(() => ({ phase: \"ready\" }));\n    },\n    \n    end: () => {\n      set((state) => {\n        // Only transition from playing to ended\n        if (state.phase === \"playing\") {\n          return { phase: \"ended\" };\n        }\n        return {};\n      });\n    }\n  }))\n);\n","size_bytes":893},"client/src/lib/game/aiPlayer.ts":{"content":"import { Card } from './cardUtils';\nimport { Player, AIDifficulty } from './gameLogic';\n\n// Evaluate hand strength (0-5 scale)\nexport function evaluateHandStrength(hand: Card[], trumpSuit: string | null): number {\n  let strength = 0;\n  \n  // Count high cards\n  for (const card of hand) {\n    if (card.value >= 12) { // J, Q, K, A\n      strength += (card.suit === trumpSuit ? 1.5 : 1);\n    } else if (card.value >= 10) {\n      strength += (card.suit === trumpSuit ? 1 : 0.5);\n    }\n  }\n  \n  // Bonus for trump cards\n  if (trumpSuit) {\n    const trumpCount = hand.filter(c => c.suit === trumpSuit).length;\n    strength += trumpCount * 0.5;\n  }\n  \n  return Math.min(5, Math.floor(strength));\n}\n\n// AI bidding strategy\nexport function makeAIBid(\n  hand: Card[], \n  currentHighestBid: number,\n  isDealer: boolean,\n  playerCount: number,\n  currentPlayerId: string,\n  allScores: Map<string, number>,\n  highestBidderId: string | null,\n  difficulty: AIDifficulty = 'medium'\n): number {\n  // Evaluate hand without knowing trump yet\n  const avgStrength = (\n    evaluateHandStrength(hand, 'hearts') +\n    evaluateHandStrength(hand, 'diamonds') +\n    evaluateHandStrength(hand, 'clubs') +\n    evaluateHandStrength(hand, 'spades')\n  ) / 4;\n  \n  // Check if opponent with current highest bid is close to winning\n  const currentScore = allScores.get(currentPlayerId) || 16;\n  const highestBidderScore = highestBidderId ? (allScores.get(highestBidderId) || 16) : 16;\n  const someoneCloseToWinning = highestBidderScore <= 3;\n  \n  // DEFENSIVE BIDDING STRATEGY: Block players near winning from calling trump\n  const canAffordPunt = currentScore >= 8; // If at 8+, a punt (+5) won't put you in danger\n  \n  if (someoneCloseToWinning && canAffordPunt && difficulty !== 'easy') {\n    if (difficulty === 'hard') {\n      // Hard: Always tries to block if possible and can afford it\n      if (currentHighestBid < 5 && avgStrength >= 1.5) {\n        // Overbid to prevent them from calling trump\n        return Math.min(5, currentHighestBid + 1);\n      }\n    } else if (difficulty === 'medium') {\n      // Medium: Sometimes blocks, 60% of the time\n      if (currentHighestBid < 5 && avgStrength >= 2 && Math.random() > 0.4) {\n        return Math.min(5, currentHighestBid + 1);\n      }\n    }\n  }\n  \n  // Adjust conservativeness based on player count\n  let conservativenessAdjustment = 0;\n  if (playerCount >= 7) {\n    conservativenessAdjustment = 2;\n  } else if (playerCount >= 5) {\n    conservativenessAdjustment = 1;\n  }\n  \n  // Difficulty-based bid adjustments\n  let difficultyAdjustment = 0;\n  \n  if (difficulty === 'easy') {\n    // Easy: Makes poor bids, often overbids or underbids\n    difficultyAdjustment = Math.random() > 0.5 ? 1 : -1; // Random +1 or -1\n  } else if (difficulty === 'medium') {\n    // Medium: Occasionally makes mistakes\n    difficultyAdjustment = Math.random() > 0.7 ? 1 : 0; // 30% chance of +1\n  } else { // hard\n    // Hard: Optimal play, no random errors\n    difficultyAdjustment = 0;\n  }\n  \n  const adjustedBid = Math.max(0, Math.min(5, Math.floor(avgStrength) - conservativenessAdjustment + difficultyAdjustment));\n  \n  // Only bid if we can beat current highest or if we're confident\n  if (adjustedBid > currentHighestBid || (isDealer && adjustedBid === currentHighestBid + 1)) {\n    return adjustedBid;\n  }\n  \n  // NOTE: Bluffing removed - it doesn't make sense in this game since bluffing = punting.\n  // The only strategic \"bluff\" is defensive bidding (already handled above) to block\n  // players close to winning from calling trump.\n  \n  return 0; // Pass\n}\n\n// AI trump suit selection\nexport function chooseAITrumpSuit(hand: Card[], difficulty: AIDifficulty = 'medium'): string {\n  const suits = ['hearts', 'diamonds', 'clubs', 'spades'] as const;\n  let bestSuit: typeof suits[number] = suits[0];\n  let bestStrength = 0;\n  \n  for (const suit of suits) {\n    const strength = evaluateHandStrength(hand, suit);\n    if (strength > bestStrength) {\n      bestStrength = strength;\n      bestSuit = suit;\n    }\n  }\n  \n  // Easy: Sometimes picks randomly instead of optimal\n  if (difficulty === 'easy' && Math.random() > 0.5) {\n    return suits[Math.floor(Math.random() * suits.length)];\n  }\n  \n  // Medium: Occasionally picks suboptimal suit\n  if (difficulty === 'medium' && Math.random() > 0.8) {\n    const otherSuits = suits.filter(s => s !== bestSuit);\n    return otherSuits[Math.floor(Math.random() * otherSuits.length)];\n  }\n  \n  // Hard: Always picks optimal\n  return bestSuit;\n}\n\n// AI sit/play decision\nexport function makeAISitPlayDecision(\n  player: Player,\n  hand: Card[],\n  trumpSuit: string | null,\n  highestBid: number,\n  canSit: boolean,\n  currentScore: number | undefined,\n  allScores: Map<string, number>,\n  difficulty: AIDifficulty = 'medium'\n): 'sit' | 'play' {\n  if (!canSit) return 'play';\n  \n  const handStrength = evaluateHandStrength(hand, trumpSuit);\n  \n  // Check if any opponent is close to winning (score â‰¤ 3)\n  // Strategy: Gang up on them by playing to try to punt them\n  const opponentScores = Array.from(allScores.entries()).filter(([id]) => id !== player.id);\n  const someoneCloseToWinning = opponentScores.some(([_, score]) => score <= 3);\n  \n  // Easy: Makes poor sit/play decisions (often sits with good hands or plays with bad)\n  if (difficulty === 'easy') {\n    // Easy bots don't recognize the collusion strategy\n    if (Math.random() > 0.6) {\n      return Math.random() > 0.5 ? 'sit' : 'play'; // Random 40% of the time\n    }\n  }\n  \n  // COLLUSION STRATEGY: If someone is at 3 or lower, be aggressive and play\n  if (someoneCloseToWinning && difficulty !== 'easy') {\n    if (difficulty === 'hard') {\n      // Hard: Always plays to gang up unless hand is completely terrible\n      if (handStrength === 0 && player.consecutiveSits === 0 && Math.random() > 0.7) {\n        return 'sit'; // Only 30% chance to sit even with terrible hand\n      }\n      return 'play';\n    } else if (difficulty === 'medium') {\n      // Medium: Usually plays, but occasionally sits\n      if (handStrength >= 1 || player.consecutiveSits >= 1) {\n        return 'play';\n      }\n      if (Math.random() > 0.5) {\n        return 'play'; // 50% chance to play even with weak hand\n      }\n      return 'sit';\n    }\n  }\n  \n  // If at 4 or lower, avoid sitting (sitting gives +1 penalty)\n  if (currentScore !== undefined && currentScore <= 4) {\n    if (difficulty === 'hard') {\n      // Hard: Only sits with terrible hand\n      if (handStrength === 0 && player.consecutiveSits === 0) {\n        return 'sit';\n      }\n      return 'play';\n    } else {\n      // Easy/Medium: Sometimes makes mistakes\n      if (handStrength <= 1 && player.consecutiveSits === 0 && Math.random() > (difficulty === 'easy' ? 0.3 : 0.6)) {\n        return 'sit';\n      }\n      return 'play';\n    }\n  }\n  \n  // Medium: Uses basic strategy\n  if (difficulty === 'medium') {\n    if (handStrength >= 2) return 'play';\n    if (player.consecutiveSits >= 1) return 'play';\n    return 'sit';\n  }\n  \n  // Hard: Optimal strategy considering all factors\n  if (difficulty === 'hard') {\n    if (handStrength >= 3) return 'play';\n    if (player.consecutiveSits >= 1) return 'play';\n    if (handStrength <= 1) return 'sit';\n    return 'play';\n  }\n  \n  // Easy: Poor default strategy\n  return handStrength >= 3 ? 'play' : 'sit';\n}\n\n// AI card play selection\nexport function chooseAICardToPlay(\n  hand: Card[],\n  currentTrick: { playerId: string; card: Card }[],\n  trumpSuit: string | null,\n  playableCards: Card[],\n  difficulty: AIDifficulty = 'medium'\n): Card {\n  if (playableCards.length === 0) return hand[0];\n  if (playableCards.length === 1) return playableCards[0];\n  \n  // Easy: Often plays random cards\n  if (difficulty === 'easy' && Math.random() > 0.4) {\n    return playableCards[Math.floor(Math.random() * playableCards.length)];\n  }\n  \n  // If leading\n  if (currentTrick.length === 0) {\n    // IMPROVED LEADING STRATEGY\n    const trumpCards = playableCards.filter(c => c.suit === trumpSuit);\n    const nonTrumpCards = playableCards.filter(c => c.suit !== trumpSuit);\n    \n    if (difficulty === 'hard') {\n      // HARD: Smart leading strategy\n      \n      // Strategy 1: If you have the Ace of trump, lead it (guaranteed winner)\n      const trumpAce = trumpCards.find(c => c.value === 14);\n      if (trumpAce) return trumpAce;\n      \n      // Strategy 2: If you have Ace of any non-trump suit, lead it\n      const nonTrumpAce = nonTrumpCards.find(c => c.value === 14);\n      if (nonTrumpAce) return nonTrumpAce;\n      \n      // Strategy 3: If you have K or Q of trump AND the Ace, you can lead the K or Q\n      const hasAceOfTrump = trumpCards.some(c => c.value === 14);\n      if (hasAceOfTrump) {\n        const protectedHighTrumps = trumpCards.filter(c => c.value === 12 || c.value === 13); // K or Q\n        if (protectedHighTrumps.length > 0) {\n          // Lead the highest protected card (K before Q)\n          return protectedHighTrumps.reduce((highest, card) => \n            card.value > highest.value ? card : highest\n          );\n        }\n      }\n      \n      // Strategy 4: If you have multiple trump cards (2+), lead low trump to draw out higher cards\n      if (trumpCards.length >= 2) {\n        return trumpCards.reduce((lowest, card) => \n          card.value < lowest.value ? card : lowest\n        );\n      }\n      \n      // Strategy 5: Lead lowest non-trump to get rid of weak cards\n      if (nonTrumpCards.length > 0) {\n        return nonTrumpCards.reduce((lowest, card) => \n          card.value < lowest.value ? card : lowest\n        );\n      }\n      \n      // Fallback: play lowest card\n      return playableCards.reduce((lowest, card) => \n        card.value < lowest.value ? card : lowest\n      );\n      \n    } else if (difficulty === 'medium') {\n      // MEDIUM: Decent strategy with occasional mistakes\n      \n      // 90% of time, use good strategy\n      if (Math.random() > 0.1) {\n        // Lead Ace of trump if you have it\n        const trumpAce = trumpCards.find(c => c.value === 14);\n        if (trumpAce) return trumpAce;\n        \n        // Lead Ace of non-trump if you have it\n        const nonTrumpAce = nonTrumpCards.find(c => c.value === 14);\n        if (nonTrumpAce) return nonTrumpAce;\n        \n        // Lead K or Q of trump only if you have the Ace\n        const hasAceOfTrump = trumpCards.some(c => c.value === 14);\n        if (hasAceOfTrump) {\n          const protectedHighTrumps = trumpCards.filter(c => c.value === 12 || c.value === 13);\n          if (protectedHighTrumps.length > 0) {\n            return protectedHighTrumps.reduce((highest, card) => \n              card.value > highest.value ? card : highest\n            );\n          }\n        }\n        \n        // If you have multiple trump cards (2+), lead low trump\n        if (trumpCards.length >= 2) {\n          return trumpCards.reduce((lowest, card) => \n            card.value < lowest.value ? card : lowest\n          );\n        }\n        \n        // Otherwise lead low non-trump\n        return playableCards.reduce((lowest, card) => \n          card.value < lowest.value ? card : lowest\n        );\n      }\n      \n      // 10% of time, make a mistake (play random)\n      return playableCards[Math.floor(Math.random() * playableCards.length)];\n    }\n    \n    // EASY: Often plays poorly\n    // 60% random, 40% highest (often wastes high cards)\n    if (Math.random() > 0.4) {\n      return playableCards[Math.floor(Math.random() * playableCards.length)];\n    }\n    return playableCards.reduce((highest, card) => \n      card.value > highest.value ? card : highest\n    );\n  }\n  \n  const leadSuit = currentTrick[0].card.suit;\n  const highestCardInTrick = currentTrick.reduce((highest, play) => \n    play.card.value > highest.card.value ? play : highest\n  );\n  \n  // Check if any trump cards have been played in this trick\n  const trumpCardsInTrick = trumpSuit \n    ? currentTrick.filter(play => play.card.suit === trumpSuit)\n    : [];\n  const highestTrumpInTrick = trumpCardsInTrick.length > 0\n    ? trumpCardsInTrick.reduce((highest, play) => \n        play.card.value > highest.card.value ? play : highest\n      )\n    : null;\n  \n  // Try to win the trick\n  const winningCards = playableCards.filter(card => {\n    // If my card is trump\n    if (trumpSuit && card.suit === trumpSuit) {\n      // If a trump has already been played, I must beat the highest trump\n      if (highestTrumpInTrick) {\n        return card.value > highestTrumpInTrick.card.value;\n      }\n      // If no trump has been played yet, any trump wins (unless lead suit is trump)\n      if (highestCardInTrick.card.suit !== trumpSuit) {\n        return true;\n      }\n      // Lead suit is trump, must beat highest card\n      return card.value > highestCardInTrick.card.value;\n    }\n    // If my card is not trump, can only win if matching lead suit and beating highest\n    if (card.suit === leadSuit && highestCardInTrick.card.suit === leadSuit && !highestTrumpInTrick) {\n      return card.value > highestCardInTrick.card.value;\n    }\n    return false;\n  });\n  \n  // Hard: Optimal play\n  if (difficulty === 'hard') {\n    if (winningCards.length > 0) {\n      return winningCards.reduce((lowest, card) => \n        card.value < lowest.value ? card : lowest\n      );\n    }\n    return playableCards.reduce((lowest, card) => \n      card.value < lowest.value ? card : lowest\n    );\n  }\n  \n  // Medium: Usually correct, occasional mistakes\n  if (difficulty === 'medium') {\n    if (winningCards.length > 0 && Math.random() > 0.2) {\n      return winningCards.reduce((lowest, card) => \n        card.value < lowest.value ? card : lowest\n      );\n    }\n    return playableCards.reduce((lowest, card) => \n      card.value < lowest.value ? card : lowest\n    );\n  }\n  \n  // Easy: Poor strategy (often wastes high cards or doesn't try to win)\n  if (winningCards.length > 0 && Math.random() > 0.6) {\n    // Sometimes wins, but uses random winning card instead of lowest\n    return winningCards[Math.floor(Math.random() * winningCards.length)];\n  }\n  return playableCards[Math.floor(Math.random() * playableCards.length)];\n}\n","size_bytes":14044},"client/src/components/ui/progress.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ProgressPrimitive from \"@radix-ui/react-progress\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Progress = React.forwardRef<\n  React.ElementRef<typeof ProgressPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ProgressPrimitive.Root>\n>(({ className, value, ...props }, ref) => (\n  <ProgressPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative h-2 w-full overflow-hidden rounded-full bg-primary/20\",\n      className\n    )}\n    {...props}\n  >\n    <ProgressPrimitive.Indicator\n      className=\"h-full w-full flex-1 bg-primary transition-all\"\n      style={{ transform: `translateX(-${100 - (value || 0)}%)` }}\n    />\n  </ProgressPrimitive.Root>\n))\nProgress.displayName = ProgressPrimitive.Root.displayName\n\nexport { Progress }\n","size_bytes":792},"client/src/components/game/GameBoard.tsx":{"content":"import { useShnarps } from '../../lib/stores/useShnarps';\nimport PlayerHand from './PlayerHand';\nimport Card from './Card';\nimport { useMemo } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { Card as CardType, isValidPlay } from '../../lib/game/cardUtils';\nimport { useGameBoardStore } from '../../lib/stores/useGameBoardStore';\n\nexport default function GameBoard() {\n  const { \n    players, \n    currentTrick, \n    gamePhase, \n    currentPlayerIndex,\n    dealerIndex,\n    trumpSuit,\n    playingPlayers,\n    scores,\n    bids,\n    localPlayerId,\n    highestBidder,\n    lastTrickWinner,\n    completedTricks\n  } = useShnarps();\n\n  const { selectedCard, setSelectedCard } = useGameBoardStore();\n  \n  const currentPlayer = players[currentPlayerIndex];\n  const localPlayer = players.find(p => p.id === localPlayerId);\n  const isLocalPlayerTurn = currentPlayer?.id === localPlayerId && playingPlayers.has(currentPlayer.id);\n  \n  const handleCardSelect = (card: CardType) => {\n    if (!localPlayer) return;\n    const isValid = isValidPlay(card, localPlayer.hand, currentTrick, trumpSuit);\n    if (isValid) {\n      setSelectedCard(card);\n    }\n  };\n\n  // Calculate tricks won by each player in current hand\n  const tricksWon = useMemo(() => {\n    const counts = new Map<string, number>();\n    completedTricks.forEach(trick => {\n      if (trick.length === 0 || !trumpSuit) return;\n      \n      // Determine winner of this trick\n      const leadSuit = trick[0].card.suit;\n      let winningPlay = trick[0];\n      \n      for (const play of trick) {\n        const isTrump = play.card.suit === trumpSuit;\n        const isWinningTrump = winningPlay.card.suit === trumpSuit;\n        \n        if (isTrump && !isWinningTrump) {\n          winningPlay = play;\n        } else if (isTrump && isWinningTrump) {\n          const rankValues: { [key: string]: number } = {\n            '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, '10': 10,\n            'J': 11, 'Q': 12, 'K': 13, 'A': 14\n          };\n          if (rankValues[play.card.rank] > rankValues[winningPlay.card.rank]) {\n            winningPlay = play;\n          }\n        } else if (!isTrump && !isWinningTrump && play.card.suit === leadSuit) {\n          const rankValues: { [key: string]: number } = {\n            '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, '10': 10,\n            'J': 11, 'Q': 12, 'K': 13, 'A': 14\n          };\n          if (rankValues[play.card.rank] > rankValues[winningPlay.card.rank]) {\n            winningPlay = play;\n          }\n        }\n      }\n      \n      counts.set(winningPlay.playerId, (counts.get(winningPlay.playerId) || 0) + 1);\n    });\n    return counts;\n  }, [completedTricks, trumpSuit]);\n\n  // Calculate player positions in a circle, with local player always at bottom\n  const playerPositions = useMemo(() => {\n    const localPlayerIndex = players.findIndex(p => p.id === localPlayerId);\n    \n    // Check if mobile (window width < 640px)\n    const isMobile = typeof window !== 'undefined' && window.innerWidth < 640;\n    \n    return players.map((_, index) => {\n      // Calculate offset so local player is at bottom (Math.PI/2 = 90 degrees = bottom)\n      const positionIndex = localPlayerIndex >= 0 \n        ? (index - localPlayerIndex + players.length) % players.length \n        : index;\n      \n      // Start at bottom and go counter-clockwise\n      const angle = (positionIndex / players.length) * Math.PI * 2 + Math.PI / 2;\n      const radius = 38; // percentage - slightly larger for better spacing\n      \n      // On mobile, move local player (bottom position) higher to avoid browser chrome cutting off cards\n      let x = 50 + Math.cos(angle) * radius;\n      let y = 50 + Math.sin(angle) * radius;\n      \n      // If this is the local player position (bottom) on mobile, shift up by 15%\n      if (isMobile && positionIndex === 0) {\n        y = y - 15; // Move up by 15 percentage points (from ~88% to ~73%)\n      }\n      \n      return { x, y, angle };\n    });\n  }, [players.length, players, localPlayerId]);\n\n  if (players.length === 0) {\n    return (\n      <div className=\"w-full h-full flex items-center justify-center\">\n        <p className=\"text-white text-xl\">Waiting for players...</p>\n      </div>\n    );\n  }\n\n  return (\n    <div \n      className=\"relative w-full h-full pb-44 sm:pb-8\"\n      style={{ \n        paddingBottom: typeof window !== 'undefined' && window.innerWidth < 640 \n          ? 'max(176px, calc(env(safe-area-inset-bottom, 0px) + 140px))' \n          : undefined \n      }}\n    >\n      {/* Game table center */}\n      <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none\">\n        <div className=\"w-64 h-64 sm:w-80 sm:h-80 md:w-96 md:h-96 rounded-full bg-green-700 border-4 sm:border-8 border-green-600 shadow-2xl\" />\n      </div>\n\n      {/* Trump suit indicator - persistent during hand play */}\n      {trumpSuit && (gamePhase === 'hand_play' || gamePhase === 'trick_complete') && (\n        <div className=\"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white bg-opacity-95 rounded-full w-12 h-12 sm:w-14 sm:h-14 flex items-center justify-center shadow-lg border border-gray-300\">\n          <p className={`text-2xl sm:text-3xl ${trumpSuit === 'hearts' || trumpSuit === 'diamonds' ? 'text-red-600' : 'text-gray-800'}`}>\n            {trumpSuit === 'hearts' ? 'â™¥' : \n             trumpSuit === 'diamonds' ? 'â™¦' : \n             trumpSuit === 'clubs' ? 'â™£' : 'â™ '}\n          </p>\n        </div>\n      )}\n\n      {/* Current trick cards positioned in front of each player */}\n      <AnimatePresence>\n        {currentTrick.map((play, index) => {\n          const playerIndex = players.findIndex(p => p.id === play.playerId);\n          const playerPos = playerPositions[playerIndex];\n          \n          if (!playerPos) return null;\n          \n          // Calculate the visual position index (accounting for local player at bottom)\n          const localPlayerIndex = players.findIndex(p => p.id === localPlayerId);\n          const visualIndex = localPlayerIndex >= 0 \n            ? (playerIndex - localPlayerIndex + players.length) % players.length \n            : playerIndex;\n          \n          // Position card towards center from player's visual position\n          const angle = (visualIndex / players.length) * Math.PI * 2 + Math.PI / 2;\n          const cardRadius = 25; // Closer to center than player\n          const cardX = 50 + Math.cos(angle) * cardRadius;\n          const cardY = 50 + Math.sin(angle) * cardRadius;\n          \n          return (\n            <motion.div \n              key={`${play.playerId}-${index}`}\n              initial={{ \n                opacity: 0, \n                scale: 0.5,\n                left: `${playerPos.x}%`,\n                top: `${playerPos.y}%`,\n              }}\n              animate={{ \n                opacity: 1, \n                scale: 1,\n                left: `${cardX}%`,\n                top: `${cardY}%`,\n              }}\n              exit={{ opacity: 0, scale: 0.5 }}\n              transition={{ \n                duration: 0.6,\n                ease: \"easeOut\",\n                delay: index * 0.2\n              }}\n              className=\"absolute transform -translate-x-1/2 -translate-y-1/2 z-20\"\n            >\n              <Card card={play.card} isPlayable={false} />\n            </motion.div>\n          );\n        })}\n      </AnimatePresence>\n\n      {/* Player hands positioned around the table */}\n      {players.map((player, index) => {\n        const pos = playerPositions[index];\n        const isCurrentPlayer = index === currentPlayerIndex;\n        const isPlaying = playingPlayers.has(player.id);\n        const isLocalPlayer = player.id === localPlayerId;\n        const score = scores.get(player.id) || 16;\n\n        return (\n          <div\n            key={player.id}\n            className={`absolute transform -translate-x-1/2 -translate-y-1/2 transition-opacity duration-300 ${\n              !isPlaying && gamePhase === 'hand_play' ? 'opacity-30' : 'opacity-100'\n            }`}\n            style={{\n              left: `${pos.x}%`,\n              top: `${pos.y}%`,\n              zIndex: isLocalPlayer ? 30 : 10,\n            }}\n          >\n            <div className=\"flex flex-col items-center gap-0.5\">\n              {/* Player info */}\n              <div className={`\n                px-2 py-0.5 sm:py-1 rounded-lg shadow-md relative\n                ${isCurrentPlayer ? 'bg-yellow-400 text-gray-900' : 'bg-gray-800 text-white'}\n              `}>\n                <div className=\"flex items-center gap-1\">\n                  {/* Dealer chip indicator */}\n                  {index === dealerIndex && (\n                    <div className=\"w-4 h-4 sm:w-5 sm:h-5 rounded-full bg-white border-2 border-gray-800 flex items-center justify-center\" title=\"Dealer\">\n                      <span className=\"text-[7px] sm:text-[8px] font-bold text-gray-800\">D</span>\n                    </div>\n                  )}\n                  \n                  <div className=\"flex items-center gap-1 sm:gap-2\">\n                    <div>\n                      <p className=\"text-[10px] sm:text-xs font-semibold whitespace-nowrap\">\n                        {player.name.length > 10 ? player.name.substring(0, 10) + '...' : player.name}\n                        {player.isAI && ' ðŸ¤–'}\n                      </p>\n                    </div>\n                    <div className={`text-sm sm:text-lg font-bold px-1 sm:px-1.5 py-0.5 rounded ${\n                      score <= 0 ? 'bg-green-600 text-white' : \n                      score >= 28 ? 'bg-red-600 text-white' : \n                      score > 16 ? 'bg-orange-500 text-white' : \n                      'bg-blue-600 text-white'\n                    }`}>\n                      {score}\n                    </div>\n                  </div>\n                </div>\n                \n                {/* Status badges - compact */}\n                {!isPlaying && gamePhase === 'hand_play' && (\n                  <div className=\"text-[10px] bg-gray-600 px-1 py-0.5 rounded mt-0.5\">\n                    Sitting\n                  </div>\n                )}\n                {player.consecutiveSits >= 2 && gamePhase !== 'hand_play' && (\n                  <div className=\"text-[10px] bg-red-600 px-1 py-0.5 rounded mt-0.5\">\n                    Musty\n                  </div>\n                )}\n              </div>\n\n              {/* Bid display during bidding phase */}\n              {gamePhase === 'bidding' && (\n                <div className=\"bg-yellow-400 text-gray-900 px-2 py-0.5 rounded shadow-sm\">\n                  <p className=\"text-[10px] font-bold text-center\">\n                    {bids.has(player.id) ? \n                      (bids.get(player.id) === 0 ? 'Pass' : `Bid: ${bids.get(player.id)}`) : \n                      '...'}\n                  </p>\n                </div>\n              )}\n\n              {/* Bidder indicator */}\n              {highestBidder === player.id && (gamePhase === 'hand_play' || gamePhase === 'trick_complete') && (\n                <div className=\"bg-purple-600 text-white px-2 py-0.5 rounded shadow-sm\">\n                  <p className=\"text-[10px] font-bold text-center\">\n                    Bid: {bids.get(player.id) || 0}\n                  </p>\n                </div>\n              )}\n\n              {/* Flicker banner for players at 28+ score */}\n              {score >= 28 && (\n                <div className=\"bg-red-600 text-white px-2 py-0.5 rounded shadow-sm animate-pulse\">\n                  <p className=\"text-[10px] font-bold text-center\">\n                    FLICKER\n                  </p>\n                </div>\n              )}\n\n              {/* Tricks won counter during hand play */}\n              {(gamePhase === 'hand_play' || gamePhase === 'trick_complete') && isPlaying && (\n                <div className=\"bg-blue-600 text-white px-2 py-0.5 rounded shadow-sm\">\n                  <p className=\"text-[10px] font-bold text-center\">\n                    Tricks: {tricksWon.get(player.id) || 0}\n                  </p>\n                </div>\n              )}\n\n              {/* Player hand - always visible for local player */}\n              {(isPlaying || (isLocalPlayer && (gamePhase === 'bidding' || gamePhase === 'sit_pass' || gamePhase === 'trump_selection'))) && (\n                <PlayerHand\n                  cards={player.hand}\n                  isCurrentPlayer={isCurrentPlayer && gamePhase === 'hand_play' && isPlaying}\n                  faceUp={isLocalPlayer}\n                  selectedCard={isLocalPlayerTurn && gamePhase === 'hand_play' ? (selectedCard || undefined) : undefined}\n                  onCardClick={isLocalPlayerTurn && gamePhase === 'hand_play' ? handleCardSelect : undefined}\n                />\n              )}\n            </div>\n          </div>\n        );\n      })}\n    </div>\n  );\n}\n","size_bytes":12880},"client/src/components/ui/button.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst buttonVariants = cva(\n  \"inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"bg-primary text-primary-foreground shadow hover:bg-primary/90\",\n        destructive:\n          \"bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90\",\n        outline:\n          \"border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground\",\n        secondary:\n          \"bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80\",\n        ghost: \"hover:bg-accent hover:text-accent-foreground\",\n        link: \"text-primary underline-offset-4 hover:underline\",\n      },\n      size: {\n        default: \"h-9 px-4 py-2\",\n        sm: \"h-8 rounded-md px-3 text-xs\",\n        lg: \"h-10 rounded-md px-8\",\n        icon: \"h-9 w-9\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nexport interface ButtonProps\n  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n    VariantProps<typeof buttonVariants> {\n  asChild?: boolean\n}\n\nconst Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n  ({ className, variant, size, asChild = false, ...props }, ref) => {\n    const Comp = asChild ? Slot : \"button\"\n    return (\n      <Comp\n        className={cn(buttonVariants({ variant, size, className }))}\n        ref={ref}\n        {...props}\n      />\n    )\n  }\n)\nButton.displayName = \"Button\"\n\nexport { Button, buttonVariants }\n","size_bytes":1902},"client/src/index.css":{"content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n@layer base {\n  * {\n    @apply border-border;\n  }\n\n  body {\n    @apply font-sans antialiased bg-background text-foreground;\n    margin: 0;\n    padding: 0;\n    overflow: hidden;\n    width: 100vw;\n    height: 100vh;\n  }\n}\n\n#root {\n  width: 100%;\n  height: 100%;\n  position: fixed;\n}\n\ncanvas {\n  width: 100% !important;\n  height: 100% !important;\n  touch-action: none;\n}","size_bytes":427},"client/src/components/game/BiddingPhase.tsx":{"content":"import { useShnarps } from '../../lib/stores/useShnarps';\nimport { Button } from '../ui/button';\n\nexport default function BiddingPhase() {\n  const { \n    players, \n    currentPlayerIndex, \n    bids, \n    placeBid,\n    localPlayerId\n  } = useShnarps();\n  \n  const currentPlayer = players[currentPlayerIndex];\n  const isLocalPlayerTurn = currentPlayer?.id === localPlayerId;\n  const localPlayer = players.find(p => p.id === localPlayerId);\n  \n  const highestBid = Math.max(0, ...Array.from(bids.values()));\n  \n  const handleBid = (bid: number) => {\n    if (currentPlayer) {\n      placeBid(currentPlayer.id, bid);\n    }\n  };\n  \n  const canBid = (bid: number) => {\n    if (bid === 0) return true; // Can always pass\n    return bid > highestBid && bid <= 5;\n  };\n\n  // Only show bidding controls for local player's turn, positioned above player\n  if (!isLocalPlayerTurn || !localPlayer) return null;\n\n  return (\n    <div className=\"fixed bottom-56 sm:bottom-48 left-1/2 transform -translate-x-1/2 z-40\">\n      <div className=\"flex gap-2 bg-gray-900 bg-opacity-90 px-4 py-3 rounded-lg shadow-xl\">\n        <Button\n          onClick={() => handleBid(0)}\n          disabled={!canBid(0)}\n          className=\"min-w-[60px] h-12 touch-manipulation bg-red-600 hover:bg-red-700 text-white font-bold\"\n        >\n          Pass\n        </Button>\n        {[1, 2, 3, 4, 5].map(bid => (\n          <Button\n            key={bid}\n            onClick={() => handleBid(bid)}\n            disabled={!canBid(bid)}\n            className=\"min-w-[50px] h-12 touch-manipulation bg-blue-600 hover:bg-blue-700 text-white font-bold disabled:opacity-30\"\n          >\n            {bid}\n          </Button>\n        ))}\n      </div>\n    </div>\n  );\n}\n","size_bytes":1711},"client/src/components/ui/toggle.tsx":{"content":"import * as React from \"react\"\nimport * as TogglePrimitive from \"@radix-ui/react-toggle\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst toggleVariants = cva(\n  \"inline-flex items-center justify-center gap-2 rounded-md text-sm font-medium transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"bg-transparent\",\n        outline:\n          \"border border-input bg-transparent shadow-sm hover:bg-accent hover:text-accent-foreground\",\n      },\n      size: {\n        default: \"h-9 px-2 min-w-9\",\n        sm: \"h-8 px-1.5 min-w-8\",\n        lg: \"h-10 px-2.5 min-w-10\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  }\n)\n\nconst Toggle = React.forwardRef<\n  React.ElementRef<typeof TogglePrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof TogglePrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, ...props }, ref) => (\n  <TogglePrimitive.Root\n    ref={ref}\n    className={cn(toggleVariants({ variant, size, className }))}\n    {...props}\n  />\n))\n\nToggle.displayName = TogglePrimitive.Root.displayName\n\nexport { Toggle, toggleVariants }\n","size_bytes":1486},"client/src/lib/hooks/useAIPlayer.ts":{"content":"import { useEffect, useRef } from 'react';\nimport { useShnarps } from '../stores/useShnarps';\nimport { makeAIBid, chooseAITrumpSuit, makeAISitPlayDecision, chooseAICardToPlay } from '../game/aiPlayer';\nimport { isValidPlay } from '../game/cardUtils';\nimport { canPlayerSit } from '../game/gameLogic';\n\nexport function useAIPlayer() {\n  const { \n    gamePhase, \n    players, \n    currentPlayerIndex, \n    bids,\n    placeBid,\n    chooseTrumpSuit,\n    chooseSitOrPlay,\n    choosePenalty,\n    playCard,\n    trumpSuit,\n    currentTrick,\n    playingPlayers,\n    completedTricks,\n    scores,\n    isSimulating,\n    multiplayerMode,\n    isMultiplayerHost\n  } = useShnarps();\n\n  // Track if we've already started an action for this turn to prevent duplicates\n  const actionPendingRef = useRef<string | null>(null);\n  const lastTrickCountRef = useRef<number>(0);\n\n  useEffect(() => {\n    const currentPlayer = players[currentPlayerIndex];\n    \n    if (!currentPlayer || !currentPlayer.isAI) {\n      // Clear pending action when it's not AI's turn\n      actionPendingRef.current = null;\n      return;\n    }\n\n    // IMPORTANT: In online multiplayer, ALL AI is handled by the server\n    // Client-side AI is only for local (same-device) mode\n    if (multiplayerMode === 'online') {\n      console.log('ðŸŒ Online multiplayer: AI handled by server, skipping client-side AI');\n      return;\n    }\n    \n    // CRITICAL: Detect when a new trick has started (completed tricks increased AND current trick is empty)\n    // This means the previous trick finished and we're starting fresh\n    if (gamePhase === 'hand_play' && currentTrick.length === 0 && completedTricks.length > lastTrickCountRef.current) {\n      console.log(`ðŸ”„ New trick detected (${completedTricks.length} completed), clearing AI lock for ${currentPlayer.name}`);\n      actionPendingRef.current = null;\n      lastTrickCountRef.current = completedTricks.length;\n    }\n    \n    // CRITICAL: For hand_play phase, use player+trick as the lock key\n    // Include trick count so lock resets for each new trick\n    const stateKey = gamePhase === 'hand_play' \n      ? `${gamePhase}-${currentPlayer.id}-trick${completedTricks.length}`\n      : `${gamePhase}-${currentPlayerIndex}-${currentPlayer.id}`;\n    \n    // If we're already processing an action for this player in this trick, skip\n    if (actionPendingRef.current === stateKey) {\n      console.log(`AI ${currentPlayer.name} action already pending for this state, skipping`);\n      return;\n    }\n    \n    // During hand_play, check if this player already played in current trick\n    if (gamePhase === 'hand_play') {\n      const hasPlayedInTrick = currentTrick.some(play => play.playerId === currentPlayer.id);\n      if (hasPlayedInTrick) {\n        console.log(`AI ${currentPlayer.name} already played in this trick, skipping`);\n        return;\n      }\n    }\n\n    // CRITICAL: Mark this state as being processed IMMEDIATELY before any async operations\n    // This prevents race conditions where multiple useEffect calls can schedule actions\n    actionPendingRef.current = stateKey;\n\n    const difficulty = currentPlayer.aiDifficulty || 'medium';\n\n    // Check if any human players are in the game\n    const hasHumanInGame = players.some(p => !p.isAI);\n    \n    // During hand_play, check if any human is actually playing (not sitting)\n    const hasHumanPlaying = gamePhase === 'hand_play' \n      ? players.some(p => !p.isAI && playingPlayers.has(p.id))\n      : hasHumanInGame;\n    \n    // Speed control: instant when simulating (10ms), fast when only bots (100-200ms), normal with humans (300-500ms)\n    const baseDelay = isSimulating ? 10 : (hasHumanPlaying ? 300 : 100);\n    const randomDelay = isSimulating ? 0 : (hasHumanPlaying ? 200 : 100);\n    \n    // Add delay to make AI decisions feel more natural\n    const aiDelay = setTimeout(() => {\n      // Bidding phase\n      if (gamePhase === 'bidding') {\n        const currentHighestBid = Math.max(0, ...Array.from(bids.values()));\n        const isDealer = currentPlayerIndex === useShnarps.getState().dealerIndex;\n        const highestBidderId = useShnarps.getState().highestBidder;\n        const aiBid = makeAIBid(\n          currentPlayer.hand, \n          currentHighestBid, \n          isDealer, \n          players.length,\n          currentPlayer.id,\n          scores,\n          highestBidderId,\n          difficulty\n        );\n        placeBid(currentPlayer.id, aiBid);\n      }\n\n      // Trump selection phase\n      else if (gamePhase === 'trump_selection') {\n        const aiTrump = chooseAITrumpSuit(currentPlayer.hand, difficulty);\n        chooseTrumpSuit(aiTrump);\n      }\n\n      // Everyone sat out phase\n      else if (gamePhase === 'everyone_sat') {\n        // AI strategy: Usually better to take -5 yourself (moves toward winning)\n        // But if very close to losing (score >= 28), give +5 to others instead\n        const currentScore = scores.get(currentPlayer.id) || 16;\n        const choice = currentScore >= 28 ? 'others' : 'self';\n        choosePenalty(choice);\n      }\n\n      // Sit/pass phase\n      else if (gamePhase === 'sit_pass') {\n        const highestBid = Math.max(0, ...Array.from(bids.values()));\n        const canSit = canPlayerSit(currentPlayer, highestBid, trumpSuit);\n        const currentScore = scores.get(currentPlayer.id) || 16;\n        const decision = makeAISitPlayDecision(\n          currentPlayer,\n          currentPlayer.hand,\n          trumpSuit,\n          highestBid,\n          canSit,\n          currentScore,\n          scores,\n          difficulty\n        );\n        chooseSitOrPlay(currentPlayer.id, decision);\n      }\n\n      // Hand play phase\n      else if (gamePhase === 'hand_play' && playingPlayers.has(currentPlayer.id)) {\n        // CRITICAL: Check if this player already played in current trick\n        const hasPlayedInTrick = currentTrick.some(play => play.playerId === currentPlayer.id);\n        if (hasPlayedInTrick) {\n          return; // Already played, don't play again\n        }\n        \n        const playableCards = currentPlayer.hand.filter(card =>\n          isValidPlay(card, currentPlayer.hand, currentTrick, trumpSuit)\n        );\n        \n        if (playableCards.length > 0) {\n          const cardToPlay = chooseAICardToPlay(\n            currentPlayer.hand,\n            currentTrick,\n            trumpSuit,\n            playableCards,\n            difficulty\n          );\n          playCard(currentPlayer.id, cardToPlay);\n        }\n      }\n      \n      // Clear the pending flag after action completes\n      actionPendingRef.current = null;\n    }, baseDelay + Math.random() * randomDelay);\n\n    return () => {\n      clearTimeout(aiDelay);\n      // Clear pending flag if component unmounts or dependencies change\n      actionPendingRef.current = null;\n    };\n  }, [gamePhase, currentPlayerIndex, players, bids, trumpSuit, currentTrick, playingPlayers, scores, isSimulating, multiplayerMode, isMultiplayerHost, placeBid, chooseTrumpSuit, chooseSitOrPlay, choosePenalty, playCard]);\n}\n","size_bytes":6998},"client/src/components/ui/tabs.tsx":{"content":"import * as React from \"react\"\nimport * as TabsPrimitive from \"@radix-ui/react-tabs\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Tabs = TabsPrimitive.Root\n\nconst TabsList = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.List\n    ref={ref}\n    className={cn(\n      \"inline-flex h-9 items-center justify-center rounded-lg bg-muted p-1 text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsList.displayName = TabsPrimitive.List.displayName\n\nconst TabsTrigger = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Trigger>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Trigger>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Trigger\n    ref={ref}\n    className={cn(\n      \"inline-flex items-center justify-center whitespace-nowrap rounded-md px-3 py-1 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsTrigger.displayName = TabsPrimitive.Trigger.displayName\n\nconst TabsContent = React.forwardRef<\n  React.ElementRef<typeof TabsPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TabsPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <TabsPrimitive.Content\n    ref={ref}\n    className={cn(\n      \"mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2\",\n      className\n    )}\n    {...props}\n  />\n))\nTabsContent.displayName = TabsPrimitive.Content.displayName\n\nexport { Tabs, TabsList, TabsTrigger, TabsContent }\n","size_bytes":1877},"client/src/components/ui/carousel.tsx":{"content":"import * as React from \"react\"\nimport useEmblaCarousel, {\n  type UseEmblaCarouselType,\n} from \"embla-carousel-react\"\nimport { ArrowLeft, ArrowRight } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Button } from \"@/components/ui/button\"\n\ntype CarouselApi = UseEmblaCarouselType[1]\ntype UseCarouselParameters = Parameters<typeof useEmblaCarousel>\ntype CarouselOptions = UseCarouselParameters[0]\ntype CarouselPlugin = UseCarouselParameters[1]\n\ntype CarouselProps = {\n  opts?: CarouselOptions\n  plugins?: CarouselPlugin\n  orientation?: \"horizontal\" | \"vertical\"\n  setApi?: (api: CarouselApi) => void\n}\n\ntype CarouselContextProps = {\n  carouselRef: ReturnType<typeof useEmblaCarousel>[0]\n  api: ReturnType<typeof useEmblaCarousel>[1]\n  scrollPrev: () => void\n  scrollNext: () => void\n  canScrollPrev: boolean\n  canScrollNext: boolean\n} & CarouselProps\n\nconst CarouselContext = React.createContext<CarouselContextProps | null>(null)\n\nfunction useCarousel() {\n  const context = React.useContext(CarouselContext)\n\n  if (!context) {\n    throw new Error(\"useCarousel must be used within a <Carousel />\")\n  }\n\n  return context\n}\n\nconst Carousel = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement> & CarouselProps\n>(\n  (\n    {\n      orientation = \"horizontal\",\n      opts,\n      setApi,\n      plugins,\n      className,\n      children,\n      ...props\n    },\n    ref\n  ) => {\n    const [carouselRef, api] = useEmblaCarousel(\n      {\n        ...opts,\n        axis: orientation === \"horizontal\" ? \"x\" : \"y\",\n      },\n      plugins\n    )\n    const [canScrollPrev, setCanScrollPrev] = React.useState(false)\n    const [canScrollNext, setCanScrollNext] = React.useState(false)\n\n    const onSelect = React.useCallback((api: CarouselApi) => {\n      if (!api) {\n        return\n      }\n\n      setCanScrollPrev(api.canScrollPrev())\n      setCanScrollNext(api.canScrollNext())\n    }, [])\n\n    const scrollPrev = React.useCallback(() => {\n      api?.scrollPrev()\n    }, [api])\n\n    const scrollNext = React.useCallback(() => {\n      api?.scrollNext()\n    }, [api])\n\n    const handleKeyDown = React.useCallback(\n      (event: React.KeyboardEvent<HTMLDivElement>) => {\n        if (event.key === \"ArrowLeft\") {\n          event.preventDefault()\n          scrollPrev()\n        } else if (event.key === \"ArrowRight\") {\n          event.preventDefault()\n          scrollNext()\n        }\n      },\n      [scrollPrev, scrollNext]\n    )\n\n    React.useEffect(() => {\n      if (!api || !setApi) {\n        return\n      }\n\n      setApi(api)\n    }, [api, setApi])\n\n    React.useEffect(() => {\n      if (!api) {\n        return\n      }\n\n      onSelect(api)\n      api.on(\"reInit\", onSelect)\n      api.on(\"select\", onSelect)\n\n      return () => {\n        api?.off(\"select\", onSelect)\n      }\n    }, [api, onSelect])\n\n    return (\n      <CarouselContext.Provider\n        value={{\n          carouselRef,\n          api: api,\n          opts,\n          orientation:\n            orientation || (opts?.axis === \"y\" ? \"vertical\" : \"horizontal\"),\n          scrollPrev,\n          scrollNext,\n          canScrollPrev,\n          canScrollNext,\n        }}\n      >\n        <div\n          ref={ref}\n          onKeyDownCapture={handleKeyDown}\n          className={cn(\"relative\", className)}\n          role=\"region\"\n          aria-roledescription=\"carousel\"\n          {...props}\n        >\n          {children}\n        </div>\n      </CarouselContext.Provider>\n    )\n  }\n)\nCarousel.displayName = \"Carousel\"\n\nconst CarouselContent = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { carouselRef, orientation } = useCarousel()\n\n  return (\n    <div ref={carouselRef} className=\"overflow-hidden\">\n      <div\n        ref={ref}\n        className={cn(\n          \"flex\",\n          orientation === \"horizontal\" ? \"-ml-4\" : \"-mt-4 flex-col\",\n          className\n        )}\n        {...props}\n      />\n    </div>\n  )\n})\nCarouselContent.displayName = \"CarouselContent\"\n\nconst CarouselItem = React.forwardRef<\n  HTMLDivElement,\n  React.HTMLAttributes<HTMLDivElement>\n>(({ className, ...props }, ref) => {\n  const { orientation } = useCarousel()\n\n  return (\n    <div\n      ref={ref}\n      role=\"group\"\n      aria-roledescription=\"slide\"\n      className={cn(\n        \"min-w-0 shrink-0 grow-0 basis-full\",\n        orientation === \"horizontal\" ? \"pl-4\" : \"pt-4\",\n        className\n      )}\n      {...props}\n    />\n  )\n})\nCarouselItem.displayName = \"CarouselItem\"\n\nconst CarouselPrevious = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollPrev, canScrollPrev } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute  h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-left-12 top-1/2 -translate-y-1/2\"\n          : \"-top-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollPrev}\n      onClick={scrollPrev}\n      {...props}\n    >\n      <ArrowLeft className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Previous slide</span>\n    </Button>\n  )\n})\nCarouselPrevious.displayName = \"CarouselPrevious\"\n\nconst CarouselNext = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<typeof Button>\n>(({ className, variant = \"outline\", size = \"icon\", ...props }, ref) => {\n  const { orientation, scrollNext, canScrollNext } = useCarousel()\n\n  return (\n    <Button\n      ref={ref}\n      variant={variant}\n      size={size}\n      className={cn(\n        \"absolute h-8 w-8 rounded-full\",\n        orientation === \"horizontal\"\n          ? \"-right-12 top-1/2 -translate-y-1/2\"\n          : \"-bottom-12 left-1/2 -translate-x-1/2 rotate-90\",\n        className\n      )}\n      disabled={!canScrollNext}\n      onClick={scrollNext}\n      {...props}\n    >\n      <ArrowRight className=\"h-4 w-4\" />\n      <span className=\"sr-only\">Next slide</span>\n    </Button>\n  )\n})\nCarouselNext.displayName = \"CarouselNext\"\n\nexport {\n  type CarouselApi,\n  Carousel,\n  CarouselContent,\n  CarouselItem,\n  CarouselPrevious,\n  CarouselNext,\n}\n","size_bytes":6210},"client/src/components/ui/sheet.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as SheetPrimitive from \"@radix-ui/react-dialog\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\nimport { X } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Sheet = SheetPrimitive.Root\n\nconst SheetTrigger = SheetPrimitive.Trigger\n\nconst SheetClose = SheetPrimitive.Close\n\nconst SheetPortal = SheetPrimitive.Portal\n\nconst SheetOverlay = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nSheetOverlay.displayName = SheetPrimitive.Overlay.displayName\n\nconst sheetVariants = cva(\n  \"fixed z-50 gap-4 bg-background p-6 shadow-lg transition ease-in-out data-[state=closed]:duration-300 data-[state=open]:duration-500 data-[state=open]:animate-in data-[state=closed]:animate-out\",\n  {\n    variants: {\n      side: {\n        top: \"inset-x-0 top-0 border-b data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top\",\n        bottom:\n          \"inset-x-0 bottom-0 border-t data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom\",\n        left: \"inset-y-0 left-0 h-full w-3/4 border-r data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left sm:max-w-sm\",\n        right:\n          \"inset-y-0 right-0 h-full w-3/4 border-l data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right sm:max-w-sm\",\n      },\n    },\n    defaultVariants: {\n      side: \"right\",\n    },\n  }\n)\n\ninterface SheetContentProps\n  extends React.ComponentPropsWithoutRef<typeof SheetPrimitive.Content>,\n    VariantProps<typeof sheetVariants> {}\n\nconst SheetContent = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Content>,\n  SheetContentProps\n>(({ side = \"right\", className, children, ...props }, ref) => (\n  <SheetPortal>\n    <SheetOverlay />\n    <SheetPrimitive.Content\n      ref={ref}\n      className={cn(sheetVariants({ side }), className)}\n      {...props}\n    >\n      <SheetPrimitive.Close className=\"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-secondary\">\n        <X className=\"h-4 w-4\" />\n        <span className=\"sr-only\">Close</span>\n      </SheetPrimitive.Close>\n      {children}\n    </SheetPrimitive.Content>\n  </SheetPortal>\n))\nSheetContent.displayName = SheetPrimitive.Content.displayName\n\nconst SheetHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetHeader.displayName = \"SheetHeader\"\n\nconst SheetFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nSheetFooter.displayName = \"SheetFooter\"\n\nconst SheetTitle = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold text-foreground\", className)}\n    {...props}\n  />\n))\nSheetTitle.displayName = SheetPrimitive.Title.displayName\n\nconst SheetDescription = React.forwardRef<\n  React.ElementRef<typeof SheetPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof SheetPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <SheetPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nSheetDescription.displayName = SheetPrimitive.Description.displayName\n\nexport {\n  Sheet,\n  SheetPortal,\n  SheetOverlay,\n  SheetTrigger,\n  SheetClose,\n  SheetContent,\n  SheetHeader,\n  SheetFooter,\n  SheetTitle,\n  SheetDescription,\n}\n","size_bytes":4280},"client/src/components/ui/aspect-ratio.tsx":{"content":"import * as AspectRatioPrimitive from \"@radix-ui/react-aspect-ratio\"\n\nconst AspectRatio = AspectRatioPrimitive.Root\n\nexport { AspectRatio }\n","size_bytes":140},"client/src/components/ui/avatar.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as AvatarPrimitive from \"@radix-ui/react-avatar\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Avatar = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Root>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Root\n    ref={ref}\n    className={cn(\n      \"relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatar.displayName = AvatarPrimitive.Root.displayName\n\nconst AvatarImage = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Image>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Image>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Image\n    ref={ref}\n    className={cn(\"aspect-square h-full w-full\", className)}\n    {...props}\n  />\n))\nAvatarImage.displayName = AvatarPrimitive.Image.displayName\n\nconst AvatarFallback = React.forwardRef<\n  React.ElementRef<typeof AvatarPrimitive.Fallback>,\n  React.ComponentPropsWithoutRef<typeof AvatarPrimitive.Fallback>\n>(({ className, ...props }, ref) => (\n  <AvatarPrimitive.Fallback\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full items-center justify-center rounded-full bg-muted\",\n      className\n    )}\n    {...props}\n  />\n))\nAvatarFallback.displayName = AvatarPrimitive.Fallback.displayName\n\nexport { Avatar, AvatarImage, AvatarFallback }\n","size_bytes":1419},"client/src/components/ui/alert-dialog.tsx":{"content":"import * as React from \"react\"\nimport * as AlertDialogPrimitive from \"@radix-ui/react-alert-dialog\"\n\nimport { cn } from \"@/lib/utils\"\nimport { buttonVariants } from \"@/components/ui/button\"\n\nconst AlertDialog = AlertDialogPrimitive.Root\n\nconst AlertDialogTrigger = AlertDialogPrimitive.Trigger\n\nconst AlertDialogPortal = AlertDialogPrimitive.Portal\n\nconst AlertDialogOverlay = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Overlay>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Overlay>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Overlay\n    className={cn(\n      \"fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0\",\n      className\n    )}\n    {...props}\n    ref={ref}\n  />\n))\nAlertDialogOverlay.displayName = AlertDialogPrimitive.Overlay.displayName\n\nconst AlertDialogContent = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPortal>\n    <AlertDialogOverlay />\n    <AlertDialogPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg\",\n        className\n      )}\n      {...props}\n    />\n  </AlertDialogPortal>\n))\nAlertDialogContent.displayName = AlertDialogPrimitive.Content.displayName\n\nconst AlertDialogHeader = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col space-y-2 text-center sm:text-left\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogHeader.displayName = \"AlertDialogHeader\"\n\nconst AlertDialogFooter = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) => (\n  <div\n    className={cn(\n      \"flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2\",\n      className\n    )}\n    {...props}\n  />\n)\nAlertDialogFooter.displayName = \"AlertDialogFooter\"\n\nconst AlertDialogTitle = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Title>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Title>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Title\n    ref={ref}\n    className={cn(\"text-lg font-semibold\", className)}\n    {...props}\n  />\n))\nAlertDialogTitle.displayName = AlertDialogPrimitive.Title.displayName\n\nconst AlertDialogDescription = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Description>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Description>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Description\n    ref={ref}\n    className={cn(\"text-sm text-muted-foreground\", className)}\n    {...props}\n  />\n))\nAlertDialogDescription.displayName =\n  AlertDialogPrimitive.Description.displayName\n\nconst AlertDialogAction = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Action>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Action>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Action\n    ref={ref}\n    className={cn(buttonVariants(), className)}\n    {...props}\n  />\n))\nAlertDialogAction.displayName = AlertDialogPrimitive.Action.displayName\n\nconst AlertDialogCancel = React.forwardRef<\n  React.ElementRef<typeof AlertDialogPrimitive.Cancel>,\n  React.ComponentPropsWithoutRef<typeof AlertDialogPrimitive.Cancel>\n>(({ className, ...props }, ref) => (\n  <AlertDialogPrimitive.Cancel\n    ref={ref}\n    className={cn(\n      buttonVariants({ variant: \"outline\" }),\n      \"mt-2 sm:mt-0\",\n      className\n    )}\n    {...props}\n  />\n))\nAlertDialogCancel.displayName = AlertDialogPrimitive.Cancel.displayName\n\nexport {\n  AlertDialog,\n  AlertDialogPortal,\n  AlertDialogOverlay,\n  AlertDialogTrigger,\n  AlertDialogContent,\n  AlertDialogHeader,\n  AlertDialogFooter,\n  AlertDialogTitle,\n  AlertDialogDescription,\n  AlertDialogAction,\n  AlertDialogCancel,\n}\n","size_bytes":4419},"client/src/components/ui/badge.tsx":{"content":"import * as React from \"react\"\nimport { cva, type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst badgeVariants = cva(\n  \"inline-flex items-center rounded-md border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2\",\n  {\n    variants: {\n      variant: {\n        default:\n          \"border-transparent bg-primary text-primary-foreground shadow hover:bg-primary/80\",\n        secondary:\n          \"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80\",\n        destructive:\n          \"border-transparent bg-destructive text-destructive-foreground shadow hover:bg-destructive/80\",\n        outline: \"text-foreground\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n    },\n  }\n)\n\nexport interface BadgeProps\n  extends React.HTMLAttributes<HTMLDivElement>,\n    VariantProps<typeof badgeVariants> {}\n\nfunction Badge({ className, variant, ...props }: BadgeProps) {\n  return (\n    <div className={cn(badgeVariants({ variant }), className)} {...props} />\n  )\n}\n\nexport { Badge, badgeVariants }\n","size_bytes":1140},"client/src/lib/queryClient.ts":{"content":"import { QueryClient, QueryFunction } from \"@tanstack/react-query\";\n\nasync function throwIfResNotOk(res: Response) {\n  if (!res.ok) {\n    const text = (await res.text()) || res.statusText;\n    throw new Error(`${res.status}: ${text}`);\n  }\n}\n\nexport async function apiRequest(\n  method: string,\n  url: string,\n  data?: unknown | undefined,\n): Promise<Response> {\n  const res = await fetch(url, {\n    method,\n    headers: data ? { \"Content-Type\": \"application/json\" } : {},\n    body: data ? JSON.stringify(data) : undefined,\n    credentials: \"include\",\n  });\n\n  await throwIfResNotOk(res);\n  return res;\n}\n\ntype UnauthorizedBehavior = \"returnNull\" | \"throw\";\nexport const getQueryFn: <T>(options: {\n  on401: UnauthorizedBehavior;\n}) => QueryFunction<T> =\n  ({ on401: unauthorizedBehavior }) =>\n  async ({ queryKey }) => {\n    const res = await fetch(queryKey[0] as string, {\n      credentials: \"include\",\n    });\n\n    if (unauthorizedBehavior === \"returnNull\" && res.status === 401) {\n      return null;\n    }\n\n    await throwIfResNotOk(res);\n    return await res.json();\n  };\n\nexport const queryClient = new QueryClient({\n  defaultOptions: {\n    queries: {\n      queryFn: getQueryFn({ on401: \"throw\" }),\n      refetchInterval: false,\n      refetchOnWindowFocus: false,\n      staleTime: Infinity,\n      retry: false,\n    },\n    mutations: {\n      retry: false,\n    },\n  },\n});\n","size_bytes":1376},"postcss.config.js":{"content":"export default {\n  plugins: {\n    tailwindcss: {},\n    autoprefixer: {},\n  },\n}\n","size_bytes":80},"client/src/components/ui/radio-group.tsx":{"content":"import * as React from \"react\"\nimport * as RadioGroupPrimitive from \"@radix-ui/react-radio-group\"\nimport { Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst RadioGroup = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Root>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Root\n      className={cn(\"grid gap-2\", className)}\n      {...props}\n      ref={ref}\n    />\n  )\n})\nRadioGroup.displayName = RadioGroupPrimitive.Root.displayName\n\nconst RadioGroupItem = React.forwardRef<\n  React.ElementRef<typeof RadioGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof RadioGroupPrimitive.Item>\n>(({ className, ...props }, ref) => {\n  return (\n    <RadioGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        \"aspect-square h-4 w-4 rounded-full border border-primary text-primary shadow focus:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    >\n      <RadioGroupPrimitive.Indicator className=\"flex items-center justify-center\">\n        <Circle className=\"h-3.5 w-3.5 fill-primary\" />\n      </RadioGroupPrimitive.Indicator>\n    </RadioGroupPrimitive.Item>\n  )\n})\nRadioGroupItem.displayName = RadioGroupPrimitive.Item.displayName\n\nexport { RadioGroup, RadioGroupItem }\n","size_bytes":1410},"client/src/components/ui/scroll-area.tsx":{"content":"import * as React from \"react\"\nimport * as ScrollAreaPrimitive from \"@radix-ui/react-scroll-area\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ScrollArea = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.Root>\n>(({ className, children, ...props }, ref) => (\n  <ScrollAreaPrimitive.Root\n    ref={ref}\n    className={cn(\"relative overflow-hidden\", className)}\n    {...props}\n  >\n    <ScrollAreaPrimitive.Viewport className=\"h-full w-full rounded-[inherit]\">\n      {children}\n    </ScrollAreaPrimitive.Viewport>\n    <ScrollBar />\n    <ScrollAreaPrimitive.Corner />\n  </ScrollAreaPrimitive.Root>\n))\nScrollArea.displayName = ScrollAreaPrimitive.Root.displayName\n\nconst ScrollBar = React.forwardRef<\n  React.ElementRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>,\n  React.ComponentPropsWithoutRef<typeof ScrollAreaPrimitive.ScrollAreaScrollbar>\n>(({ className, orientation = \"vertical\", ...props }, ref) => (\n  <ScrollAreaPrimitive.ScrollAreaScrollbar\n    ref={ref}\n    orientation={orientation}\n    className={cn(\n      \"flex touch-none select-none transition-colors\",\n      orientation === \"vertical\" &&\n        \"h-full w-2.5 border-l border-l-transparent p-[1px]\",\n      orientation === \"horizontal\" &&\n        \"h-2.5 flex-col border-t border-t-transparent p-[1px]\",\n      className\n    )}\n    {...props}\n  >\n    <ScrollAreaPrimitive.ScrollAreaThumb className=\"relative flex-1 rounded-full bg-border\" />\n  </ScrollAreaPrimitive.ScrollAreaScrollbar>\n))\nScrollBar.displayName = ScrollAreaPrimitive.ScrollAreaScrollbar.displayName\n\nexport { ScrollArea, ScrollBar }\n","size_bytes":1642},"client/src/components/ui/collapsible.tsx":{"content":"\"use client\"\n\nimport * as CollapsiblePrimitive from \"@radix-ui/react-collapsible\"\n\nconst Collapsible = CollapsiblePrimitive.Root\n\nconst CollapsibleTrigger = CollapsiblePrimitive.CollapsibleTrigger\n\nconst CollapsibleContent = CollapsiblePrimitive.CollapsibleContent\n\nexport { Collapsible, CollapsibleTrigger, CollapsibleContent }\n","size_bytes":329},"client/src/components/ui/toggle-group.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as ToggleGroupPrimitive from \"@radix-ui/react-toggle-group\"\nimport { type VariantProps } from \"class-variance-authority\"\n\nimport { cn } from \"@/lib/utils\"\nimport { toggleVariants } from \"@/components/ui/toggle\"\n\nconst ToggleGroupContext = React.createContext<\n  VariantProps<typeof toggleVariants>\n>({\n  size: \"default\",\n  variant: \"default\",\n})\n\nconst ToggleGroup = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> &\n    VariantProps<typeof toggleVariants>\n>(({ className, variant, size, children, ...props }, ref) => (\n  <ToggleGroupPrimitive.Root\n    ref={ref}\n    className={cn(\"flex items-center justify-center gap-1\", className)}\n    {...props}\n  >\n    <ToggleGroupContext.Provider value={{ variant, size }}>\n      {children}\n    </ToggleGroupContext.Provider>\n  </ToggleGroupPrimitive.Root>\n))\n\nToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n\nconst ToggleGroupItem = React.forwardRef<\n  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item> &\n    VariantProps<typeof toggleVariants>\n>(({ className, children, variant, size, ...props }, ref) => {\n  const context = React.useContext(ToggleGroupContext)\n\n  return (\n    <ToggleGroupPrimitive.Item\n      ref={ref}\n      className={cn(\n        toggleVariants({\n          variant: context.variant || variant,\n          size: context.size || size,\n        }),\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </ToggleGroupPrimitive.Item>\n  )\n})\n\nToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n\nexport { ToggleGroup, ToggleGroupItem }\n","size_bytes":1753},"tailwind.config.ts":{"content":"import type { Config } from \"tailwindcss\";\n\nexport default {\n  darkMode: [\"class\"],\n  content: [\"./client/index.html\", \"./client/src/**/*.{js,jsx,ts,tsx}\"],\n  theme: {\n    extend: {\n      borderRadius: {\n        lg: \"var(--radius)\",\n        md: \"calc(var(--radius) - 2px)\",\n        sm: \"calc(var(--radius) - 4px)\",\n      },\n      colors: {\n        background: \"hsl(var(--background))\",\n        foreground: \"hsl(var(--foreground))\",\n        card: {\n          DEFAULT: \"hsl(var(--card))\",\n          foreground: \"hsl(var(--card-foreground))\",\n        },\n        popover: {\n          DEFAULT: \"hsl(var(--popover))\",\n          foreground: \"hsl(var(--popover-foreground))\",\n        },\n        primary: {\n          DEFAULT: \"hsl(var(--primary))\",\n          foreground: \"hsl(var(--primary-foreground))\",\n        },\n        secondary: {\n          DEFAULT: \"hsl(var(--secondary))\",\n          foreground: \"hsl(var(--secondary-foreground))\",\n        },\n        muted: {\n          DEFAULT: \"hsl(var(--muted))\",\n          foreground: \"hsl(var(--muted-foreground))\",\n        },\n        accent: {\n          DEFAULT: \"hsl(var(--accent))\",\n          foreground: \"hsl(var(--accent-foreground))\",\n        },\n        destructive: {\n          DEFAULT: \"hsl(var(--destructive))\",\n          foreground: \"hsl(var(--destructive-foreground))\",\n        },\n        border: \"hsl(var(--border))\",\n        input: \"hsl(var(--input))\",\n        ring: \"hsl(var(--ring))\",\n        chart: {\n          \"1\": \"hsl(var(--chart-1))\",\n          \"2\": \"hsl(var(--chart-2))\",\n          \"3\": \"hsl(var(--chart-3))\",\n          \"4\": \"hsl(var(--chart-4))\",\n          \"5\": \"hsl(var(--chart-5))\",\n        },\n        sidebar: {\n          DEFAULT: \"hsl(var(--sidebar-background))\",\n          foreground: \"hsl(var(--sidebar-foreground))\",\n          primary: \"hsl(var(--sidebar-primary))\",\n          \"primary-foreground\": \"hsl(var(--sidebar-primary-foreground))\",\n          accent: \"hsl(var(--sidebar-accent))\",\n          \"accent-foreground\": \"hsl(var(--sidebar-accent-foreground))\",\n          border: \"hsl(var(--sidebar-border))\",\n          ring: \"hsl(var(--sidebar-ring))\",\n        },\n      },\n      keyframes: {\n        \"accordion-down\": {\n          from: {\n            height: \"0\",\n          },\n          to: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n        },\n        \"accordion-up\": {\n          from: {\n            height: \"var(--radix-accordion-content-height)\",\n          },\n          to: {\n            height: \"0\",\n          },\n        },\n      },\n      animation: {\n        \"accordion-down\": \"accordion-down 0.2s ease-out\",\n        \"accordion-up\": \"accordion-up 0.2s ease-out\",\n      },\n    },\n  },\n  plugins: [require(\"tailwindcss-animate\"), require(\"@tailwindcss/typography\")],\n} satisfies Config;\n","size_bytes":2787},"client/src/components/ui/command.tsx":{"content":"import * as React from \"react\"\nimport { type DialogProps } from \"@radix-ui/react-dialog\"\nimport { Command as CommandPrimitive } from \"cmdk\"\nimport { Search } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\nimport { Dialog, DialogContent } from \"@/components/ui/dialog\"\n\nconst Command = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive\n    ref={ref}\n    className={cn(\n      \"flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\nCommand.displayName = CommandPrimitive.displayName\n\nconst CommandDialog = ({ children, ...props }: DialogProps) => {\n  return (\n    <Dialog {...props}>\n      <DialogContent className=\"overflow-hidden p-0\">\n        <Command className=\"[&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-group]]:px-2 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n          {children}\n        </Command>\n      </DialogContent>\n    </Dialog>\n  )\n}\n\nconst CommandInput = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Input>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Input>\n>(({ className, ...props }, ref) => (\n  <div className=\"flex items-center border-b px-3\" cmdk-input-wrapper=\"\">\n    <Search className=\"mr-2 h-4 w-4 shrink-0 opacity-50\" />\n    <CommandPrimitive.Input\n      ref={ref}\n      className={cn(\n        \"flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50\",\n        className\n      )}\n      {...props}\n    />\n  </div>\n))\n\nCommandInput.displayName = CommandPrimitive.Input.displayName\n\nconst CommandList = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.List>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.List>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.List\n    ref={ref}\n    className={cn(\"max-h-[300px] overflow-y-auto overflow-x-hidden\", className)}\n    {...props}\n  />\n))\n\nCommandList.displayName = CommandPrimitive.List.displayName\n\nconst CommandEmpty = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Empty>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Empty>\n>((props, ref) => (\n  <CommandPrimitive.Empty\n    ref={ref}\n    className=\"py-6 text-center text-sm\"\n    {...props}\n  />\n))\n\nCommandEmpty.displayName = CommandPrimitive.Empty.displayName\n\nconst CommandGroup = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Group>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Group>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Group\n    ref={ref}\n    className={cn(\n      \"overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandGroup.displayName = CommandPrimitive.Group.displayName\n\nconst CommandSeparator = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nCommandSeparator.displayName = CommandPrimitive.Separator.displayName\n\nconst CommandItem = React.forwardRef<\n  React.ElementRef<typeof CommandPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof CommandPrimitive.Item>\n>(({ className, ...props }, ref) => (\n  <CommandPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0\",\n      className\n    )}\n    {...props}\n  />\n))\n\nCommandItem.displayName = CommandPrimitive.Item.displayName\n\nconst CommandShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nCommandShortcut.displayName = \"CommandShortcut\"\n\nexport {\n  Command,\n  CommandDialog,\n  CommandInput,\n  CommandList,\n  CommandEmpty,\n  CommandGroup,\n  CommandItem,\n  CommandShortcut,\n  CommandSeparator,\n}\n","size_bytes":4873},"client/src/components/game/MultiplayerSetup.tsx":{"content":"import { useState, useEffect } from 'react';\nimport { Button } from '../ui/button';\nimport { Card, CardContent, CardHeader, CardTitle } from '../ui/card';\nimport { Input } from '../ui/input';\nimport { useMultiplayer } from '../../lib/hooks/useMultiplayer';\n\ninterface MultiplayerSetupProps {\n  onBack: () => void;\n  onConnected?: () => void;\n}\n\nexport default function MultiplayerSetup({ onBack, onConnected }: MultiplayerSetupProps) {\n  const [playerName, setPlayerName] = useState('');\n  const [roomCode, setRoomCode] = useState('');\n  const [mode, setMode] = useState<'menu' | 'create' | 'join' | 'spectate'>('menu');\n  const { connectToRoom, isConnected, mode: multiplayerMode } = useMultiplayer();\n\n  // When successfully connected to online mode, notify parent to close this dialog\n  useEffect(() => {\n    if (multiplayerMode === 'online' && onConnected) {\n      console.log('âœ… MultiplayerSetup: Connected to online mode, calling onConnected');\n      onConnected();\n    }\n  }, [multiplayerMode, onConnected]);\n\n  const handleCreateRoom = () => {\n    console.log('Create room button clicked, playerName:', playerName);\n    if (playerName.trim()) {\n      console.log('Calling connectToRoom...');\n      connectToRoom(playerName.trim(), undefined, false);\n    } else {\n      console.log('Player name is empty');\n    }\n  };\n\n  const handleCreateSpectatorRoom = () => {\n    console.log('Creating spectator room (AI-only game)');\n    connectToRoom('', undefined, true); // Empty name, spectator mode\n  };\n\n  const handleJoinRoom = () => {\n    console.log('Join room button clicked, playerName:', playerName, 'roomCode:', roomCode);\n    if (playerName.trim() && roomCode.trim()) {\n      console.log('Calling connectToRoom...');\n      connectToRoom(playerName.trim(), roomCode.trim().toUpperCase(), false);\n    } else {\n      console.log('Player name or room code is empty');\n    }\n  };\n\n  if (mode === 'menu') {\n    return (\n      <div className=\"fixed inset-0 flex items-start justify-center pt-8 md:pt-16\" style={{ zIndex: 9999 }}>\n        <Card className=\"w-full max-w-md mx-4 shadow-2xl bg-white\">\n          <CardHeader>\n            <CardTitle className=\"text-center\">Online Multiplayer</CardTitle>\n            <p className=\"text-center text-sm text-muted-foreground\">\n              Play with friends in real-time\n            </p>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <Button onClick={() => setMode('create')} className=\"w-full\" size=\"lg\">\n              Create New Room\n            </Button>\n            <Button onClick={() => setMode('join')} className=\"w-full\" variant=\"outline\" size=\"lg\">\n              Join Existing Room\n            </Button>\n            <Button onClick={handleCreateSpectatorRoom} className=\"w-full\" variant=\"secondary\" size=\"lg\">\n              ðŸ¤– Spectate AI Game\n            </Button>\n            <Button onClick={onBack} className=\"w-full\" variant=\"ghost\">\n              Back to Menu\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (mode === 'create') {\n    return (\n      <div className=\"fixed inset-0 flex items-start justify-center pt-8 md:pt-16\" style={{ zIndex: 9999 }}>\n        <Card className=\"w-full max-w-md mx-4 shadow-2xl bg-white\">\n          <CardHeader>\n            <CardTitle className=\"text-center\">Create Room</CardTitle>\n            <p className=\"text-center text-sm text-muted-foreground\">\n              You'll get a room code to share with friends\n            </p>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div>\n              <label className=\"text-sm font-medium\">Your Name</label>\n              <Input\n                placeholder=\"Enter your name\"\n                value={playerName}\n                onChange={(e) => setPlayerName(e.target.value)}\n                onKeyDown={(e) => {\n                  if (e.key === 'Enter' && playerName.trim()) {\n                    handleCreateRoom();\n                  }\n                }}\n              />\n            </div>\n            <Button \n              onClick={handleCreateRoom} \n              className=\"w-full\" \n              disabled={!playerName.trim() || isConnected}\n            >\n              {isConnected ? 'Creating...' : 'Create Room'}\n            </Button>\n            <Button onClick={() => setMode('menu')} className=\"w-full\" variant=\"ghost\">\n              Back\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  if (mode === 'join') {\n    return (\n      <div className=\"fixed inset-0 flex items-start justify-center pt-8 md:pt-16\" style={{ zIndex: 9999 }}>\n        <Card className=\"w-full max-w-md mx-4 shadow-2xl bg-white\">\n          <CardHeader>\n            <CardTitle className=\"text-center\">Join Room</CardTitle>\n            <p className=\"text-center text-sm text-muted-foreground\">\n              Enter the room code from your friend\n            </p>\n          </CardHeader>\n          <CardContent className=\"space-y-4\">\n            <div>\n              <label className=\"text-sm font-medium\">Your Name</label>\n              <Input\n                placeholder=\"Enter your name\"\n                value={playerName}\n                onChange={(e) => setPlayerName(e.target.value)}\n              />\n            </div>\n            <div>\n              <label className=\"text-sm font-medium\">Room Code</label>\n              <Input\n                placeholder=\"Enter 6-character code\"\n                value={roomCode}\n                onChange={(e) => setRoomCode(e.target.value.toUpperCase())}\n                maxLength={6}\n                onKeyDown={(e) => {\n                  if (e.key === 'Enter' && playerName.trim() && roomCode.trim()) {\n                    handleJoinRoom();\n                  }\n                }}\n              />\n            </div>\n            <Button \n              onClick={handleJoinRoom} \n              className=\"w-full\" \n              disabled={!playerName.trim() || !roomCode.trim() || isConnected}\n            >\n              {isConnected ? 'Joining...' : 'Join Room'}\n            </Button>\n            <Button onClick={() => setMode('menu')} className=\"w-full\" variant=\"ghost\">\n              Back\n            </Button>\n          </CardContent>\n        </Card>\n      </div>\n    );\n  }\n\n  return null;\n}\n","size_bytes":6311},"client/src/components/ui/context-menu.tsx":{"content":"import * as React from \"react\"\nimport * as ContextMenuPrimitive from \"@radix-ui/react-context-menu\"\nimport { Check, ChevronRight, Circle } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst ContextMenu = ContextMenuPrimitive.Root\n\nconst ContextMenuTrigger = ContextMenuPrimitive.Trigger\n\nconst ContextMenuGroup = ContextMenuPrimitive.Group\n\nconst ContextMenuPortal = ContextMenuPrimitive.Portal\n\nconst ContextMenuSub = ContextMenuPrimitive.Sub\n\nconst ContextMenuRadioGroup = ContextMenuPrimitive.RadioGroup\n\nconst ContextMenuSubTrigger = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubTrigger>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubTrigger> & {\n    inset?: boolean\n  }\n>(({ className, inset, children, ...props }, ref) => (\n  <ContextMenuPrimitive.SubTrigger\n    ref={ref}\n    className={cn(\n      \"flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[state=open]:bg-accent data-[state=open]:text-accent-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  >\n    {children}\n    <ChevronRight className=\"ml-auto h-4 w-4\" />\n  </ContextMenuPrimitive.SubTrigger>\n))\nContextMenuSubTrigger.displayName = ContextMenuPrimitive.SubTrigger.displayName\n\nconst ContextMenuSubContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.SubContent>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.SubContent>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.SubContent\n    ref={ref}\n    className={cn(\n      \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuSubContent.displayName = ContextMenuPrimitive.SubContent.displayName\n\nconst ContextMenuContent = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Content>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Portal>\n    <ContextMenuPrimitive.Content\n      ref={ref}\n      className={cn(\n        \"z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </ContextMenuPrimitive.Portal>\n))\nContextMenuContent.displayName = ContextMenuPrimitive.Content.displayName\n\nconst ContextMenuItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Item>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Item> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Item\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuItem.displayName = ContextMenuPrimitive.Item.displayName\n\nconst ContextMenuCheckboxItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.CheckboxItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.CheckboxItem>\n>(({ className, children, checked, ...props }, ref) => (\n  <ContextMenuPrimitive.CheckboxItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    checked={checked}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Check className=\"h-4 w-4\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.CheckboxItem>\n))\nContextMenuCheckboxItem.displayName =\n  ContextMenuPrimitive.CheckboxItem.displayName\n\nconst ContextMenuRadioItem = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.RadioItem>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.RadioItem>\n>(({ className, children, ...props }, ref) => (\n  <ContextMenuPrimitive.RadioItem\n    ref={ref}\n    className={cn(\n      \"relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50\",\n      className\n    )}\n    {...props}\n  >\n    <span className=\"absolute left-2 flex h-3.5 w-3.5 items-center justify-center\">\n      <ContextMenuPrimitive.ItemIndicator>\n        <Circle className=\"h-4 w-4 fill-current\" />\n      </ContextMenuPrimitive.ItemIndicator>\n    </span>\n    {children}\n  </ContextMenuPrimitive.RadioItem>\n))\nContextMenuRadioItem.displayName = ContextMenuPrimitive.RadioItem.displayName\n\nconst ContextMenuLabel = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Label>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Label> & {\n    inset?: boolean\n  }\n>(({ className, inset, ...props }, ref) => (\n  <ContextMenuPrimitive.Label\n    ref={ref}\n    className={cn(\n      \"px-2 py-1.5 text-sm font-semibold text-foreground\",\n      inset && \"pl-8\",\n      className\n    )}\n    {...props}\n  />\n))\nContextMenuLabel.displayName = ContextMenuPrimitive.Label.displayName\n\nconst ContextMenuSeparator = React.forwardRef<\n  React.ElementRef<typeof ContextMenuPrimitive.Separator>,\n  React.ComponentPropsWithoutRef<typeof ContextMenuPrimitive.Separator>\n>(({ className, ...props }, ref) => (\n  <ContextMenuPrimitive.Separator\n    ref={ref}\n    className={cn(\"-mx-1 my-1 h-px bg-border\", className)}\n    {...props}\n  />\n))\nContextMenuSeparator.displayName = ContextMenuPrimitive.Separator.displayName\n\nconst ContextMenuShortcut = ({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLSpanElement>) => {\n  return (\n    <span\n      className={cn(\n        \"ml-auto text-xs tracking-widest text-muted-foreground\",\n        className\n      )}\n      {...props}\n    />\n  )\n}\nContextMenuShortcut.displayName = \"ContextMenuShortcut\"\n\nexport {\n  ContextMenu,\n  ContextMenuTrigger,\n  ContextMenuContent,\n  ContextMenuItem,\n  ContextMenuCheckboxItem,\n  ContextMenuRadioItem,\n  ContextMenuLabel,\n  ContextMenuSeparator,\n  ContextMenuShortcut,\n  ContextMenuGroup,\n  ContextMenuPortal,\n  ContextMenuSub,\n  ContextMenuSubContent,\n  ContextMenuSubTrigger,\n  ContextMenuRadioGroup,\n}\n","size_bytes":7224},"client/src/components/ui/tooltip.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as TooltipPrimitive from \"@radix-ui/react-tooltip\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst TooltipProvider = TooltipPrimitive.Provider\n\nconst Tooltip = TooltipPrimitive.Root\n\nconst TooltipTrigger = TooltipPrimitive.Trigger\n\nconst TooltipContent = React.forwardRef<\n  React.ElementRef<typeof TooltipPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n>(({ className, sideOffset = 4, ...props }, ref) => (\n  <TooltipPrimitive.Portal>\n    <TooltipPrimitive.Content\n      ref={ref}\n      sideOffset={sideOffset}\n      className={cn(\n        \"z-50 overflow-hidden rounded-md bg-primary px-3 py-1.5 text-xs text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n        className\n      )}\n      {...props}\n    />\n  </TooltipPrimitive.Portal>\n))\nTooltipContent.displayName = TooltipPrimitive.Content.displayName\n\nexport { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }\n","size_bytes":1217},"client/src/components/ui/interface.tsx":{"content":"import { useEffect } from \"react\";\nimport { useGame } from \"@/lib/stores/useGame\";\nimport { useAudio } from \"@/lib/stores/useAudio\";\nimport { Button } from \"./button\";\nimport { Card, CardContent, CardFooter, CardHeader, CardTitle } from \"./card\";\nimport { VolumeX, Volume2, RotateCw, Trophy } from \"lucide-react\";\n\nexport function Interface() {\n  const restart = useGame((state) => state.restart);\n  const phase = useGame((state) => state.phase);\n  const { isMuted, toggleMute } = useAudio();\n\n  // Handle clicks on the interface in the ready phase to start the game\n  useEffect(() => {\n    if (phase === \"ready\") {\n      const handleClick = () => {\n        const activeElement = document.activeElement;\n        if (activeElement && 'blur' in activeElement) {\n          (activeElement as HTMLElement).blur();\n        }\n        const event = new KeyboardEvent(\"keydown\", { code: \"Space\" });\n        window.dispatchEvent(event);\n      };\n\n      window.addEventListener(\"click\", handleClick);\n      return () => window.removeEventListener(\"click\", handleClick);\n    }\n  }, [phase]);\n\n  return (\n    <>\n      {/* Top-right corner UI controls */}\n      <div className=\"fixed top-4 right-4 flex gap-2 z-10\">\n        <Button\n          variant=\"outline\"\n          size=\"icon\"\n          onClick={toggleMute}\n          title={isMuted ? \"Unmute\" : \"Mute\"}\n        >\n          {isMuted ? <VolumeX size={18} /> : <Volume2 size={18} />}\n        </Button>\n        \n        <Button\n          variant=\"outline\"\n          size=\"icon\"\n          onClick={restart}\n          title=\"Restart Game\"\n        >\n          <RotateCw size={18} />\n        </Button>\n      </div>\n      \n      {/* Game completion overlay */}\n      {phase === \"ended\" && (\n        <div className=\"fixed inset-0 flex items-center justify-center z-20 bg-black/30\">\n          <Card className=\"w-full max-w-md mx-4 shadow-lg\">\n            <CardHeader>\n              <CardTitle className=\"flex items-center justify-center gap-2\">\n                <Trophy className=\"text-yellow-500\" />\n                Level Complete!\n              </CardTitle>\n            </CardHeader>\n            \n            <CardContent>\n              <p className=\"text-center text-muted-foreground\">\n                Congratulations! You successfully navigated the course.\n              </p>\n            </CardContent>\n            \n            <CardFooter className=\"flex justify-center\">\n              <Button onClick={restart} className=\"w-full\">\n                Play Again\n              </Button>\n            </CardFooter>\n          </Card>\n        </div>\n      )}\n      \n      {/* Instructions panel */}\n      <div className=\"fixed bottom-4 left-4 z-10\">\n        <Card className=\"w-auto max-w-xs bg-background/80 backdrop-blur-sm\">\n          <CardContent className=\"p-4\">\n            <h3 className=\"font-medium mb-2\">Controls:</h3>\n            <ul className=\"text-sm space-y-1 text-muted-foreground\">\n              <li>WASD or Arrow Keys: Move the ball</li>\n              <li>Space: Jump</li>\n              <li>R: Restart game</li>\n              <li>M: Toggle sound</li>\n            </ul>\n          </CardContent>\n        </Card>\n      </div>\n    </>\n  );\n}\n","size_bytes":3180},"client/src/components/ui/skeleton.tsx":{"content":"import { cn } from \"@/lib/utils\"\n\nfunction Skeleton({\n  className,\n  ...props\n}: React.HTMLAttributes<HTMLDivElement>) {\n  return (\n    <div\n      className={cn(\"animate-pulse rounded-md bg-primary/10\", className)}\n      {...props}\n    />\n  )\n}\n\nexport { Skeleton }\n","size_bytes":266},"client/src/App.tsx":{"content":"import { useEffect } from \"react\";\nimport { QueryClient, QueryClientProvider } from \"@tanstack/react-query\";\nimport \"@fontsource/inter\";\nimport \"./index.css\";\n\nimport GameBoard from \"./components/game/GameBoard\";\nimport GameUI from \"./components/game/GameUI\";\nimport { useShnarps } from \"./lib/stores/useShnarps\";\nimport { useAIPlayer } from \"./lib/hooks/useAIPlayer\";\n\nconst queryClient = new QueryClient();\n\nfunction App() {\n  const { initializeGame, gamePhase, players } = useShnarps();\n  useAIPlayer(); // Enable AI player automation\n\n  useEffect(() => {\n    initializeGame();\n  }, [initializeGame]);\n\n  useEffect(() => {\n    console.log('Game Phase:', gamePhase);\n    console.log('Players:', players.length);\n  }, [gamePhase, players]);\n\n  return (\n    <QueryClientProvider client={queryClient}>\n      <div className=\"w-screen h-screen bg-gradient-to-br from-green-800 to-green-900 overflow-hidden\">\n        <GameBoard />\n        <GameUI />\n      </div>\n    </QueryClientProvider>\n  );\n}\n\nexport default App;\n","size_bytes":1014},"client/src/lib/stores/useShnarps.tsx":{"content":"import { create } from \"zustand\";\nimport { subscribeWithSelector } from \"zustand/middleware\";\nimport { GamePhase, Player, GameState, RoundHistory, AIDifficulty, calculateGameEndPayout } from \"../game/gameLogic\";\nimport { Card, createDeck, shuffleDeck, dealCards, determineTrickWinner, sortHandBySuit } from \"../game/cardUtils\";\nimport { useSettings } from \"./useSettings\";\nimport { useWallet } from \"./useWallet\";\n\ninterface ShnarpsState extends GameState {\n  localPlayerId: string | null;\n  isSimulating: boolean;\n  multiplayerMode: 'local' | 'online';\n  multiplayerRoomCode: string | null;\n  isMultiplayerHost: boolean;\n  websocket: WebSocket | null;\n  turnTimeRemaining: number | null;\n  // Actions\n  initializeGame: () => void;\n  setMultiplayerMode: (mode: 'local' | 'online', roomCode?: string | null, isHost?: boolean) => void;\n  setWebSocket: (ws: WebSocket | null) => void;\n  joinGame: (playerName: string, avatar?: { color: string; icon: string }) => void;\n  addAIPlayer: (difficulty?: AIDifficulty) => void;\n  startGame: () => void;\n  placeBid: (playerId: string, bid: number) => void;\n  chooseTrumpSuit: (suit: string) => void;\n  chooseSitOrPlay: (playerId: string, decision: 'sit' | 'play') => void;\n  choosePenalty: (choice: 'self' | 'others') => void;\n  playCard: (playerId: string, card: Card) => void;\n  nextTrick: () => void;\n  resetGame: () => void;\n  setSimulating: (simulating: boolean) => void;\n  setTurnTimer: (timeLimit: number) => void;\n  // Multiplayer actions\n  setMultiplayerState: (players: Player[], gameState: any, localPlayerId: string) => void;\n  addRemotePlayer: (player: Player) => void;\n  removePlayer: (playerId: string) => void;\n  applyGameAction: (action: string, payload: any) => void;\n  syncGameState: (gameState: any) => void;\n}\n\nexport const useShnarps = create<ShnarpsState>()(\n  subscribeWithSelector((set, get) => ({\n    // Initial game state\n    gamePhase: 'setup' as GamePhase,\n    localPlayerId: null,\n    isSimulating: false,\n    multiplayerMode: 'local' as 'local' | 'online',\n    multiplayerRoomCode: null,\n    isMultiplayerHost: false,\n    websocket: null,\n    turnTimeRemaining: null,\n    players: [],\n    eliminatedPlayers: [],\n    currentPlayerIndex: 0,\n    dealerIndex: 0,\n    deck: [],\n    currentTrick: [],\n    completedTricks: [],\n    bids: new Map(),\n    trumpSuit: null,\n    highestBidder: null,\n    playingPlayers: new Set(),\n    mustyPlayers: new Set(),\n    scores: new Map(),\n    round: 1,\n    history: [],\n    lastTrickWinner: null as string | null,\n    \n    setMultiplayerMode: (mode, roomCode, isHost) => {\n      set({\n        multiplayerMode: mode,\n        multiplayerRoomCode: roomCode ?? null,\n        isMultiplayerHost: isHost ?? false\n      });\n    },\n\n    setTurnTimer: (timeLimit: number) => {\n      set({ turnTimeRemaining: timeLimit });\n      \n      // Count down timer\n      const interval = setInterval(() => {\n        const state = get();\n        if (state.turnTimeRemaining === null || state.turnTimeRemaining <= 0) {\n          clearInterval(interval);\n          set({ turnTimeRemaining: null });\n        } else {\n          set({ turnTimeRemaining: state.turnTimeRemaining - 1 });\n        }\n      }, 1000);\n    },\n\n    setWebSocket: (ws) => {\n      set({ websocket: ws });\n    },\n    \n    initializeGame: () => {\n      const deck = shuffleDeck(createDeck());\n      set({\n        gamePhase: 'setup',\n        localPlayerId: null,\n        isSimulating: false,\n        players: [],\n        eliminatedPlayers: [],\n        currentPlayerIndex: 0,\n        dealerIndex: 0,\n        deck,\n        currentTrick: [],\n        completedTricks: [],\n        bids: new Map(),\n        trumpSuit: null,\n        highestBidder: null,\n        playingPlayers: new Set(),\n        mustyPlayers: new Set(),\n        scores: new Map(),\n        round: 1,\n        history: [],\n        lastTrickWinner: null,\n      });\n    },\n\n    joinGame: (playerName: string, avatar?: { color: string; icon: string }) => {\n      const state = get();\n      if (state.players.length >= 8 || state.gamePhase !== 'setup') return;\n      \n      const settings = useSettings.getState();\n      const wallet = useWallet.getState();\n      \n      const newPlayer: Player = {\n        id: `player_${Date.now()}_${Math.random()}`,\n        name: playerName,\n        hand: [],\n        isActive: true,\n        consecutiveSits: 0,\n        isAI: false,\n        avatar,\n        wallet: wallet.balance, // Use persistent wallet balance\n        punts: 0\n      };\n      \n      const newScores = new Map(state.scores);\n      newScores.set(newPlayer.id, settings.startingScore);\n      \n      set({\n        players: [...state.players, newPlayer],\n        scores: newScores,\n        localPlayerId: newPlayer.id // Store the local player's ID\n      });\n    },\n\n    addAIPlayer: (difficulty?: AIDifficulty) => {\n      const state = get();\n      if (state.players.length >= 8 || state.gamePhase !== 'setup') return;\n      \n      const settings = useSettings.getState();\n      const aiDifficulty = difficulty || settings.defaultAIDifficulty;\n      \n      // Random manly names for AI players\n      const aiPlayerNames = [\n        'Jack', 'Luke', 'Cole', 'Ryan',\n        'Jake', 'Tyler', 'Chase', 'Dylan',\n        'Blake', 'Hunter', 'Mason', 'Logan',\n        'Austin', 'Carter', 'Wyatt', 'Cody',\n        'Trevor', 'Connor', 'Brett', 'Shane'\n      ];\n      \n      // Pick a random name that hasn't been used\n      const usedNames = state.players.map(p => p.name);\n      const availableNames = aiPlayerNames.filter(name => !usedNames.includes(name));\n      const aiName = availableNames.length > 0 \n        ? availableNames[Math.floor(Math.random() * availableNames.length)]\n        : `AI ${state.players.length + 1}`;\n      \n      // Random avatar for AI\n      const aiColors = ['#EF4444', '#3B82F6', '#10B981', '#8B5CF6', '#F97316', '#EC4899', '#EAB308', '#14B8A6'];\n      const aiIcons = ['ðŸ¤–', 'ðŸŽ®', 'ðŸŽ¯', 'ðŸŽ²', 'ðŸƒ', 'â­', 'ðŸ”¥', 'ðŸ’Ž'];\n      const randomAvatar = {\n        color: aiColors[Math.floor(Math.random() * aiColors.length)],\n        icon: aiIcons[Math.floor(Math.random() * aiIcons.length)]\n      };\n      \n      const newPlayer: Player = {\n        id: `ai_${Date.now()}_${Math.random()}`,\n        name: aiName,\n        hand: [],\n        isActive: true,\n        consecutiveSits: 0,\n        isAI: true,\n        aiDifficulty: aiDifficulty,\n        avatar: randomAvatar,\n        wallet: 100, // Default wallet for AI players\n        punts: 0\n      };\n      \n      const newScores = new Map(state.scores);\n      newScores.set(newPlayer.id, settings.startingScore);\n      \n      set({\n        players: [...state.players, newPlayer],\n        scores: newScores\n      });\n    },\n\n    startGame: () => {\n      const state = get();\n      if (state.players.length < 4) return;\n      \n      // In online multiplayer, don't deal cards locally - server handles it\n      if (state.multiplayerMode === 'online') {\n        console.log('Online mode: Server will deal cards');\n        return;\n      }\n      \n      // Deal cards to all players (local mode only)\n      const shuffledDeck = shuffleDeck(createDeck());\n      const dealtCards = dealCards(shuffledDeck, state.players.length);\n      \n      const updatedPlayers = state.players.map((player, index) => ({\n        ...player,\n        hand: dealtCards[index] || []\n      }));\n      \n      set({\n        gamePhase: 'bidding',\n        players: updatedPlayers,\n        deck: shuffledDeck.slice(state.players.length * 5), // Remaining cards\n        currentPlayerIndex: (state.dealerIndex + 1) % state.players.length,\n        bids: new Map(),\n        trumpSuit: null,\n        highestBidder: null,\n      });\n    },\n\n    placeBid: (playerId: string, bid: number) => {\n      const state = get();\n      if (state.gamePhase !== 'bidding') return;\n      \n      const currentPlayer = state.players[state.currentPlayerIndex];\n      if (currentPlayer.id !== playerId) return;\n\n      // In online multiplayer, send action to server\n      if (state.multiplayerMode === 'online' && state.websocket) {\n        state.websocket.send(JSON.stringify({\n          type: 'GAME_ACTION',\n          action: 'bid',\n          payload: { playerId, bid }\n        }));\n        return; // Server will broadcast the state update\n      }\n      \n      const newBids = new Map(state.bids);\n      newBids.set(playerId, bid);\n      \n      // Find highest bid and bidder\n      let highestBid = 0;\n      let highestBidder = null;\n      for (const [id, playerBid] of newBids) {\n        if (playerBid > highestBid) {\n          highestBid = playerBid;\n          highestBidder = id;\n        }\n      }\n      \n      // Move to next player\n      let nextPlayerIndex = (state.currentPlayerIndex + 1) % state.players.length;\n      \n      // Check if bidding is complete (all players have bid)\n      const allPlayersBid = state.players.every(player => newBids.has(player.id));\n      \n      if (allPlayersBid) {\n        if (highestBidder) {\n          // Move to trump selection if someone bid > 0\n          set({\n            bids: newBids,\n            highestBidder,\n            gamePhase: 'trump_selection',\n            currentPlayerIndex: state.players.findIndex(p => p.id === highestBidder)\n          });\n        } else {\n          // All players passed, reshuffle and deal again\n          const shuffledDeck = shuffleDeck(createDeck());\n          const dealtCards = dealCards(shuffledDeck, state.players.length);\n          \n          const updatedPlayers = state.players.map((player, index) => ({\n            ...player,\n            hand: dealtCards[index] || []\n          }));\n          \n          set({\n            players: updatedPlayers,\n            deck: shuffledDeck.slice(state.players.length * 5),\n            bids: new Map(),\n            currentPlayerIndex: (state.dealerIndex + 1) % state.players.length\n          });\n        }\n      } else {\n        set({\n          bids: newBids,\n          currentPlayerIndex: nextPlayerIndex,\n          highestBidder\n        });\n      }\n    },\n\n    chooseTrumpSuit: (suit: string) => {\n      const state = get();\n      if (state.gamePhase !== 'trump_selection') return;\n\n      // In online multiplayer, send action to server\n      if (state.multiplayerMode === 'online' && state.websocket) {\n        state.websocket.send(JSON.stringify({\n          type: 'GAME_ACTION',\n          action: 'trump',\n          payload: { suit }\n        }));\n        return; // Server will broadcast the state update\n      }\n      \n      // Highest bidder always plays (if they're still active)\n      const playingPlayers = new Set<string>();\n      if (state.highestBidder) {\n        const bidder = state.players.find(p => p.id === state.highestBidder);\n        if (bidder && bidder.isActive) {\n          playingPlayers.add(state.highestBidder);\n        }\n      }\n      \n      // Check if everyone must play (bid of 1 or spades trump)\n      const highestBid = Math.max(0, ...Array.from(state.bids.values()));\n      const everyoneMustPlay = highestBid === 1 || suit === 'spades';\n      \n      if (everyoneMustPlay) {\n        // Everyone who is active plays, skip sit/pass phase\n        state.players.forEach(player => {\n          if (player.isActive) {\n            playingPlayers.add(player.id);\n          }\n        });\n        \n        // NOTE: Do NOT reset consecutiveSits here! \n        // Musty rule tracks sits ACROSS ROUNDS, not per round.\n        // consecutiveSits only resets when player actively chooses to PLAY.\n        \n        // First player to lead is to the left of the dealer\n        let firstPlayerIndex = (state.dealerIndex + 1) % state.players.length;\n        \n        // Make sure the first player is actually playing\n        while (!playingPlayers.has(state.players[firstPlayerIndex].id)) {\n          firstPlayerIndex = (firstPlayerIndex + 1) % state.players.length;\n        }\n        \n        set({\n          trumpSuit: suit,\n          gamePhase: 'hand_play',\n          currentPlayerIndex: firstPlayerIndex,\n          playingPlayers,\n          currentTrick: []\n        });\n      } else {\n        // Move to sit/pass phase, starting with player after highest bidder\n        const highestBidderIndex = state.players.findIndex(p => p.id === state.highestBidder);\n        const nextPlayerIndex = (highestBidderIndex + 1) % state.players.length;\n        \n        set({\n          trumpSuit: suit,\n          gamePhase: 'sit_pass',\n          currentPlayerIndex: nextPlayerIndex,\n          playingPlayers\n        });\n      }\n    },\n\n    choosePenalty: (choice: 'self' | 'others') => {\n      const state = get();\n      if (state.gamePhase !== 'everyone_sat') return;\n\n      // In online multiplayer, send action to server\n      if (state.multiplayerMode === 'online' && state.websocket) {\n        state.websocket.send(JSON.stringify({\n          type: 'GAME_ACTION',\n          action: 'penalty',\n          payload: { choice }\n        }));\n        return; // Server will broadcast the state update\n      }\n      \n      const newScores = new Map(state.scores);\n      \n      if (choice === 'self') {\n        // Reduce bidder's score by 5\n        const currentScore = newScores.get(state.highestBidder!) || 16;\n        newScores.set(state.highestBidder!, currentScore - 5);\n      } else {\n        // Add 5 to all other players' scores\n        state.players.forEach(player => {\n          if (player.id !== state.highestBidder) {\n            const currentScore = newScores.get(player.id) || 16;\n            newScores.set(player.id, currentScore + 5);\n          }\n        });\n      }\n      \n      // Save round history with penalty\n      const scoreChanges = new Map<string, number>();\n      if (choice === 'self') {\n        scoreChanges.set(state.highestBidder!, -5);\n      } else {\n        state.players.forEach(player => {\n          if (player.id !== state.highestBidder) {\n            scoreChanges.set(player.id, 5);\n          }\n        });\n      }\n      \n      const roundHistory: RoundHistory = {\n        round: state.round,\n        bids: new Map(state.bids),\n        trumpSuit: state.trumpSuit,\n        highestBidder: state.highestBidder,\n        playingPlayers: Array.from(state.playingPlayers),\n        tricksWon: new Map(),\n        scoreChanges,\n        finalScores: new Map(newScores)\n      };\n      \n      // Separate eliminated players using settings\n      const settings = useSettings.getState();\n      const newlyEliminatedPlayers: Player[] = [];\n      const remainingPlayers: Player[] = [];\n      \n      state.players.forEach(player => {\n        const score = newScores.get(player.id) || settings.startingScore;\n        if (score > settings.eliminationScore) {\n          newlyEliminatedPlayers.push({ ...player, isActive: false });\n        } else {\n          remainingPlayers.push(player);\n        }\n      });\n      \n      // Combine with previously eliminated players\n      const allEliminatedPlayers = [...state.eliminatedPlayers, ...newlyEliminatedPlayers];\n      \n      const activePlayers = remainingPlayers.filter(player => {\n        const score = newScores.get(player.id) || settings.startingScore;\n        return score > settings.winningScore && player.isActive;\n      });\n      \n      const hasWinner = Array.from(newScores.values()).some(score => score <= settings.winningScore);\n      \n      if (activePlayers.length <= 1 || hasWinner) {\n        set({\n          gamePhase: 'game_over',\n          players: remainingPlayers,\n          eliminatedPlayers: allEliminatedPlayers,\n          scores: newScores,\n          history: [...state.history, roundHistory],\n          isSimulating: false\n        });\n      } else {\n        // Start next round - eliminated players are completely removed\n        const nextDealerIndex = (state.dealerIndex + 1) % activePlayers.length;\n        const shuffledDeck = shuffleDeck(createDeck());\n        const dealtCards = dealCards(shuffledDeck, activePlayers.length);\n        \n        const updatedPlayers = activePlayers.map((player, index) => ({\n          ...player,\n          hand: dealtCards[index] || []\n          // NOTE: Do NOT reset consecutiveSits - musty rule persists across rounds!\n        }));\n        \n        set({\n          gamePhase: 'bidding',\n          players: updatedPlayers,\n          eliminatedPlayers: allEliminatedPlayers,\n          dealerIndex: nextDealerIndex,\n          currentPlayerIndex: (nextDealerIndex + 1) % activePlayers.length,\n          deck: shuffledDeck.slice(activePlayers.length * 5),\n          currentTrick: [],\n          completedTricks: [],\n          bids: new Map(),\n          trumpSuit: null,\n          highestBidder: null,\n          playingPlayers: new Set(),\n          scores: newScores,\n          round: state.round + 1,\n          history: [...state.history, roundHistory]\n        });\n      }\n    },\n\n    chooseSitOrPlay: (playerId: string, decision: 'sit' | 'play') => {\n      const state = get();\n      if (state.gamePhase !== 'sit_pass') return;\n      \n      const currentPlayer = state.players[state.currentPlayerIndex];\n      if (currentPlayer.id !== playerId) return;\n\n      // In online multiplayer, send action to server\n      if (state.multiplayerMode === 'online' && state.websocket) {\n        state.websocket.send(JSON.stringify({\n          type: 'GAME_ACTION',\n          action: 'sitpass',\n          payload: { playerId, decision }\n        }));\n        return; // Server will broadcast the state update\n      }\n      \n      const newPlayingPlayers = new Set(state.playingPlayers);\n      const updatedPlayers = [...state.players];\n      \n      const playerIndex = state.players.findIndex(p => p.id === playerId);\n      const highestBidderIndex = state.players.findIndex(p => p.id === state.highestBidder);\n      \n      if (decision === 'play') {\n        newPlayingPlayers.add(playerId);\n        updatedPlayers[playerIndex].consecutiveSits = 0;\n      } else {\n        updatedPlayers[playerIndex].consecutiveSits += 1;\n        \n        // If player is at 4 or lower and sits, add +1 to their score\n        const playerScore = state.scores.get(playerId) || 16;\n        if (playerScore <= 4) {\n          const newScores = new Map(state.scores);\n          newScores.set(playerId, playerScore + 1);\n          set({ scores: newScores });\n        }\n      }\n      \n      // Move to next player\n      let nextPlayerIndex = (state.currentPlayerIndex + 1) % state.players.length;\n      \n      // Check if we've gone around to the highest bidder (they were first, so we're done)\n      const backToHighestBidder = nextPlayerIndex === highestBidderIndex;\n      \n      if (backToHighestBidder) {\n        // All players have decided\n        const highestBid = Math.max(0, ...Array.from(state.bids.values()));\n        \n        // Check if everyone except the bidder sat out\n        const everyoneSatOut = newPlayingPlayers.size === 1 && \n                                state.highestBidder && \n                                newPlayingPlayers.has(state.highestBidder);\n        \n        // Check if the bidder can choose penalty (bid >= 2 and trump is not spades)\n        const canChoosePenalty = everyoneSatOut && highestBid >= 2 && state.trumpSuit !== 'spades';\n        \n        if (canChoosePenalty) {\n          // Move to everyone_sat phase where bidder chooses penalty\n          const bidderIndex = state.players.findIndex(p => p.id === state.highestBidder);\n          set({\n            playingPlayers: newPlayingPlayers,\n            players: updatedPlayers,\n            gamePhase: 'everyone_sat',\n            currentPlayerIndex: bidderIndex\n          });\n        } else {\n          // Start hand play phase\n          // First player to lead is to the left of the dealer\n          let firstPlayerIndex = (state.dealerIndex + 1) % state.players.length;\n          \n          // Make sure the first player is actually playing\n          while (!newPlayingPlayers.has(state.players[firstPlayerIndex].id)) {\n            firstPlayerIndex = (firstPlayerIndex + 1) % state.players.length;\n          }\n          \n          set({\n            playingPlayers: newPlayingPlayers,\n            players: updatedPlayers,\n            gamePhase: 'hand_play',\n            currentPlayerIndex: firstPlayerIndex,\n            currentTrick: []\n          });\n        }\n      } else {\n        set({\n          playingPlayers: newPlayingPlayers,\n          players: updatedPlayers,\n          currentPlayerIndex: nextPlayerIndex\n        });\n      }\n    },\n\n    playCard: (playerId: string, card: Card) => {\n      const state = get();\n      if (state.gamePhase !== 'hand_play') return;\n      \n      const currentPlayer = state.players[state.currentPlayerIndex];\n      if (currentPlayer.id !== playerId || !state.playingPlayers.has(playerId)) return;\n\n      // Remove card from player's hand IMMEDIATELY (prevents duplicate card bug)\n      const updatedPlayers = state.players.map(player => \n        player.id === playerId \n          ? { ...player, hand: player.hand.filter(c => c.suit !== card.suit || c.rank !== card.rank) }\n          : player\n      );\n\n      // In online multiplayer, send action to server\n      if (state.multiplayerMode === 'online' && state.websocket) {\n        // Update local state immediately to prevent duplicate plays\n        set({ players: updatedPlayers });\n        \n        state.websocket.send(JSON.stringify({\n          type: 'GAME_ACTION',\n          action: 'playcard',\n          payload: { playerId, card }\n        }));\n        return; // Server will broadcast the full state update\n      }\n      \n      const newTrick = [...state.currentTrick, { playerId, card }];\n      \n      // Check if trick is complete (all playing players have played)\n      const playingPlayersList = Array.from(state.playingPlayers);\n      if (newTrick.length === playingPlayersList.length) {\n        // Trick is complete - determine winner\n        const trickWinnerId = determineTrickWinner(newTrick, state.trumpSuit);\n        const newCompletedTricks = [...state.completedTricks, newTrick];\n        \n        // Check if all tricks are done (5 tricks total)\n        if (newCompletedTricks.length === 5) {\n          // Hand is complete - move to scoring\n          set({\n            players: updatedPlayers,\n            currentTrick: newTrick,\n            completedTricks: newCompletedTricks,\n            gamePhase: 'trick_complete',\n            lastTrickWinner: trickWinnerId\n          });\n          \n          // Auto-trigger scoring after a delay\n          setTimeout(() => {\n            get().nextTrick();\n          }, 2000);\n        } else {\n          // More tricks to play - winner leads next trick\n          let winnerIndex = state.players.findIndex(p => p.id === trickWinnerId);\n          \n          // CRITICAL: Ensure winner is in playingPlayers, otherwise find next playing player\n          if (!state.playingPlayers.has(state.players[winnerIndex].id)) {\n            console.warn('Trick winner is sitting out, finding next playing player');\n            // Find first playing player starting from winner position\n            let searchIndex = winnerIndex;\n            for (let i = 0; i < state.players.length; i++) {\n              searchIndex = (winnerIndex + i) % state.players.length;\n              if (state.playingPlayers.has(state.players[searchIndex].id)) {\n                winnerIndex = searchIndex;\n                break;\n              }\n            }\n          }\n          \n          set({\n            players: updatedPlayers,\n            currentTrick: newTrick, // Keep the trick visible\n            completedTricks: newCompletedTricks,\n            currentPlayerIndex: winnerIndex,\n            gamePhase: 'trick_complete',\n            lastTrickWinner: trickWinnerId\n          });\n          \n          // Auto-transition back to hand_play after showing the trick winner\n          setTimeout(() => {\n            set({ \n              gamePhase: 'hand_play',\n              currentTrick: [], // Clear trick when starting new one\n              lastTrickWinner: null\n            });\n          }, 1500);\n        }\n      } else {\n        // Move to next playing player\n        let nextPlayerIndex = (state.currentPlayerIndex + 1) % state.players.length;\n        while (!state.playingPlayers.has(state.players[nextPlayerIndex].id)) {\n          nextPlayerIndex = (nextPlayerIndex + 1) % state.players.length;\n        }\n        \n        set({\n          players: updatedPlayers,\n          currentTrick: newTrick,\n          currentPlayerIndex: nextPlayerIndex\n        });\n      }\n    },\n\n    nextTrick: () => {\n      const state = get();\n      \n      // In multiplayer, only host should calculate scores to prevent desync\n      if (state.multiplayerMode === 'online' && !state.isMultiplayerHost) {\n        // Non-host players should wait for host to broadcast state update\n        console.log('Non-host waiting for score update from host');\n        return;\n      }\n      \n      // Determine winner of current trick if it's complete\n      let trickWinnerId = null;\n      if (state.currentTrick.length > 0) {\n        trickWinnerId = determineTrickWinner(state.currentTrick, state.trumpSuit);\n      }\n      \n      // Check if hand is complete (all 5 tricks played)\n      if (state.completedTricks.length === 5) {\n        // Calculate scores and move to next round or end game\n        const newScores = new Map(state.scores);\n        \n        // Count tricks won by each player\n        const tricksWonByPlayer = new Map<string, number>();\n        for (const trick of state.completedTricks) {\n          const winnerId = determineTrickWinner(trick, state.trumpSuit);\n          tricksWonByPlayer.set(winnerId, (tricksWonByPlayer.get(winnerId) || 0) + 1);\n        }\n        \n        // Check for \"spading out\" - trump is spades and bidder won all 5 tricks\n        const spadingOut = state.trumpSuit === 'spades' && \n                          state.highestBidder && \n                          tricksWonByPlayer.get(state.highestBidder) === 5;\n        \n        // Track score changes and punts for history\n        const scoreChanges = new Map<string, number>();\n        const puntsThisRound = new Map<string, number>();\n        const updatedPlayersAfterScoring = [...state.players];\n        \n        if (spadingOut) {\n          // Spading out: instant win for the bidder\n          const bidderScore = newScores.get(state.highestBidder!) || 16;\n          newScores.set(state.highestBidder!, 0); // Set to winning score\n          scoreChanges.set(state.highestBidder!, -bidderScore);\n        } else {\n          // Update scores based on tricks won and bids\n          for (const playerId of state.playingPlayers) {\n            const tricksWon = tricksWonByPlayer.get(playerId) || 0;\n            const bid = state.bids.get(playerId) || 0;\n            const currentScore = newScores.get(playerId) || 16;\n            const isHighestBidder = playerId === state.highestBidder;\n            \n            let scoreChange = 0;\n            let isPunt = false;\n            \n            // Check for punt conditions\n            if (tricksWon === 0) {\n              // Didn't win any tricks: punt (+5)\n              scoreChange = 5;\n              isPunt = true;\n            } else if (isHighestBidder && tricksWon < bid) {\n              // Highest bidder didn't meet their bid: punt (+5)\n              scoreChange = 5;\n              isPunt = true;\n            } else {\n              // Normal scoring: -1 per trick won\n              scoreChange = -tricksWon;\n            }\n            \n            // Track punt for this round and increment player's total punts\n            if (isPunt) {\n              puntsThisRound.set(playerId, 1);\n              const playerIndex = updatedPlayersAfterScoring.findIndex(p => p.id === playerId);\n              if (playerIndex !== -1) {\n                updatedPlayersAfterScoring[playerIndex] = {\n                  ...updatedPlayersAfterScoring[playerIndex],\n                  punts: (updatedPlayersAfterScoring[playerIndex].punts || 0) + 1\n                };\n              }\n            }\n            \n            scoreChanges.set(playerId, scoreChange);\n            const newScore = currentScore + scoreChange;\n            newScores.set(playerId, newScore);\n          }\n        }\n        \n        // Save round history (no money changes during rounds)\n        const roundHistory: RoundHistory = {\n          round: state.round,\n          bids: new Map(state.bids),\n          trumpSuit: state.trumpSuit,\n          highestBidder: state.highestBidder,\n          playingPlayers: Array.from(state.playingPlayers),\n          tricksWon: tricksWonByPlayer,\n          scoreChanges,\n          finalScores: new Map(newScores),\n          punts: puntsThisRound\n        };\n        \n        // Separate eliminated players using settings\n        const settings = useSettings.getState();\n        const newlyEliminatedPlayers: Player[] = [];\n        const remainingPlayers: Player[] = [];\n        \n        updatedPlayersAfterScoring.forEach(player => {\n          const score = newScores.get(player.id) || settings.startingScore;\n          if (score > settings.eliminationScore) {\n            newlyEliminatedPlayers.push({ ...player, isActive: false });\n          } else {\n            remainingPlayers.push(player);\n          }\n        });\n        \n        // Combine with previously eliminated players\n        const allEliminatedPlayers = [...state.eliminatedPlayers, ...newlyEliminatedPlayers];\n        \n        const activePlayers = remainingPlayers.filter(player => {\n          const score = newScores.get(player.id) || settings.startingScore;\n          return score > settings.winningScore && player.isActive;\n        });\n        \n        // Check if game is over\n        const hasWinner = Array.from(newScores.values()).some(score => score <= settings.winningScore);\n        \n        if (activePlayers.length <= 1 || hasWinner) {\n          // Calculate money payout at game end using ALL players (including eliminated)\n          const allPlayers = [...remainingPlayers, ...allEliminatedPlayers];\n          const moneyChanges = calculateGameEndPayout(\n            allPlayers, \n            newScores,\n            settings.moneyPerPoint,\n            settings.moneyPerPunt\n          );\n          \n          // Update player wallets with game-end payout for ALL players\n          const updatedRemainingPlayers = remainingPlayers.map(player => ({\n            ...player,\n            wallet: (player.wallet || 100) + (moneyChanges.get(player.id) || 0)\n          }));\n          \n          const updatedEliminatedPlayers = allEliminatedPlayers.map(player => ({\n            ...player,\n            wallet: (player.wallet || 100) + (moneyChanges.get(player.id) || 0)\n          }));\n          \n          // Add money changes to the final round history\n          roundHistory.moneyChanges = moneyChanges;\n          roundHistory.finalWallets = new Map(\n            [...updatedRemainingPlayers, ...updatedEliminatedPlayers].map(p => [p.id, p.wallet || 100])\n          );\n          \n          set({\n            gamePhase: 'game_over',\n            players: updatedRemainingPlayers,\n            eliminatedPlayers: updatedEliminatedPlayers,\n            scores: newScores,\n            history: [...state.history, roundHistory],\n            isSimulating: false\n          });\n          \n          // Update persistent wallet for local human player\n          if (state.localPlayerId && moneyChanges.has(state.localPlayerId)) {\n            const localPlayer = [...updatedRemainingPlayers, ...updatedEliminatedPlayers].find(p => p.id === state.localPlayerId);\n            if (localPlayer && !localPlayer.isAI) {\n              const moneyChange = moneyChanges.get(state.localPlayerId) || 0;\n              const wallet = useWallet.getState();\n              \n              if (moneyChange > 0) {\n                wallet.addTransaction('win', moneyChange, `Won game - Round ${state.round}`);\n              } else if (moneyChange < 0) {\n                wallet.addTransaction('loss', Math.abs(moneyChange), `Lost game - Round ${state.round}`);\n              }\n            }\n          }\n        } else {\n          // Start next round (no wallet changes between rounds)\n          // Only deal cards to active players, eliminated players are completely removed\n          const nextDealerIndex = (state.dealerIndex + 1) % activePlayers.length;\n          const shuffledDeck = shuffleDeck(createDeck());\n          const dealtCards = dealCards(shuffledDeck, activePlayers.length);\n          \n          // Give hands to active players\n          const updatedPlayers = activePlayers.map((player, index) => ({\n            ...player,\n            hand: dealtCards[index] || [],\n            punts: player.punts || 0,\n            consecutiveSits: 0\n          }));\n          \n          set({\n            gamePhase: 'bidding',\n            players: updatedPlayers,\n            eliminatedPlayers: allEliminatedPlayers,\n            dealerIndex: nextDealerIndex,\n            currentPlayerIndex: (nextDealerIndex + 1) % activePlayers.length,\n            deck: shuffledDeck.slice(activePlayers.length * 5),\n            currentTrick: [],\n            completedTricks: [],\n            bids: new Map(),\n            trumpSuit: null,\n            highestBidder: null,\n            playingPlayers: new Set(),\n            scores: newScores,\n            round: state.round + 1,\n            history: [...state.history, roundHistory]\n          });\n          \n          // In multiplayer, host broadcasts new round state to all clients\n          if (state.multiplayerMode === 'online' && state.isMultiplayerHost && state.websocket) {\n            const newState = get();\n            state.websocket.send(JSON.stringify({\n              type: 'GAME_ACTION',\n              action: 'sync_state',\n              payload: {\n                gamePhase: newState.gamePhase,\n                players: newState.players,\n                eliminatedPlayers: newState.eliminatedPlayers,\n                scores: Object.fromEntries(newState.scores),\n                round: newState.round,\n                dealerIndex: newState.dealerIndex,\n                currentPlayerIndex: newState.currentPlayerIndex\n              }\n            }));\n          }\n        }\n      } else {\n        // Continue with next trick - winner of this trick leads the next\n        const winnerIndex = trickWinnerId \n          ? state.players.findIndex(p => p.id === trickWinnerId)\n          : (state.dealerIndex + 1) % state.players.length;\n        \n        // Make sure the next player to play is actually playing\n        let nextPlayerIndex = winnerIndex;\n        while (!state.playingPlayers.has(state.players[nextPlayerIndex].id)) {\n          nextPlayerIndex = (nextPlayerIndex + 1) % state.players.length;\n        }\n        \n        set({\n          currentTrick: [],\n          currentPlayerIndex: nextPlayerIndex\n        });\n        \n        // In multiplayer, host broadcasts trick completion to all clients\n        if (state.multiplayerMode === 'online' && state.isMultiplayerHost && state.websocket) {\n          const newState = get();\n          state.websocket.send(JSON.stringify({\n            type: 'GAME_ACTION',\n            action: 'sync_state',\n            payload: {\n              currentTrick: newState.currentTrick,\n              currentPlayerIndex: newState.currentPlayerIndex\n            }\n          }));\n        }\n      }\n    },\n\n    resetGame: () => {\n      const state = get();\n      \n      // If in multiplayer mode, disconnect and return to menu\n      if (state.multiplayerMode === 'online') {\n        // Close WebSocket connection\n        if (state.websocket) {\n          state.websocket.close();\n        }\n        \n        // Reset to menu state\n        get().initializeGame();\n        set({\n          multiplayerMode: 'local',\n          multiplayerRoomCode: null,\n          isMultiplayerHost: false,\n          websocket: null\n        });\n        return;\n      }\n      \n      // Local game reset: Save player wallets and avatars before reset\n      const playerWallets = new Map<string, number>();\n      const playerAvatars = new Map<string, { color: string; icon: string }>();\n      const playerNames = new Map<string, string>();\n      const playerAI = new Map<string, boolean>();\n      const playerDifficulty = new Map<string, AIDifficulty>();\n      \n      state.players.forEach(player => {\n        playerWallets.set(player.id, player.wallet || 100);\n        if (player.avatar) {\n          playerAvatars.set(player.id, player.avatar);\n        }\n        playerNames.set(player.id, player.name);\n        playerAI.set(player.id, player.isAI);\n        if (player.aiDifficulty) {\n          playerDifficulty.set(player.id, player.aiDifficulty);\n        }\n      });\n      \n      // Initialize game\n      get().initializeGame();\n      \n      // Restore players with their preserved wallets and avatars\n      const newState = get();\n      const deck = shuffleDeck(createDeck());\n      const dealtCards = dealCards(deck, state.players.length);\n      \n      const restoredPlayers = state.players.map((player, index) => ({\n        ...player,\n        hand: dealtCards[index] || [],\n        wallet: playerWallets.get(player.id) || 100,\n        avatar: playerAvatars.get(player.id),\n        punts: 0\n      }));\n      \n      const newScores = new Map();\n      restoredPlayers.forEach(player => {\n        newScores.set(player.id, 16);\n      });\n      \n      set({\n        gamePhase: 'setup',\n        players: restoredPlayers,\n        scores: newScores,\n        deck,\n        currentPlayerIndex: 0,\n        dealerIndex: 0,\n        currentTrick: [],\n        completedTricks: [],\n        bids: new Map(),\n        trumpSuit: null,\n        highestBidder: null,\n        playingPlayers: new Set(),\n        mustyPlayers: new Set(),\n        round: 1,\n        history: []\n      });\n    },\n\n    setSimulating: (simulating: boolean) => {\n      set({ isSimulating: simulating });\n    },\n\n    // Multiplayer methods\n    setMultiplayerState: (players: Player[], gameState: any, localPlayerId: string) => {\n      // Sort each player's hand by suit\n      const sortedPlayers = players.map(player => ({\n        ...player,\n        hand: player.hand.length > 0 ? sortHandBySuit(player.hand) : player.hand\n      }));\n\n      set({\n        players: sortedPlayers,\n        gamePhase: gameState.gamePhase,\n        currentPlayerIndex: gameState.currentPlayerIndex,\n        dealerIndex: gameState.dealerIndex,\n        bids: new Map(Object.entries(gameState.bids || {})),\n        trumpSuit: gameState.trumpSuit,\n        highestBidder: gameState.highestBidder,\n        playingPlayers: new Set(gameState.playingPlayers || []),\n        mustyPlayers: new Set(gameState.mustyPlayers || []),\n        scores: new Map(Object.entries(gameState.scores || {})),\n        round: gameState.round,\n        localPlayerId\n      });\n    },\n\n    addRemotePlayer: (player: Player) => {\n      const state = get();\n      set({\n        players: [...state.players, player],\n        scores: new Map(state.scores).set(player.id, 16)\n      });\n    },\n\n    removePlayer: (playerId: string) => {\n      const state = get();\n      const newScores = new Map(state.scores);\n      newScores.delete(playerId);\n      set({\n        players: state.players.filter(p => p.id !== playerId),\n        scores: newScores\n      });\n    },\n\n    applyGameAction: (action: string, payload: any) => {\n      // Apply state changes directly from server without executing full game logic\n      // This prevents double-execution and phase desync issues\n      const state = get();\n      \n      console.log(`ðŸ“¥ Applying action from server: ${action}`, payload);\n\n      switch (action) {\n        case 'bid': {\n          const newBids = new Map(state.bids);\n          newBids.set(payload.playerId, payload.bid);\n          \n          // Find highest bid and bidder\n          let highestBid = 0;\n          let highestBidder = null;\n          for (const [id, playerBid] of newBids) {\n            if (playerBid > highestBid) {\n              highestBid = playerBid;\n              highestBidder = id;\n            }\n          }\n          \n          // Check if bidding is complete\n          const allPlayersBid = state.players.every(player => newBids.has(player.id));\n          \n          if (allPlayersBid && highestBidder) {\n            // Move to trump selection\n            set({\n              bids: newBids,\n              highestBidder,\n              gamePhase: 'trump_selection',\n              currentPlayerIndex: state.players.findIndex(p => p.id === highestBidder)\n            });\n          } else {\n            // Move to next player\n            const nextPlayerIndex = (state.currentPlayerIndex + 1) % state.players.length;\n            set({\n              bids: newBids,\n              currentPlayerIndex: nextPlayerIndex,\n              highestBidder\n            });\n          }\n          break;\n        }\n        \n        case 'trump': {\n          const suit = payload.suit;\n          const highestBid = Math.max(0, ...Array.from(state.bids.values()));\n          const everyoneMustPlay = highestBid === 1 || suit === 'spades';\n          \n          // Build playing players set\n          const playingPlayers = new Set<string>();\n          if (state.highestBidder) {\n            playingPlayers.add(state.highestBidder);\n          }\n          \n          if (everyoneMustPlay) {\n            state.players.forEach(player => {\n              if (player.isActive) {\n                playingPlayers.add(player.id);\n              }\n            });\n            \n            // Skip sit/pass, go directly to hand_play\n            const firstPlayerIndex = (state.dealerIndex + 1) % state.players.length;\n            set({\n              trumpSuit: suit,\n              gamePhase: 'hand_play',\n              playingPlayers,\n              currentPlayerIndex: firstPlayerIndex,\n              currentTrick: []\n            });\n          } else {\n            // Go to sit/pass\n            const highestBidderIndex = state.players.findIndex(p => p.id === state.highestBidder);\n            const nextPlayerIndex = (highestBidderIndex + 1) % state.players.length;\n            set({\n              trumpSuit: suit,\n              gamePhase: 'sit_pass',\n              playingPlayers,\n              currentPlayerIndex: nextPlayerIndex\n            });\n          }\n          break;\n        }\n        \n        case 'sitpass': {\n          const { playerId, decision } = payload;\n          const newPlayingPlayers = new Set(state.playingPlayers);\n          const newMustyPlayers = new Set(state.mustyPlayers);\n          \n          if (decision === 'play') {\n            newPlayingPlayers.add(playerId);\n            newMustyPlayers.delete(playerId);\n          } else {\n            newMustyPlayers.add(playerId);\n          }\n          \n          // Check if all players have decided\n          const nonBidders = state.players.filter(p => p.id !== state.highestBidder);\n          const allDecided = nonBidders.every(p => \n            newPlayingPlayers.has(p.id) || newMustyPlayers.has(p.id)\n          );\n          \n          if (allDecided) {\n            // Check if everyone sat (only bidder is playing)\n            if (newPlayingPlayers.size === 1) {\n              console.log('Everyone sat except bidder - moving to everyone_sat phase');\n              // Set current player to the bidder so they can make the penalty choice\n              const bidderIndex = state.players.findIndex(p => p.id === state.highestBidder);\n              set({\n                playingPlayers: newPlayingPlayers,\n                mustyPlayers: newMustyPlayers,\n                gamePhase: 'everyone_sat',\n                currentPlayerIndex: bidderIndex\n              });\n            } else {\n              // Find first player to lead who is actually playing\n              let firstPlayerIndex = (state.dealerIndex + 1) % state.players.length;\n              while (!newPlayingPlayers.has(state.players[firstPlayerIndex].id)) {\n                firstPlayerIndex = (firstPlayerIndex + 1) % state.players.length;\n              }\n              \n              console.log(`First player to lead: index ${firstPlayerIndex}, player ${state.players[firstPlayerIndex].name}`);\n              \n              set({\n                playingPlayers: newPlayingPlayers,\n                mustyPlayers: newMustyPlayers,\n                gamePhase: 'hand_play',\n                currentPlayerIndex: firstPlayerIndex,\n                currentTrick: []\n              });\n            }\n          } else {\n            let nextPlayerIndex = (state.currentPlayerIndex + 1) % state.players.length;\n            while (state.players[nextPlayerIndex].id === state.highestBidder || \n                   newPlayingPlayers.has(state.players[nextPlayerIndex].id) ||\n                   newMustyPlayers.has(state.players[nextPlayerIndex].id)) {\n              nextPlayerIndex = (nextPlayerIndex + 1) % state.players.length;\n            }\n            set({\n              playingPlayers: newPlayingPlayers,\n              mustyPlayers: newMustyPlayers,\n              currentPlayerIndex: nextPlayerIndex\n            });\n          }\n          break;\n        }\n        \n        case 'playcard': {\n          const { playerId, card } = payload;\n          \n          // CRITICAL: Ignore playcard if we're not in hand_play phase\n          // This prevents duplicate cards being added to completed tricks\n          if (state.gamePhase !== 'hand_play') {\n            console.log(`âš ï¸ Ignoring playcard in phase ${state.gamePhase}`);\n            return;\n          }\n          \n          // CRITICAL: Check if this player already played in current trick\n          if (state.currentTrick.some(play => play.playerId === playerId)) {\n            console.log(`âš ï¸ Player ${playerId} already played in this trick, ignoring duplicate`);\n            return;\n          }\n          \n          // Remove card from player's hand\n          const updatedPlayers = state.players.map(player => \n            player.id === playerId\n              ? { ...player, hand: player.hand.filter(c => !(c.suit === card.suit && c.rank === card.rank)) }\n              : player\n          );\n          \n          // Add to current trick\n          const newTrick = [...state.currentTrick, { playerId, card }];\n          \n          // Check if trick is complete\n          const playingPlayersList = Array.from(state.playingPlayers);\n          if (newTrick.length === playingPlayersList.length) {\n            // Trick complete!\n            console.log('ðŸŽ¯ Trick complete!', newTrick.length, 'cards played');\n            \n            const trickWinnerId = determineTrickWinner(newTrick, state.trumpSuit);\n            const newCompletedTricks = [...state.completedTricks, newTrick];\n            \n            console.log(`Trick winner: ${trickWinnerId}, Completed tricks: ${newCompletedTricks.length}/5`);\n            \n            // Update state with completed trick\n            set({\n              players: updatedPlayers,\n              currentTrick: newTrick,\n              completedTricks: newCompletedTricks,\n              gamePhase: 'trick_complete',\n              lastTrickWinner: trickWinnerId\n            });\n            \n            // Only the host handles trick completion and broadcasts the next state\n            if (state.isMultiplayerHost) {\n              console.log('Host handling trick completion');\n              setTimeout(() => {\n                const currentState = get();\n                \n                // CRITICAL: Use currentState.completedTricks, not the captured newCompletedTricks\n                if (currentState.completedTricks.length === 5) {\n                  // Hand complete - trigger scoring\n                  console.log('All 5 tricks complete - triggering scoring');\n                  get().nextTrick();\n                } else {\n                  // Move to next trick - winner leads\n                  // CRITICAL: Use currentState, not the old captured state\n                  console.log(`ðŸ” Finding winner of trick. Winner ID: ${trickWinnerId}`);\n                  console.log(`ðŸ” Current players:`, currentState.players.map(p => `${p.name}(${p.id})`));\n                  console.log(`ðŸ” Playing players:`, Array.from(currentState.playingPlayers));\n                  \n                  let winnerIndex = currentState.players.findIndex(p => p.id === trickWinnerId);\n                  \n                  console.log(`ðŸ” findIndex returned: ${winnerIndex}, player at index: ${currentState.players[winnerIndex]?.name}`);\n                  \n                  // CRITICAL: Ensure winner is actually in playingPlayers\n                  // This can fail if player indices don't match playing status\n                  if (winnerIndex === -1 || !currentState.playingPlayers.has(currentState.players[winnerIndex]?.id)) {\n                    console.error(`âš ï¸ Winner index ${winnerIndex} (${currentState.players[winnerIndex]?.name}) not in playingPlayers! Finding first playing player...`);\n                    console.error(`âš ï¸ Winner ID \"${trickWinnerId}\" not found in players array or not playing`);\n                    // Find first playing player as fallback\n                    for (let i = 0; i < currentState.players.length; i++) {\n                      if (currentState.playingPlayers.has(currentState.players[i].id)) {\n                        winnerIndex = i;\n                        break;\n                      }\n                    }\n                    console.log(`Using index ${winnerIndex} (${currentState.players[winnerIndex]?.name}) instead`);\n                  }\n                  \n                  console.log(`Starting next trick, winner index: ${winnerIndex}, winner: ${currentState.players[winnerIndex]?.name}`);\n                  \n                  // Broadcast the cleared trick state\n                  if (currentState.websocket) {\n                    currentState.websocket.send(JSON.stringify({\n                      type: 'GAME_ACTION',\n                      action: 'sync_state',\n                      payload: {\n                        gamePhase: 'hand_play',\n                        currentTrick: [],\n                        currentPlayerIndex: winnerIndex,\n                        completedTricks: currentState.completedTricks,\n                        lastTrickWinner: null,\n                        playingPlayers: Array.from(currentState.playingPlayers)\n                      }\n                    }));\n                  }\n                  \n                  set({ \n                    gamePhase: 'hand_play',\n                    currentTrick: [],\n                    currentPlayerIndex: winnerIndex,\n                    lastTrickWinner: null\n                  });\n                }\n              }, 1500);\n            }\n          } else {\n            // Move to next playing player\n            let nextPlayerIndex = (state.currentPlayerIndex + 1) % state.players.length;\n            while (!state.playingPlayers.has(state.players[nextPlayerIndex].id)) {\n              nextPlayerIndex = (nextPlayerIndex + 1) % state.players.length;\n            }\n            set({\n              players: updatedPlayers,\n              currentTrick: newTrick,\n              currentPlayerIndex: nextPlayerIndex\n            });\n          }\n          break;\n        }\n        \n        case 'penalty': {\n          // Handle everyone_sat penalty choice\n          const { choice } = payload;\n          const newScores = new Map(state.scores);\n          \n          if (choice === 'self') {\n            const currentScore = newScores.get(state.highestBidder!) || 16;\n            newScores.set(state.highestBidder!, currentScore - 5);\n          } else {\n            state.players.forEach(player => {\n              if (player.id !== state.highestBidder) {\n                const currentScore = newScores.get(player.id) || 16;\n                newScores.set(player.id, currentScore + 5);\n              }\n            });\n          }\n          \n          // Move to next round - CRITICAL: Deal new cards!\n          const nextDealerIndex = (state.dealerIndex + 1) % state.players.length;\n          \n          // Only deal new cards if we're the host (in multiplayer) or in local mode\n          if (state.multiplayerMode === 'local' || state.isMultiplayerHost) {\n            const shuffledDeck = shuffleDeck(createDeck());\n            const dealtCards = dealCards(shuffledDeck, state.players.length);\n            \n            const updatedPlayers = state.players.map((player, index) => ({\n              ...player,\n              hand: dealtCards[index] || []\n              // NOTE: Do NOT reset consecutiveSits - musty rule persists!\n            }));\n            \n            set({\n              scores: newScores,\n              gamePhase: 'bidding',\n              round: state.round + 1,\n              dealerIndex: nextDealerIndex,\n              currentPlayerIndex: (nextDealerIndex + 1) % state.players.length,\n              players: updatedPlayers,\n              deck: shuffledDeck.slice(state.players.length * 5),\n              bids: new Map(),\n              trumpSuit: null,\n              highestBidder: null,\n              playingPlayers: new Set(),\n              mustyPlayers: new Set(),\n              currentTrick: [],\n              completedTricks: []\n            });\n            \n            // In multiplayer, host broadcasts new round state to all clients\n            if (state.multiplayerMode === 'online' && state.isMultiplayerHost && state.websocket) {\n              const newState = get();\n              state.websocket.send(JSON.stringify({\n                type: 'GAME_ACTION',\n                action: 'sync_state',\n                payload: {\n                  gamePhase: newState.gamePhase,\n                  players: newState.players,\n                  eliminatedPlayers: newState.eliminatedPlayers,\n                  scores: Object.fromEntries(newState.scores),\n                  round: newState.round,\n                  dealerIndex: newState.dealerIndex,\n                  currentPlayerIndex: newState.currentPlayerIndex\n                }\n              }));\n            }\n          } else {\n            // Non-host client: just update local state, cards will come from server\n            set({\n              scores: newScores,\n              gamePhase: 'bidding',\n              round: state.round + 1,\n              dealerIndex: nextDealerIndex,\n              currentPlayerIndex: (nextDealerIndex + 1) % state.players.length,\n              bids: new Map(),\n              trumpSuit: null,\n              highestBidder: null,\n              playingPlayers: new Set(),\n              mustyPlayers: new Set(),\n              currentTrick: [],\n              completedTricks: []\n            });\n          }\n          break;\n        }\n        \n        case 'sync_state': {\n          // Host is broadcasting authoritative state (scores, round changes, etc.)\n          const updates: any = {};\n          if (payload.gamePhase) updates.gamePhase = payload.gamePhase;\n          if (payload.scores) updates.scores = new Map(Object.entries(payload.scores));\n          if (payload.round !== undefined) updates.round = payload.round;\n          if (payload.dealerIndex !== undefined) updates.dealerIndex = payload.dealerIndex;\n          if (payload.currentPlayerIndex !== undefined) updates.currentPlayerIndex = payload.currentPlayerIndex;\n          if (payload.currentTrick !== undefined) updates.currentTrick = payload.currentTrick;\n          if (payload.completedTricks !== undefined) updates.completedTricks = payload.completedTricks;\n          if (payload.lastTrickWinner !== undefined) updates.lastTrickWinner = payload.lastTrickWinner;\n          if (payload.players) updates.players = payload.players;\n          if (payload.eliminatedPlayers) updates.eliminatedPlayers = payload.eliminatedPlayers;\n          if (payload.playingPlayers) updates.playingPlayers = new Set(payload.playingPlayers);\n          if (payload.mustyPlayers) updates.mustyPlayers = new Set(payload.mustyPlayers);\n          if (payload.trumpSuit !== undefined) updates.trumpSuit = payload.trumpSuit;\n          if (payload.bids) updates.bids = new Map(Object.entries(payload.bids));\n          if (payload.highestBidder !== undefined) updates.highestBidder = payload.highestBidder;\n          set(updates);\n          \n          // CRITICAL: When a new trick starts (currentTrick is empty), force a state update\n          // This ensures AI hooks re-evaluate and don't stay locked from previous attempts\n          if (payload.currentTrick && payload.currentTrick.length === 0 && payload.gamePhase === 'hand_play') {\n            // Force re-render by updating a timestamp or similar to break AI lock\n            console.log('ðŸ”„ New trick started via sync, clearing AI locks');\n            set({ lastTrickWinner: null });\n          }\n          break;\n        }\n      }\n    },\n\n    syncGameState: (gameState: any) => {\n      set({\n        gamePhase: gameState.gamePhase,\n        currentPlayerIndex: gameState.currentPlayerIndex,\n        dealerIndex: gameState.dealerIndex,\n        bids: new Map(Object.entries(gameState.bids || {})),\n        trumpSuit: gameState.trumpSuit,\n        highestBidder: gameState.highestBidder,\n        playingPlayers: new Set(gameState.playingPlayers || []),\n        mustyPlayers: new Set(gameState.mustyPlayers || []),\n        scores: new Map(Object.entries(gameState.scores || {})),\n        round: gameState.round\n      });\n    }\n  }))\n);\n","size_bytes":57281},"client/src/components/ui/hover-card.tsx":{"content":"\"use client\"\n\nimport * as React from \"react\"\nimport * as HoverCardPrimitive from \"@radix-ui/react-hover-card\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst HoverCard = HoverCardPrimitive.Root\n\nconst HoverCardTrigger = HoverCardPrimitive.Trigger\n\nconst HoverCardContent = React.forwardRef<\n  React.ElementRef<typeof HoverCardPrimitive.Content>,\n  React.ComponentPropsWithoutRef<typeof HoverCardPrimitive.Content>\n>(({ className, align = \"center\", sideOffset = 4, ...props }, ref) => (\n  <HoverCardPrimitive.Content\n    ref={ref}\n    align={align}\n    sideOffset={sideOffset}\n    className={cn(\n      \"z-50 w-64 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2\",\n      className\n    )}\n    {...props}\n  />\n))\nHoverCardContent.displayName = HoverCardPrimitive.Content.displayName\n\nexport { HoverCard, HoverCardTrigger, HoverCardContent }\n","size_bytes":1198},"client/src/components/game/AppWalkthrough.tsx":{"content":"import { useState } from 'react';\nimport { Button } from '../ui/button';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '../ui/dialog';\nimport { ChevronRight, X } from 'lucide-react';\n\ninterface AppWalkthroughProps {\n  open: boolean;\n  onClose: () => void;\n}\n\nconst walkthroughSteps = [\n  {\n    title: \"Welcome to Shnarps! ðŸŽ´\",\n    content: (\n      <div className=\"space-y-4\">\n        <p className=\"text-lg\">Let's show you around the app!</p>\n        <div className=\"bg-blue-50 p-4 rounded-lg\">\n          <p className=\"text-sm\">This quick walkthrough will help you understand:</p>\n          <ul className=\"list-disc list-inside text-sm mt-2 space-y-1\">\n            <li>How to start a game</li>\n            <li>Game modes available</li>\n            <li>Customizing your avatar</li>\n            <li>Navigating the interface</li>\n          </ul>\n        </div>\n      </div>\n    )\n  },\n  {\n    title: \"Choose Your Game Mode\",\n    content: (\n      <div className=\"space-y-3\">\n        <p>When you start, you'll see two options:</p>\n        <div className=\"space-y-3\">\n          <div className=\"bg-green-50 p-3 rounded-lg border border-green-200\">\n            <p className=\"font-semibold\">ðŸ  Local Game</p>\n            <p className=\"text-sm mt-1\">Play on one device with friends or AI players. Perfect for:</p>\n            <ul className=\"list-disc list-inside text-sm mt-1 ml-2\">\n              <li>Playing solo with AI</li>\n              <li>Pass-and-play with friends nearby</li>\n              <li>Learning the game</li>\n            </ul>\n          </div>\n          <div className=\"bg-blue-50 p-3 rounded-lg border border-blue-200\">\n            <p className=\"font-semibold\">ðŸŒ Online Multiplayer</p>\n            <p className=\"text-sm mt-1\">Play with friends online using room codes:</p>\n            <ul className=\"list-disc list-inside text-sm mt-1 ml-2\">\n              <li>Create a room and share the code</li>\n              <li>Join a friend's room with their code</li>\n              <li>Add AI players to fill empty spots</li>\n            </ul>\n          </div>\n        </div>\n      </div>\n    )\n  },\n  {\n    title: \"Customize Your Avatar\",\n    content: (\n      <div className=\"space-y-3\">\n        <p>Make your player unique with custom avatars!</p>\n        <div className=\"bg-purple-50 p-4 rounded-lg\">\n          <p className=\"text-sm font-semibold mb-2\">How to customize:</p>\n          <ol className=\"list-decimal list-inside text-sm space-y-1\">\n            <li>Click on your avatar when joining a game</li>\n            <li>Choose from 8 different colors</li>\n            <li>Pick your favorite icon (24 options!)</li>\n            <li>Save and see it throughout the game</li>\n          </ol>\n        </div>\n        <p className=\"text-sm text-muted-foreground\">Your avatar appears next to your name and score everywhere in the game!</p>\n      </div>\n    )\n  },\n  {\n    title: \"Setting Up a Game\",\n    content: (\n      <div className=\"space-y-3\">\n        <p className=\"font-semibold\">Local Game Setup:</p>\n        <ol className=\"list-decimal list-inside text-sm space-y-2\">\n          <li>Enter your name and customize your avatar</li>\n          <li>Click \"Join Game\"</li>\n          <li>Add 3-7 more players (human or AI)</li>\n          <li>Select AI difficulty (Easy, Medium, Hard)</li>\n          <li>Click \"Start Game\" when ready</li>\n        </ol>\n        <div className=\"bg-yellow-50 p-3 rounded-lg border border-yellow-200 mt-3\">\n          <p className=\"text-sm\">ðŸ’¡ <strong>Tip:</strong> You need at least 4 players total to start a game!</p>\n        </div>\n      </div>\n    )\n  },\n  {\n    title: \"Online Multiplayer\",\n    content: (\n      <div className=\"space-y-3\">\n        <p className=\"font-semibold\">Creating a Room:</p>\n        <ol className=\"list-decimal list-inside text-sm space-y-1 mb-3\">\n          <li>Choose \"Online Multiplayer\"</li>\n          <li>Click \"Create Room\"</li>\n          <li>Share the 6-character room code with friends</li>\n          <li>As host, you can add AI players and start the game</li>\n        </ol>\n        <p className=\"font-semibold\">Joining a Room:</p>\n        <ol className=\"list-decimal list-inside text-sm space-y-1\">\n          <li>Choose \"Online Multiplayer\"</li>\n          <li>Click \"Join Room\"</li>\n          <li>Enter your friend's room code</li>\n          <li>Wait for the host to start the game</li>\n        </ol>\n      </div>\n    )\n  },\n  {\n    title: \"Game Interface Overview\",\n    content: (\n      <div className=\"space-y-3\">\n        <p>Once the game starts, here's what you'll see:</p>\n        <div className=\"space-y-2\">\n          <div className=\"bg-gray-50 p-2 rounded\">\n            <p className=\"text-sm\"><strong>Top Left:</strong> Round number and current game phase</p>\n          </div>\n          <div className=\"bg-gray-50 p-2 rounded\">\n            <p className=\"text-sm\"><strong>Top Right:</strong> All player scores with avatars</p>\n          </div>\n          <div className=\"bg-gray-50 p-2 rounded\">\n            <p className=\"text-sm\"><strong>Center:</strong> Game board with current cards</p>\n          </div>\n          <div className=\"bg-gray-50 p-2 rounded\">\n            <p className=\"text-sm\"><strong>Bottom:</strong> Your hand of cards</p>\n          </div>\n          <div className=\"bg-gray-50 p-2 rounded\">\n            <p className=\"text-sm\"><strong>History Button:</strong> View past rounds and scores</p>\n          </div>\n        </div>\n      </div>\n    )\n  },\n  {\n    title: \"Mobile-Friendly\",\n    content: (\n      <div className=\"space-y-3\">\n        <p>The game works great on mobile devices!</p>\n        <div className=\"bg-blue-50 p-3 rounded-lg\">\n          <p className=\"text-sm font-semibold mb-2\">Mobile Features:</p>\n          <ul className=\"list-disc list-inside text-sm space-y-1\">\n            <li>Larger cards optimized for touch</li>\n            <li>Horizontal scrolling for your hand</li>\n            <li>Touch-friendly buttons (minimum 44px)</li>\n            <li>Responsive dialogs and menus</li>\n          </ul>\n        </div>\n        <p className=\"text-sm text-muted-foreground\">Play anywhere, on any device!</p>\n      </div>\n    )\n  },\n  {\n    title: \"Tips & Tricks\",\n    content: (\n      <div className=\"space-y-3\">\n        <p className=\"font-semibold\">App Tips:</p>\n        <ul className=\"list-disc list-inside text-sm space-y-2\">\n          <li><strong>History:</strong> Click the history button to review previous rounds and scoring</li>\n          <li><strong>AI Difficulty:</strong> Easy AI makes mistakes, Medium is balanced, Hard plays optimally</li>\n          <li><strong>Room Codes:</strong> Online room codes are case-insensitive and easy to share</li>\n          <li><strong>Auto-Save:</strong> Your game progress is automatically saved</li>\n        </ul>\n        <div className=\"bg-green-50 p-3 rounded-lg border border-green-200 mt-3\">\n          <p className=\"text-sm\">âœ… You can access the game rules tutorial anytime from the main menu!</p>\n        </div>\n      </div>\n    )\n  },\n  {\n    title: \"You're Ready!\",\n    content: (\n      <div className=\"space-y-4 text-center\">\n        <p className=\"text-xl font-semibold\">All Set! ðŸŽ‰</p>\n        <p>You now know how to navigate the app and set up games.</p>\n        <div className=\"bg-blue-50 p-4 rounded-lg\">\n          <p className=\"text-sm font-semibold mb-2\">Don't know how to play yet?</p>\n          <p className=\"text-sm\">Check out the <strong>Game Tutorial</strong> from the main menu to learn the rules!</p>\n        </div>\n        <p className=\"text-sm text-muted-foreground\">Have fun playing Shnarps!</p>\n      </div>\n    )\n  }\n];\n\nexport default function AppWalkthrough({ open, onClose }: AppWalkthroughProps) {\n  const [currentStep, setCurrentStep] = useState(0);\n\n  const handleNext = () => {\n    if (currentStep < walkthroughSteps.length - 1) {\n      setCurrentStep(currentStep + 1);\n    } else {\n      // Mark walkthrough as completed in localStorage\n      localStorage.setItem('shnarps_walkthrough_completed', 'true');\n      onClose();\n    }\n  };\n\n  const handleSkip = () => {\n    localStorage.setItem('shnarps_walkthrough_completed', 'true');\n    setCurrentStep(0);\n    onClose();\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={handleSkip}>\n      <DialogContent className=\"sm:max-w-2xl bg-white max-h-[90vh] overflow-y-auto\">\n        <DialogHeader>\n          <div className=\"flex items-center justify-between\">\n            <DialogTitle>{walkthroughSteps[currentStep].title}</DialogTitle>\n            <Button variant=\"ghost\" size=\"sm\" onClick={handleSkip} className=\"h-8 w-8 p-0\">\n              <X className=\"h-4 w-4\" />\n            </Button>\n          </div>\n          <div className=\"flex items-center gap-2 mt-2\">\n            <div className=\"flex-1 bg-gray-200 rounded-full h-2\">\n              <div\n                className=\"bg-green-500 h-2 rounded-full transition-all\"\n                style={{ width: `${((currentStep + 1) / walkthroughSteps.length) * 100}%` }}\n              />\n            </div>\n            <span className=\"text-sm text-muted-foreground\">\n              {currentStep + 1}/{walkthroughSteps.length}\n            </span>\n          </div>\n        </DialogHeader>\n\n        <div className=\"py-4\">\n          {walkthroughSteps[currentStep].content}\n        </div>\n\n        <div className=\"flex justify-between pt-4 border-t\">\n          <Button onClick={handleSkip} variant=\"ghost\">\n            Skip Tour\n          </Button>\n          <Button onClick={handleNext}>\n            {currentStep === walkthroughSteps.length - 1 ? (\n              \"Get Started!\"\n            ) : (\n              <>\n                Next\n                <ChevronRight className=\"h-4 w-4 ml-1\" />\n              </>\n            )}\n          </Button>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":9791},"client/src/components/ui/sonner.tsx":{"content":"\"use client\"\n\nimport { useTheme } from \"next-themes\"\nimport { Toaster as Sonner } from \"sonner\"\n\ntype ToasterProps = React.ComponentProps<typeof Sonner>\n\nconst Toaster = ({ ...props }: ToasterProps) => {\n  const { theme = \"system\" } = useTheme()\n\n  return (\n    <Sonner\n      theme={theme as ToasterProps[\"theme\"]}\n      className=\"toaster group\"\n      toastOptions={{\n        classNames: {\n          toast:\n            \"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg\",\n          description: \"group-[.toast]:text-muted-foreground\",\n          actionButton:\n            \"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground\",\n          cancelButton:\n            \"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground\",\n        },\n      }}\n      {...props}\n    />\n  )\n}\n\nexport { Toaster }\n","size_bytes":894},"client/src/components/game/Chat.tsx":{"content":"import { useState, useEffect, useRef } from 'react';\nimport { Button } from '../ui/button';\nimport { Input } from '../ui/input';\nimport { Card, CardContent, CardHeader, CardTitle } from '../ui/card';\nimport { MessageCircle, X, Send } from 'lucide-react';\n\ninterface ChatMessage {\n  id: string;\n  playerId: string;\n  playerName: string;\n  message: string;\n  timestamp: number;\n  isSystem?: boolean;\n}\n\ninterface ChatProps {\n  messages: ChatMessage[];\n  onSendMessage: (message: string) => void;\n  currentPlayerName: string;\n}\n\nexport default function Chat({ messages, onSendMessage, currentPlayerName }: ChatProps) {\n  const [isOpen, setIsOpen] = useState(false);\n  const [inputValue, setInputValue] = useState('');\n  const messagesEndRef = useRef<HTMLDivElement>(null);\n\n  const scrollToBottom = () => {\n    messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });\n  };\n\n  useEffect(() => {\n    if (isOpen) {\n      scrollToBottom();\n    }\n  }, [messages, isOpen]);\n\n  const handleSend = () => {\n    if (inputValue.trim()) {\n      onSendMessage(inputValue.trim());\n      setInputValue('');\n    }\n  };\n\n  if (!isOpen) {\n    return (\n      <Button\n        onClick={() => setIsOpen(true)}\n        className=\"fixed bottom-4 right-4 z-50 rounded-full h-14 w-14 p-0 shadow-lg\"\n        variant=\"default\"\n      >\n        <MessageCircle className=\"h-6 w-6\" />\n      </Button>\n    );\n  }\n\n  return (\n    <Card className=\"fixed bottom-4 right-4 z-50 w-80 md:w-96 shadow-2xl bg-white\">\n      <CardHeader className=\"pb-3 flex flex-row items-center justify-between space-y-0\">\n        <CardTitle className=\"text-lg\">Chat</CardTitle>\n        <Button\n          onClick={() => setIsOpen(false)}\n          variant=\"ghost\"\n          size=\"sm\"\n          className=\"h-8 w-8 p-0\"\n        >\n          <X className=\"h-4 w-4\" />\n        </Button>\n      </CardHeader>\n      <CardContent className=\"space-y-3\">\n        {/* Messages */}\n        <div className=\"h-64 overflow-y-auto space-y-2 bg-gray-50 rounded-lg p-3\">\n          {messages.length === 0 ? (\n            <p className=\"text-sm text-muted-foreground text-center py-8\">\n              No messages yet. Say hello!\n            </p>\n          ) : (\n            messages.map((msg) => (\n              <div\n                key={msg.id}\n                className={`text-sm ${\n                  msg.isSystem\n                    ? 'text-center text-muted-foreground italic'\n                    : msg.playerName === currentPlayerName\n                    ? 'text-right'\n                    : 'text-left'\n                }`}\n              >\n                {!msg.isSystem && (\n                  <p className=\"font-semibold text-xs mb-0.5\">\n                    {msg.playerName}\n                  </p>\n                )}\n                <p\n                  className={`inline-block rounded-lg px-3 py-1.5 ${\n                    msg.isSystem\n                      ? 'bg-gray-200 text-gray-600'\n                      : msg.playerName === currentPlayerName\n                      ? 'bg-blue-500 text-white'\n                      : 'bg-gray-300 text-gray-900'\n                  }`}\n                >\n                  {msg.message}\n                </p>\n              </div>\n            ))\n          )}\n          <div ref={messagesEndRef} />\n        </div>\n\n        {/* Input */}\n        <div className=\"flex gap-2\">\n          <Input\n            placeholder=\"Type a message...\"\n            value={inputValue}\n            onChange={(e) => setInputValue(e.target.value)}\n            onKeyDown={(e) => {\n              if (e.key === 'Enter' && !e.shiftKey) {\n                e.preventDefault();\n                handleSend();\n              }\n            }}\n            className=\"flex-1\"\n          />\n          <Button\n            onClick={handleSend}\n            disabled={!inputValue.trim()}\n            size=\"sm\"\n            className=\"px-3\"\n          >\n            <Send className=\"h-4 w-4\" />\n          </Button>\n        </div>\n      </CardContent>\n    </Card>\n  );\n}\n","size_bytes":3988},"client/src/components/ui/sidebar.tsx":{"content":"import * as React from \"react\";\nimport { Slot } from \"@radix-ui/react-slot\";\nimport { VariantProps, cva } from \"class-variance-authority\";\nimport { PanelLeft } from \"lucide-react\";\n\nimport { useIsMobile } from \"@/hooks/use-is-mobile\";\nimport { cn } from \"@/lib/utils\";\nimport { Button } from \"@/components/ui/button\";\nimport { Input } from \"@/components/ui/input\";\nimport { Separator } from \"@/components/ui/separator\";\nimport {\n  Sheet,\n  SheetContent,\n  SheetDescription,\n  SheetHeader,\n  SheetTitle,\n} from \"@/components/ui/sheet\";\nimport { Skeleton } from \"@/components/ui/skeleton\";\nimport {\n  Tooltip,\n  TooltipContent,\n  TooltipProvider,\n  TooltipTrigger,\n} from \"@/components/ui/tooltip\";\n\nconst SIDEBAR_COOKIE_NAME = \"sidebar_state\";\nconst SIDEBAR_COOKIE_MAX_AGE = 60 * 60 * 24 * 7;\nconst SIDEBAR_WIDTH = \"16rem\";\nconst SIDEBAR_WIDTH_MOBILE = \"18rem\";\nconst SIDEBAR_WIDTH_ICON = \"3rem\";\nconst SIDEBAR_KEYBOARD_SHORTCUT = \"b\";\n\ntype SidebarContext = {\n  state: \"expanded\" | \"collapsed\";\n  open: boolean;\n  setOpen: (open: boolean) => void;\n  openMobile: boolean;\n  setOpenMobile: (open: boolean) => void;\n  isMobile: boolean;\n  toggleSidebar: () => void;\n};\n\nconst SidebarContext = React.createContext<SidebarContext | null>(null);\n\nfunction useSidebar() {\n  const context = React.useContext(SidebarContext);\n  if (!context) {\n    throw new Error(\"useSidebar must be used within a SidebarProvider.\");\n  }\n\n  return context;\n}\n\nconst SidebarProvider = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    defaultOpen?: boolean;\n    open?: boolean;\n    onOpenChange?: (open: boolean) => void;\n  }\n>(\n  (\n    {\n      defaultOpen = true,\n      open: openProp,\n      onOpenChange: setOpenProp,\n      className,\n      style,\n      children,\n      ...props\n    },\n    ref,\n  ) => {\n    const isMobile = useIsMobile();\n    const [openMobile, setOpenMobile] = React.useState(false);\n\n    // This is the internal state of the sidebar.\n    // We use openProp and setOpenProp for control from outside the component.\n    const [_open, _setOpen] = React.useState(defaultOpen);\n    const open = openProp ?? _open;\n    const setOpen = React.useCallback(\n      (value: boolean | ((value: boolean) => boolean)) => {\n        const openState = typeof value === \"function\" ? value(open) : value;\n        if (setOpenProp) {\n          setOpenProp(openState);\n        } else {\n          _setOpen(openState);\n        }\n\n        // This sets the cookie to keep the sidebar state.\n        document.cookie = `${SIDEBAR_COOKIE_NAME}=${openState}; path=/; max-age=${SIDEBAR_COOKIE_MAX_AGE}`;\n      },\n      [setOpenProp, open],\n    );\n\n    // Helper to toggle the sidebar.\n    const toggleSidebar = React.useCallback(() => {\n      return isMobile\n        ? setOpenMobile((open) => !open)\n        : setOpen((open) => !open);\n    }, [isMobile, setOpen, setOpenMobile]);\n\n    // Adds a keyboard shortcut to toggle the sidebar.\n    React.useEffect(() => {\n      const handleKeyDown = (event: KeyboardEvent) => {\n        if (\n          event.key === SIDEBAR_KEYBOARD_SHORTCUT &&\n          (event.metaKey || event.ctrlKey)\n        ) {\n          event.preventDefault();\n          toggleSidebar();\n        }\n      };\n\n      window.addEventListener(\"keydown\", handleKeyDown);\n      return () => window.removeEventListener(\"keydown\", handleKeyDown);\n    }, [toggleSidebar]);\n\n    // We add a state so that we can do data-state=\"expanded\" or \"collapsed\".\n    // This makes it easier to style the sidebar with Tailwind classes.\n    const state = open ? \"expanded\" : \"collapsed\";\n\n    const contextValue = React.useMemo<SidebarContext>(\n      () => ({\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      }),\n      [\n        state,\n        open,\n        setOpen,\n        isMobile,\n        openMobile,\n        setOpenMobile,\n        toggleSidebar,\n      ],\n    );\n\n    return (\n      <SidebarContext.Provider value={contextValue}>\n        <TooltipProvider delayDuration={0}>\n          <div\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH,\n                \"--sidebar-width-icon\": SIDEBAR_WIDTH_ICON,\n                ...style,\n              } as React.CSSProperties\n            }\n            className={cn(\n              \"group/sidebar-wrapper flex min-h-svh w-full has-[[data-variant=inset]]:bg-sidebar\",\n              className,\n            )}\n            ref={ref}\n            {...props}\n          >\n            {children}\n          </div>\n        </TooltipProvider>\n      </SidebarContext.Provider>\n    );\n  },\n);\nSidebarProvider.displayName = \"SidebarProvider\";\n\nconst Sidebar = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    side?: \"left\" | \"right\";\n    variant?: \"sidebar\" | \"floating\" | \"inset\";\n    collapsible?: \"offcanvas\" | \"icon\" | \"none\";\n  }\n>(\n  (\n    {\n      side = \"left\",\n      variant = \"sidebar\",\n      collapsible = \"offcanvas\",\n      className,\n      children,\n      ...props\n    },\n    ref,\n  ) => {\n    const { isMobile, state, openMobile, setOpenMobile } = useSidebar();\n\n    if (collapsible === \"none\") {\n      return (\n        <div\n          className={cn(\n            \"flex h-full w-[--sidebar-width] flex-col bg-sidebar text-sidebar-foreground\",\n            className,\n          )}\n          ref={ref}\n          {...props}\n        >\n          {children}\n        </div>\n      );\n    }\n\n    if (isMobile) {\n      return (\n        <Sheet open={openMobile} onOpenChange={setOpenMobile} {...props}>\n          <SheetContent\n            data-sidebar=\"sidebar\"\n            data-mobile=\"true\"\n            className=\"w-[--sidebar-width] bg-sidebar p-0 text-sidebar-foreground [&>button]:hidden\"\n            style={\n              {\n                \"--sidebar-width\": SIDEBAR_WIDTH_MOBILE,\n              } as React.CSSProperties\n            }\n            side={side}\n          >\n            <SheetHeader className=\"sr-only\">\n              <SheetTitle>Sidebar</SheetTitle>\n              <SheetDescription>Displays the mobile sidebar.</SheetDescription>\n            </SheetHeader>\n            <div className=\"flex h-full w-full flex-col\">{children}</div>\n          </SheetContent>\n        </Sheet>\n      );\n    }\n\n    return (\n      <div\n        ref={ref}\n        className=\"group peer hidden text-sidebar-foreground md:block\"\n        data-state={state}\n        data-collapsible={state === \"collapsed\" ? collapsible : \"\"}\n        data-variant={variant}\n        data-side={side}\n      >\n        {/* This is what handles the sidebar gap on desktop */}\n        <div\n          className={cn(\n            \"relative w-[--sidebar-width] bg-transparent transition-[width] duration-200 ease-linear\",\n            \"group-data-[collapsible=offcanvas]:w-0\",\n            \"group-data-[side=right]:rotate-180\",\n            variant === \"floating\" || variant === \"inset\"\n              ? \"group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4))]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon]\",\n          )}\n        />\n        <div\n          className={cn(\n            \"fixed inset-y-0 z-10 hidden h-svh w-[--sidebar-width] transition-[left,right,width] duration-200 ease-linear md:flex\",\n            side === \"left\"\n              ? \"left-0 group-data-[collapsible=offcanvas]:left-[calc(var(--sidebar-width)*-1)]\"\n              : \"right-0 group-data-[collapsible=offcanvas]:right-[calc(var(--sidebar-width)*-1)]\",\n            // Adjust the padding for floating and inset variants.\n            variant === \"floating\" || variant === \"inset\"\n              ? \"p-2 group-data-[collapsible=icon]:w-[calc(var(--sidebar-width-icon)_+_theme(spacing.4)_+2px)]\"\n              : \"group-data-[collapsible=icon]:w-[--sidebar-width-icon] group-data-[side=left]:border-r group-data-[side=right]:border-l\",\n            className,\n          )}\n          {...props}\n        >\n          <div\n            data-sidebar=\"sidebar\"\n            className=\"flex h-full w-full flex-col bg-sidebar group-data-[variant=floating]:rounded-lg group-data-[variant=floating]:border group-data-[variant=floating]:border-sidebar-border group-data-[variant=floating]:shadow\"\n          >\n            {children}\n          </div>\n        </div>\n      </div>\n    );\n  },\n);\nSidebar.displayName = \"Sidebar\";\n\nconst SidebarTrigger = React.forwardRef<\n  React.ElementRef<typeof Button>,\n  React.ComponentProps<typeof Button>\n>(({ className, onClick, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar();\n\n  return (\n    <Button\n      ref={ref}\n      data-sidebar=\"trigger\"\n      variant=\"ghost\"\n      size=\"icon\"\n      className={cn(\"h-7 w-7\", className)}\n      onClick={(event) => {\n        onClick?.(event);\n        toggleSidebar();\n      }}\n      {...props}\n    >\n      <PanelLeft />\n      <span className=\"sr-only\">Toggle Sidebar</span>\n    </Button>\n  );\n});\nSidebarTrigger.displayName = \"SidebarTrigger\";\n\nconst SidebarRail = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\">\n>(({ className, ...props }, ref) => {\n  const { toggleSidebar } = useSidebar();\n\n  return (\n    <button\n      ref={ref}\n      data-sidebar=\"rail\"\n      aria-label=\"Toggle Sidebar\"\n      tabIndex={-1}\n      onClick={toggleSidebar}\n      title=\"Toggle Sidebar\"\n      className={cn(\n        \"absolute inset-y-0 z-20 hidden w-4 -translate-x-1/2 transition-all ease-linear after:absolute after:inset-y-0 after:left-1/2 after:w-[2px] hover:after:bg-sidebar-border group-data-[side=left]:-right-4 group-data-[side=right]:left-0 sm:flex\",\n        \"[[data-side=left]_&]:cursor-w-resize [[data-side=right]_&]:cursor-e-resize\",\n        \"[[data-side=left][data-state=collapsed]_&]:cursor-e-resize [[data-side=right][data-state=collapsed]_&]:cursor-w-resize\",\n        \"group-data-[collapsible=offcanvas]:translate-x-0 group-data-[collapsible=offcanvas]:after:left-full group-data-[collapsible=offcanvas]:hover:bg-sidebar\",\n        \"[[data-side=left][data-collapsible=offcanvas]_&]:-right-2\",\n        \"[[data-side=right][data-collapsible=offcanvas]_&]:-left-2\",\n        className,\n      )}\n      {...props}\n    />\n  );\n});\nSidebarRail.displayName = \"SidebarRail\";\n\nconst SidebarInset = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"main\">\n>(({ className, ...props }, ref) => {\n  return (\n    <main\n      ref={ref}\n      className={cn(\n        \"relative flex w-full flex-1 flex-col bg-background\",\n        \"md:peer-data-[variant=inset]:m-2 md:peer-data-[state=collapsed]:peer-data-[variant=inset]:ml-2 md:peer-data-[variant=inset]:ml-0 md:peer-data-[variant=inset]:rounded-xl md:peer-data-[variant=inset]:shadow\",\n        className,\n      )}\n      {...props}\n    />\n  );\n});\nSidebarInset.displayName = \"SidebarInset\";\n\nconst SidebarInput = React.forwardRef<\n  React.ElementRef<typeof Input>,\n  React.ComponentProps<typeof Input>\n>(({ className, ...props }, ref) => {\n  return (\n    <Input\n      ref={ref}\n      data-sidebar=\"input\"\n      className={cn(\n        \"h-8 w-full bg-background shadow-none focus-visible:ring-2 focus-visible:ring-sidebar-ring\",\n        className,\n      )}\n      {...props}\n    />\n  );\n});\nSidebarInput.displayName = \"SidebarInput\";\n\nconst SidebarHeader = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"header\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  );\n});\nSidebarHeader.displayName = \"SidebarHeader\";\n\nconst SidebarFooter = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"footer\"\n      className={cn(\"flex flex-col gap-2 p-2\", className)}\n      {...props}\n    />\n  );\n});\nSidebarFooter.displayName = \"SidebarFooter\";\n\nconst SidebarSeparator = React.forwardRef<\n  React.ElementRef<typeof Separator>,\n  React.ComponentProps<typeof Separator>\n>(({ className, ...props }, ref) => {\n  return (\n    <Separator\n      ref={ref}\n      data-sidebar=\"separator\"\n      className={cn(\"mx-2 w-auto bg-sidebar-border\", className)}\n      {...props}\n    />\n  );\n});\nSidebarSeparator.displayName = \"SidebarSeparator\";\n\nconst SidebarContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"content\"\n      className={cn(\n        \"flex min-h-0 flex-1 flex-col gap-2 overflow-auto group-data-[collapsible=icon]:overflow-hidden\",\n        className,\n      )}\n      {...props}\n    />\n  );\n});\nSidebarContent.displayName = \"SidebarContent\";\n\nconst SidebarGroup = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => {\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"group\"\n      className={cn(\"relative flex w-full min-w-0 flex-col p-2\", className)}\n      {...props}\n    />\n  );\n});\nSidebarGroup.displayName = \"SidebarGroup\";\n\nconst SidebarGroupLabel = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"div\";\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-label\"\n      className={cn(\n        \"flex h-8 shrink-0 items-center rounded-md px-2 text-xs font-medium text-sidebar-foreground/70 outline-none ring-sidebar-ring transition-[margin,opacity] duration-200 ease-linear focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        \"group-data-[collapsible=icon]:-mt-8 group-data-[collapsible=icon]:opacity-0\",\n        className,\n      )}\n      {...props}\n    />\n  );\n});\nSidebarGroupLabel.displayName = \"SidebarGroupLabel\";\n\nconst SidebarGroupAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & { asChild?: boolean }\n>(({ className, asChild = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\";\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"group-action\"\n      className={cn(\n        \"absolute right-3 top-3.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className,\n      )}\n      {...props}\n    />\n  );\n});\nSidebarGroupAction.displayName = \"SidebarGroupAction\";\n\nconst SidebarGroupContent = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"group-content\"\n    className={cn(\"w-full text-sm\", className)}\n    {...props}\n  />\n));\nSidebarGroupContent.displayName = \"SidebarGroupContent\";\n\nconst SidebarMenu = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu\"\n    className={cn(\"flex w-full min-w-0 flex-col gap-1\", className)}\n    {...props}\n  />\n));\nSidebarMenu.displayName = \"SidebarMenu\";\n\nconst SidebarMenuItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    data-sidebar=\"menu-item\"\n    className={cn(\"group/menu-item relative\", className)}\n    {...props}\n  />\n));\nSidebarMenuItem.displayName = \"SidebarMenuItem\";\n\nconst sidebarMenuButtonVariants = cva(\n  \"peer/menu-button flex w-full items-center gap-2 overflow-hidden rounded-md p-2 text-left text-sm outline-none ring-sidebar-ring transition-[width,height,padding] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 group-has-[[data-sidebar=menu-action]]/menu-item:pr-8 aria-disabled:pointer-events-none aria-disabled:opacity-50 data-[active=true]:bg-sidebar-accent data-[active=true]:font-medium data-[active=true]:text-sidebar-accent-foreground data-[state=open]:hover:bg-sidebar-accent data-[state=open]:hover:text-sidebar-accent-foreground group-data-[collapsible=icon]:!size-8 group-data-[collapsible=icon]:!p-2 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0\",\n  {\n    variants: {\n      variant: {\n        default: \"hover:bg-sidebar-accent hover:text-sidebar-accent-foreground\",\n        outline:\n          \"bg-background shadow-[0_0_0_1px_hsl(var(--sidebar-border))] hover:bg-sidebar-accent hover:text-sidebar-accent-foreground hover:shadow-[0_0_0_1px_hsl(var(--sidebar-accent))]\",\n      },\n      size: {\n        default: \"h-8 text-sm\",\n        sm: \"h-7 text-xs\",\n        lg: \"h-12 text-sm group-data-[collapsible=icon]:!p-0\",\n      },\n    },\n    defaultVariants: {\n      variant: \"default\",\n      size: \"default\",\n    },\n  },\n);\n\nconst SidebarMenuButton = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean;\n    isActive?: boolean;\n    tooltip?: string | React.ComponentProps<typeof TooltipContent>;\n  } & VariantProps<typeof sidebarMenuButtonVariants>\n>(\n  (\n    {\n      asChild = false,\n      isActive = false,\n      variant = \"default\",\n      size = \"default\",\n      tooltip,\n      className,\n      ...props\n    },\n    ref,\n  ) => {\n    const Comp = asChild ? Slot : \"button\";\n    const { isMobile, state } = useSidebar();\n\n    const button = (\n      <Comp\n        ref={ref}\n        data-sidebar=\"menu-button\"\n        data-size={size}\n        data-active={isActive}\n        className={cn(sidebarMenuButtonVariants({ variant, size }), className)}\n        {...props}\n      />\n    );\n\n    if (!tooltip) {\n      return button;\n    }\n\n    if (typeof tooltip === \"string\") {\n      tooltip = {\n        children: tooltip,\n      };\n    }\n\n    return (\n      <Tooltip>\n        <TooltipTrigger asChild>{button}</TooltipTrigger>\n        <TooltipContent\n          side=\"right\"\n          align=\"center\"\n          hidden={state !== \"collapsed\" || isMobile}\n          {...tooltip}\n        />\n      </Tooltip>\n    );\n  },\n);\nSidebarMenuButton.displayName = \"SidebarMenuButton\";\n\nconst SidebarMenuAction = React.forwardRef<\n  HTMLButtonElement,\n  React.ComponentProps<\"button\"> & {\n    asChild?: boolean;\n    showOnHover?: boolean;\n  }\n>(({ className, asChild = false, showOnHover = false, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"button\";\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-action\"\n      className={cn(\n        \"absolute right-1 top-1.5 flex aspect-square w-5 items-center justify-center rounded-md p-0 text-sidebar-foreground outline-none ring-sidebar-ring transition-transform hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 peer-hover/menu-button:text-sidebar-accent-foreground [&>svg]:size-4 [&>svg]:shrink-0\",\n        // Increases the hit area of the button on mobile.\n        \"after:absolute after:-inset-2 after:md:hidden\",\n        \"peer-data-[size=sm]/menu-button:top-1\",\n        \"peer-data-[size=default]/menu-button:top-1.5\",\n        \"peer-data-[size=lg]/menu-button:top-2.5\",\n        \"group-data-[collapsible=icon]:hidden\",\n        showOnHover &&\n          \"group-focus-within/menu-item:opacity-100 group-hover/menu-item:opacity-100 data-[state=open]:opacity-100 peer-data-[active=true]/menu-button:text-sidebar-accent-foreground md:opacity-0\",\n        className,\n      )}\n      {...props}\n    />\n  );\n});\nSidebarMenuAction.displayName = \"SidebarMenuAction\";\n\nconst SidebarMenuBadge = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\">\n>(({ className, ...props }, ref) => (\n  <div\n    ref={ref}\n    data-sidebar=\"menu-badge\"\n    className={cn(\n      \"pointer-events-none absolute right-1 flex h-5 min-w-5 select-none items-center justify-center rounded-md px-1 text-xs font-medium tabular-nums text-sidebar-foreground\",\n      \"peer-hover/menu-button:text-sidebar-accent-foreground peer-data-[active=true]/menu-button:text-sidebar-accent-foreground\",\n      \"peer-data-[size=sm]/menu-button:top-1\",\n      \"peer-data-[size=default]/menu-button:top-1.5\",\n      \"peer-data-[size=lg]/menu-button:top-2.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className,\n    )}\n    {...props}\n  />\n));\nSidebarMenuBadge.displayName = \"SidebarMenuBadge\";\n\nconst SidebarMenuSkeleton = React.forwardRef<\n  HTMLDivElement,\n  React.ComponentProps<\"div\"> & {\n    showIcon?: boolean;\n  }\n>(({ className, showIcon = false, ...props }, ref) => {\n  // Random width between 50 to 90%.\n  const width = React.useMemo(() => {\n    return `${Math.floor(Math.random() * 40) + 50}%`;\n  }, []);\n\n  return (\n    <div\n      ref={ref}\n      data-sidebar=\"menu-skeleton\"\n      className={cn(\"flex h-8 items-center gap-2 rounded-md px-2\", className)}\n      {...props}\n    >\n      {showIcon && (\n        <Skeleton\n          className=\"size-4 rounded-md\"\n          data-sidebar=\"menu-skeleton-icon\"\n        />\n      )}\n      <Skeleton\n        className=\"h-4 max-w-[--skeleton-width] flex-1\"\n        data-sidebar=\"menu-skeleton-text\"\n        style={\n          {\n            \"--skeleton-width\": width,\n          } as React.CSSProperties\n        }\n      />\n    </div>\n  );\n});\nSidebarMenuSkeleton.displayName = \"SidebarMenuSkeleton\";\n\nconst SidebarMenuSub = React.forwardRef<\n  HTMLUListElement,\n  React.ComponentProps<\"ul\">\n>(({ className, ...props }, ref) => (\n  <ul\n    ref={ref}\n    data-sidebar=\"menu-sub\"\n    className={cn(\n      \"mx-3.5 flex min-w-0 translate-x-px flex-col gap-1 border-l border-sidebar-border px-2.5 py-0.5\",\n      \"group-data-[collapsible=icon]:hidden\",\n      className,\n    )}\n    {...props}\n  />\n));\nSidebarMenuSub.displayName = \"SidebarMenuSub\";\n\nconst SidebarMenuSubItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentProps<\"li\">\n>(({ ...props }, ref) => <li ref={ref} {...props} />);\nSidebarMenuSubItem.displayName = \"SidebarMenuSubItem\";\n\nconst SidebarMenuSubButton = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentProps<\"a\"> & {\n    asChild?: boolean;\n    size?: \"sm\" | \"md\";\n    isActive?: boolean;\n  }\n>(({ asChild = false, size = \"md\", isActive, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\";\n\n  return (\n    <Comp\n      ref={ref}\n      data-sidebar=\"menu-sub-button\"\n      data-size={size}\n      data-active={isActive}\n      className={cn(\n        \"flex h-7 min-w-0 -translate-x-px items-center gap-2 overflow-hidden rounded-md px-2 text-sidebar-foreground outline-none ring-sidebar-ring hover:bg-sidebar-accent hover:text-sidebar-accent-foreground focus-visible:ring-2 active:bg-sidebar-accent active:text-sidebar-accent-foreground disabled:pointer-events-none disabled:opacity-50 aria-disabled:pointer-events-none aria-disabled:opacity-50 [&>span:last-child]:truncate [&>svg]:size-4 [&>svg]:shrink-0 [&>svg]:text-sidebar-accent-foreground\",\n        \"data-[active=true]:bg-sidebar-accent data-[active=true]:text-sidebar-accent-foreground\",\n        size === \"sm\" && \"text-xs\",\n        size === \"md\" && \"text-sm\",\n        \"group-data-[collapsible=icon]:hidden\",\n        className,\n      )}\n      {...props}\n    />\n  );\n});\nSidebarMenuSubButton.displayName = \"SidebarMenuSubButton\";\n\nexport {\n  Sidebar,\n  SidebarContent,\n  SidebarFooter,\n  SidebarGroup,\n  SidebarGroupAction,\n  SidebarGroupContent,\n  SidebarGroupLabel,\n  SidebarHeader,\n  SidebarInput,\n  SidebarInset,\n  SidebarMenu,\n  SidebarMenuAction,\n  SidebarMenuBadge,\n  SidebarMenuButton,\n  SidebarMenuItem,\n  SidebarMenuSkeleton,\n  SidebarMenuSub,\n  SidebarMenuSubButton,\n  SidebarMenuSubItem,\n  SidebarProvider,\n  SidebarRail,\n  SidebarSeparator,\n  SidebarTrigger,\n  useSidebar,\n};\n","size_bytes":23790},"client/src/components/ui/breadcrumb.tsx":{"content":"import * as React from \"react\"\nimport { Slot } from \"@radix-ui/react-slot\"\nimport { ChevronRight, MoreHorizontal } from \"lucide-react\"\n\nimport { cn } from \"@/lib/utils\"\n\nconst Breadcrumb = React.forwardRef<\n  HTMLElement,\n  React.ComponentPropsWithoutRef<\"nav\"> & {\n    separator?: React.ReactNode\n  }\n>(({ ...props }, ref) => <nav ref={ref} aria-label=\"breadcrumb\" {...props} />)\nBreadcrumb.displayName = \"Breadcrumb\"\n\nconst BreadcrumbList = React.forwardRef<\n  HTMLOListElement,\n  React.ComponentPropsWithoutRef<\"ol\">\n>(({ className, ...props }, ref) => (\n  <ol\n    ref={ref}\n    className={cn(\n      \"flex flex-wrap items-center gap-1.5 break-words text-sm text-muted-foreground sm:gap-2.5\",\n      className\n    )}\n    {...props}\n  />\n))\nBreadcrumbList.displayName = \"BreadcrumbList\"\n\nconst BreadcrumbItem = React.forwardRef<\n  HTMLLIElement,\n  React.ComponentPropsWithoutRef<\"li\">\n>(({ className, ...props }, ref) => (\n  <li\n    ref={ref}\n    className={cn(\"inline-flex items-center gap-1.5\", className)}\n    {...props}\n  />\n))\nBreadcrumbItem.displayName = \"BreadcrumbItem\"\n\nconst BreadcrumbLink = React.forwardRef<\n  HTMLAnchorElement,\n  React.ComponentPropsWithoutRef<\"a\"> & {\n    asChild?: boolean\n  }\n>(({ asChild, className, ...props }, ref) => {\n  const Comp = asChild ? Slot : \"a\"\n\n  return (\n    <Comp\n      ref={ref}\n      className={cn(\"transition-colors hover:text-foreground\", className)}\n      {...props}\n    />\n  )\n})\nBreadcrumbLink.displayName = \"BreadcrumbLink\"\n\nconst BreadcrumbPage = React.forwardRef<\n  HTMLSpanElement,\n  React.ComponentPropsWithoutRef<\"span\">\n>(({ className, ...props }, ref) => (\n  <span\n    ref={ref}\n    role=\"link\"\n    aria-disabled=\"true\"\n    aria-current=\"page\"\n    className={cn(\"font-normal text-foreground\", className)}\n    {...props}\n  />\n))\nBreadcrumbPage.displayName = \"BreadcrumbPage\"\n\nconst BreadcrumbSeparator = ({\n  children,\n  className,\n  ...props\n}: React.ComponentProps<\"li\">) => (\n  <li\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"[&>svg]:w-3.5 [&>svg]:h-3.5\", className)}\n    {...props}\n  >\n    {children ?? <ChevronRight />}\n  </li>\n)\nBreadcrumbSeparator.displayName = \"BreadcrumbSeparator\"\n\nconst BreadcrumbEllipsis = ({\n  className,\n  ...props\n}: React.ComponentProps<\"span\">) => (\n  <span\n    role=\"presentation\"\n    aria-hidden=\"true\"\n    className={cn(\"flex h-9 w-9 items-center justify-center\", className)}\n    {...props}\n  >\n    <MoreHorizontal className=\"h-4 w-4\" />\n    <span className=\"sr-only\">More</span>\n  </span>\n)\nBreadcrumbEllipsis.displayName = \"BreadcrumbElipssis\"\n\nexport {\n  Breadcrumb,\n  BreadcrumbList,\n  BreadcrumbItem,\n  BreadcrumbLink,\n  BreadcrumbPage,\n  BreadcrumbSeparator,\n  BreadcrumbEllipsis,\n}\n","size_bytes":2712},"capacitor.config.ts":{"content":"import type { CapacitorConfig } from '@capacitor/cli';\n\nconst config: CapacitorConfig = {\n  appId: 'com.shnarps.cardgame',\n  appName: 'Shnarps Card Game',\n  webDir: 'dist/public',\n  server: {\n    androidScheme: 'https'\n  }\n};\n\nexport default config;\n","size_bytes":250},"IOS_QUICK_START.md":{"content":"# iOS Quick Start Guide\n\n## âœ… Your App is Ready for iOS!\n\nShnarps Card Game has been configured as an iOS app. Here's what you need to know:\n\n## ðŸŽ¯ What You Need\n\n1. **Mac Computer** (required - iOS apps can only be built on Mac)\n2. **Apple Developer Account** ($99/year) - [Sign up here](https://developer.apple.com)\n3. **Xcode** (free from Mac App Store)\n\n## ðŸš€ Quick Deploy Steps\n\n### On This Computer (Replit):\n```bash\n# Build the web app\nvite build\n\n# Sync to iOS platform\nnpx cap sync ios\n```\n\n### On Your Mac:\n```bash\n# Install CocoaPods (one time)\nsudo gem install cocoapods\n\n# Open the iOS project in Xcode\nnpx cap open ios\n```\n\n### In Xcode:\n1. Select your Apple Developer Team in \"Signing & Capabilities\"\n2. Add app icons (Assets.xcassets > AppIcon)\n3. Test on a simulator or device\n4. Archive (Product > Archive)\n5. Upload to App Store Connect\n\n## ðŸ“ Project Structure\n\n- `ios/` - Your iOS native project (open in Xcode)\n- `dist/public/` - Built web app (synced to iOS)\n- `capacitor.config.ts` - Capacitor configuration\n\n## ðŸ”„ Making Updates\n\n1. Make your changes in Replit\n2. Build: `vite build`\n3. Sync: `npx cap sync ios`\n4. Test in Xcode\n5. Upload new version to App Store\n\n## ðŸ“± App Details\n\n- **App ID**: com.shnarps.cardgame\n- **App Name**: Shnarps Card Game\n- **Platform**: iOS (iPhone & iPad ready)\n\n## âš ï¸ Important Notes\n\n### Multiplayer\n- For production, deploy your backend server (not just Replit dev)\n- Update WebSocket URLs to production server\n- Use secure connections (HTTPS/WSS)\n\n### In-Game Money\n- Your game has a virtual wallet system\n- This is fine as-is (virtual currency for scoring)\n- If you want REAL money, you MUST use Apple In-App Purchases\n\n### Testing\n- Test all features on actual iOS devices\n- Verify both local and online multiplayer work\n- Check that cards, animations, and UI look good on different screen sizes\n\n## ðŸ“š Full Documentation\n\nSee `IOS_DEPLOYMENT_GUIDE.md` for complete details on:\n- App Store submission process\n- Screenshots and metadata requirements\n- Privacy policy requirements\n- Troubleshooting common issues\n\n## ðŸ†˜ Need Help?\n\n- **Capacitor Docs**: https://capacitorjs.com/docs\n- **Apple Developer Portal**: https://developer.apple.com\n- **App Store Connect**: https://appstoreconnect.apple.com\n\n---\n\n**Ready to deploy?** Transfer this project to your Mac and follow the steps above!\n","size_bytes":2371},"IOS_DEPLOYMENT_GUIDE.md":{"content":"# iOS App Store Deployment Guide for Shnarps Card Game\n\n## âœ… Setup Complete!\n\nYour Shnarps card game is now configured as an iOS app using Capacitor! Here's everything you need to know to deploy it to the Apple App Store.\n\n## ðŸ“± What's Been Set Up\n\n- **App ID**: `com.shnarps.cardgame`\n- **App Name**: Shnarps Card Game\n- **iOS Platform**: Added and configured in the `ios/` folder\n- **Build Configuration**: Web app builds to `dist/public` and syncs to iOS\n\n## ðŸš€ Building and Deploying to App Store\n\n### Prerequisites\n\n1. **Mac Computer** (required for iOS development)\n2. **Apple Developer Account** ($99/year)\n   - Sign up at: https://developer.apple.com\n3. **Xcode** (latest version)\n   - Download from Mac App Store\n4. **CocoaPods** (for iOS dependencies)\n   ```bash\n   sudo gem install cocoapods\n   ```\n\n### Step-by-Step Deployment Process\n\n#### 1. Build Your Web App\n\nOn Replit or locally, run:\n```bash\nnpm run build\n# Or just build the client:\nvite build\n```\n\nThis creates the production-ready web app in `dist/public/`.\n\n#### 2. Sync to iOS Platform\n\n```bash\nnpx cap sync ios\n```\n\nThis copies your web app to the iOS project and updates native dependencies.\n\n#### 3. Open in Xcode (Mac Only)\n\n```bash\nnpx cap open ios\n```\n\nThis opens your iOS project in Xcode.\n\n#### 4. Configure App in Xcode\n\n**a. Set Your Team:**\n- Select the project in Xcode's left sidebar\n- Go to \"Signing & Capabilities\" tab\n- Select your Apple Developer Team\n\n**b. Update Bundle Identifier (if needed):**\n- Change `com.shnarps.cardgame` to your preferred identifier\n- Must be unique in the App Store\n\n**c. Set App Version:**\n- Update Version (e.g., 1.0.0)\n- Update Build number (e.g., 1)\n\n**d. Add App Icons:**\n- Create app icons in these sizes:\n  - 1024Ã—1024 (App Store)\n  - 180Ã—180, 167Ã—167, 152Ã—152, 120Ã—120, 87Ã—87, 80Ã—80, 76Ã—76, 60Ã—60, 58Ã—58, 40Ã—40, 29Ã—29, 20Ã—20\n- Add them in Assets.xcassets > AppIcon\n\n**e. Add Launch Screen:**\n- Customize the splash screen in Assets.xcassets\n\n#### 5. Test on Device/Simulator\n\n- Select a device or simulator in Xcode\n- Click the Play button (â–¶ï¸) to build and run\n- Test all game features\n\n#### 6. Archive and Upload to App Store\n\n**a. Archive Your App:**\n- In Xcode menu: Product > Archive\n- Wait for archive to complete\n\n**b. Upload to App Store Connect:**\n- Click \"Distribute App\"\n- Choose \"App Store Connect\"\n- Follow the prompts to upload\n\n#### 7. App Store Connect Setup\n\n1. Go to https://appstoreconnect.apple.com\n2. Create a new app\n3. Fill in app information:\n   - Name: Shnarps Card Game\n   - Category: Games > Card\n   - Description, keywords, screenshots\n4. Set pricing (free or paid)\n5. Submit for review\n\n## ðŸ“ Important Configurations\n\n### App Capabilities\n\nYou may want to add these in Xcode:\n- **Game Center** (for leaderboards/achievements)\n- **In-App Purchases** (if monetizing)\n- **Push Notifications** (for multiplayer invites)\n\n### Privacy & Data\n\nCreate a privacy policy and declare:\n- What data you collect\n- How you use it\n- Third-party services used\n\n### App Store Screenshots\n\nRequired sizes (use iPhone simulator):\n- 6.7\" Display (iPhone 14 Pro Max): 1290Ã—2796\n- 6.5\" Display (iPhone 11 Pro Max): 1242Ã—2688\n- 5.5\" Display (iPhone 8 Plus): 1242Ã—2208\n\nTake screenshots showing:\n- Main menu\n- Game in progress\n- Multiplayer lobby\n- Score/victory screen\n\n## ðŸ”„ Updating Your App\n\nWhen you make changes:\n\n1. **Update Your Code** (on Replit or locally)\n2. **Build Web App**: `vite build`\n3. **Sync to iOS**: `npx cap sync ios`\n4. **Increment Version** in Xcode\n5. **Test Thoroughly**\n6. **Archive & Upload** new version\n\n## ðŸ› ï¸ Useful Commands\n\n```bash\n# Build web app only\nvite build\n\n# Sync web app to iOS (after building)\nnpx cap sync ios\n\n# Open in Xcode (Mac only)\nnpx cap open ios\n\n# Update iOS dependencies\ncd ios/App && pod install && cd ../..\n\n# Clean and rebuild\nnpx cap sync ios --deployment\n```\n\n## ðŸ“± Live Updates vs App Store\n\n**Current Setup:**\n- Changes require App Store review (1-3 days)\n\n**Alternative - Live Updates:**\n- Use Capacitor Live Updates (paid service)\n- Push updates instantly without App Store review\n- https://capacitorjs.com/docs/guides/live-updates\n\n## ðŸ› Common Issues\n\n### \"CocoaPods not installed\"\n```bash\nsudo gem install cocoapods\ncd ios/App && pod install\n```\n\n### \"Developer Team not set\"\n- Open Xcode\n- Go to Signing & Capabilities\n- Select your team from dropdown\n\n### \"Bundle identifier already exists\"\n- Change `com.shnarps.cardgame` to unique ID\n- Update in both `capacitor.config.ts` and Xcode\n\n### \"App icons missing\"\n- Add all required icon sizes in Xcode\n- Use a tool like: https://www.appicon.co\n\n## ðŸŽ® Multiplayer Considerations\n\nYour game has multiplayer with WebSockets. For production:\n\n1. **Deploy Backend** to a permanent server (not Replit dev)\n2. **Update WebSocket URL** in your app to production URL\n3. **Use HTTPS/WSS** for secure connections\n4. **Consider Using:**\n   - Replit Deployments (for hosting backend)\n   - Firebase/Supabase (for real-time data)\n   - Custom server (AWS, DigitalOcean, etc.)\n\n## ðŸ’° Money/Wallet System\n\nYour app has in-game currency. Important:\n- If using REAL money, you MUST use In-App Purchases\n- Virtual currency is OK as long as it's not purchasable\n- Add disclaimer that money is virtual/for game purposes only\n\n## ðŸ“‹ App Store Review Checklist\n\n- [ ] App functions properly on iOS\n- [ ] All features work offline (or handle network errors gracefully)\n- [ ] Follows Apple's Human Interface Guidelines\n- [ ] No crashes or major bugs\n- [ ] Privacy policy created and linked\n- [ ] Screenshots and descriptions ready\n- [ ] App icons and launch screen set\n- [ ] Appropriate age rating selected\n- [ ] Contact information provided\n\n## ðŸ”— Helpful Resources\n\n- **Capacitor Docs**: https://capacitorjs.com/docs\n- **Apple Developer**: https://developer.apple.com\n- **App Store Guidelines**: https://developer.apple.com/app-store/review/guidelines/\n- **Xcode Help**: https://developer.apple.com/xcode/\n\n## ðŸŽ‰ Next Steps\n\n1. **Transfer project to Mac** (or use Mac for development)\n2. **Install Xcode and CocoaPods**\n3. **Open project**: `npx cap open ios`\n4. **Configure signing** with your Apple Developer account\n5. **Test on real device**\n6. **Archive and submit** to App Store!\n\n---\n\n**Questions?** The iOS project is in the `ios/` folder. All your game logic and UI from the web version will work in the iOS app!\n","size_bytes":6394},"ios/App/App/AppDelegate.swift":{"content":"import UIKit\nimport Capacitor\n\n@UIApplicationMain\nclass AppDelegate: UIResponder, UIApplicationDelegate {\n\n    var window: UIWindow?\n\n    func application(_ application: UIApplication, didFinishLaunchingWithOptions launchOptions: [UIApplication.LaunchOptionsKey: Any]?) -> Bool {\n        // Override point for customization after application launch.\n        return true\n    }\n\n    func applicationWillResignActive(_ application: UIApplication) {\n        // Sent when the application is about to move from active to inactive state. This can occur for certain types of temporary interruptions (such as an incoming phone call or SMS message) or when the user quits the application and it begins the transition to the background state.\n        // Use this method to pause ongoing tasks, disable timers, and invalidate graphics rendering callbacks. Games should use this method to pause the game.\n    }\n\n    func applicationDidEnterBackground(_ application: UIApplication) {\n        // Use this method to release shared resources, save user data, invalidate timers, and store enough application state information to restore your application to its current state in case it is terminated later.\n        // If your application supports background execution, this method is called instead of applicationWillTerminate: when the user quits.\n    }\n\n    func applicationWillEnterForeground(_ application: UIApplication) {\n        // Called as part of the transition from the background to the active state; here you can undo many of the changes made on entering the background.\n    }\n\n    func applicationDidBecomeActive(_ application: UIApplication) {\n        // Restart any tasks that were paused (or not yet started) while the application was inactive. If the application was previously in the background, optionally refresh the user interface.\n    }\n\n    func applicationWillTerminate(_ application: UIApplication) {\n        // Called when the application is about to terminate. Save data if appropriate. See also applicationDidEnterBackground:.\n    }\n\n    func application(_ app: UIApplication, open url: URL, options: [UIApplication.OpenURLOptionsKey: Any] = [:]) -> Bool {\n        // Called when the app was launched with a url. Feel free to add additional processing here,\n        // but if you want the App API to support tracking app url opens, make sure to keep this call\n        return ApplicationDelegateProxy.shared.application(app, open: url, options: options)\n    }\n\n    func application(_ application: UIApplication, continue userActivity: NSUserActivity, restorationHandler: @escaping ([UIUserActivityRestoring]?) -> Void) -> Bool {\n        // Called when the app was launched with an activity, including Universal Links.\n        // Feel free to add additional processing here, but if you want the App API to support\n        // tracking app url opens, make sure to keep this call\n        return ApplicationDelegateProxy.shared.application(application, continue: userActivity, restorationHandler: restorationHandler)\n    }\n\n}\n","size_bytes":3031},"client/src/lib/stores/useGameBoardStore.ts":{"content":"import { create } from 'zustand';\nimport { Card } from '../game/cardUtils';\n\ninterface GameBoardState {\n  selectedCard: Card | null;\n  setSelectedCard: (card: Card | null) => void;\n}\n\nexport const useGameBoardStore = create<GameBoardState>((set) => ({\n  selectedCard: null,\n  setSelectedCard: (card) => set({ selectedCard: card }),\n}));\n","size_bytes":337},"client/src/components/Settings.tsx":{"content":"import { useState } from 'react';\nimport { useSettings } from '@/lib/stores/useSettings';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogFooter } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { Label } from '@/components/ui/label';\nimport { Input } from '@/components/ui/input';\nimport { Switch } from '@/components/ui/switch';\nimport { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select';\nimport { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs';\nimport { DollarSign, Trophy, Volume2, Bot, Users } from 'lucide-react';\n\ninterface SettingsProps {\n  open: boolean;\n  onClose: () => void;\n}\n\nexport function Settings({ open, onClose }: SettingsProps) {\n  const settings = useSettings();\n  \n  const [moneyPerPoint, setMoneyPerPoint] = useState(settings.moneyPerPoint);\n  const [moneyPerPunt, setMoneyPerPunt] = useState(settings.moneyPerPunt);\n  const [startingScore, setStartingScore] = useState(settings.startingScore);\n  const [winningScore, setWinningScore] = useState(settings.winningScore);\n  const [eliminationScore, setEliminationScore] = useState(settings.eliminationScore);\n  const [soundEnabled, setSoundEnabled] = useState(settings.soundEnabled);\n  const [musicEnabled, setMusicEnabled] = useState(settings.musicEnabled);\n  const [defaultAIDifficulty, setDefaultAIDifficulty] = useState(settings.defaultAIDifficulty);\n  const [turnTimeLimit, setTurnTimeLimit] = useState(settings.turnTimeLimit);\n  const [autoPlayDisconnected, setAutoPlayDisconnected] = useState(settings.autoPlayDisconnected);\n\n  const handleSave = () => {\n    settings.updateSettings({\n      moneyPerPoint,\n      moneyPerPunt,\n      startingScore,\n      winningScore,\n      eliminationScore,\n      soundEnabled,\n      musicEnabled,\n      defaultAIDifficulty,\n      turnTimeLimit,\n      autoPlayDisconnected\n    });\n    onClose();\n  };\n\n  const handleReset = () => {\n    settings.resetToDefaults();\n    setMoneyPerPoint(0.25);\n    setMoneyPerPunt(1.00);\n    setStartingScore(16);\n    setWinningScore(0);\n    setEliminationScore(32);\n    setSoundEnabled(true);\n    setMusicEnabled(true);\n    setDefaultAIDifficulty('hard');\n    setTurnTimeLimit(30);\n    setAutoPlayDisconnected(true);\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] overflow-y-auto bg-gray-100\">\n        <DialogHeader>\n          <DialogTitle className=\"text-2xl text-gray-900\">Game Settings</DialogTitle>\n        </DialogHeader>\n\n        <Tabs defaultValue=\"stakes\" className=\"w-full\">\n          <TabsList className=\"grid w-full grid-cols-5\">\n            <TabsTrigger value=\"stakes\">\n              <DollarSign className=\"w-4 h-4 mr-2\" />\n              Stakes\n            </TabsTrigger>\n            <TabsTrigger value=\"rules\">\n              <Trophy className=\"w-4 h-4 mr-2\" />\n              Rules\n            </TabsTrigger>\n            <TabsTrigger value=\"multiplayer\">\n              <Users className=\"w-4 h-4 mr-2\" />\n              Online\n            </TabsTrigger>\n            <TabsTrigger value=\"audio\">\n              <Volume2 className=\"w-4 h-4 mr-2\" />\n              Audio\n            </TabsTrigger>\n            <TabsTrigger value=\"ai\">\n              <Bot className=\"w-4 h-4 mr-2\" />\n              AI\n            </TabsTrigger>\n          </TabsList>\n\n          <TabsContent value=\"stakes\" className=\"space-y-6 mt-6\">\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"moneyPerPoint\" className=\"text-base text-gray-900\">Coins Per Point</Label>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-lg\">ðŸª™</span>\n                  <Input\n                    id=\"moneyPerPoint\"\n                    type=\"number\"\n                    step=\"0.05\"\n                    min=\"0\"\n                    value={moneyPerPoint}\n                    onChange={(e) => setMoneyPerPoint(parseFloat(e.target.value) || 0)}\n                    className=\"max-w-[150px]\"\n                  />\n                </div>\n                <p className=\"text-sm text-muted-foreground\">\n                  Coins losers pay per point difference to the winner\n                </p>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"moneyPerPunt\" className=\"text-base text-gray-900\">Coins Per Punt</Label>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-lg\">ðŸª™</span>\n                  <Input\n                    id=\"moneyPerPunt\"\n                    type=\"number\"\n                    step=\"0.25\"\n                    min=\"0\"\n                    value={moneyPerPunt}\n                    onChange={(e) => setMoneyPerPunt(parseFloat(e.target.value) || 0)}\n                    className=\"max-w-[150px]\"\n                  />\n                </div>\n                <p className=\"text-sm text-muted-foreground\">\n                  Coins losers pay per successful punt to the winner\n                </p>\n              </div>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"rules\" className=\"space-y-6 mt-6\">\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"startingScore\" className=\"text-base text-gray-900\">Starting Score</Label>\n                <Input\n                  id=\"startingScore\"\n                  type=\"number\"\n                  min=\"1\"\n                  max=\"50\"\n                  value={startingScore}\n                  onChange={(e) => setStartingScore(parseInt(e.target.value) || 16)}\n                  className=\"max-w-[150px]\"\n                />\n                <p className=\"text-sm text-muted-foreground\">\n                  Points each player starts with\n                </p>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"winningScore\" className=\"text-base text-gray-900\">Winning Score</Label>\n                <Input\n                  id=\"winningScore\"\n                  type=\"number\"\n                  min=\"0\"\n                  max=\"50\"\n                  value={winningScore}\n                  onChange={(e) => setWinningScore(parseInt(e.target.value) || 0)}\n                  className=\"max-w-[150px]\"\n                />\n                <p className=\"text-sm text-muted-foreground\">\n                  First player to reach this score wins\n                </p>\n              </div>\n\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"eliminationScore\" className=\"text-base text-gray-900\">Elimination Score</Label>\n                <Input\n                  id=\"eliminationScore\"\n                  type=\"number\"\n                  min=\"1\"\n                  max=\"100\"\n                  value={eliminationScore}\n                  onChange={(e) => setEliminationScore(parseInt(e.target.value) || 32)}\n                  className=\"max-w-[150px]\"\n                />\n                <p className=\"text-sm text-muted-foreground\">\n                  Players are eliminated when reaching this score\n                </p>\n              </div>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"multiplayer\" className=\"space-y-6 mt-6\">\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"turnTimeLimit\" className=\"text-base text-gray-900\">Turn Time Limit</Label>\n                <Input\n                  id=\"turnTimeLimit\"\n                  type=\"number\"\n                  min=\"0\"\n                  max=\"120\"\n                  value={turnTimeLimit}\n                  onChange={(e) => setTurnTimeLimit(parseInt(e.target.value) || 0)}\n                  className=\"max-w-[150px]\"\n                />\n                <p className=\"text-sm text-muted-foreground\">\n                  Seconds per turn (0 = no limit). Default is 30 seconds.\n                </p>\n              </div>\n\n              <div className=\"flex items-center justify-between\">\n                <div className=\"space-y-0.5\">\n                  <Label htmlFor=\"autoPlayDisconnected\" className=\"text-base text-gray-900\">Auto-Play for Disconnected</Label>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Automatically play safe moves for disconnected or timed-out players\n                  </p>\n                </div>\n                <Switch\n                  id=\"autoPlayDisconnected\"\n                  checked={autoPlayDisconnected}\n                  onCheckedChange={setAutoPlayDisconnected}\n                />\n              </div>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"audio\" className=\"space-y-6 mt-6\">\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"space-y-0.5\">\n                  <Label htmlFor=\"soundEnabled\" className=\"text-base text-gray-900\">Sound Effects</Label>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Play sound effects for game actions\n                  </p>\n                </div>\n                <Switch\n                  id=\"soundEnabled\"\n                  checked={soundEnabled}\n                  onCheckedChange={setSoundEnabled}\n                />\n              </div>\n\n              <div className=\"flex items-center justify-between\">\n                <div className=\"space-y-0.5\">\n                  <Label htmlFor=\"musicEnabled\" className=\"text-base text-gray-900\">Background Music</Label>\n                  <p className=\"text-sm text-muted-foreground\">\n                    Play background music during gameplay\n                  </p>\n                </div>\n                <Switch\n                  id=\"musicEnabled\"\n                  checked={musicEnabled}\n                  onCheckedChange={setMusicEnabled}\n                />\n              </div>\n            </div>\n          </TabsContent>\n\n          <TabsContent value=\"ai\" className=\"space-y-6 mt-6\">\n            <div className=\"space-y-4\">\n              <div className=\"space-y-2\">\n                <Label htmlFor=\"aiDifficulty\" className=\"text-base text-gray-900\">Default AI Difficulty</Label>\n                <Select value={defaultAIDifficulty} onValueChange={(value: any) => setDefaultAIDifficulty(value)}>\n                  <SelectTrigger className=\"max-w-[200px]\">\n                    <SelectValue />\n                  </SelectTrigger>\n                  <SelectContent>\n                    <SelectItem value=\"easy\">Easy</SelectItem>\n                    <SelectItem value=\"medium\">Medium</SelectItem>\n                    <SelectItem value=\"hard\">Hard</SelectItem>\n                  </SelectContent>\n                </Select>\n                <p className=\"text-sm text-muted-foreground\">\n                  Default difficulty when adding AI players\n                </p>\n              </div>\n            </div>\n          </TabsContent>\n        </Tabs>\n\n        <DialogFooter className=\"gap-2\">\n          <Button variant=\"outline\" onClick={handleReset}>\n            Reset to Defaults\n          </Button>\n          <Button onClick={handleSave}>\n            Save Settings\n          </Button>\n        </DialogFooter>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":11358},"client/src/lib/stores/useWallet.tsx":{"content":"import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\n\nexport interface Transaction {\n  id: string;\n  date: number;\n  type: 'win' | 'loss' | 'reset';\n  amount: number;\n  balance: number;\n  description: string;\n}\n\ninterface WalletState {\n  balance: number;\n  transactions: Transaction[];\n  \n  // Actions\n  addTransaction: (type: 'win' | 'loss' | 'reset', amount: number, description: string) => void;\n  resetWallet: () => void;\n  setBalance: (balance: number) => void;\n}\n\nconst DEFAULT_WALLET_BALANCE = 100;\n\nexport const useWallet = create<WalletState>()(\n  persist(\n    (set, get) => ({\n      balance: DEFAULT_WALLET_BALANCE,\n      transactions: [],\n      \n      addTransaction: (type: 'win' | 'loss' | 'reset', amount: number, description: string) => {\n        const state = get();\n        const newBalance = type === 'reset' \n          ? amount \n          : type === 'win' \n            ? state.balance + amount \n            : state.balance - amount;\n        \n        const transaction: Transaction = {\n          id: `tx_${Date.now()}_${Math.random()}`,\n          date: Date.now(),\n          type,\n          amount,\n          balance: newBalance,\n          description\n        };\n        \n        set({\n          balance: newBalance,\n          transactions: [transaction, ...state.transactions]\n        });\n      },\n      \n      resetWallet: () => {\n        set({\n          balance: DEFAULT_WALLET_BALANCE,\n          transactions: []\n        });\n      },\n      \n      setBalance: (balance: number) => {\n        set({ balance });\n      }\n    }),\n    {\n      name: 'shnarps-wallet'\n    }\n  )\n);\n","size_bytes":1621},"client/src/components/game/TurnTimer.tsx":{"content":"import { useShnarps } from '@/lib/stores/useShnarps';\nimport { Card, CardContent } from '../ui/card';\n\nexport function TurnTimer() {\n  const { turnTimeRemaining, multiplayerMode } = useShnarps();\n\n  // Only show in multiplayer\n  if (multiplayerMode !== 'online' || turnTimeRemaining === null) {\n    return null;\n  }\n\n  const percentage = Math.max(0, (turnTimeRemaining / 30) * 100);\n  const isLowTime = turnTimeRemaining <= 10;\n  const isVeryLowTime = turnTimeRemaining <= 5;\n\n  return (\n    <div className=\"fixed top-20 right-4 z-40\">\n      <Card className={`\n        bg-gray-900 bg-opacity-95 border-2 transition-colors duration-300\n        ${isVeryLowTime ? 'border-red-500 animate-pulse' : isLowTime ? 'border-yellow-500' : 'border-blue-500'}\n      `}>\n        <CardContent className=\"p-4\">\n          <div className=\"flex items-center gap-3\">\n            <div className=\"text-2xl\">â±ï¸</div>\n            <div>\n              <div className={`text-2xl font-bold ${isVeryLowTime ? 'text-red-400' : isLowTime ? 'text-yellow-400' : 'text-blue-400'}`}>\n                {turnTimeRemaining}s\n              </div>\n              <div className=\"w-24 h-2 bg-gray-700 rounded-full overflow-hidden mt-1\">\n                <div \n                  className={`h-full transition-all duration-300 ${\n                    isVeryLowTime ? 'bg-red-500' : isLowTime ? 'bg-yellow-500' : 'bg-blue-500'\n                  }`}\n                  style={{ width: `${percentage}%` }}\n                />\n              </div>\n            </div>\n          </div>\n        </CardContent>\n      </Card>\n    </div>\n  );\n}\n","size_bytes":1590},"client/src/lib/stores/useSettings.tsx":{"content":"import { create } from 'zustand';\nimport { persist } from 'zustand/middleware';\n\nexport interface GameSettings {\n  // Money & Stakes\n  moneyPerPoint: number;\n  moneyPerPunt: number;\n  \n  // Game Rules\n  startingScore: number;\n  winningScore: number;\n  eliminationScore: number;\n  \n  // Multiplayer\n  turnTimeLimit: number; // in seconds, 0 = no limit\n  autoPlayDisconnected: boolean;\n  \n  // Audio\n  soundEnabled: boolean;\n  musicEnabled: boolean;\n  \n  // AI\n  defaultAIDifficulty: 'easy' | 'medium' | 'hard';\n}\n\ninterface SettingsState extends GameSettings {\n  resetToDefaults: () => void;\n  updateSettings: (settings: Partial<GameSettings>) => void;\n}\n\nconst defaultSettings: GameSettings = {\n  moneyPerPoint: 0.25,\n  moneyPerPunt: 1.00,\n  startingScore: 16,\n  winningScore: 0,\n  eliminationScore: 32,\n  turnTimeLimit: 30, // 30 seconds per turn\n  autoPlayDisconnected: true,\n  soundEnabled: true,\n  musicEnabled: true,\n  defaultAIDifficulty: 'hard'\n};\n\nexport const useSettings = create<SettingsState>()(\n  persist(\n    (set) => ({\n      ...defaultSettings,\n      \n      resetToDefaults: () => set(defaultSettings),\n      \n      updateSettings: (newSettings: Partial<GameSettings>) => \n        set((state) => ({ ...state, ...newSettings }))\n    }),\n    {\n      name: 'shnarps-settings'\n    }\n  )\n);\n","size_bytes":1302},"client/src/components/TransactionHistory.tsx":{"content":"import { useWallet, Transaction } from '@/lib/stores/useWallet';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle } from '@/components/ui/dialog';\nimport { Button } from '@/components/ui/button';\nimport { ScrollArea } from '@/components/ui/scroll-area';\nimport { Wallet, TrendingUp, TrendingDown, RotateCcw } from 'lucide-react';\n\ninterface TransactionHistoryProps {\n  open: boolean;\n  onClose: () => void;\n}\n\nexport function TransactionHistory({ open, onClose }: TransactionHistoryProps) {\n  const { transactions, balance, resetWallet } = useWallet();\n\n  const formatDate = (timestamp: number) => {\n    return new Date(timestamp).toLocaleString('en-US', {\n      month: 'short',\n      day: 'numeric',\n      year: 'numeric',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  const handleReset = () => {\n    if (confirm('Are you sure you want to reset your wallet? This will clear all transaction history and reset your balance to the starting amount.')) {\n      resetWallet();\n    }\n  };\n\n  return (\n    <Dialog open={open} onOpenChange={onClose}>\n      <DialogContent className=\"max-w-2xl max-h-[90vh] bg-gray-100\">\n        <DialogHeader>\n          <DialogTitle className=\"text-2xl text-gray-900 flex items-center gap-2\">\n            <Wallet className=\"h-6 w-6\" />\n            Game Statistics\n          </DialogTitle>\n        </DialogHeader>\n\n        <div className=\"space-y-4\">\n          {/* Current Balance */}\n          <div className=\"p-4 bg-green-50 rounded-lg border-2 border-green-200\">\n            <div className=\"flex items-center justify-between\">\n              <span className=\"text-sm font-medium text-green-700\">Current Balance</span>\n              <span className=\"text-2xl font-bold text-green-700\">ðŸª™ {balance.toFixed(2)}</span>\n            </div>\n          </div>\n\n          {/* Transactions List */}\n          <div className=\"space-y-2\">\n            <div className=\"flex items-center justify-between\">\n              <h3 className=\"font-semibold text-gray-900\">Recent Transactions</h3>\n              <Button \n                variant=\"outline\" \n                size=\"sm\" \n                onClick={handleReset}\n                className=\"text-xs\"\n              >\n                <RotateCcw className=\"h-3 w-3 mr-1\" />\n                Reset Wallet\n              </Button>\n            </div>\n\n            <ScrollArea className=\"h-[400px] rounded-lg border bg-white p-2\">\n              {transactions.length === 0 ? (\n                <div className=\"flex flex-col items-center justify-center h-full text-center p-8\">\n                  <Wallet className=\"h-16 w-16 text-gray-300 mb-4\" />\n                  <p className=\"text-gray-500 font-medium\">No transactions yet</p>\n                  <p className=\"text-sm text-gray-400 mt-2\">\n                    Your wins and losses will appear here\n                  </p>\n                </div>\n              ) : (\n                <div className=\"space-y-2\">\n                  {transactions.map((tx: Transaction) => (\n                    <div\n                      key={tx.id}\n                      className={`p-3 rounded-lg border ${\n                        tx.type === 'win'\n                          ? 'bg-green-50 border-green-200'\n                          : tx.type === 'loss'\n                          ? 'bg-red-50 border-red-200'\n                          : 'bg-gray-50 border-gray-200'\n                      }`}\n                    >\n                      <div className=\"flex items-start justify-between\">\n                        <div className=\"flex items-start gap-3\">\n                          {tx.type === 'win' ? (\n                            <TrendingUp className=\"h-5 w-5 text-green-600 mt-0.5\" />\n                          ) : tx.type === 'loss' ? (\n                            <TrendingDown className=\"h-5 w-5 text-red-600 mt-0.5\" />\n                          ) : (\n                            <RotateCcw className=\"h-5 w-5 text-gray-600 mt-0.5\" />\n                          )}\n                          <div>\n                            <p className=\"font-medium text-gray-900\">{tx.description}</p>\n                            <p className=\"text-xs text-gray-500 mt-1\">{formatDate(tx.date)}</p>\n                          </div>\n                        </div>\n                        <div className=\"text-right\">\n                          <p\n                            className={`text-lg font-bold ${\n                              tx.type === 'win'\n                                ? 'text-green-600'\n                                : tx.type === 'loss'\n                                ? 'text-red-600'\n                                : 'text-gray-600'\n                            }`}\n                          >\n                            {tx.type === 'win' ? '+' : tx.type === 'loss' ? '-' : ''}ðŸª™\n                            {tx.amount.toFixed(2)}\n                          </p>\n                          <p className=\"text-xs text-gray-500 mt-1\">\n                            Balance: ðŸª™ {tx.balance.toFixed(2)}\n                          </p>\n                        </div>\n                      </div>\n                    </div>\n                  ))}\n                </div>\n              )}\n            </ScrollArea>\n          </div>\n        </div>\n      </DialogContent>\n    </Dialog>\n  );\n}\n","size_bytes":5298},"test-simulation.ts":{"content":"import { useShnarps } from './client/src/lib/stores/useShnarps';\n\ninterface GameResult {\n  gameNumber: number;\n  status: 'completed' | 'frozen' | 'error';\n  phase: string;\n  rounds: number;\n  error?: string;\n  completedTricks?: number;\n  totalTricks?: number;\n}\n\nasync function runGameSimulation(gameNumber: number): Promise<GameResult> {\n  console.log(`\\n========== GAME ${gameNumber} START ==========`);\n  \n  const result: GameResult = {\n    gameNumber,\n    status: 'completed',\n    phase: 'setup',\n    rounds: 0\n  };\n\n  try {\n    const store = useShnarps.getState();\n    \n    // Reset to initial state\n    store.resetGame();\n    \n    // Set up multiplayer mode\n    store.setMultiplayerMode('online', true);\n    \n    // Add 5 players (1 human + 4 AI)\n    store.addPlayer('TestPlayer', false);\n    store.addPlayer('AI_Bot1', true, 'medium');\n    store.addPlayer('AI_Bot2', true, 'medium');\n    store.addPlayer('AI_Bot3', true, 'medium');\n    store.addPlayer('AI_Bot4', true, 'medium');\n    \n    // Enable simulation mode for faster play\n    store.setSimulating(true);\n    \n    // Start the game\n    store.startGame();\n    \n    let roundCount = 0;\n    let iterationCount = 0;\n    const maxIterations = 1000; // Safety limit\n    \n    // Monitor game until completion\n    while (iterationCount < maxIterations) {\n      iterationCount++;\n      await new Promise(resolve => setTimeout(resolve, 50)); // Check every 50ms\n      \n      const state = useShnarps.getState();\n      result.phase = state.gamePhase;\n      \n      // Check if game ended\n      if (state.gamePhase === 'ended') {\n        result.rounds = roundCount;\n        console.log(`âœ… Game ${gameNumber} completed successfully after ${roundCount} rounds`);\n        break;\n      }\n      \n      // Count rounds\n      if (state.gamePhase === 'bidding' && state.completedTricks.length === 0) {\n        if (roundCount > 0 || iterationCount > 100) {\n          roundCount++;\n        }\n      }\n      \n      // Check for freeze conditions\n      if (state.gamePhase === 'hand_play') {\n        result.completedTricks = state.completedTricks.length;\n        result.totalTricks = 5;\n        \n        // If we've been in hand_play for too long without progress, might be frozen\n        if (iterationCount > 500 && state.completedTricks.length < 5) {\n          result.status = 'frozen';\n          result.error = `Frozen in hand_play with ${state.completedTricks.length}/5 tricks complete`;\n          console.log(`âŒ Game ${gameNumber} FROZEN: ${result.error}`);\n          break;\n        }\n      }\n      \n      // Check for everyone_sat freeze\n      if (state.gamePhase === 'everyone_sat' && iterationCount > 100) {\n        result.status = 'frozen';\n        result.error = 'Frozen in everyone_sat phase';\n        console.log(`âŒ Game ${gameNumber} FROZEN: ${result.error}`);\n        break;\n      }\n    }\n    \n    if (iterationCount >= maxIterations) {\n      result.status = 'frozen';\n      result.error = `Hit iteration limit (${maxIterations}) in phase ${result.phase}`;\n      console.log(`âŒ Game ${gameNumber} TIMEOUT: ${result.error}`);\n    }\n    \n  } catch (error) {\n    result.status = 'error';\n    result.error = error instanceof Error ? error.message : String(error);\n    console.log(`âŒ Game ${gameNumber} ERROR: ${result.error}`);\n  }\n  \n  console.log(`========== GAME ${gameNumber} END ==========\\n`);\n  return result;\n}\n\nasync function runAllSimulations() {\n  console.log('\\nðŸŽ® STARTING 10 GAME SIMULATIONS\\n');\n  \n  const results: GameResult[] = [];\n  \n  for (let i = 1; i <= 10; i++) {\n    const result = await runGameSimulation(i);\n    results.push(result);\n    \n    // Brief pause between games\n    await new Promise(resolve => setTimeout(resolve, 500));\n  }\n  \n  // Generate report\n  console.log('\\n' + '='.repeat(60));\n  console.log('ðŸ“Š SIMULATION REPORT');\n  console.log('='.repeat(60) + '\\n');\n  \n  const completed = results.filter(r => r.status === 'completed').length;\n  const frozen = results.filter(r => r.status === 'frozen').length;\n  const errors = results.filter(r => r.status === 'error').length;\n  \n  console.log(`Total Games: 10`);\n  console.log(`âœ… Completed: ${completed}`);\n  console.log(`â„ï¸  Frozen: ${frozen}`);\n  console.log(`âŒ Errors: ${errors}`);\n  console.log('');\n  \n  if (frozen > 0) {\n    console.log('Frozen Games Details:');\n    results.filter(r => r.status === 'frozen').forEach(r => {\n      console.log(`  Game ${r.gameNumber}: ${r.error} (Phase: ${r.phase})`);\n    });\n    console.log('');\n  }\n  \n  if (errors > 0) {\n    console.log('Error Games Details:');\n    results.filter(r => r.status === 'error').forEach(r => {\n      console.log(`  Game ${r.gameNumber}: ${r.error}`);\n    });\n    console.log('');\n  }\n  \n  console.log('='.repeat(60) + '\\n');\n  \n  return results;\n}\n\n// Run the simulations\nrunAllSimulations().then(results => {\n  const successRate = (results.filter(r => r.status === 'completed').length / 10) * 100;\n  console.log(`\\nðŸŽ¯ Success Rate: ${successRate}%\\n`);\n  process.exit(0);\n}).catch(err => {\n  console.error('Fatal error running simulations:', err);\n  process.exit(1);\n});\n","size_bytes":5103},"server/ai/cardHelpers.ts":{"content":"// Helper functions for card validation\nimport { Card, Player } from './aiEngine';\n\nexport function canPlayerSit(player: Player, bid: number, trumpSuit: string | null): boolean {\n  // Cannot sit if bid is 1\n  if (bid === 1) return false;\n  \n  // Cannot sit if trump is spades\n  if (trumpSuit === 'spades') return false;\n  \n  // Cannot sit if already musty (2 consecutive sits)\n  if (player.consecutiveSits >= 2) return false;\n  \n  return true;\n}\n\nexport function isValidPlay(card: Card, hand: Card[], currentTrick: { playerId: string; card: Card }[], trumpSuit: string | null): boolean {\n  if (!hand.some(c => c.suit === card.suit && c.value === card.value)) {\n    return false;\n  }\n  \n  if (currentTrick.length === 0) {\n    return true;\n  }\n  \n  const leadSuit = currentTrick[0].card.suit;\n  const hasLeadSuit = hand.some(c => c.suit === leadSuit);\n  \n  if (hasLeadSuit && card.suit !== leadSuit) {\n    return false;\n  }\n  \n  return true;\n}\n\nexport function getPlayableCards(hand: Card[], currentTrick: { playerId: string; card: Card }[], trumpSuit: string | null): Card[] {\n  if (currentTrick.length === 0) {\n    return hand;\n  }\n  \n  const leadSuit = currentTrick[0].card.suit;\n  const cardsOfLeadSuit = hand.filter(c => c.suit === leadSuit);\n  \n  if (cardsOfLeadSuit.length > 0) {\n    return cardsOfLeadSuit;\n  }\n  \n  return hand;\n}\n","size_bytes":1337},"TEST_REPORT.md":{"content":"# Shnarps Multiplayer Test Report\n**Date:** October 27, 2025  \n**Test Type:** Manual Online Multiplayer with AI Bots  \n**Target:** 10 full game completions\n\n---\n\n## Test Configuration\n- **Mode:** Online Multiplayer\n- **Players:** 1 Human + 4 AI Bots (Medium difficulty)\n- **Simulation:** Disabled (normal speed for observation)\n\n---\n\n## Test Results\n\n### Game 1\n- **Status:** âœ… COMPLETED\n- **Rounds Completed:** Multiple (until game_over)\n- **Issues Found:** None\n- **Notes:** Clean run, no freezes or errors detected \n\n### Game 2 (Multi-Device Test)\n- **Status:** â„ï¸ FROZEN \n- **Rounds Completed:** 0 (froze after first hand - all 5 tricks)\n- **Issues Found:** Freeze at hand completion, server crashed with EADDRINUSE\n- **Notes:** Laptop + phone test. Freeze happened when transitioning from hand_play to new round. Logs lost due to server crash. Pattern: after all 5 tricks complete, game should start new round but freezes instead \n\n### Game 3\n- **Status:** \n- **Rounds Completed:** \n- **Issues Found:** \n- **Notes:** \n\n### Game 4\n- **Status:** \n- **Rounds Completed:** \n- **Issues Found:** \n- **Notes:** \n\n### Game 5\n- **Status:** \n- **Rounds Completed:** \n- **Issues Found:** \n- **Notes:** \n\n### Game 6\n- **Status:** \n- **Rounds Completed:** \n- **Issues Found:** \n- **Notes:** \n\n### Game 7\n- **Status:** \n- **Rounds Completed:** \n- **Issues Found:** \n- **Notes:** \n\n### Game 8\n- **Status:** \n- **Rounds Completed:** \n- **Issues Found:** \n- **Notes:** \n\n### Game 9\n- **Status:** \n- **Rounds Completed:** \n- **Issues Found:** \n- **Notes:** \n\n### Game 10\n- **Status:** \n- **Rounds Completed:** \n- **Issues Found:** \n- **Notes:** \n\n---\n\n## Summary\n\n### Success Rate\n- **Completed:** 0/10\n- **Frozen:** 0/10\n- **Errors:** 0/10\n\n### Common Issues\n(To be filled based on patterns)\n\n### Bug Categories\n1. **Duplicate Card Plays:** \n2. **Trick Completion Freezes:** \n3. **Everyone-Sat Freezes:** \n4. **Score Calculation Errors:** \n5. **Phase Transition Errors:** \n\n---\n\n## Recommendations\n(To be filled after testing)\n","size_bytes":2021},"server/ai/gameLoop.ts":{"content":"// Server-side game loop for AI players\nimport { makeAIBid, chooseAITrumpSuit, makeAISitPlayDecision, chooseAICardToPlay } from './aiEngine';\nimport { canPlayerSit, getPlayableCards } from './cardHelpers';\n\nexport interface GameRoom {\n  roomCode: string;\n  players: Map<string, any>;\n  gameState: any;\n}\n\n// Import the applyGameAction function from websocket module\n// This will be set by websocket.ts\nlet applyGameActionFn: ((room: GameRoom, action: string, payload: any) => void) | null = null;\n\nexport function setApplyGameAction(fn: (room: GameRoom, action: string, payload: any) => void) {\n  applyGameActionFn = fn;\n}\n\n// Execute AI turn for the current player if they're an AI\nexport function processAITurn(room: GameRoom, broadcast: (message: any) => void): void {\n  // Check if current player is AI - if not, stop the loop\n  const playerArray = Array.from(room.players.values());\n  const currentPlayer = playerArray[room.gameState.currentPlayerIndex];\n  \n  if (!currentPlayer || !currentPlayer.isAI) {\n    // Not AI's turn, stop processing\n    return;\n  }\n  \n  const gamePhase = room.gameState.gamePhase;\n  \n  // Only proceed in these phases\n  if (!['bidding', 'trump_selection', 'sit_pass', 'hand_play', 'everyone_sat'].includes(gamePhase)) {\n    return;\n  }\n  \n  // Add small delay to make AI feel more natural\n  setTimeout(() => {\n    try {\n      // Re-check that it's still this player's turn (state may have changed)\n      const updatedPlayerArray = Array.from(room.players.values());\n      const updatedPlayer = updatedPlayerArray[room.gameState.currentPlayerIndex];\n      if (!updatedPlayer || updatedPlayer.id !== currentPlayer.id) {\n        // Player turn changed, don't process\n        return;\n      }\n      \n      switch (gamePhase) {\n        case 'bidding': {\n          const bidValues = Array.from(room.gameState.bids.values()) as number[];\n          const currentHighestBid = Math.max(0, ...bidValues);\n          const isDealer = room.gameState.currentPlayerIndex === room.gameState.dealerIndex;\n          const highestBidderId = room.gameState.highestBidder;\n          const difficulty = currentPlayer.aiDifficulty || 'medium';\n          \n          const aiBid = makeAIBid(\n            currentPlayer.hand,\n            currentHighestBid,\n            isDealer,\n            playerArray.length,\n            currentPlayer.id,\n            room.gameState.scores,\n            highestBidderId,\n            difficulty\n          );\n          \n          console.log(`ðŸ¤– AI ${currentPlayer.name} bids ${aiBid}`);\n          \n          // Apply action to server state\n          if (applyGameActionFn) {\n            applyGameActionFn(room, 'bid', { playerId: currentPlayer.id, bid: aiBid });\n          }\n          \n          // Broadcast bid action to all clients\n          broadcast({\n            type: 'GAME_STATE_UPDATE',\n            action: 'bid',\n            payload: { playerId: currentPlayer.id, bid: aiBid }\n          });\n          \n          // Continue processing next AI turn\n          setTimeout(() => processAITurn(room, broadcast), 500);\n          break;\n        }\n        \n        case 'trump_selection': {\n          const difficulty = currentPlayer.aiDifficulty || 'medium';\n          const aiTrump = chooseAITrumpSuit(currentPlayer.hand, difficulty);\n          \n          console.log(`ðŸ¤– AI ${currentPlayer.name} chooses ${aiTrump} as trump`);\n          \n          // Apply action to server state\n          if (applyGameActionFn) {\n            applyGameActionFn(room, 'trump', { suit: aiTrump });\n          }\n          \n          broadcast({\n            type: 'GAME_STATE_UPDATE',\n            action: 'trump',\n            payload: { suit: aiTrump }\n          });\n          \n          // Continue processing next AI turn\n          setTimeout(() => processAITurn(room, broadcast), 500);\n          break;\n        }\n        \n        case 'sit_pass': {\n          const bidValues = Array.from(room.gameState.bids.values()) as number[];\n          const highestBid = Math.max(0, ...bidValues);\n          const canSit = canPlayerSit(currentPlayer, highestBid, room.gameState.trumpSuit);\n          const currentScore = room.gameState.scores.get(currentPlayer.id);\n          const difficulty = currentPlayer.aiDifficulty || 'medium';\n          \n          const decision = makeAISitPlayDecision(\n            currentPlayer,\n            currentPlayer.hand,\n            room.gameState.trumpSuit,\n            highestBid,\n            canSit,\n            currentScore,\n            room.gameState.scores,\n            difficulty\n          );\n          \n          console.log(`ðŸ¤– AI ${currentPlayer.name} decides to ${decision}`);\n          \n          // Update consecutiveSits on server\n          if (decision === 'play') {\n            currentPlayer.consecutiveSits = 0;\n          } else {\n            currentPlayer.consecutiveSits += 1;\n          }\n          \n          // Apply action to server state\n          if (applyGameActionFn) {\n            applyGameActionFn(room, 'sitpass', { playerId: currentPlayer.id, decision });\n          }\n          \n          broadcast({\n            type: 'GAME_STATE_UPDATE',\n            action: 'sitpass',\n            payload: { playerId: currentPlayer.id, decision }\n          });\n          \n          // Continue processing next AI turn\n          setTimeout(() => processAITurn(room, broadcast), 500);\n          break;\n        }\n        \n        case 'hand_play': {\n          const playableCards = getPlayableCards(\n            currentPlayer.hand,\n            room.gameState.currentTrick,\n            room.gameState.trumpSuit\n          );\n          const difficulty = currentPlayer.aiDifficulty || 'medium';\n          \n          const cardToPlay = chooseAICardToPlay(\n            currentPlayer.hand,\n            room.gameState.currentTrick,\n            room.gameState.trumpSuit,\n            playableCards,\n            difficulty\n          );\n          \n          console.log(`ðŸ¤– AI ${currentPlayer.name} plays ${cardToPlay.rank}${cardToPlay.suit}`);\n          \n          // Apply action to server state\n          if (applyGameActionFn) {\n            applyGameActionFn(room, 'playcard', { playerId: currentPlayer.id, card: cardToPlay });\n          }\n          \n          broadcast({\n            type: 'GAME_STATE_UPDATE',\n            action: 'playcard',\n            payload: { playerId: currentPlayer.id, card: cardToPlay }\n          });\n          \n          // Continue processing next AI turn\n          setTimeout(() => processAITurn(room, broadcast), 500);\n          break;\n        }\n        \n        case 'everyone_sat': {\n          // AI strategy: Usually better to take -5 yourself (moves toward winning)\n          // But if very close to losing (score >= 28), give +5 to others instead\n          const currentScore = room.gameState.scores.get(currentPlayer.id) || 16;\n          const choice = currentScore >= 28 ? 'others' : 'self';\n          \n          console.log(`ðŸ¤– AI ${currentPlayer.name} chooses penalty: ${choice}`);\n          \n          // Apply action to server state\n          if (applyGameActionFn) {\n            applyGameActionFn(room, 'penalty', { choice });\n          }\n          \n          broadcast({\n            type: 'GAME_STATE_UPDATE',\n            action: 'penalty',\n            payload: { choice }\n          });\n          \n          // Continue processing next AI turn\n          setTimeout(() => processAITurn(room, broadcast), 500);\n          break;\n        }\n      }\n    } catch (error) {\n      console.error('âŒ Error processing AI turn:', error);\n    }\n  }, 800); // 800ms delay for natural feel\n}\n","size_bytes":7584},"server/ai/aiEngine.ts":{"content":"// Server-side AI decision engine\n// Ported from client/src/lib/game/aiPlayer.ts\n\nexport interface Card {\n  suit: 'hearts' | 'diamonds' | 'clubs' | 'spades';\n  rank: 'A' | 'K' | 'Q' | 'J' | '10' | '9' | '8' | '7' | '6' | '5' | '4' | '3' | '2';\n  value: number;\n}\n\nexport interface Player {\n  id: string;\n  name: string;\n  hand: Card[];\n  isActive: boolean;\n  consecutiveSits: number;\n  isAI: boolean;\n  aiDifficulty?: 'easy' | 'medium' | 'hard';\n}\n\nexport type AIDifficulty = 'easy' | 'medium' | 'hard';\n\n// Evaluate hand strength (0-5 scale)\nexport function evaluateHandStrength(hand: Card[], trumpSuit: string | null): number {\n  let strength = 0;\n  \n  // Count high cards\n  for (const card of hand) {\n    if (card.value >= 12) { // J, Q, K, A\n      strength += (card.suit === trumpSuit ? 1.5 : 1);\n    } else if (card.value >= 10) {\n      strength += (card.suit === trumpSuit ? 1 : 0.5);\n    }\n  }\n  \n  // Bonus for trump cards\n  if (trumpSuit) {\n    const trumpCount = hand.filter(c => c.suit === trumpSuit).length;\n    strength += trumpCount * 0.5;\n  }\n  \n  return Math.min(5, Math.floor(strength));\n}\n\n// AI bidding strategy\nexport function makeAIBid(\n  hand: Card[], \n  currentHighestBid: number,\n  isDealer: boolean,\n  playerCount: number,\n  currentPlayerId: string,\n  allScores: Map<string, number>,\n  highestBidderId: string | null,\n  difficulty: AIDifficulty = 'medium'\n): number {\n  // Evaluate hand without knowing trump yet\n  const avgStrength = (\n    evaluateHandStrength(hand, 'hearts') +\n    evaluateHandStrength(hand, 'diamonds') +\n    evaluateHandStrength(hand, 'clubs') +\n    evaluateHandStrength(hand, 'spades')\n  ) / 4;\n  \n  // Check if opponent with current highest bid is close to winning\n  const currentScore = allScores.get(currentPlayerId) || 16;\n  const highestBidderScore = highestBidderId ? (allScores.get(highestBidderId) || 16) : 16;\n  const someoneCloseToWinning = highestBidderScore <= 3;\n  \n  // DEFENSIVE BIDDING STRATEGY: Block players near winning from calling trump\n  const canAffordPunt = currentScore >= 8; // If at 8+, a punt (+5) won't put you in danger\n  \n  if (someoneCloseToWinning && canAffordPunt && difficulty !== 'easy') {\n    if (difficulty === 'hard') {\n      // Hard: Always tries to block if possible and can afford it\n      if (currentHighestBid < 5 && avgStrength >= 1.5) {\n        // Overbid to prevent them from calling trump\n        return Math.min(5, currentHighestBid + 1);\n      }\n    } else if (difficulty === 'medium') {\n      // Medium: Sometimes blocks, 60% of the time\n      if (currentHighestBid < 5 && avgStrength >= 2 && Math.random() > 0.4) {\n        return Math.min(5, currentHighestBid + 1);\n      }\n    }\n  }\n  \n  // Adjust conservativeness based on player count\n  let conservativenessAdjustment = 0;\n  if (playerCount >= 7) {\n    conservativenessAdjustment = 2;\n  } else if (playerCount >= 5) {\n    conservativenessAdjustment = 1;\n  }\n  \n  // Difficulty-based bid adjustments\n  let difficultyAdjustment = 0;\n  \n  if (difficulty === 'easy') {\n    // Easy: Makes poor bids, often overbids or underbids\n    difficultyAdjustment = Math.random() > 0.5 ? 1 : -1; // Random +1 or -1\n  } else if (difficulty === 'medium') {\n    // Medium: Occasionally makes mistakes\n    difficultyAdjustment = Math.random() > 0.7 ? 1 : 0; // 30% chance of +1\n  } else { // hard\n    // Hard: Optimal play, no random errors\n    difficultyAdjustment = 0;\n  }\n  \n  const adjustedBid = Math.max(0, Math.min(5, Math.floor(avgStrength) - conservativenessAdjustment + difficultyAdjustment));\n  \n  // Only bid if we can beat current highest or if we're confident\n  if (adjustedBid > currentHighestBid || (isDealer && adjustedBid === currentHighestBid + 1)) {\n    return adjustedBid;\n  }\n  \n  // NOTE: Bluffing removed - it doesn't make sense in this game since bluffing = punting.\n  // The only strategic \"bluff\" is defensive bidding (already handled above) to block\n  // players close to winning from calling trump.\n  \n  return 0; // Pass\n}\n\n// AI trump suit selection\nexport function chooseAITrumpSuit(hand: Card[], difficulty: AIDifficulty = 'medium'): string {\n  const suits = ['hearts', 'diamonds', 'clubs', 'spades'] as const;\n  let bestSuit: typeof suits[number] = suits[0];\n  let bestStrength = 0;\n  \n  for (const suit of suits) {\n    const strength = evaluateHandStrength(hand, suit);\n    if (strength > bestStrength) {\n      bestStrength = strength;\n      bestSuit = suit;\n    }\n  }\n  \n  // Easy: Sometimes picks randomly instead of optimal\n  if (difficulty === 'easy' && Math.random() > 0.5) {\n    return suits[Math.floor(Math.random() * suits.length)];\n  }\n  \n  // Medium: Occasionally picks suboptimal suit\n  if (difficulty === 'medium' && Math.random() > 0.8) {\n    const otherSuits = suits.filter(s => s !== bestSuit);\n    return otherSuits[Math.floor(Math.random() * otherSuits.length)];\n  }\n  \n  // Hard: Always picks optimal\n  return bestSuit;\n}\n\n// AI sit/play decision\nexport function makeAISitPlayDecision(\n  player: Player,\n  hand: Card[],\n  trumpSuit: string | null,\n  highestBid: number,\n  canSit: boolean,\n  currentScore: number | undefined,\n  allScores: Map<string, number>,\n  difficulty: AIDifficulty = 'medium'\n): 'sit' | 'play' {\n  if (!canSit) return 'play';\n  \n  const handStrength = evaluateHandStrength(hand, trumpSuit);\n  \n  // Check if any opponent is close to winning (score â‰¤ 3)\n  // Strategy: Gang up on them by playing to try to punt them\n  const opponentScores = Array.from(allScores.entries()).filter(([id]) => id !== player.id);\n  const someoneCloseToWinning = opponentScores.some(([_, score]) => score <= 3);\n  \n  // Easy: Makes poor sit/play decisions (often sits with good hands or plays with bad)\n  if (difficulty === 'easy') {\n    // Easy bots don't recognize the collusion strategy\n    if (Math.random() > 0.6) {\n      return Math.random() > 0.5 ? 'sit' : 'play'; // Random 40% of the time\n    }\n  }\n  \n  // COLLUSION STRATEGY: If someone is at 3 or lower, be aggressive and play\n  if (someoneCloseToWinning && difficulty !== 'easy') {\n    if (difficulty === 'hard') {\n      // Hard: Always plays to gang up unless hand is completely terrible\n      if (handStrength === 0 && player.consecutiveSits === 0 && Math.random() > 0.7) {\n        return 'sit'; // Only 30% chance to sit even with terrible hand\n      }\n      return 'play';\n    } else if (difficulty === 'medium') {\n      // Medium: Usually plays, but occasionally sits\n      if (handStrength >= 1 || player.consecutiveSits >= 1) {\n        return 'play';\n      }\n      if (Math.random() > 0.5) {\n        return 'play'; // 50% chance to play even with weak hand\n      }\n      return 'sit';\n    }\n  }\n  \n  // If at 4 or lower, avoid sitting (sitting gives +1 penalty)\n  if (currentScore !== undefined && currentScore <= 4) {\n    if (difficulty === 'hard') {\n      // Hard: Only sits with terrible hand\n      if (handStrength === 0 && player.consecutiveSits === 0) {\n        return 'sit';\n      }\n      return 'play';\n    } else {\n      // Easy/Medium: Sometimes makes mistakes\n      if (handStrength <= 1 && player.consecutiveSits === 0 && Math.random() > (difficulty === 'easy' ? 0.3 : 0.6)) {\n        return 'sit';\n      }\n      return 'play';\n    }\n  }\n  \n  // Medium: Uses basic strategy\n  if (difficulty === 'medium') {\n    if (handStrength >= 2) return 'play';\n    if (player.consecutiveSits >= 1) return 'play';\n    return 'sit';\n  }\n  \n  // Hard: Optimal strategy considering all factors\n  if (difficulty === 'hard') {\n    if (handStrength >= 3) return 'play';\n    if (player.consecutiveSits >= 1) return 'play';\n    if (handStrength <= 1) return 'sit';\n    return 'play';\n  }\n  \n  // Easy: Poor default strategy\n  return handStrength >= 3 ? 'play' : 'sit';\n}\n\n// AI card play selection\nexport function chooseAICardToPlay(\n  hand: Card[],\n  currentTrick: { playerId: string; card: Card }[],\n  trumpSuit: string | null,\n  playableCards: Card[],\n  difficulty: AIDifficulty = 'medium'\n): Card {\n  if (playableCards.length === 0) return hand[0];\n  if (playableCards.length === 1) return playableCards[0];\n  \n  // Easy: Often plays random cards\n  if (difficulty === 'easy' && Math.random() > 0.4) {\n    return playableCards[Math.floor(Math.random() * playableCards.length)];\n  }\n  \n  // If leading\n  if (currentTrick.length === 0) {\n    const trumpCards = playableCards.filter(c => c.suit === trumpSuit);\n    const nonTrumpCards = playableCards.filter(c => c.suit !== trumpSuit);\n    \n    if (difficulty === 'hard') {\n      // Lead Ace of trump if available\n      const trumpAce = trumpCards.find(c => c.value === 14);\n      if (trumpAce) return trumpAce;\n      \n      // Lead Ace of non-trump if available\n      const nonTrumpAce = nonTrumpCards.find(c => c.value === 14);\n      if (nonTrumpAce) return nonTrumpAce;\n      \n      // If you have Ace of trump, can safely lead K or Q\n      const hasAceOfTrump = trumpCards.some(c => c.value === 14);\n      if (hasAceOfTrump) {\n        const protectedHighTrumps = trumpCards.filter(c => c.value === 12 || c.value === 13);\n        if (protectedHighTrumps.length > 0) {\n          return protectedHighTrumps.reduce((highest, card) => \n            card.value > highest.value ? card : highest\n          );\n        }\n      }\n      \n      // If multiple trump cards, lead low trump\n      if (trumpCards.length >= 2) {\n        return trumpCards.reduce((lowest, card) => \n          card.value < lowest.value ? card : lowest\n        );\n      }\n      \n      // Lead lowest non-trump\n      if (nonTrumpCards.length > 0) {\n        return nonTrumpCards.reduce((lowest, card) => \n          card.value < lowest.value ? card : lowest\n        );\n      }\n      \n      return playableCards.reduce((lowest, card) => \n        card.value < lowest.value ? card : lowest\n      );\n      \n    } else if (difficulty === 'medium') {\n      if (Math.random() > 0.1) {\n        const trumpAce = trumpCards.find(c => c.value === 14);\n        if (trumpAce) return trumpAce;\n        \n        const nonTrumpAce = nonTrumpCards.find(c => c.value === 14);\n        if (nonTrumpAce) return nonTrumpAce;\n        \n        const hasAceOfTrump = trumpCards.some(c => c.value === 14);\n        if (hasAceOfTrump) {\n          const protectedHighTrumps = trumpCards.filter(c => c.value === 12 || c.value === 13);\n          if (protectedHighTrumps.length > 0) {\n            return protectedHighTrumps.reduce((highest, card) => \n              card.value > highest.value ? card : highest\n            );\n          }\n        }\n        \n        if (trumpCards.length >= 2) {\n          return trumpCards.reduce((lowest, card) => \n            card.value < lowest.value ? card : lowest\n          );\n        }\n        \n        return playableCards.reduce((lowest, card) => \n          card.value < lowest.value ? card : lowest\n        );\n      }\n      \n      return playableCards[Math.floor(Math.random() * playableCards.length)];\n    }\n    \n    // Easy: Poor strategy\n    if (Math.random() > 0.4) {\n      return playableCards[Math.floor(Math.random() * playableCards.length)];\n    }\n    return playableCards.reduce((highest, card) => \n      card.value > highest.value ? card : highest\n    );\n  }\n  \n  const leadSuit = currentTrick[0].card.suit;\n  const highestCardInTrick = currentTrick.reduce((highest, play) => \n    play.card.value > highest.card.value ? play : highest\n  );\n  \n  const trumpCardsInTrick = trumpSuit \n    ? currentTrick.filter(play => play.card.suit === trumpSuit)\n    : [];\n  const highestTrumpInTrick = trumpCardsInTrick.length > 0\n    ? trumpCardsInTrick.reduce((highest, play) => \n        play.card.value > highest.card.value ? play : highest\n      )\n    : null;\n  \n  const winningCards = playableCards.filter(card => {\n    if (trumpSuit && card.suit === trumpSuit) {\n      if (highestTrumpInTrick) {\n        return card.value > highestTrumpInTrick.card.value;\n      }\n      if (highestCardInTrick.card.suit !== trumpSuit) {\n        return true;\n      }\n      return card.value > highestCardInTrick.card.value;\n    }\n    if (card.suit === leadSuit && highestCardInTrick.card.suit === leadSuit && !highestTrumpInTrick) {\n      return card.value > highestCardInTrick.card.value;\n    }\n    return false;\n  });\n  \n  if (difficulty === 'hard') {\n    if (winningCards.length > 0) {\n      return winningCards.reduce((lowest, card) => \n        card.value < lowest.value ? card : lowest\n      );\n    }\n    return playableCards.reduce((lowest, card) => \n      card.value < lowest.value ? card : lowest\n    );\n  }\n  \n  if (difficulty === 'medium') {\n    if (winningCards.length > 0 && Math.random() > 0.2) {\n      return winningCards.reduce((lowest, card) => \n        card.value < lowest.value ? card : lowest\n      );\n    }\n    return playableCards.reduce((lowest, card) => \n      card.value < lowest.value ? card : lowest\n    );\n  }\n  \n  // Easy: Poor strategy\n  if (winningCards.length > 0 && Math.random() > 0.6) {\n    return winningCards[Math.floor(Math.random() * winningCards.length)];\n  }\n  return playableCards[Math.floor(Math.random() * playableCards.length)];\n}\n","size_bytes":13022}},"version":2}